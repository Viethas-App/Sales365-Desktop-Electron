{"version":3,"file":"default-src_app_sales_menu_developers_online-payment_component_qr-banking-modal_qr-banking-mo-348d80.js","mappings":"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","sources":["./src/app/sales/menu/developers/online-payment/component/qr-banking-modal/qr-banking-modal.component.ts","./src/app/sales/menu/developers/online-payment/component/qr-banking-modal/qr-banking-modal.component.html"],"sourcesContent":["import { Component, Input, OnInit } from '@angular/core';\r\nimport { Router } from '@angular/router';\r\nimport { VhQuerySales, VhQueryDealer } from 'ionic-vhframeworks';\r\nimport { NzModalService } from 'ng-zorro-antd/modal';\r\nimport { VhComponent } from 'src/app/sales/components/vh-component/vh-component';\r\nimport { LanguageService } from 'src/app/sales/services/language.service';\r\n\r\n@Component({\r\n  selector: 'atw-qr-banking-modal',\r\n  templateUrl: './qr-banking-modal.component.html',\r\n  styleUrls: ['./qr-banking-modal.component.scss']\r\n})\r\nexport class QrBankingModalComponent implements OnInit {\r\n  @Input() total = 5000;\r\n  @Input() id_payment = ''\r\n  banks: any = []\r\n  urlImg: string = 'https://img.vietqr.io/image/<BANK_ID>-<ACCOUNT_NO>-<TEMPLATE>.png?amount=<AMOUNT>&addInfo=<DESCRIPTION>&accountName=<ACCOUNT_NAME>'\r\n  loading: boolean = false;\r\n  loading_banks: boolean = false;\r\n  bankAccounts: any[] = [];\r\n  bank_active = {}\r\n  constructor(\r\n    private vhQueryDealer:VhQueryDealer,\r\n    private vhQuerySales: VhQuerySales, \r\n    private vhComponent: VhComponent,\r\n    private languageService: LanguageService,\r\n    private router: Router,\r\n    private nzModalService:NzModalService\r\n  ) { }\r\n\r\n  ngOnInit() {\r\n\r\n    this.getBanks()\r\n  }\r\n\r\n  getBanks() {\r\n    this.vhQueryDealer.vietqr_getBanks()\r\n      .then((res: any) => {\r\n        // console.log('vietqr_getBanks', res)\r\n        if (res.vcode == 0) {\r\n          this.banks = res.data\r\n          this.getBanksAccount()\r\n        }\r\n      })\r\n      .catch((err) => console.error(err))\r\n\r\n  }\r\n  interval: any\r\n  ngAfterViewInit(): void {\r\n    this.interval = setInterval(() => {\r\n      this.vhQuerySales.getPayment(this.id_payment)\r\n        .then((payment: any) => {\r\n          console.log(payment);\r\n          \r\n          if (payment.payment_type == 1 && payment.paid_online) {\r\n            this.vhComponent.alertMessageDesktop(\"success\", this.languageService.translate(\"Thanh toán thành công\"))\r\n            this.nzModalService.closeAll()\r\n            this.router.navigate(['/sales/dashboard/developers/online-payment']);\r\n            clearInterval(this.interval)\r\n          }\r\n        })\r\n    }, 5000);\r\n\r\n  }\r\n\r\n  ngOnDestroy(): void {\r\n    //Called once, before the instance is destroyed.\r\n    //Add 'implements OnDestroy' to the class.\r\n    clearInterval(this.interval)\r\n  }\r\n\r\n  getBanksAccount() {\r\n    this.bankAccounts = [\r\n      // {\r\n      //   _id: \"1\",\r\n      //   acq_id: \"970436\",\r\n      //   account_name: \"CÔNG TY TNHH GIẢI PHÁP CÔNG NGHỆ VIETHAS\",\r\n      //   account_no: \"0441000644964\",\r\n      //   template: \"compact2\",\r\n      //   // branch: this.vhQuerySales.getDefaultBranch()._id\r\n      // },\r\n      {\r\n        _id: \"7\",\r\n        acq_id: \"970422\",\r\n        account_name: \"LE DUC HUY\",\r\n        account_no: \"0909925354\",\r\n        template: \"compact2\",\r\n        // branch: this.vhQuerySales.getDefaultBranch()._id\r\n      },\r\n      // {\r\n      //   _id: \"2\",\r\n      //   acq_id: \"970436\",\r\n      //   account_name: \"Nguyễn Hoàng Nam\",\r\n      //   account_no: \"0251002660414\",\r\n      //   template: \"compact2\",\r\n      //   // branch: this.vhQuerySales.getDefaultBranch()._id\r\n      // },\r\n      // {\r\n      //   _id: \"3\",\r\n      //   acq_id: \"970406\",\r\n      //   account_name: \"Nguyễn Hoàng Nam\",\r\n      //   account_no: \"0104782569\",\r\n      //   template: \"compact2\",\r\n      //   // branch: this.vhQuerySales.getDefaultBranch()._id\r\n      // },\r\n      // {\r\n      //   _id: \"4\",\r\n      //   acq_id: \"970403\",\r\n      //   account_name: \"Nguyễn Hoàng Nam\",\r\n      //   account_no: \"060007797128\",\r\n      //   template: \"compact2\",\r\n      //   // branch: this.vhQuerySales.getDefaultBranch()._id\r\n      // },\r\n      // {\r\n      //   _id: \"5\",\r\n      //   acq_id: \"970416\",\r\n      //   account_name: \"Nguyễn Hoàng Nam\",\r\n      //   account_no: \"115621719\",\r\n      //   template: \"compact2\",\r\n      //   // branch: this.vhQuerySales.getDefaultBranch()._id\r\n      // },\r\n      // {\r\n      //   _id: \"6\",\r\n      //   acq_id: \"970405\",\r\n      //   account_name: \"Nguyễn Hoàng Nam\",\r\n      //   account_no: \"6360205227977\",\r\n      //   template: \"compact2\",\r\n      //   // branch: this.vhQuerySales.getDefaultBranch()._id\r\n      // },\r\n    ];\r\n\r\n    this.bankAccounts.forEach((bank) => {\r\n      bank.logo = this.banks.find((b) => b.bin == bank.acq_id)?.logo\r\n    })\r\n\r\n    if (this.bankAccounts.length) {\r\n      this.handleClick(this.bankAccounts[0])\r\n    }\r\n  }\r\n\r\n  handleClick(bank) {\r\n    this.bank_active = bank\r\n    this.loading = true\r\n    const accountNo = bank.account_no;\r\n    const accountName = bank.account_name;\r\n    const acqId = bank.acq_id;\r\n    const template = bank.template;\r\n    const amount = this.total;\r\n    const idBill = this.id_payment;\r\n    this.vhQuerySales.vietqr_generateQR(accountNo, accountName, acqId, template, idBill, amount)\r\n    // this.vhQueryDealer.vietqr_generateQR('0909925354', 'LE DUC HUY', '970422', 'compact2', this.id_payment, 2000)\r\n      .then((res: any) => {\r\n        console.log('vietqr_generateQR', res)\r\n        if (res.vcode == 0) {\r\n          this.urlImg = res.data\r\n        }\r\n      })\r\n      .catch((err) => console.error(err))\r\n      .finally(() => this.loading = false)\r\n  }\r\n}\r\n","<div class=\"modal-container\" >\r\n  <div class=\"content-left\" >\r\n    <img *ngIf=\"urlImg && !loading\" [src]=\"urlImg\" alt=\"QR Code\" style=\"width:80%; height: auto\" />\r\n    \r\n    <div *ngIf=\"loading\"  style=\"position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);\">\r\n      <nz-spin nzSimple></nz-spin>\r\n    </div>\r\n  </div>\r\n  <div class=\"content-right\" >\r\n    \r\n    <p><strong>Sử dụng Mobile Banking hỗ trợ QR</strong></p>\r\n    <div class=\"account-list\" >\r\n      <ng-container *ngIf=\"!loading_banks\">\r\n        <ng-container *ngFor=\"let bank of bankAccounts\">\r\n          <div class=\"account-item\" (click)=\"handleClick(bank)\" [ngClass]=\"{'active': bank.account_no == bank_active.account_no}\">\r\n            <img style=\"width:100%; height: auto\" [src]=\"bank.logo\" [alt]=\"bank.shortName\" />\r\n          </div>\r\n        </ng-container>\r\n      </ng-container>\r\n      <nz-spin *ngIf=\"loading_banks\" nzSimple></nz-spin>\r\n    </div>\r\n  </div>\r\n</div>"],"names":[],"sourceRoot":"webpack:///"}