{"version":3,"file":"src_app_cafe_desktop_menu_settings_chat_chat_module_ts.js","mappings":"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","sources":["./src/app/cafe/desktop/menu/settings/chat/chat.component.ts","./src/app/cafe/desktop/menu/settings/chat/chat.component.html","./src/app/cafe/desktop/menu/settings/chat/chat.module.ts"],"sourcesContent":["import { Component, OnInit } from '@angular/core';\r\nimport { VhAlgorithm, VhImage, VhQuery, VhQueryCafe } from 'ionic-vhframeworks';\r\nimport { LanguageService } from 'src/app/cafe/services/language.service';\r\nimport { VhComponent } from 'src/app/cafe/components/vh-component/vh-component';\r\nimport { NzImageService } from 'ng-zorro-antd/image';\r\n@Component({\r\n  selector: 'app-chat',\r\n  templateUrl: './chat.component.html',\r\n  styleUrls: ['./chat.component.scss']\r\n})\r\nexport class ChatComponent implements OnInit {\r\n  message: any = \"\";\r\n  currentIndex: number;\r\n  listImg: any[];\r\n\r\n  public listMessages: Array<any> = [];\r\n  public viewImage: boolean = false;\r\n\r\n  constructor(\r\n    public languageService: LanguageService,\r\n    public vhQuery: VhQuery,\r\n    public vhQueryCafe: VhQueryCafe,\r\n    public vhImage: VhImage,\r\n    public vhAlgorithm: VhAlgorithm,\r\n    private vhComponent: VhComponent,\r\n    private nzImageService: NzImageService\r\n  ) { }\r\n\r\n  public myTrackByFunction(index: number, complexItem: any): number {\r\n    return complexItem._id;\r\n  }\r\n\r\n  ngOnInit() {\r\n    this.vhQueryCafe.initChatToAppCare();\r\n  }\r\n  ngAfterViewInit() {\r\n    this.vhQueryCafe.listeningChatToAppCare_Insert().subscribe((message: any) => {\r\n      this.listMessages.push(message);\r\n      if (message.img)\r\n        this.listImg.push({ ...message, index: this.listImg.length })\r\n      setTimeout(() => this.scrollBottom(), 200)\r\n    })\r\n    this.vhQueryCafe.getOldMessages(100).then((messages: any[]) => {\r\n      this.listImg = []\r\n      if (messages.length > 0) {\r\n        this.listMessages = [...messages];\r\n\r\n        let index: number = 0\r\n        this.listImg = messages.filter((item) => {\r\n          if (item.img) {\r\n            item.index = index\r\n            index++;\r\n            return true\r\n          } else return false\r\n        })\r\n      }\r\n      setTimeout(() => this.scrollBottom(), 200)\r\n    })\r\n  }\r\n\r\n  ngOnDestroy() { }\r\n  //this.vhQuery.clearCallbackAppCare();}\r\n\r\n\r\n\r\n  /**Hàm gửi tin nhắn \r\n  */\r\n  sendMessage() {\r\n    this.vhQueryCafe.sendMessageToAppCare(this.message);\r\n    this.message = \"\";\r\n    this.scrollBottom()\r\n  }\r\n\r\n  messageChange(event) {\r\n    if (event['keyCode'] == 13 && event['key'] == \"Enter\" && this.message.trim().length) this.sendMessage()\r\n  }\r\n\r\n\r\n  /**\r\n     * lấy hình từ Desktop\r\n     * @param e\r\n     */\r\n  onUpload(e?) {\r\n    const file = e.target.files[0];\r\n    this.vhComponent.showLoading((this.languageService.translate(\"Please wait...\"))).then(() => {\r\n      this.vhImage.getThumbnailFromDesktop(file, 256, 256, \"messages\").then(\r\n        photoURL => {\r\n          this.vhQueryCafe.sendImageToAppCare(photoURL);\r\n          this.vhComponent.hideLoading(0);\r\n        },\r\n        () => {\r\n          this.vhComponent.hideLoading(0).then(() => this.vhComponent.showToast(2000, this.languageService.translate(\"Image was failed\"), \"alert-toast\"))\r\n        });\r\n    });\r\n  }\r\n\r\n  getFile() {\r\n    document.getElementById(\"file-upload\").click();\r\n  }\r\n\r\n  /**Xem hình ảnh */\r\n  openImage(urlImg) {\r\n    // let imgs = this.listImg.map((item) => {\r\n    //   return { ...item, src: item.img }\r\n    // })\r\n    // this.nzImageService.preview(imgs, { nzZoom: 1.5, nzRotate: 0 });\r\n  }\r\n\r\n  scrollBottom() {\r\n    let elmnt = document.getElementById(\"content\");\r\n    elmnt.scrollTop = elmnt.scrollHeight;\r\n  }\r\n\r\n\r\n}\r\n","<nz-layout>\r\n    <div nz-row>\r\n        <div nz-col nzSpan=\"21\" class=\"title\">\r\n            <b>{{'Chat with Viethas' | translate}}</b>\r\n        </div>\r\n    </div>\r\n    <div nz-row class=\"body\" id=\"content\">\r\n        <div class=\"chat\" *ngFor=\"let item of listMessages; trackBy:myTrackByFunction\">\r\n            <div class=\"chat-{{item.align}}\">\r\n                <div class=\"chat-{{item.align}}-avatar\">\r\n                    <div class=\"img\">\r\n                        <img *ngIf=\"item.align == 'right'\"\r\n                            src=\"{{item.avatar ? item.avatar : 'assets/icon/Profile.svg'}}\" />\r\n                    </div>\r\n                </div>\r\n                <div class=\"chat-{{item.align}}-message\" *ngIf=\"item.img || item.msg\">\r\n                    <div class=\"chat-{{item.align}}-message-date\">\r\n                        {{(item.date.seconds ? item.date.seconds * 1000 : item.date) | date: 'dd/MM/yyyy HH:mm'}}\r\n                    </div>\r\n                    <div class=\"chat-{{item.align}}-message-img\" *ngIf=\"item.img\">\r\n                        <ion-spinner *ngIf=\"item.loading\" color=\"vh-green\"></ion-spinner>\r\n                        <img nz-image style=\"cursor: pointer;\" [nzSrc]=\"item.img\">\r\n                    </div>\r\n                    <div class=\"chat-{{item.align}}-message-content\" *ngIf=\"item.msg\">\r\n                        {{item.msg}}\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n    <div nz-row class=\"send\">\r\n        <ion-buttons slot=\"start\">\r\n            <ion-button (click)=\"getFile()\">\r\n                <ion-icon color=\"vh-green\" slot=\"icon-only\" name=\"image-outline\"></ion-icon>\r\n            </ion-button>\r\n        </ion-buttons>\r\n        <ion-input style=\"font-size: 0.9rem;\" [placeholder]=\"languageService.translate('Enter your message...')\"\r\n            [(ngModel)]=\"message\" (keyup)=\"messageChange($event)\">\r\n        </ion-input>\r\n        <ion-buttons slot=\"end\">\r\n            <ion-button (click)=\"sendMessage()\" [disabled]=\"!message.trim().length\">\r\n                <ion-icon color=\"vh-green\" slot=\"icon-only\" name=\"send-outline\"></ion-icon>\r\n            </ion-button>\r\n        </ion-buttons>\r\n    </div>\r\n</nz-layout>\r\n<input style=\"display: none;\" id=\"file-upload\" type=\"file\" accept=\".png, .jpg\" (change)=\"onUpload($event)\" />","import { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { RouterModule, Routes } from '@angular/router';\r\nimport { IonicModule } from '@ionic/angular';\r\nimport { NgZorroAntModule } from 'src/app/cafe/desktop/ng-zorro-ant.module';\r\nimport { TranslateModule } from '@ngx-translate/core';\r\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\r\nimport { ChatComponent } from 'src/app/cafe/desktop/menu/settings/chat/chat.component';\r\n\r\nconst routes: Routes = [\r\n  {\r\n    path: \"\",\r\n    component: ChatComponent\r\n  },\r\n]\r\n\r\n@NgModule({\r\n  declarations: [ChatComponent],\r\n  imports: [\r\n    CommonModule,\r\n    RouterModule.forChild(routes),\r\n    IonicModule,\r\n    FormsModule,\r\n    ReactiveFormsModule,\r\n    TranslateModule,\r\n    NgZorroAntModule,\r\n  ],\r\n})\r\nexport class ChatModule { }\r\n"],"names":[],"sourceRoot":"webpack:///"}