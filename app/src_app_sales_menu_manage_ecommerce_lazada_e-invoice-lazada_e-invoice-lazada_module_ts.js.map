{"version":3,"file":"src_app_sales_menu_manage_ecommerce_lazada_e-invoice-lazada_e-invoice-lazada_module_ts.js","mappings":"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","sources":["./src/app/sales/menu/manage/ecommerce/lazada/e-invoice-lazada/e-invoice-lazada.component.ts","./src/app/sales/menu/manage/ecommerce/lazada/e-invoice-lazada/e-invoice-lazada.component.html","./src/app/sales/menu/manage/ecommerce/lazada/e-invoice-lazada/e-invoice-lazada.module.ts"],"sourcesContent":["import { DatePipe } from '@angular/common';\r\nimport { ChangeDetectorRef, Component, OnInit, TemplateRef } from '@angular/core';\r\nimport { Router } from '@angular/router';\r\nimport { VhAlgorithm, VhAuth, VhEcommerce, VhEinvoice, VhQuery, VhQuerySales } from 'ionic-vhframeworks';\r\nimport { NzModalService } from 'ng-zorro-antd/modal';\r\nimport { VhComponent } from 'src/app/sales/components/vh-component/vh-component';\r\nimport { VhType } from 'src/app/sales/interface/vh-type';\r\nimport { BillService } from 'src/app/sales/services/bill.service';\r\nimport { LanguageService } from 'src/app/sales/services/language.service';\r\nimport { PrintService } from 'src/app/sales/services/print.service';\r\n@Component({\r\n  selector: 'app-e-invoice-lazada',\r\n  templateUrl: './e-invoice-lazada.component.html',\r\n  styleUrls: ['./e-invoice-lazada.component.scss']\r\n})\r\nexport class EInvoiceLazadaComponent implements OnInit {\r\n  searchValue: any;\r\n  searchProductAppValue: any = '';\r\n  salesOrder: Array<any> = [];\r\n  salesSubOrder: Array<any> = [];\r\n  selectedIndex: number = 0;\r\n  list_status_bill: Array<any> = [\r\n    { name: \"All\", value: \"all\" },\r\n    { name: \"Unpaid\", value: \"unpaid\" },\r\n    { name: \"Wait for confirmation\", value: \"pending\" },\r\n    { name: \"To ship\", value: \"packed\", value2: 'ready_to_ship' },\r\n    { name: \"Shipping\", value: \"shipped\" },\r\n    { name: \"Delivered\", value: \"delivered\" },\r\n    { name: \"Cancellation\", value: \"canceled\" },\r\n    { name: \"Trouble\", value: \"package_scrapped\" },\r\n    { name: \"Return or refund\", value: \"returned\" },\r\n    { name: \"Failed Delivered\", value: \"shipped_back\", value2: \"shipped_back_success\", value3: \"failed_delivery\" },\r\n    { name: \"Lost & Damaged\", value: \"lost_by_3pl\", value2: \"damaged_by_3pl\" },\r\n    { name: \"Confirmed\", value: \"confirmed\" },\r\n  ];\r\n  // unpaid, pending, packed, ready_to_ship_pending, ready_to_ship, shipped, failed_delivery, lost_by_3pl, damaged_by_3pl, delivered, returned, canceled, confirmed, shipped_back, shipped_back_success, shipped_back_failed\r\n  heightScroll: any;\r\n  widthScroll: any;\r\n  public date: Date[] = [new Date(), new Date()];\r\n  startTimeBackUp: Date;\r\n  endTimeBackUp: Date;\r\n  load_status: boolean = false;\r\n  dataRestore: any;\r\n  /**Gii hn thi gian cho xem bill */\r\n  disabledDate = (current: Date): boolean => {\r\n    if (current.getTime() < new Date(this.vhAuth.getStore().registrationdate).getTime() - 24 * 60 * 60 * 1000) return true;\r\n    return false;\r\n  };\r\n  listProductOfBranch: Array<any> = []; // sp ca phn mm c lin kt vi lazada\r\n  listProductApp: Array<any> = []; //sp ca phn mm\r\n  listSubProductApp: Array<any> = []; //sp ca app cha lazada[]\r\n  listProductLazada: Array<any> = [];\r\n  id_branch: string = this.vhQuerySales.getDefaultBranch()._id;\r\n  infoShop: any = {};\r\n  arrayHidden: Array<any> = []; //mng ny cha id ca nhng sp ang tm n\r\n  infoBranch = this.vhQuerySales.getlocalBranch(this.vhQuerySales.getDefaultBranch()._id);\r\n\r\n\r\n\r\n  constructor(\r\n    private router: Router,\r\n    public lang: LanguageService,\r\n    public vhComponent: VhComponent,\r\n    public vhAlgorithm: VhAlgorithm,\r\n    private vhQuerySales: VhQuerySales,\r\n    private cdRef: ChangeDetectorRef,\r\n    private modal: NzModalService,\r\n    private vhAuth: VhAuth,\r\n    private vhEinvoice: VhEinvoice,\r\n    private vhQuery: VhQuery,\r\n    private vhEcommerce: VhEcommerce,\r\n    private billService: BillService,\r\n    public printService: PrintService,\r\n    public datePipe: DatePipe,\r\n  ) {\r\n    this.dataRestore = this.router.getCurrentNavigation().extras.state?.dataRestore;\r\n  }\r\n\r\n  ngOnInit(): void {\r\n    if (this.dataRestore) {\r\n      this.searchValue = this.dataRestore.searchValue;\r\n      this.salesOrder = this.dataRestore.salesOrder;\r\n      this.salesSubOrder = this.dataRestore.salesSubOrder;\r\n      this.countOrderByStatus(this.salesOrder);\r\n      this.load_status = true;\r\n      this.selectedIndex = this.dataRestore.selectedIndex;\r\n      this.date = this.dataRestore.date;\r\n      this.segmentChanged(this.selectedIndex);\r\n    }\r\n    this.infoShop = this.vhQuerySales.getlocalShopListLazada()[0];\r\n    this.listProductOfBranch = this.vhQuerySales.getlocalDetailProducts(35).filter(e => !e.delete_hidden).filter(item => item[this.id_branch] && item[this.id_branch].lazadas && item[this.id_branch].lazadas.length >= 0);\r\n    let localProducts: Array<any> = this.vhQuerySales.getlocalDetailProducts(35).filter(e => !e.delete_hidden);\r\n\r\n    this.listProductApp = localProducts.filter(e => !e.delete_hidden).map(item => {\r\n      if (item[this.id_branch] && item[this.id_branch].lazadas && item[this.id_branch].lazadas.length) { //filter nhng sp lazada thuc id lazada  chn\r\n        item[this.id_branch].lazadas = [...item[this.id_branch].lazadas.filter(prod => prod.id_shop == this.infoShop._id)];\r\n      }\r\n      return { ...item, ...this.vhQuerySales.getUnit_byRatio(item.units, 1) };\r\n    });\r\n    this.listSubProductApp = [...this.listProductApp];\r\n    this.returnArrayHiddenProduct();\r\n    this.listProductLazada = this.clearProductShow(this.vhQuerySales.getlocalProductListLazada(this.infoShop['_id']).filter(item => {\r\n      if (item && !this.arrayHidden.includes(item.item_id)) return item;\r\n    }), this.listProductApp);\r\n    this.listProductLazada.forEach(item => item.name = item.attributes.name);\r\n  }\r\n\r\n  /**\r\n    * Ly ra nhng id ca cc sn phm b tm n\r\n    * @example this.returnArrayHiddenProduct()\r\n    */\r\n  returnArrayHiddenProduct() {\r\n    let arr: Array<any> = [];\r\n    this.arrayHidden = [];\r\n    let localProduct: Array<any> = this.vhQuerySales.getlocalDetailProducts(35).filter(e => !e.delete_hidden);\r\n    for (let product of localProduct) {\r\n      if (product[this.id_branch] && product[this.id_branch].lazadas && product[this.id_branch].lazadas.length) {\r\n        for (let prod of product[this.id_branch].lazadas)\r\n          if (prod.hidden == true && prod.id_shop == this.infoShop['_id']) arr.push(prod.item_id);\r\n      }\r\n    }\r\n    this.arrayHidden = arr;\r\n  }\r\n\r\n  /**Xa nhng sp  c lin kt ri ra khi mng ca modal danh sch sp lin kt\r\n * @param listProduct : danh sch sp  lk vi sn\r\n * @param listProductApp : ton b danh sch sp ca app\r\n * @example let daa =  this.clearProductShow([], [])\r\n *\r\n*/\r\n  clearProductShow(listProduct, listProductApp) {\r\n    for (let prodApp of listProductApp) {\r\n      if (prodApp[this.id_branch] && prodApp[this.id_branch].lazadas && prodApp[this.id_branch].lazadas.length) {\r\n        for (let item of prodApp[this.id_branch].lazadas) {\r\n          let indexProd = listProduct.findIndex(prod => prod.item_id == item.item_id);\r\n          if (indexProd >= 0) {\r\n            for (let indexSku in item.skus) {\r\n              let indexSub = listProduct[indexProd].skus.findIndex(sku => sku.SkuId == item.skus[indexSku].SkuId);\r\n              if (indexSub >= 0) {\r\n                listProduct[indexProd].skus.splice(indexSub, 1);\r\n                if (listProduct[indexProd].skus.length == 0) listProduct.splice(indexProd, 1);\r\n              }\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n    return listProduct;\r\n  }\r\n  /**\r\n   * bt sk thay i ngy xem ha n\r\n   * @example this.changeTime('2023-06-09T04:14:30.367Z')\r\n   */\r\n  changeTime(event) {\r\n    if (event[1].getTime() - event[0].getTime() <= 2678400000) {\r\n    } else {\r\n      this.vhComponent.showToast(2000, this.lang.translate(\"The time to view no more than 30 days\"), \"alert-toast\");\r\n      this.date = [new Date(event[0]), new Date(event[0].getTime() + 2678313600)];\r\n    }\r\n  }\r\n\r\n  /**\r\n   * lc salesOrder theo order_id\r\n   * @param value\r\n   * @example this.search('060623A001')\r\n   */\r\n  search(value: string) {\r\n    this.segmentChanged(this.selectedIndex);\r\n    /** Mng bill cn search */\r\n    let valArray: string[] = value.split(',').map(val => this.vhAlgorithm.changeAlias(val?.toString().trim().toLowerCase())).filter(val => val?.length > 0);\r\n    if (valArray?.length > 0) {\r\n      // search theo order_id\r\n      this.salesOrder = this.salesOrder.filter(item => {\r\n        return valArray.some(val => {\r\n          return this.vhAlgorithm.changeAlias(item?.order_id?.toString())?.includes(val);\r\n        });\r\n      });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * search tn sn phm trong app viethas\r\n   * @example this.search('Sn phm A')\r\n   */\r\n  searchProductApp(value: string) {\r\n    let val: string = this.vhAlgorithm.changeAlias(value.trim().toLowerCase());\r\n    this.listProductApp = this.vhAlgorithm.searchList(val, [...this.listSubProductApp], ['name', 'barcode', 'item_code']);\r\n  }\r\n\r\n  /**\r\n   * bt sk thay i tab xem trng thi n\r\n   * @param event\r\n   */\r\n  segmentChanged(event) { // sau ny s filter theo trng thi qua hm ny\r\n    // Nu chn tab Khc th hin nhng n khng c trong danh sch trng thi\r\n    if(event === this.list_status_bill.length) {\r\n      this.salesOrder = this.salesSubOrder.filter(item => {\r\n        return !this.list_status_bill.some(status => status.value === item.statuses[0] || status.value2 === item.statuses[0] || status.value3 === item.statuses[0]);\r\n      });\r\n      return;\r\n    }\r\n\r\n    if (event == 0) this.salesOrder = this.salesSubOrder;\r\n    else this.salesOrder = this.salesSubOrder.filter(item => item.statuses[0] == this.list_status_bill[event].value || item.statuses[0] == this.list_status_bill[event].value2 || item.statuses[0] == this.list_status_bill[event].value3);\r\n  }\r\n\r\n\r\n\r\n  /** Map cha s lng n hng theo trng thi */\r\n  orderCountByStatus: any = {\r\n    'All': 0,\r\n    'Unpaid': 0,\r\n    'Wait for confirmation': 0,\r\n    'To ship': 0,\r\n    'Shipping': 0,\r\n    'Delivered': 0,\r\n    'Cancellation': 0,\r\n    'Trouble': 0,\r\n    'Return or refund': 0,\r\n    'Failed Delivered': 0,\r\n    'Lost & Damaged': 0,\r\n    'Confirmed': 0,\r\n  }\r\n  /** S lng n hng khng nm trong danh sch trng thi */\r\n  orderOthersCountByStatus = 0;\r\n\r\n  /**\r\n   * m s lng n hng theo trng thi\r\n   * @param orders\r\n   */\r\n  countOrderByStatus(orders) {\r\n    this.orderOthersCountByStatus = orders.filter(order => {\r\n      return !this.list_status_bill.some(status => status.value === order.statuses[0] || status.value2 === order.statuses[0] || status.value3 === order.statuses[0]);\r\n    }).length;\r\n\r\n    for (const key in this.orderCountByStatus) {\r\n      if (key === 'All') {\r\n        this.orderCountByStatus[key] = orders.length;\r\n      }\r\n      else {\r\n        this.orderCountByStatus[key] = orders.filter(order => {\r\n          return order.statuses[0] === this.list_status_bill.find(status => status.name === key).value ||\r\n            order.statuses[0] === this.list_status_bill.find(status => status.name === key).value2 ||\r\n            order.statuses[0] === this.list_status_bill.find(status => status.name === key).value3;\r\n        }).length;\r\n      }\r\n    }\r\n  }\r\n\r\n\r\n\r\n  /**\r\n   * tr v trang qun l lazada\r\n   * @example this.goBack()\r\n   */\r\n  goBack() {\r\n    this.router.navigate(['/sales/dashboard/manage/ecommerce/lazada'], {\r\n      state: {\r\n        dataRestore: { dataRestore: this.dataRestore }\r\n      }\r\n    });\r\n  }\r\n  /**\r\n   * get ha n lazada\r\n   * @example this.showReport()\r\n   */\r\n  showReport() {\r\n    this.load_status = true;\r\n    this.salesOrder = [];\r\n    this.vhComponent.showLoading(\"\", \"transparent-loading\").then(() => {\r\n      this.vhQuerySales.getSalesOrderDetailListLazada(new Date(this.date[0].setHours(0, 0, 0)).toISOString(), new Date(this.date[1].setHours(23, 59, 59, 59)).toISOString(), this.infoShop.access_token, this.infoShop._id)\r\n        .then((result: any) => {\r\n          this.vhComponent.hideLoading(0);\r\n          result.forEach(item => {\r\n            if (item.statuses.length > 1) {\r\n              let count = 0;\r\n              item.order_items.forEach(product => { if (product.status == 'canceled') count++; });\r\n              item.deliveredProduct = item.order_items.length - count;\r\n              item.canceledProduct = count;\r\n            }\r\n            this.salesOrder.push({ ...item, checked: true, total_amount: this.calculateTotal(item), created_at: new Date(item.created_at), id_shop: this.infoShop._id, cqt_status: item.cqt_status ?? 1 });\r\n          });\r\n\r\n          // this.salesOrder = result.map(item => { return { ...item, id_shop: this.infoShop._id, shop_name: shop.account }})\r\n          this.salesSubOrder = this.salesOrder;\r\n          this.countOrderByStatus(this.salesOrder);\r\n          this.segmentChanged(this.selectedIndex);\r\n        }, (error => this.vhComponent.hideLoading(0))\r\n        ).catch(err => this.vhComponent.hideLoading(0));\r\n    });\r\n  }\r\n\r\n  /** hm sort cho cc ct */\r\n  dateCol = false;\r\n  bill_codeCol = false;\r\n  partner_nameCol = false;\r\n  payment_nameCol = false;\r\n  statusCol = false;\r\n  sum_priceCol = false;\r\n  /** Hm thc hin sp xp theo collection\r\n   *\r\n   * @param colName       // tn ct mun sp xp\r\n   */\r\n  sortTable(colName) {\r\n    switch (colName) {\r\n      case 'date':\r\n        if (this.dateCol) {\r\n          this.salesOrder = this.vhAlgorithm.sortDatebyASC([...this.salesOrder], colName);\r\n        } else {\r\n          this.salesOrder = this.vhAlgorithm.sortDatebyDESC([...this.salesOrder], colName);\r\n        }\r\n        break;\r\n      case 'status': if (this.statusCol) {\r\n        this.salesOrder = this.vhAlgorithm.sortNumberbyASC([...this.salesOrder], 'cqt_status');\r\n      } else {\r\n        this.salesOrder = this.vhAlgorithm.sortNumberbyDESC([...this.salesOrder], 'cqt_status');\r\n      }\r\n        console.log(this.salesOrder);\r\n        break;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * tnh li tng tin\r\n   * @param bill\r\n   * @returns number\r\n   * @example let total = this.calculateTotal(bill)\r\n   */\r\n  calculateTotal(bill) {\r\n    return +bill['price'] - bill['voucher'] + bill['shipping_fee'];\r\n  }\r\n\r\n  ngAfterViewChecked() {\r\n    if (document.querySelector(\"#order-status-lazada\") && document.querySelector(\".ant-tabs-tab\") && document.querySelector(\".ant-table-thead\") && document.querySelector(\".order-status-lazada-header\") && document.querySelector(\".ant-table-pagination\")) {\r\n      this.heightScroll = document.querySelector(\"#order-status-lazada\").clientHeight - document.querySelector(\".ant-table-thead\").clientHeight\r\n        - document.querySelector(\".order-status-lazada-header\").clientHeight - document.querySelector(\".ant-tabs-tab\").clientHeight - 90 + \"px\";\r\n    }\r\n    if (document.getElementById(\"order-status-lazada\"))\r\n      this.widthScroll = document.getElementById(\"order-status-lazada\").clientWidth + \"px\";\r\n    this.cdRef.detectChanges();\r\n  }\r\n\r\n\r\n  gotoDetail(bill) {\r\n    this.router.navigate(['/sales/dashboard/manage/ecommerce/lazada/order-status/detail'], { state: { bill: bill, dataRestore: { salesOrder: this.salesOrder, searchValue: this.searchValue, id_shop_selected: this.infoShop._id, date: this.date, salesSubOrder: this.salesSubOrder, selectedIndex: this.selectedIndex } } });\r\n  }\r\n\r\n  allChecked = true;\r\n  indeterminate = true;\r\n\r\n\r\n\r\n  /**\r\n   * Check tt c\r\n   * @param value\r\n   */\r\n  checkAll(value: boolean): void {\r\n    this.salesOrder.forEach(data => {\r\n      if (!data.disabled) {\r\n        data.checked = value;\r\n      }\r\n    });\r\n    this.refreshStatus();\r\n  }\r\n\r\n\r\n\r\n  /**\r\n   * Check 1 ci\r\n   */\r\n  refreshStatus(): void {\r\n    const validData = this.salesOrder.filter(value => !value.disabled);\r\n    const allChecked = validData.length > 0 && validData.every(value => value.checked === true);\r\n    const allUnChecked = validData.every(value => !value.checked);\r\n    this.allChecked = allChecked;\r\n    this.indeterminate = !allChecked && !allUnChecked;\r\n  }\r\n\r\n  async sendCQT() {\r\n    let bill_checked = this.salesOrder.filter(item => item.checked).filter((data: any) => !data.cqt_status || data.cqt_status == 1); // lc ra nhng ha n  chn v cha gi ln CQT\r\n\r\n    if (bill_checked.length == 0) {\r\n      this.vhComponent.alertMessageDesktop(\"error\", this.lang.translate(\"Vui lng chn ha n cn gi CQT\"));\r\n      return;\r\n    }\r\n\r\n    // Nu c bt cqt_vat_ecommerce_use_latest_order_update_time th sp xp theo thi gian cp nht trng thi gn nht ca n hng t sn, \r\n    // c gi trc, mi gi sau\r\n    if (this.cqt_vat_ecommerce_use_latest_order_update_time) {\r\n      bill_checked = bill_checked.sort((a, b) => a.update_time - b.update_time);\r\n    }\r\n\r\n    const batchSize = 1;\r\n    const totalBatches = Math.ceil(bill_checked.length / batchSize);\r\n\r\n    if (!bill_checked.length) {\r\n      this.vhComponent.alertMessageDesktop('error', this.lang.translate(\"Please select at least one invoice\"));\r\n      return;\r\n\r\n    }\r\n\r\n    await this.vhComponent.showLoadingNotDuration(this.lang.translate(\"Sending...\"));\r\n\r\n    for (let i = 0; i < bill_checked.length; i += batchSize) {\r\n      // to mi ln 1 request gi ha n\r\n      const batch = bill_checked.slice(i, i + batchSize);\r\n      const currentBatchIndex = Math.floor(i / batchSize) + 1;\r\n      const promises = batch.map(bill => {\r\n        return this.signatureManual(bill);\r\n\r\n      });\r\n\r\n      try {\r\n        const results = await this.vhQuery.asyncPromiseAll(promises);\r\n        console.log(`Batch ${i / batchSize + 1}:`, results);\r\n        if (currentBatchIndex == totalBatches) {\r\n          this.vhComponent.hideLoading();\r\n\r\n        }\r\n      } catch (error) {\r\n        // trng hp 1 vi n b li ko gi dc\r\n        if (currentBatchIndex == totalBatches) {\r\n          this.vhComponent.hideLoading();\r\n\r\n        }\r\n        console.error(`Error in batch ${i / batchSize + 1}:`, error);\r\n      }\r\n\r\n\r\n    }\r\n  }\r\n\r\n  /**\r\n   * hm ny k ha n ln cqt\r\n   * @param invoice\r\n   */\r\n  signatureManual(invoice) {\r\n    return new Promise((resolve, reject) => {\r\n\r\n      // ly ra chi nhnh hin ti\r\n      let currentBranch = this.vhQuerySales.getlocalBranch(this.vhQuerySales.getDefaultBranch()._id);\r\n\r\n      console.log('currentBranch', currentBranch);\r\n      // trng hp cha c to kt ni ha n in t\r\n      if (!currentBranch.einvoices?.length) {\r\n        this.vhComponent.alertMessageDesktop(\"error\", this.lang.translate(\"Please connect e-invoice for this branch\"));\r\n        resolve(true);\r\n        return;\r\n      }\r\n      // trng hp ch c 1 kt ni ha n in t th to thng lun\r\n      if (currentBranch.einvoices.length && currentBranch.einvoices.length == 1) {\r\n        // trng hp ncc ha n in t l M-invoice\r\n        if (currentBranch.einvoices[0].invoice_provider == 'M-invoice') {\r\n\r\n          if (!currentBranch.einvoices[0].invoiceSeries.length) {\r\n            this.vhComponent.alertMessageDesktop(\"error\", this.lang.translate(\"Please connect e-invoice for this branch\"));\r\n            resolve(true);\r\n            return;\r\n          }\r\n          invoice.isLoading = true;\r\n\r\n          this.changeLazada_toInvoice_byMinvoice(invoice, currentBranch.einvoices[0].invoiceSeries[0])\r\n            .then((rsp: any) => {\r\n              if (rsp.vcode == 0) {\r\n                // K t ng ngay khi gi ha n ln C quan thu\r\n                if (this.cqt_invoice_auto_sign) {\r\n                  this.vhEinvoice.saveInvoice_Sign_byMinvoice(currentBranch.taxcode, currentBranch.einvoices[0].token, 1, rsp.data)\r\n                    .then((res: any) => {\r\n                      console.log(res);\r\n                      invoice.isLoading = false;\r\n                      if (res.code == '00') {\r\n                        invoice.cqt_status = 3;\r\n                        invoice.status = this.lang.translate(\"Sent to CQT\");\r\n                        this.vhComponent.alertMessageDesktop(\"success\", this.lang.translate('Update invoice to CQT successfully'));\r\n                        this.vhQuerySales.updateSalesOrderLazada_byFile([invoice.order_id.toString()], { cqt_status: 3 }, this.infoShop.access_token, this.infoShop._id)\r\n                          .then((array: any) => {\r\n                            console.log('updateSalesOrderLazada_byFile', array);\r\n                            resolve(true);\r\n                          }, error => {\r\n                            console.log(error);\r\n                          });\r\n                      }\r\n                      else if (res.code == '9999') {\r\n                        resolve(true);\r\n                        this.vhComponent.alertMessageDesktop(\"error\", this.lang.translate(\"Vui lng kim tra li thng tin ha n y ln CQT cha ph hp\"));\r\n                      }\r\n                      else if (res.code == '296') {\r\n                        resolve(true);\r\n                        this.vhComponent.alertMessageDesktop(\"error\", this.lang.translate(\"Khng th gi nhng ha n c ngy lp ha n nh hn ngy lp ha n cui cng  gi ln C quan thu. <br> Nu cn gi nhng ha n c hn, bn cn tt cu hnh 'S dng thi gian cp nht trng thi gn nht ca n hng t sn  thit lp ngy lp ha n' trong Ci t\"), 4000);\r\n                      }\r\n                      else {\r\n                        resolve(true);\r\n                        this.vhComponent.alertMessageDesktop(\"error\", this.lang.translate(res.message));\r\n                      }\r\n                    }, (error: any) => {\r\n                      invoice.isLoading = true;\r\n                      this.vhComponent.alertMessageDesktop(\"error\", this.lang.translate(\"C li xy ra khi khi to ha n y ln CQT\"));\r\n                      console.log('error', error);\r\n                    });\r\n                }\r\n                else {\r\n                  this.vhEinvoice.saveInvoice_noSign_byMinvoice(currentBranch.taxcode, currentBranch.einvoices[0].token, 1, rsp.data)\r\n                    .then((res: any) => {\r\n                      console.log(res);\r\n                      invoice.isLoading = false;\r\n                      if (res.code == '00') {\r\n                        invoice.cqt_status = 2;\r\n                        invoice.status = this.lang.translate(\"Sent to CQT\");\r\n                        this.vhComponent.alertMessageDesktop(\"success\", this.lang.translate('Update invoice to CQT successfully'));\r\n                        this.vhQuerySales.updateSalesOrderLazada_byFile([invoice.order_id.toString()], { cqt_status: 2 }, this.infoShop.access_token, this.infoShop._id)\r\n                          .then((array: any) => {\r\n                            console.log('updateSalesOrderLazada_byFile', array);\r\n                            resolve(true);\r\n                          }, error => {\r\n                            console.log(error);\r\n                          });\r\n                      }\r\n                      else if (res.code == '9999') {\r\n                        resolve(true);\r\n                        this.vhComponent.alertMessageDesktop(\"error\", this.lang.translate(\"Vui lng kim tra li thng tin ha n y ln CQT cha ph hp\"));\r\n                      }\r\n                      else if (res.code == '296') {\r\n                        resolve(true);\r\n                        this.vhComponent.alertMessageDesktop(\"error\", this.lang.translate(\"Khng th gi nhng ha n c ngy lp ha n nh hn ngy lp ha n cui cng  gi ln C quan thu. <br> Nu cn gi nhng ha n c hn, bn cn tt cu hnh 'S dng thi gian cp nht trng thi gn nht ca n hng t sn  thit lp ngy lp ha n' trong Ci t\"), 4000);\r\n                      }\r\n                      else {\r\n                        resolve(true);\r\n                        this.vhComponent.alertMessageDesktop(\"error\", this.lang.translate(res.message));\r\n                      }\r\n                    }, (error: any) => {\r\n                      invoice.isLoading = true;\r\n                      this.vhComponent.alertMessageDesktop(\"error\", this.lang.translate(\"C li xy ra khi khi to ha n y ln CQT\"));\r\n                      console.log('error', error);\r\n                    });\r\n                }\r\n              }\r\n              else {\r\n                invoice.isLoading = true;\r\n                this.vhComponent.alertMessageDesktop(\"error\", this.lang.translate(\"C li xy ra khi khi to ha n y ln CQT\"));\r\n              }\r\n            }, (error: any) => {\r\n              this.vhComponent.alertMessageDesktop(\"error\", this.lang.translate(\"C li xy ra khi khi to ha n y ln CQT\"));\r\n              invoice.isLoading = true;\r\n              console.log('error', error);\r\n            });\r\n\r\n        }\r\n      }\r\n      // trng hp ch c 2 kt ni ha n in t tr ln th hin modal chn ncc  ha n in t\r\n      if (currentBranch.einvoices.length && currentBranch.einvoices.length > 1) {\r\n\r\n      }\r\n    });\r\n  }\r\n\r\n\r\n\r\n  /** Gi ha n ln C quan thu km ph vn chuyn */\r\n  cqt_submit_invoice_with_shipping_fee = this.vhQuerySales.getLocalAppSettingNameBranch('permission_branch').cqt_submit_invoice_with_shipping_fee;\r\n  /** Gi ha n ln C quan thu km ph giao dch/ph sn */\r\n  cqt_submit_invoice_with_ecommerce_fee = this.vhQuerySales.getLocalAppSettingNameBranch('permission_branch').cqt_submit_invoice_with_ecommerce_fee;\r\n  /** Gi bn hng ha, dch v... trn sn  bao gm thu VAT */\r\n  cqt_vat_ecommerce_already_Included = this.vhQuerySales.getLocalAppSettingNameBranch('permission_branch').cqt_vat_ecommerce_already_Included;\r\n  /** % thu VAT */\r\n  cqt_vat_ecommerce_rate = this.vhQuerySales.getLocalAppSettingNameBranch('permission_branch').cqt_vat_ecommerce_rate;\r\n  /** K t ng ngay khi gi ha n ln C quan thu */\r\n  cqt_invoice_auto_sign = this.vhQuerySales.getLocalAppSettingNameBranch('permission_branch').cqt_invoice_auto_sign;\r\n  /** Gi bn hng ha, dch v trn sn  bao gm VAT, tnh theo VAT hng ha, dch v lin kt */\r\n  cqt_vat_ecommerce_by_linked_product = this.vhQuerySales.getLocalAppSettingNameBranch('permission_branch').cqt_vat_ecommerce_by_linked_product;\r\n  /** Hng khuyn mi c php xut 0. Nu l true th tchat2 s c cc ct = 0, ma_thue vn l s bnh thng */\r\n  cqt_vat_ecommerce_allow_promotional_items_zero_price = this.vhQuerySales.getLocalAppSettingNameBranch('permission_branch').cqt_vat_ecommerce_allow_promotional_items_zero_price;\r\n  /** Xut ring chit khu/gim gi ca sn phm thnh 1 dng ring khi gi CQT */\r\n  cqt_vat_ecommerce_separate_discount_line = this.vhQuerySales.getLocalAppSettingNameBranch('permission_branch').cqt_vat_ecommerce_separate_discount_line;\r\n  /** Vn gi hng xut bn cho sn phm tng/khuyn mi khi gi CQT */\r\n  cqt_vat_ecommerce_keep_promotional_items_as_sold = this.vhQuerySales.getLocalAppSettingNameBranch('permission_branch').cqt_vat_ecommerce_keep_promotional_items_as_sold;\r\n  /** S dng thi gian cp nht trng thi gn nht ca n hng t sn  thit lp ngy lp ha n */\r\n  cqt_vat_ecommerce_use_latest_order_update_time = this.vhQuerySales.getLocalAppSettingNameBranch('permission_branch').cqt_vat_ecommerce_use_latest_order_update_time;\r\n  /** Xut ha n t sn vi thng tin ngi mua km theo tn sn v m n hng */\r\n  cqt_vat_ecommerce_buyer_info_with_platform_and_so_benh_an = this.vhQuerySales.getLocalAppSettingNameBranch('permission_branch').cqt_vat_ecommerce_buyer_info_with_platform_and_so_benh_an;\r\n  /** Xut ha n t sn vi thng tin thanh ton mc nh l 'Chuyn khon' */\r\n  cqt_vat_ecommerce_default_payment_method_chuyen_khoan: boolean = this.vhQuerySales.getLocalAppSettingNameBranch('permission_branch').cqt_vat_ecommerce_default_payment_method_chuyen_khoan;\r\n  /** M sn phm khi gi CQT l m vch sn phm */\r\n  cqt_vat_ecommerce_item_code_is_barcode = this.vhQuerySales.getLocalAppSettingNameBranch('permission_branch').cqt_vat_ecommerce_item_code_is_barcode;\r\n  /** Gi hng ha, dch v... gi CQT l gi bn  gim */\r\n  cqt_vat_ecommerce_item_price_is_discounted = this.vhQuerySales.getLocalAppSettingNameBranch('permission_branch').cqt_vat_ecommerce_item_price_is_discounted;\r\n\r\n\r\n\r\n  /**\r\n  * @example\r\n  * this.vhQuerySales.changeLazada_toInvoice_byMinvoice(order, invoiceSeries)\r\n    .then((rsp) => {\r\n      //-----------your code here-----------\r\n    },(error: any) => {\r\n      console.log('error', error);\r\n    });\r\n\r\n  * @param order : ha n ly t lazada v\r\n  * @param invoiceSeries : k hiu ha n\r\n  * @returns Promise => {vcode, msg, data(array)}\r\n   * \r\n   * \r\n   * Cu trc cn x l 3 ci:\r\n   *  - Danh sch ha n chi tit:\r\n   *    + Check trng hp combo\r\n   *  - Ph vn chuyn\r\n   *  - Chit khu thng mi\r\n   * \r\n   * \r\n   * Ghi ch:\r\n   *  - Lazada  bao gm thu nn s b qua platformTax\r\n   *  - Nu KHNG bt cqt_vat_ecommerce_already_Included th s set mc nh l 0, b qua platformTax\r\n   *  - Trng hp c bt cqt_vat_ecommerce_already_Included, th phi tnh li Gi  total sau khi p thu (thu t phn ci t ca app mnh) v Chit khu l khng thay i. \r\n   *  - tchat2 v tchat3 th discountAmount v discountPercentage s = 0\r\n   *  - Chit khu thng mi th Thu = 0\r\n   *  - Combo s khng c trng hp tt c cc sn phm bn trong c gi = 0 ( bt khi lin kt sn phm) nn c th b qua trng hp ny\r\n   *  - i vi combo lin kt, Trng hp cqt_vat_ecommerce_by_linked_product th bt  combo nhng vn gi code  invoice_detail cha  logic khng b thay i. Trng hp cqt_vat_ecommerce_already_Included th bt  invoice_detail cha, khng cn bt  combo na, v khi chia ra t l vn s m bo do  tnh  cha\r\n   */\r\n  public changeLazada_toInvoice_byMinvoice(order: any, invoiceSeries: string) {\r\n    return new Promise(async (resolve, reject) => {\r\n      try {\r\n\r\n        console.log('order', order);\r\n\r\n        //Tch phn chi tit ha n ca lazada ra, v gom nhng chi tit ha n ging nhau li\r\n        let order_details: any = [...order.order_items];\r\n        for (let i = 0; i < order_details.length; i++) if (order_details[i].quantity == undefined) order_details[i].quantity = 1;;\r\n        for (let i = 0; i < order_details.length; i++) {\r\n          if (order_details[i]) {\r\n            let quantity = order_details[i].quantity;\r\n            for (let j = i + 1; j < order_details.length; j++) {\r\n              if (order_details[j] && order_details[i].sku_id === order_details[j].sku_id) {\r\n                if ((order_details[i].item_price === order_details[j].item_price) || (order_details[i].paid_price === order_details[j].paid_price)\r\n                  || (order_details[i].voucher_amount === order_details[j].voucher_amount) || (order_details[i].shipping_amount === order_details[j].shipping_amount)) {\r\n                  quantity = quantity + order_details[j].quantity;\r\n                  order_details[j] = null;\r\n                }\r\n              }\r\n            }\r\n            order_details[i].quantity = quantity;\r\n          }\r\n        }\r\n        order_details = order_details.filter((e: any) => e != null);\r\n\r\n\r\n        /* ---------------------------------------------------------- Khi to invoice ---------------------------------------------------------- */\r\n\r\n        let invoice: any = {\r\n          inv_invoiceSeries: invoiceSeries,\r\n          inv_invoiceIssuedDate: this.vhAlgorithm.formatDateToString(new Date()),\r\n          inv_currencyCode: \"VND\",\r\n          inv_exchangeRate: 1,\r\n          inv_discountAmount: 0,\r\n          inv_vatAmount: 0,\r\n          inv_TotalAmountWithoutVat: 0,\r\n          inv_TotalAmount: 0,\r\n          key_api: order.order_id,\r\n          so_benh_an: order.order_id,\r\n        };\r\n\r\n\r\n\r\n        /* --------- X l cqt_vat_ecommerce_use_latest_order_update_time th ly ngy cp nht trng thi gn nht ca n hng t sn --------- */\r\n        if (this.cqt_vat_ecommerce_use_latest_order_update_time) {\r\n          invoice.inv_invoiceIssuedDate = this.vhAlgorithm.formatDateToString(new Date(order.updated_at));\r\n        }\r\n\r\n\r\n\r\n        /* --------------------------------------------------------- Thng tin ngi mua -------------------------------------------------------- */\r\n\r\n        /** Tn ngi mua mc nh nu khng c thng tin trong ha n */\r\n        let buyerDisplayNameDefault = 'Ngi mua khng ly ha n';\r\n        /* ------ X l cqt_vat_ecommerce_buyer_info_with_platform_and_so_benh_an --------------------------------------------------------------- */\r\n        // Nu bt th s thnh: Tn sn - Ngi mua khng ly ha n - M n hng\r\n        if (this.cqt_vat_ecommerce_buyer_info_with_platform_and_so_benh_an) {\r\n          buyerDisplayNameDefault = `Lazada - ${buyerDisplayNameDefault} - ${invoice.so_benh_an}`;\r\n        }\r\n\r\n        /* ------ X l cqt_vat_ecommerce_default_payment_method_chuyen_khoan ------------------------------------------------------------------- */\r\n        // Nu c bt th lun l 'Chuyn khon', nu khng th s ly theo ca n hng\r\n        if (this.cqt_vat_ecommerce_default_payment_method_chuyen_khoan) {\r\n          invoice.inv_paymentMethodName = 'Chuyn khon';\r\n        }\r\n        else {\r\n          invoice.inv_paymentMethodName = order.payment_method == 'COD' ? 'Tin mt' : 'Chuyn khon';\r\n        }\r\n\r\n        invoice.inv_buyerDisplayName = order.tax_buyerDisplayName ? order.tax_buyerDisplayName : buyerDisplayNameDefault;\r\n        invoice.inv_buyerLegalName = order.tax_buyerLegalName ? order.tax_buyerLegalName : '';\r\n        invoice.inv_buyerTaxCode = order.tax_buyerTaxCode ? order.tax_buyerTaxCode : '';\r\n        invoice.inv_buyerAddressLine = order.tax_buyerAddressLine ? order.tax_buyerAddressLine : '';\r\n        invoice.inv_buyerEmail = order.tax_buyerEmail ? order.tax_buyerEmail : '';\r\n\r\n\r\n\r\n        /* ------------------------------------------------------ Tnh ton invoice details ----------------------------------------------------- */\r\n\r\n        /** Thu ca ha n. Nu KHNG bt cqt_vat_ecommerce_already_Included th s set mc nh l 0, b qua platformTax */\r\n        let billTax = 0;\r\n        // nu bt cqt_vat_ecommerce_already_Included th ly thu t ci t\r\n        if (this.cqt_vat_ecommerce_already_Included) {\r\n          billTax = this.cqt_vat_ecommerce_rate || 0;\r\n        }\r\n\r\n        /**------------To chi tit ha n thu----------------- */\r\n        var invoice_details = new Array();\r\n\r\n        for (let i = 0; i < order_details.length; i++) {\r\n          /** Sn phm lin kt vi sn phm ca sn */\r\n          const productLinked = this.findProductLinked(order_details[i]);\r\n          // Khi to chi tit ha n\r\n          let invoice_detail = this.billService.createEInvoiceDetailTemplate();\r\n\r\n          /** Tnh cht hng ha. Nu inv_TotalAmountWithoutVat = 0 th tchat = 2, nu khng th tchat = 1 */\r\n          const tchat = order_details[i].item_price * order_details[i].quantity - order_details[i].voucher_seller === 0 ? 2 : 1;\r\n          /** Thu ca bill detail ny. Nu c sn phm lin kt v bt setting cqt_vat_ecommerce_by_linked_product th s ly thu t sn phm lin kt, ngc li th vn ly t billTx nh c  */\r\n          const invoiceDetailTax = (this.cqt_vat_ecommerce_by_linked_product && productLinked && productLinked.tax !== undefined) ? productLinked.tax : billTax;\r\n\r\n          // Gn cc gi tr chung\r\n          invoice_detail.tchat = tchat;\r\n          invoice_detail.stt_rec0 = invoice_details.length + 1;\r\n          invoice_detail.inv_itemCode = order_details[i].sku_id;\r\n          invoice_detail.inv_unitCode = 'Ci';\r\n          invoice_detail.inv_quantity = order_details[i].quantity;\r\n          invoice_detail.inv_unitPrice = order_details[i].item_price; // Gi bn sn phm trn sn lazada ( bao gm thu)\r\n          invoice_detail.ma_thue = invoiceDetailTax;\r\n\r\n\r\n          /* ------ X l tchat --------------------------------------------------------------------------- */\r\n          if (tchat === 2) {\r\n            // Gn li tn\r\n            invoice_detail.inv_itemName = 'Hng khuyn mi/hng tng ' + order_details[i].name;\r\n            // Tnh li gi tr tr gi (chit khu) ca chi tit ha n trng hp tchat2\r\n            invoice_detail.inv_discountAmount = 0;\r\n\r\n            /* ------ X l cqt_vat_ecommerce_already_Included cqt_vat_ecommerce_by_linked_product --------- */\r\n            if (this.cqt_vat_ecommerce_already_Included || this.cqt_vat_ecommerce_by_linked_product) {\r\n              // Tnh li gi\r\n              invoice_detail.inv_unitPrice = this.billService.calculateNewPriceToUseSettingTax(invoice_detail.inv_unitPrice, invoice_detail.inv_quantity, invoice_detail.inv_discountAmount, invoice_detail.ma_thue, 0);\r\n            }\r\n\r\n            /* ------ X l Hng khuyn mi c php xut 0 ----------------------------------------------- */\r\n            // Nu c bt cqt_vat_ecommerce_allow_promotional_items_zero_price v l tchat2 th cn gn li gi = 0,  cc php tnh cho nhng trng khc bn di cng s t tnh = 0\r\n            if (this.cqt_vat_ecommerce_allow_promotional_items_zero_price) {\r\n              invoice_detail.inv_unitPrice = 0;\r\n            }\r\n\r\n            /* ------ X l Vn gi hng xut bn cho sn phm tng/khuyn mi khi gi CQT ------------------ */\r\n            // Nu c bt cqt_vat_ecommerce_keep_promotional_items_as_sold v l tchat2 th s set li nso thnh tchat1, discountAmount v discountPercentage vn l 0\r\n            if (this.cqt_vat_ecommerce_keep_promotional_items_as_sold) {\r\n              // Gn li tchat\r\n              invoice_detail.tchat = 1; // Gn li tchat thnh 1\r\n              // Gn li tn\r\n              invoice_detail.inv_itemName = order_details[i].name;\r\n            }\r\n\r\n            // Tr gi (chit khu) tnh theo %\r\n            invoice_detail.inv_discountPercentage = 0;\r\n          }\r\n          else {\r\n            // Gn li tn\r\n            invoice_detail.inv_itemName = order_details[i].name;\r\n            // Tr gi (chit khu) ca nh bn hng trn mi chi tit ha n = seller discount (khng ly ca sn)\r\n            invoice_detail.inv_discountAmount = order_details[i].voucher_seller;\r\n\r\n            /* ------ X l Gi hng ha, dch v... gi CQT l gi bn  gim ----------------------------------------- */\r\n            if(this.cqt_vat_ecommerce_item_price_is_discounted) {\r\n              // Gn li thnh gi  gim\r\n              invoice_detail.inv_unitPrice = invoice_detail.inv_unitPrice - invoice_detail.inv_discountAmount / invoice_detail.inv_quantity;\r\n              // Gn li Chit khu = 0\r\n              invoice_detail.inv_discountAmount = 0;\r\n            }\r\n\r\n            /* ------ X l cqt_vat_ecommerce_already_Included cqt_vat_ecommerce_by_linked_product --------- */\r\n            if (this.cqt_vat_ecommerce_already_Included || this.cqt_vat_ecommerce_by_linked_product) {\r\n              // Tnh li gi\r\n              invoice_detail.inv_unitPrice = this.billService.calculateNewPriceToUseSettingTax(invoice_detail.inv_unitPrice, invoice_detail.inv_quantity, invoice_detail.inv_discountAmount, invoice_detail.ma_thue, 0);\r\n            }\r\n\r\n            // Tr gi (chit khu) tnh theo %\r\n            invoice_detail.inv_discountPercentage = invoice_detail.inv_discountAmount / (invoice_detail.inv_unitPrice * invoice_detail.inv_quantity) * 100;\r\n          }\r\n\r\n          //Gi cui ( tr tr gi) ca chi tit ha n\r\n          invoice_detail.inv_TotalAmountWithoutVat = invoice_detail.inv_unitPrice * invoice_detail.inv_quantity - invoice_detail.inv_discountAmount;\r\n          //Thu VAT c tnh theo chi tit ha n\r\n          invoice_detail.inv_vatAmount = invoice_detail.inv_TotalAmountWithoutVat * invoice_detail.ma_thue / 100;\r\n          //Tng gi tr hng ha k khai theo chi tit ha n\r\n          invoice_detail.inv_TotalAmount = invoice_detail.inv_TotalAmountWithoutVat + invoice_detail.inv_vatAmount;\r\n\r\n          // Nu nh c lin kt\r\n          if (productLinked) {\r\n            // Nu lin kt vi sn phm\r\n            if (productLinked.type === VhType.PRODUCT) {\r\n              // Thay i inv_itemName v inv_itemCode\r\n              invoice_detail.inv_itemName = productLinked.name;\r\n\r\n              /* ------ X l cqt_vat_ecommerce_item_code_is_barcode ------------------------------------------ */\r\n              if(this.cqt_vat_ecommerce_item_code_is_barcode) {\r\n                const barcode = this.vhQuerySales.getUnit_byRatio(productLinked.units, 1)?.barcode;\r\n                // Nu c barcode th dng barcode\r\n                if(barcode) {\r\n                  invoice_detail.inv_itemCode = barcode;\r\n                }\r\n                // Nu khng c barcode th thng bo\r\n                else {\r\n                  this.vhComponent.hideLoading();\r\n                  this.vhComponent.alertMessageDesktop(\"error\", this.lang.translate(\"Gi ha n ln CQT tht bi. Ha n c cha sn phm cha c m vch, vui lng b sung v th li. Hoc b chn cu hnh M sn phm khi xut ha n l m vch  tip tc\"), 5000);\r\n                  return;\r\n                }\r\n              }\r\n              else {\r\n                invoice_detail.inv_itemCode = productLinked.id_subproduct ? productLinked.id_subproduct : productLinked['_id'];\r\n              }\r\n              \r\n              // Thm vo mng\r\n              invoice_details = this.billService.addEInvoiceDetail(invoice_detail, invoice_details, { cqt_vat_ecommerce_separate_discount_line: this.cqt_vat_ecommerce_separate_discount_line });\r\n            }\r\n            // Nu lin kt vi combo\r\n            else if (productLinked.type === VhType.COMBO) {\r\n              const priceCombo = productLinked.units[0].price;\r\n              if (priceCombo == 0) {\r\n                const errorZeroPriceComboMessage = this.lang.translate(\"Unable to issue the invoice because a linked combo product has a price of 0\", { invoice: order.order_id });\r\n                this.vhComponent.hideLoading();\r\n                this.vhComponent.alertMessageDesktop(\"error\", errorZeroPriceComboMessage);\r\n                return;\r\n              }\r\n\r\n              // loop qua combo ri tnh li chi tit ha n\r\n              for (let j = 0; j < productLinked.combos.length; j++) {\r\n                const combo = productLinked.combos[j];\r\n                // Khi to chi tit ha n\r\n                let combo_detail = this.billService.createEInvoiceDetailTemplate();\r\n\r\n                /** T l phn trm ca gi sn phm v tng gi combo */\r\n                const percentRate = (combo.price * combo.quantity) / priceCombo;\r\n                /** Tnh cht hng ha. Nu inv_TotalAmountWithoutVat = 0 th tchat = 2, nu khng th tchat = 1 */\r\n                const tchatCombo = (!percentRate || combo.price == 0 || invoice_detail.inv_TotalAmountWithoutVat * percentRate == 0) ? 2 : 1;\r\n                /** Sn phm trong combo, get li  ly tax */\r\n                let detailproduct = this.vhQuerySales.getlocalDetailProduct(combo.id_subproduct ? combo.id_subproduct : combo.id_product);\r\n                /** Thu ca bill detail ny. Nu c sn phm lin kt v bt setting cqt_vat_ecommerce_by_linked_product th s ly thu t sn phm lin kt, ngc li th vn ly t billTx nh c  */\r\n                const invoiceDetailComboTax = (this.cqt_vat_ecommerce_by_linked_product && detailproduct && detailproduct.tax !== undefined) ? detailproduct.tax : invoice_detail.ma_thue;\r\n                /** n gi */\r\n                const unitPrice = ((invoice_detail.inv_TotalAmountWithoutVat + invoice_detail.inv_discountAmount) * percentRate) / (combo.quantity * invoice_detail.inv_quantity);\r\n\r\n                // Gn cc gi tr chung\r\n                combo_detail.tchat = tchatCombo;\r\n                combo_detail.stt_rec0 = invoice_details.length + 1;\r\n                combo_detail.inv_unitCode = 'Ci';\r\n                combo_detail.inv_quantity = combo.quantity * invoice_detail.inv_quantity;\r\n                combo_detail.inv_unitPrice = unitPrice; // Gi gc bn sn phm trn sn shopee\r\n                combo_detail.ma_thue = invoiceDetailComboTax;\r\n\r\n\r\n                /* ------ X l cqt_vat_ecommerce_item_code_is_barcode ------------------------------------------ */\r\n                if(this.cqt_vat_ecommerce_item_code_is_barcode) {\r\n                  const barcode = this.vhQuerySales.getUnit_byRatio(combo.units, combo.ratio)?.barcode;\r\n                  // Nu c barcode th dng barcode\r\n                  if(barcode) {\r\n                    combo_detail.inv_itemCode = barcode;\r\n                  }\r\n                  // Nu khng c barcode th thng bo\r\n                  else {\r\n                    this.vhComponent.hideLoading();\r\n                    this.vhComponent.alertMessageDesktop(\"error\", this.lang.translate(\"Gi ha n ln CQT tht bi. Ha n c cha sn phm cha c m vch, vui lng b sung v th li. Hoc b chn cu hnh M sn phm khi xut ha n l m vch  tip tc\"), 5000);\r\n                    return;\r\n                  }\r\n                }\r\n                else {\r\n                  combo_detail.inv_itemCode = combo.id_subproduct ? combo.id_subproduct : combo.id_product;\r\n                }\r\n\r\n\r\n                /* ------ X l tchat --------------------------------------------------------------------------- */\r\n                if (tchatCombo === 2) {\r\n                  // Gn li tn\r\n                  combo_detail.inv_itemName = 'Hng khuyn mi/hng tng ' + combo.name;\r\n                  // Tnh li gi tr tr gi (chit khu) ca chi tit ha n trng hp tchat2\r\n                  combo_detail.inv_discountAmount = 0;\r\n\r\n                  /* ------ X l cqt_vat_ecommerce_by_linked_product --------- */\r\n                  if (this.cqt_vat_ecommerce_by_linked_product) {\r\n                    // Tnh li gi\r\n                    combo_detail.inv_unitPrice = this.billService.calculateNewPriceToUseSettingTax(combo_detail.inv_unitPrice, combo_detail.inv_quantity, combo_detail.inv_discountAmount, combo_detail.ma_thue, 0);\r\n                  }\r\n\r\n                  /* ------ X l Hng khuyn mi c php xut 0 ----------------------------------------------- */\r\n                  // Nu c bt cqt_vat_ecommerce_allow_promotional_items_zero_price v l tchat2 th cn gn li gi = 0,  cc php tnh cho nhng trng khc bn di cng s t tnh = 0\r\n                  if (this.cqt_vat_ecommerce_allow_promotional_items_zero_price) {\r\n                    combo_detail.inv_unitPrice = 0;\r\n                  }\r\n\r\n                  /* ------ X l Vn gi hng xut bn cho sn phm tng/khuyn mi khi gi CQT ------------------ */\r\n                  // Nu c bt cqt_vat_ecommerce_keep_promotional_items_as_sold v l tchat2 th s set li nso thnh tchat1, discountAmount v discountPercentage vn l 0\r\n                  if (this.cqt_vat_ecommerce_keep_promotional_items_as_sold) {\r\n                    // Gn li tchat\r\n                    combo_detail.tchat = 1; // Gn li tchat thnh 1\r\n                    // Gn li tn\r\n                    combo_detail.inv_itemName = combo.name;\r\n                  }\r\n\r\n                  // Tr gi (chit khu) tnh theo %\r\n                  combo_detail.inv_discountPercentage = 0;\r\n                }\r\n                else {\r\n                  // Gn li tn\r\n                  combo_detail.inv_itemName = combo.name;\r\n                  // Tr gi (chit khu) ca nh bn hng trn mi chi tit ha n = seller_discount + shopee_discount\r\n                  combo_detail.inv_discountAmount = this.billService.roundTo4Decimal(invoice_detail.inv_discountAmount * percentRate);\r\n\r\n                  /* ------ X l Gi hng ha, dch v... gi CQT l gi bn  gim ----------------------------------------- */\r\n                  if(this.cqt_vat_ecommerce_item_price_is_discounted) {\r\n                    // Gn li thnh gi  gim\r\n                    combo_detail.inv_unitPrice = combo_detail.inv_unitPrice - combo_detail.inv_discountAmount / combo_detail.inv_quantity;\r\n                    // Gn li Chit khu = 0\r\n                    combo_detail.inv_discountAmount = 0;\r\n                  }\r\n\r\n                  /* ------ X l cqt_vat_ecommerce_by_linked_product --------- */\r\n                  if (this.cqt_vat_ecommerce_by_linked_product) {\r\n                    // Tnh li gi\r\n                    combo_detail.inv_unitPrice = this.billService.calculateNewPriceToUseSettingTax(combo_detail.inv_unitPrice, combo_detail.inv_quantity, combo_detail.inv_discountAmount, combo_detail.ma_thue, 0);\r\n                  }\r\n\r\n                  // Tr gi (chit khu) tnh theo %\r\n                  combo_detail.inv_discountPercentage = combo_detail.inv_discountAmount / (combo_detail.inv_unitPrice * combo_detail.inv_quantity) * 100;\r\n                }\r\n\r\n                // Gi cui ( tr tr gi) ca chi tit ha n\r\n                combo_detail.inv_TotalAmountWithoutVat = combo_detail.inv_unitPrice * combo_detail.inv_quantity - combo_detail.inv_discountAmount;\r\n                // Thu VAT c tnh theo chi tit ha n\r\n                combo_detail.inv_vatAmount = combo_detail.inv_TotalAmountWithoutVat * combo_detail.ma_thue / 100;\r\n                // Tng gi tr hng ha k khai theo chi tit ha n\r\n                combo_detail.inv_TotalAmount = combo_detail.inv_TotalAmountWithoutVat + combo_detail.inv_vatAmount;\r\n\r\n                // Thm vo mng\r\n                invoice_details = this.billService.addEInvoiceDetail(combo_detail, invoice_details, { cqt_vat_ecommerce_separate_discount_line: this.cqt_vat_ecommerce_separate_discount_line });\r\n              }\r\n            }\r\n          }\r\n          else {\r\n            invoice_details = this.billService.addEInvoiceDetail(invoice_detail, invoice_details, { cqt_vat_ecommerce_separate_discount_line: this.cqt_vat_ecommerce_separate_discount_line });\r\n          }\r\n        }\r\n\r\n\r\n\r\n        /* -------------------------- Tnh chi ph vn chuyn, nu c th sinh ra mt chi tit ha n \"Ph vn chuyn\" ------------------------- */\r\n\r\n        // Ph ship ngi mua phi tr\r\n        let shipping_paid_by_buyer = 0;\r\n        // Ph ship ngi ca c tr gi (ngi bn + lazada)\r\n        let shipping_discount = 0;\r\n        if (order.shipping_fee_original > 0) {\r\n          shipping_discount = order.shipping_fee_discount_seller + order.shipping_fee_discount_platform;\r\n          shipping_paid_by_buyer = order.shipping_fee_original - shipping_discount;\r\n        }\r\n        if (this.cqt_submit_invoice_with_shipping_fee && shipping_paid_by_buyer > 0) {\r\n          // Khi to chi tit ha n\r\n          let invoice_detail = this.billService.createEInvoiceDetailTemplate();\r\n\r\n          // Gn cc gi tr chung\r\n          invoice_detail.tchat = 1; // Tnh cht hng ha\r\n          invoice_detail.stt_rec0 = invoice_details.length + 1;\r\n          invoice_detail.inv_itemCode = 'phi_van_chuyen';\r\n          invoice_detail.inv_itemName = 'Ph vn chuyn';\r\n          invoice_detail.inv_unitCode = 'Ln';\r\n          invoice_detail.inv_quantity = 1;\r\n          invoice_detail.inv_unitPrice = order.shipping_fee_original; // Gi gc vn chuyn\r\n          invoice_detail.inv_discountAmount = shipping_discount; // Tr gi (chit khu) ca chi tit ha n\r\n          invoice_detail.inv_TotalAmountWithoutVat = shipping_paid_by_buyer; // Gi cui ( tr tr gi) ca chi tit ha n\r\n          invoice_detail.ma_thue = billTax; // Ly thu cao nht trong thu ca danh sch chi tit ha n\r\n\r\n          /* ------ X l cqt_vat_ecommerce_already_Included ---------------------------------------------- */\r\n          if (this.cqt_vat_ecommerce_already_Included) {\r\n            // Tnh li gi\r\n            invoice_detail.inv_unitPrice = this.billService.calculateNewPriceToUseSettingTax(invoice_detail.inv_unitPrice, invoice_detail.inv_quantity, invoice_detail.inv_discountAmount, invoice_detail.ma_thue, 0);\r\n          }\r\n\r\n          // Tr gi (chit khu) tnh theo %\r\n          invoice_detail.inv_discountPercentage = invoice_detail.inv_discountAmount / (invoice_detail.inv_unitPrice * invoice_detail.inv_quantity) * 100;\r\n          // Gi cui ( tr tr gi) ca chi tit ha n\r\n          invoice_detail.inv_TotalAmountWithoutVat = invoice_detail.inv_unitPrice - invoice_detail.inv_discountAmount;\r\n          // Thu VAT c tnh theo chi tit ha n\r\n          invoice_detail.inv_vatAmount = invoice_detail.inv_TotalAmountWithoutVat * invoice_detail.ma_thue / 100;\r\n          // Tng gi tr hng ha k khai theo chi tit ha n\r\n          invoice_detail.inv_TotalAmount = invoice_detail.inv_TotalAmountWithoutVat + invoice_detail.inv_vatAmount;\r\n\r\n          // Thm vo mng\r\n          invoice_details = this.billService.addEInvoiceDetail(invoice_detail, invoice_details, { cqt_vat_ecommerce_separate_discount_line: this.cqt_vat_ecommerce_separate_discount_line });\r\n        }\r\n\r\n        // tnh ph giao dch\r\n        if (this.cqt_submit_invoice_with_ecommerce_fee) {\r\n          /** Tng tin gim gi (Tng tin chit khu) */\r\n          let totalDiscountAmount = 0;\r\n          const startTime = new Date(order.created_at);\r\n          const endTime = new Date();\r\n          const json = {\r\n            start_time: startTime,\r\n            end_time: endTime,\r\n            limit: 100,\r\n            offset: 0,\r\n            trade_order_id: order.order_id,\r\n            trans_type: -1,\r\n          };\r\n\r\n          const listFee = await this.vhQuerySales.getTransactionDetailsLazada(json, this.infoShop['access_token']) as any[];\r\n          const phi_co_dinh = this.calculateTotalFee(listFee, 'Commission');\r\n          const phi_xu_ly_don_hang = this.calculateTotalFee(listFee, 'Payment Fee');\r\n          const ecommerce_fee = phi_co_dinh + phi_xu_ly_don_hang;\r\n          totalDiscountAmount += ecommerce_fee;\r\n          /** Tin thu */\r\n          const vatAmount = 0; // Khng c thu cho chit khu thng mi\r\n\r\n          // Khi to chi tit ha n\r\n          let invoice_detail = this.billService.createEInvoiceDetailTemplate();\r\n\r\n          // Gn cc gi tr chung\r\n          invoice_detail.tchat = 3;\r\n          invoice_detail.stt_rec0 = invoice_details.length + 1;\r\n          invoice_detail.inv_itemCode = 'chiet_khau_thuong_mai';\r\n          invoice_detail.inv_itemName = 'Chit khu thng mi';\r\n          invoice_detail.inv_unitCode = 'Phn';\r\n          invoice_detail.inv_quantity = 1;\r\n          invoice_detail.inv_unitPrice = totalDiscountAmount;\r\n          invoice_detail.inv_TotalAmountWithoutVat = totalDiscountAmount;\r\n          invoice_detail.ma_thue = 0; // Khng c thu cho chit khu thng mi\r\n          invoice_detail.inv_vatAmount = vatAmount;\r\n          invoice_detail.inv_TotalAmount = totalDiscountAmount + vatAmount;\r\n\r\n          // Thm vo mng\r\n          invoice_details = this.billService.addEInvoiceDetail(invoice_detail, invoice_details, { cqt_vat_ecommerce_separate_discount_line: this.cqt_vat_ecommerce_separate_discount_line });\r\n        }\r\n\r\n\r\n\r\n        /* ---------------------------------------------- Gn li cc trng tnh ton cho invoice ---------------------------------------------- */\r\n\r\n        for (let i = 0; i < invoice_details.length; i++) {\r\n          if (invoice_details[i].tchat == 1) {\r\n            // tchat 1 th cng dn\r\n            invoice.inv_discountAmount += invoice_details[i].inv_discountAmount;\r\n            invoice.inv_vatAmount += invoice_details[i].inv_vatAmount;\r\n            invoice.inv_TotalAmountWithoutVat += invoice_details[i].inv_TotalAmountWithoutVat;\r\n            invoice.inv_TotalAmount += invoice_details[i].inv_TotalAmount;\r\n          } else if (invoice_details[i].tchat == 2) {\r\n            // tchat 2 th b qua\r\n          } else if (invoice_details[i].tchat == 3) {\r\n            // tchat 3 th phi tr li\r\n            invoice.inv_discountAmount -= invoice_details[i].inv_discountAmount;\r\n            invoice.inv_vatAmount -= invoice_details[i].inv_vatAmount;\r\n            invoice.inv_TotalAmountWithoutVat -= invoice_details[i].inv_TotalAmountWithoutVat;\r\n            invoice.inv_TotalAmount -= invoice_details[i].inv_TotalAmount;\r\n          }\r\n        }\r\n        //Ha n in t thu gm 2 phn ha n + chi tit ha n\r\n        let invoices = [{ ...invoice, details: [{ data: invoice_details }] }];\r\n        console.log('invoices', invoices);\r\n        resolve({ vcode: 0, msg: 'success', data: invoices });\r\n      } catch (err) {\r\n        console.error(' Li changeLazada_toInvoice_byMinvoice:', err);\r\n        reject(err);\r\n      }\r\n    });\r\n  }\r\n\r\n\r\n\r\n  private groupedItemsMap = new Map<string, any[]>();\r\n\r\n  getGroupedItemsCached(orderItems: any[]): any[] {\r\n    const key = JSON.stringify(orderItems);\r\n    if (!this.groupedItemsMap.has(key)) {\r\n      const filtered = orderItems.filter(e => !e.reason || e.status == 'delivered');\r\n      const grouped = new Map<number, { sku_id: number; name: string; quantity: number; }>();\r\n      for (const item of filtered) {\r\n        if (grouped.has(item.sku_id)) {\r\n          grouped.get(item.sku_id)!.quantity += 1;\r\n        } else {\r\n          grouped.set(item.sku_id, {\r\n            sku_id: Number(item.sku_id),\r\n            name: item.name,\r\n            quantity: 1\r\n          });\r\n        }\r\n      }\r\n      this.groupedItemsMap.set(key, Array.from(grouped.values()));\r\n    }\r\n\r\n    return this.groupedItemsMap.get(key)!;\r\n  }\r\n\r\n  findProductLinked(item) {\r\n    for (let productOfBranch of this.listProductOfBranch) {\r\n      for (let productLazada of productOfBranch[this.id_branch].lazadas) {\r\n        let findProd = productLazada.skus.find(sku => sku.SkuId == item.sku_id);\r\n        if (findProd) {\r\n          return productOfBranch;\r\n        }\r\n      }\r\n    }\r\n\r\n    return null;\r\n  }\r\n\r\n  /**\r\n   * Kim tra sn phm  c lien kt hay cha\r\n   *\r\n   */\r\n  isLinkedToProduct(item): boolean {\r\n    for (let productOfBranch of this.listProductOfBranch) {\r\n      for (let productLazada of productOfBranch[this.id_branch].lazadas) {\r\n        let findProd = productLazada.skus.find(sku => sku.SkuId == item.sku_id);\r\n        if (findProd) {\r\n          return true;\r\n        }\r\n      }\r\n    };\r\n    return false;\r\n  }\r\n\r\n  visible_affiliate: boolean = false; // hin th modal chn sn phm phn mm lin kt\r\n  productLazadaSelected: any = null; // sn phm lazada c chn  lien kt\r\n\r\n\r\n  openModelSelectProductsLazada(productLazada) {\r\n    this.productLazadaSelected = productLazada;\r\n    this.visible_affiliate = true;\r\n  }\r\n\r\n\r\n  /**\r\n   * Tt modal v clone mng product ra mt mng mi  trnh nh li product c b checked\r\n   */\r\n  cancelAffiliate() {\r\n    this.visible_affiliate = false;\r\n  }\r\n\r\n\r\n  /**\r\n    * Lin kt sn phm t lazada vi sn phm ti ca hng.\r\n    * @param product Sn phm ca ca hng\r\n    */\r\n  acceptAfiliate(product) {\r\n    const isZeroPriceCombo = product.type == VhType.COMBO && product.units[0].price == 0;\r\n    const confirmZeroPriceComboMessage = this.lang.translate(\"This product is a combo with a price of 0. Do you still want to link it with the product\", { platform: 'Lazada' }) + \"?\";\r\n    this.modal.confirm({\r\n      nzTitle: '<i>' + (isZeroPriceCombo ? confirmZeroPriceComboMessage : this.lang.translate(\"Confirm\")) + '</i>',\r\n      nzIconType: \"info-circle\",\r\n      nzCancelText: this.lang.translate(\"Cancel\"),\r\n      nzOnOk: () => {\r\n        this.vhComponent.showLoading(\"\", \"transparent-loading\").then(() => {\r\n          // Tm sn phm lazada theo sku_id\r\n          const selectedSkuId = this.productLazadaSelected?.sku_id;\r\n          const matchedProduct = this.listProductLazada.find(product =>\r\n            product.skus?.some(sku => sku.SkuId == selectedSkuId)\r\n          );\r\n\r\n          const id_product_selected = product.id_subproduct ? product.id_subproduct : product['_id'];\r\n\r\n          let productLazada = {\r\n            id_shop: this.infoShop._id,\r\n            item_id: matchedProduct.item_id,\r\n            SkuIds: [{ SkuId: this.productLazadaSelected.sku_id }]\r\n          };\r\n\r\n          this.vhQuerySales.addMergeLazadasProduct_skus(id_product_selected, productLazada.item_id, productLazada.SkuIds, this.infoShop['_id']).then((bool) => {\r\n            this.vhComponent.hideLoading().then(() => {\r\n              setTimeout(() => {\r\n                this.visible_affiliate = false;\r\n                this.listProductOfBranch = this.vhQuerySales.getlocalDetailProducts(35).filter(e => !e.delete_hidden).filter(item => item[this.id_branch] && item[this.id_branch].lazadas && item[this.id_branch].lazadas.length >= 0);\r\n                this.vhComponent.alertMessageDesktop('success', this.lang.translate(\"Product linked successfully\"));\r\n              }, 300);\r\n            });\r\n          }).catch(err => {\r\n            console.error(err);\r\n            this.visible_affiliate = false;\r\n            this.vhComponent.alertMessageDesktop('error', this.lang.translate(\"The product link failed\"));\r\n            this.vhComponent.hideLoading(0);\r\n          });\r\n        });\r\n      }\r\n    });\r\n  }\r\n\r\n  normalizeVietnamTaxPercent(itemPrice: number, taxAmount: number): number {\r\n    if (itemPrice === 0) return 0;\r\n\r\n    const calculatedPercent = (taxAmount / itemPrice) * 100;\r\n\r\n    if (calculatedPercent <= 5) return 5;\r\n    if (calculatedPercent > 5 && calculatedPercent <= 7) return 7;\r\n    return 10;\r\n  }\r\n\r\n  calculateTotalFee(data: any[], typeFee: string): number {\r\n    return data\r\n      .filter(item => item.fee_name === typeFee)\r\n      .map(item => {\r\n        // Remove commas and convert to a number\r\n        const rawAmount = item.amount.replace(/,/g, '');\r\n        return Math.abs(parseFloat(rawAmount));\r\n      })\r\n      .reduce((total, amount) => total + amount, 0);\r\n  }\r\n\r\n  /** C hin th modal chnh sa customer tax hay khng */\r\n  isShowModalEditCustomerTax: boolean = false;\r\n  tempCustomerTax: any = null;\r\n  /**\r\n   * Khi nhn edit ct thng tin khch hng\r\n   */\r\n  editTax(invoice) {\r\n    this.tempCustomerTax = invoice;\r\n    this.isShowModalEditCustomerTax = true;\r\n  }\r\n\r\n\r\n  /**\r\n   * Khi ok trong modal chnh sa customer tax\r\n   * @param customerTaxInfo\r\n   */\r\n  onOkEditTax(customerTaxInfo) {\r\n    this.isShowModalEditCustomerTax = false;\r\n\r\n    Object.assign(this.tempCustomerTax, customerTaxInfo);\r\n  }\r\n\r\n\r\n\r\n  /**\r\n   * m s lng bill ang check\r\n   */\r\n  get countSelectedBill(): number {\r\n    return this.salesOrder?.filter((e: any) => e.checked)?.filter((data: any) => !data.cqt_status || data.cqt_status == 1)?.length;\r\n  }\r\n\r\n\r\n\r\n  /**\r\n   * Ly ngy cp nht ca n hng theo nh dng 2025-06-25\r\n   */\r\n  getUpdateTimeFormat(order) {\r\n    return this.vhAlgorithm.formatDateToString(new Date(order.updated_at));\r\n  }\r\n\r\n\r\n\r\n  /**\r\n   * Xut danh sch ang hin trn table ra file excel\r\n   */\r\n  exportExcel() {\r\n    if (!this.salesOrder || !this.salesOrder.length) return;\r\n  \r\n    // Lp qua danh sch ha n\r\n    const XLSXData = this.salesOrder.reduce((acc, order) => {\r\n      if (!order || !order.order_items || !order.order_items.length) return acc;\r\n  \r\n      // Mi item trong order_items s thnh 1 row\r\n      const rows = order.order_items.map(item => ({\r\n        'orderItemId': item.order_item_id?.toString() || '',\r\n        'orderType': item.order_flag || '',\r\n        'deliveryType': item.shipping_provider_type?.toUpperCase() || '',\r\n        'lazadaId': item.order_item_id?.toString() || '',\r\n        'sellerSku': item.sku || '',\r\n        'lazadaSku': item.shop_sku || '',\r\n        'createTime': this.datePipe.transform(item.created_at, 'yyyy-MM-dd HH:mm') || '',\r\n        'updateTime': this.datePipe.transform(item.updated_at, 'yyyy-MM-dd HH:mm') || '',\r\n        'ttsSla': item.sla_time_stamp || '',\r\n        'orderNumber': item.order_id?.toString() || '',\r\n        'invoiceRequired': !JSON.parse(order?.extra_attributes)?.TaxInvoiceRequested ? 'No' : 'Yes',\r\n        'invoiceNumber': item.invoice_number || '',\r\n        'customerName': (order.customer_first_name + ' ' + order.customer_last_name)?.trim() || '',\r\n        'nationalRegistrationNumber': order.national_registration_number || '',\r\n        'shippingName': (order.address_shipping.first_name + ' ' + order.address_shipping.last_name)?. trim() || '',\r\n        'shippingAddress': order.address_shipping.address1 || '',\r\n        'shippingAddress2': order.address_shipping.address2 || '',\r\n        'shippingAddress3': order.address_shipping.address3 || '',\r\n        'shippingAddress4': order.address_shipping.address4 || '',\r\n        'shippingAddress5': order.address_shipping.address5 || '',\r\n        'shippingPhone': order.address_shipping.phone || '',\r\n        'shippingPhone2': order.address_shipping.phone2 || '',\r\n        'shippingCity': order.address_shipping.city || '',\r\n        'shippingPostCode': order.address_shipping.post_code || '',\r\n        'shippingCountry': order.address_shipping.country || '',\r\n        'billingName': (order.address_billing.first_name + ' ' + order.address_billing.last_name)?.trim() || '',\r\n        'billingAddr': order.address_billing.address1 || '',\r\n        'billingAddr2': order.address_billing.address2 || '',\r\n        'billingAddr3': order.address_billing.address3 || '',\r\n        'billingAddr4': order.address_billing.address4 || '',\r\n        'billingAddr5': order.address_billing.address5 || '',\r\n        'billingPhone': order.address_billing.phone || '',\r\n        'billingPhone2': order.address_billing.phone2 || '',\r\n        'billingCity': order.address_billing.city || '',\r\n        'billingPostCode': order.address_billing.post_code || '',\r\n        'billingCountry': order.address_billing.country || '',\r\n        'taxCode': order.tax_code || '',\r\n        'branchNumber': order.branch_number || '',\r\n        'taxInvoiceRequested': JSON.parse(order?.extra_attributes)?.TaxInvoiceRequested,\r\n        'payMethod': order.payment_method || '',\r\n        'paidPrice': item.paid_price || '',\r\n        'unitPrice': item.item_price || '',\r\n        'sellerDiscountTotal': -(item.voucher_seller) || '',\r\n        'shippingFee': item.shipping_amount || '',\r\n        'walletCredit': item.wallet_credits || '',\r\n        'itemName': item.name || '',\r\n        'variation': item.variation || '',\r\n        'shippingProvider': item?.shipment_provider?.split(',')[1]?.split(':')[1]?.trim() || '',\r\n        'shipmentTypeName': item.shipping_type || '',\r\n        'shippingProviderType': item.shipping_provider_type?.toUpperCase() || '',\r\n        'trackingCode': item.tracking_code || '',\r\n        'shippingProviderFM': item?.shipment_provider?.split(',')[0] || '',\r\n        'status': item.status || '',\r\n        'semi_managed': item.semi_managed\r\n      }));\r\n  \r\n      return acc.concat(rows);\r\n    }, []);\r\n  \r\n    // X l tn file, s c dng Order.{status}.{startDate}_{endDate}.xlsx\r\n    const statusName = this.vhAlgorithm.changeAlias(this.list_status_bill[this.selectedIndex]?.name?.toLowerCase().replace(/ /g, '') || 'all');\r\n    const startDate = this.vhAlgorithm.formatDateToString(this.date[0]).replace(/-/g, '');\r\n    const endDate = this.vhAlgorithm.formatDateToString(this.date[1]).replace(/-/g, '');\r\n    const nameFile = `Order.${statusName}.${startDate}_${endDate}`;\r\n\r\n    this.vhAlgorithm.exportXLSX(XLSXData, nameFile).then(() => {\r\n      console.log('Xut file Excel thnh cng:', nameFile);\r\n    }).catch(err => {\r\n      console.error('Li xut file Excel:', err);\r\n    });\r\n  }\r\n\r\n}\r\n","<div nz-row class=\"row-back medium-size\" (click)=\"goBack()\">\r\n    <i nz-icon nzType=\"left\" nzTheme=\"outline\"></i>{{'Back' | translate}}\r\n</div>\r\n\r\n<nz-layout id=\"order-status-lazada\">\r\n    <div nz-row nzGutter=\"4\" class=\"order-status-lazada-header\">\r\n        <!-- Tiu  -->\r\n        <div nz-col nzSpan=\"6\" class=\"title\">\r\n            <b>{{'Xut ha n in t t sn' | translate}}</b> <br>\r\n             {{'Shop name' | translate}}: <b class=\"color-green\">{{infoShop.data?.name}}</b>\r\n        </div>\r\n        <!-- Tm kim -->\r\n        <div nz-col nzSpan=\"6\" class=\"title center-all-content\">\r\n            <nz-input-group [nzSuffix]=\"suffixIconSearch\">\r\n                <input [(ngModel)]=\"searchValue\" (ngModelChange)=\"search($event)\" type=\"text\" nz-input\r\n                    [placeholder]=\"'Tm m n hng (phn tch bi du phy)' | translate\" />\r\n            </nz-input-group>\r\n            <ng-template #suffixIconSearch>\r\n                <i nz-icon nzType=\"search\"></i>\r\n            </ng-template>\r\n        </div>\r\n        <!-- Chn ngy -->\r\n        <div nz-col nzSpan=\"6\">\r\n             <nz-range-picker nzFormat='dd/MM/yyyy' [nzDisabledDate]=\"disabledDate\" nzFormat=\"dd/MM/yyyy\" [(ngModel)]=\"date\"\r\n                (ngModelChange)=\"changeTime($event)\">\r\n            </nz-range-picker>\r\n        </div>\r\n        <!-- Nt xem bo co v gi CQT -->\r\n        <div nz-col nzSpan=\"6\" class=\"right-all-content\">\r\n             <button class=\"btn-view center-all-content\" nz-button nzType=\"default\" (click)=\"showReport()\">\r\n                    <ion-icon src=\"assets/icon/management/view.svg\"></ion-icon>\r\n                    {{'View' | translate}}\r\n                </button>\r\n            <button class=\"btn-view center-all-content\" nz-button nzType=\"default\" (click)=\"sendCQT()\">\r\n                {{'Gi CQT' | translate}}\r\n            </button>\r\n            <button class=\"btn-view center-all-content\" nz-button nzType=\"default\" (click)=\"exportExcel()\">\r\n                {{'Xut Excel' | translate}}\r\n            </button>\r\n        </div>\r\n    </div>\r\n\r\n    <div *ngIf=\"load_status else no_data\" nz-row nzGutter=\"16\" class=\"order-status-lazada-body\">\r\n        <div nz-col nzSpan=\"24\">\r\n\r\n            <nz-tabset [(nzSelectedIndex)]=\"selectedIndex\" (nzSelectChange)=\"segmentChanged($event.index)\">\r\n                <nz-tab *ngFor=\"let item of list_status_bill\" nzTitle=\"{{item.name | translate}} ({{orderCountByStatus[item.name]}})\"></nz-tab>\r\n                <nz-tab *ngIf=\"orderOthersCountByStatus > 0\" nzTitle=\"{{'Other' | translate}} ({{orderOthersCountByStatus}})\"></nz-tab>\r\n            </nz-tabset>\r\n\r\n            <nz-table *ngIf=\"salesOrder.length > 0;else no_bill\" [nzScroll]=\"{y: heightScroll }\" #salesOrder_show\r\n                nzShowPagination nzShowSizeChanger [nzData]=\"salesOrder\" [nzPageSize]=\"20\"\r\n                [nzPageSizeOptions]=\"[20, 30, 40, 50, 100, 200]\">\r\n                <thead>\r\n                    <tr>\r\n                        <th nzAlign=\"center\" nzWidth=\"6%\"><b>{{'No.' | translate}}</b></th>\r\n                        <th nzLeft nzWidth=\"17%\"><b>{{'Date order' | translate}}</b></th>\r\n                        <th nzLeft nzWidth=\"17%\"><b>{{'Order number' | translate}}</b></th>\r\n                        <th><b>{{'Product' | translate}}</b></th>\r\n                        <th nzWidth=\"15%\"><b>{{'Status on Lazada' | translate}}</b></th>\r\n                        <th style=\"cursor: pointer;\" nzAlign='left'\r\n                            (click)=\"statusCol = !statusCol; sortTable('status')\">\r\n                            <b>{{'Status CQT' | translate}}</b>\r\n                            <i nz-icon [nzType]=\"statusCol == true ? 'caret-down':'caret-up'\" nzTheme=\"outline\"></i>\r\n                        </th>\r\n                        <th style=\"text-align: right;\" nzWidth=\"17%\"><b>{{\"Total\"| translate}}</b></th>\r\n                        <!-- <th style=\"text-align: center;\" nzWidth=\"17%\"><b>{{\"Canceled reason\" | translate}}</b></th> -->\r\n                        <th nzAlign=\"center\" [(nzChecked)]=\"allChecked\" [nzIndeterminate]=\"indeterminate\" (nzCheckedChange)=\"checkAll($event)\">\r\n                            ({{countSelectedBill}})\r\n                        </th>\r\n                    </tr>\r\n                </thead>\r\n                <tbody>\r\n                    <tr (click)=\"gotoDetail(bill)\" *ngFor=\"let bill of salesOrder_show.data,index as i\"\r\n                        style=\"cursor: pointer;\">\r\n                        <td nzAlign=\"center\">{{(salesOrder_show.nzPageIndex - 1) * salesOrder_show.nzPageSize + i + 1}}</td>\r\n                        <td nzLeft>\r\n                            {{bill.created_at | date : \"dd/MM/yyyy HH:mm\"}}</td>\r\n                        <td nzLeft> <a target=\"_blank\"\r\n                                href=\"https://sellercenter.lazada.vn/apps/order/detail?spm=a1zawf.20980230.order_table_{{i}}.1.77a14edf58FSge&tradeOrderId={{bill.order_id}}\">\r\n                                {{bill.order_id}} </a><i\r\n                                (click)=\"$event.stopPropagation();vhComponent.copyValue(bill.order_id)\" nz-icon\r\n                                nzType=\"copy\" nzTheme=\"outline\"></i>\r\n\r\n                        </td>\r\n                        <td>\r\n                            <span [style.color]=\"isLinkedToProduct(item) ? '' : 'var(--ion-color-vh-red)'\" style=\"font-size: 0.8rem;\" *ngFor=\"let item of getGroupedItemsCached(bill.order_items)\">\r\n                                {{isLinkedToProduct(item) ? findProductLinked(item).name : item.name}} (SL: {{item.quantity}})\r\n                                <i *ngIf=\"!isLinkedToProduct(item)\" (click)=\"$event.stopPropagation();openModelSelectProductsLazada(item)\" class=\"icon-link green\" nz-icon nzType=\"link\" nzTheme=\"outline\"></i>\r\n                                <br>\r\n                            </span>\r\n                        </td>\r\n                        <td>\r\n                            <span *ngIf=\"bill.statuses[0] != 'pending' && bill.statuses[0] != 'packed'\" nz-tooltip [nzTooltipTitle]=\"getUpdateTimeFormat(bill)\">\r\n                                <span *ngIf=\"bill.statuses.length<2;else multiStatus\">{{bill.statuses[0]|\r\n                                    translate}}</span>\r\n                                <ng-template #multiStatus>\r\n                                    <div><span style=\"color:var(--ion-color-vh-green);\">{{bill.deliveredProduct}}</span>\r\n                                        sp giao thnh cng</div>\r\n                                    <div><span style=\"color:var(--ion-color-vh-red);\">{{bill.canceledProduct}}</span> sp\r\n                                        giao tht bi</div>\r\n                                </ng-template>\r\n                            </span>\r\n                        </td>\r\n                        <td>\r\n                            <span *ngIf=\"bill.cqt_status == 3\">{{'Sent to CQT' | translate}} <span nz-tooltip [nzTooltipTitle]=\"'View E-invoice' | translate\" nz-icon class=\"ant-input-password-icon\" [nzType]=\"'eye'\" (click)=\"$event.stopPropagation(); printService.viewEInvoice(infoBranch, {_id: bill.order_id})\"></span></span>\r\n                            <span *ngIf=\"bill.cqt_status == 2\">{{'Waiting for signature' | translate}} <span nz-tooltip [nzTooltipTitle]=\"'View E-invoice' | translate\" nz-icon class=\"ant-input-password-icon\" [nzType]=\"'eye'\" (click)=\"$event.stopPropagation(); printService.viewEInvoice(infoBranch, {_id: bill.order_id})\"></span></span>\r\n                            <span *ngIf=\"!bill.cqt_status || bill.cqt_status == 1\">{{'Not sent to CQT' | translate}}</span>\r\n                        </td>\r\n                        <td style=\"text-align: right;\"><b>{{vhAlgorithm.vhcurrencyunit(bill.total_amount)}}</b></td>\r\n                       <td nzAlign=\"center\" (click)=\"$event.stopPropagation();\">\r\n                        <i (click)=\"editTax(bill)\" class=\"cus-icon\" nz-icon nzType=\"info-circle\" nzTheme=\"outline\"\r\n                                style=\"cursor: pointer;margin-right: 10px;\"></i>\r\n                            <label  *ngIf=\"bill.cqt_status == 1 || !bill.cqt_status\" [(ngModel)]=\"bill.checked\" (ngModelChange)=\"refreshStatus()\"\r\n                                nz-button  nz-checkbox>\r\n                            </label>\r\n                        </td>\r\n                        <!-- <td style=\"text-align: left;\">{{bill.carrier_name}}</td> -->\r\n                    </tr>\r\n                </tbody>\r\n            </nz-table>\r\n            <ng-template #no_bill class=\"full-height\">\r\n                <div nz-col nzSpan=\"24\" class=\"center-all-content\">\r\n                    <div>{{'No data'| translate}}</div>\r\n                </div>\r\n            </ng-template>\r\n        </div>\r\n    </div>\r\n    <ng-template #no_data>\r\n        <div nz-row class=\"no-affiliate\">\r\n            <div nz-col nzSpan=\"24\" class=\"text-center\">\r\n                <img src=\"assets/icon/management/ecommerce/no-data-orderstatus.svg\" alt=\"\">\r\n                <p>{{\"Please click the view button\"|\r\n                    translate}}</p>\r\n            </div>\r\n        </div>\r\n    </ng-template>\r\n\r\n</nz-layout>\r\n\r\n<!-- -------------------------------------------- MODAL CHNH SA THNG TIN THU KHCH HNG -------------------------------------------- -->\r\n<app-edit-customer-tax *ngIf=\"isShowModalEditCustomerTax\" ecommerce_platform=\"lazada\" [invoice]=\"tempCustomerTax\" [infoShop]=\"infoShop\"\r\n    (onClose)=\"isShowModalEditCustomerTax = false\" (onOk)=\"isShowModalEditCustomerTax = false; onOkEditTax($event)\">\r\n</app-edit-customer-tax>\r\n\r\n<!-- --------------modal chn sn phm lin kt--------------- -->\r\n<app-modal-link-product-ecommerce\r\n    [title]=\"'Select Lazada linked products' | translate\"\r\n    [visible_affiliate]=\"visible_affiliate\"\r\n    [listProductApp]=\"listProductApp\"\r\n    [searchProductAppValue]=\"searchProductAppValue\"\r\n    (cancelAffiliate)=\"cancelAffiliate()\"\r\n    (searchProductApp)=\"searchProductApp($event)\"\r\n    (acceptAfiliate)=\"acceptAfiliate($event)\"\r\n></app-modal-link-product-ecommerce>\r\n","\r\nimport { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { RouterModule, Routes } from '@angular/router';\r\nimport { NgZorroAntModule } from 'src/app/ng-zorro-ant.module';\r\nimport { TranslateModule } from '@ngx-translate/core';\r\nimport { IonicModule } from '@ionic/angular';\r\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\r\nimport { ModalLinkProductEcommerceModule } from 'src/app/sales/menu/manage/ecommerce/components/modal-link-product-ecommerce/modal-link-product-ecommerce.module';\r\nimport { EInvoiceLazadaComponent } from './e-invoice-lazada.component';\r\nimport { EditCustomerTaxModule } from 'src/app/sales/menu/manage/ecommerce/components/edit-customer-tax/edit-customer-tax.module';\r\n\r\nconst routes: Routes = [\r\n  {\r\n    path: \"\",\r\n    component: EInvoiceLazadaComponent\r\n  },\r\n]\r\n\r\n\r\n\r\n@NgModule({\r\n  declarations: [\r\n    EInvoiceLazadaComponent\r\n  ],\r\n  imports: [\r\n    CommonModule,\r\n    RouterModule.forChild(routes),\r\n    NgZorroAntModule,\r\n    TranslateModule,\r\n    IonicModule,\r\n    FormsModule,\r\n    ReactiveFormsModule,\r\n    EditCustomerTaxModule,\r\n    ModalLinkProductEcommerceModule\r\n  ]\r\n})\r\nexport class EInvoiceLazadaModule { }\r\n"],"names":["VhType","i0","$event","_r28","ctx_r33","_id","ctx_r36","ctx_r46","ctx_r49","ctx_r8","_r9","ctx_r58","ctx_r5","EInvoiceLazadaComponent","constructor","router","lang","vhComponent","vhAlgorithm","vhQuerySales","cdRef","modal","vhAuth","vhEinvoice","vhQuery","vhEcommerce","billService","printService","datePipe","name","value","value2","value3","Date","current","getTime","getStore","registrationdate","getDefaultBranch","getlocalBranch","getLocalAppSettingNameBranch","cqt_submit_invoice_with_shipping_fee","cqt_submit_invoice_with_ecommerce_fee","cqt_vat_ecommerce_already_Included","cqt_vat_ecommerce_rate","cqt_invoice_auto_sign","cqt_vat_ecommerce_by_linked_product","cqt_vat_ecommerce_allow_promotional_items_zero_price","cqt_vat_ecommerce_separate_discount_line","cqt_vat_ecommerce_keep_promotional_items_as_sold","cqt_vat_ecommerce_use_latest_order_update_time","cqt_vat_ecommerce_buyer_info_with_platform_and_so_benh_an","cqt_vat_ecommerce_default_payment_method_chuyen_khoan","cqt_vat_ecommerce_item_code_is_barcode","cqt_vat_ecommerce_item_price_is_discounted","Map","dataRestore","getCurrentNavigation","extras","state","_a","ngOnInit","searchValue","salesOrder","salesSubOrder","countOrderByStatus","load_status","selectedIndex","date","segmentChanged","infoShop","getlocalShopListLazada","listProductOfBranch","getlocalDetailProducts","filter","e","delete_hidden","item","id_branch","lazadas","length","localProducts","listProductApp","map","prod","id_shop","getUnit_byRatio","units","listSubProductApp","returnArrayHiddenProduct","listProductLazada","clearProductShow","getlocalProductListLazada","arrayHidden","includes","item_id","forEach","attributes","arr","localProduct","product","hidden","push","listProduct","prodApp","indexProd","findIndex","indexSku","skus","indexSub","sku","SkuId","splice","changeTime","event","showToast","translate","search","valArray","split","val","changeAlias","toString","trim","toLowerCase","some","order_id","_b","searchProductApp","searchList","list_status_bill","status","statuses","orders","orderOthersCountByStatus","order","key","orderCountByStatus","find","goBack","navigate","showReport","showLoading","then","getSalesOrderDetailListLazada","setHours","toISOString","access_token","result","hideLoading","count","order_items","deliveredProduct","canceledProduct","Object","checked","total_amount","calculateTotal","created_at","cqt_status","error","catch","err","sortTable","colName","dateCol","sortDatebyASC","sortDatebyDESC","statusCol","sortNumberbyASC","sortNumberbyDESC","console","log","bill","ngAfterViewChecked","document","querySelector","heightScroll","clientHeight","getElementById","widthScroll","clientWidth","detectChanges","gotoDetail","id_shop_selected","checkAll","data","disabled","refreshStatus","validData","allChecked","every","allUnChecked","indeterminate","sendCQT","bill_checked","alertMessageDesktop","sort","a","b","update_time","batchSize","totalBatches","Math","ceil","showLoadingNotDuration","i","batch","slice","currentBatchIndex","floor","promises","signatureManual","results","asyncPromiseAll","invoice","Promise","resolve","reject","currentBranch","einvoices","invoice_provider","invoiceSeries","isLoading","changeLazada_toInvoice_byMinvoice","rsp","vcode","saveInvoice_Sign_byMinvoice","taxcode","token","res","code","updateSalesOrderLazada_byFile","array","message","saveInvoice_noSign_byMinvoice","order_details","quantity","undefined","j","sku_id","item_price","paid_price","voucher_amount","shipping_amount","inv_invoiceSeries","inv_invoiceIssuedDate","formatDateToString","inv_currencyCode","inv_exchangeRate","inv_discountAmount","inv_vatAmount","inv_TotalAmountWithoutVat","inv_TotalAmount","key_api","so_benh_an","updated_at","buyerDisplayNameDefault","inv_paymentMethodName","payment_method","inv_buyerDisplayName","tax_buyerDisplayName","inv_buyerLegalName","tax_buyerLegalName","inv_buyerTaxCode","tax_buyerTaxCode","inv_buyerAddressLine","tax_buyerAddressLine","inv_buyerEmail","tax_buyerEmail","billTax","invoice_details","Array","productLinked","findProductLinked","invoice_detail","createEInvoiceDetailTemplate","tchat","voucher_seller","invoiceDetailTax","tax","stt_rec0","inv_itemCode","inv_unitCode","inv_quantity","inv_unitPrice","ma_thue","inv_itemName","calculateNewPriceToUseSettingTax","inv_discountPercentage","type","PRODUCT","barcode","id_subproduct","addEInvoiceDetail","COMBO","priceCombo","price","errorZeroPriceComboMessage","combos","combo","combo_detail","percentRate","tchatCombo","detailproduct","getlocalDetailProduct","id_product","invoiceDetailComboTax","unitPrice","ratio","roundTo4Decimal","shipping_paid_by_buyer","shipping_discount","shipping_fee_original","shipping_fee_discount_seller","shipping_fee_discount_platform","totalDiscountAmount","startTime","endTime","json","start_time","end_time","limit","offset","trade_order_id","trans_type","listFee","getTransactionDetailsLazada","phi_co_dinh","calculateTotalFee","phi_xu_ly_don_hang","ecommerce_fee","vatAmount","invoices","details","msg","getGroupedItemsCached","orderItems","JSON","stringify","groupedItemsMap","has","filtered","reason","grouped","get","set","Number","from","values","productOfBranch","productLazada","findProd","isLinkedToProduct","openModelSelectProductsLazada","productLazadaSelected","visible_affiliate","cancelAffiliate","acceptAfiliate","isZeroPriceCombo","confirmZeroPriceComboMessage","platform","confirm","nzTitle","nzIconType","nzCancelText","nzOnOk","selectedSkuId","matchedProduct","id_product_selected","SkuIds","addMergeLazadasProduct_skus","bool","setTimeout","normalizeVietnamTaxPercent","itemPrice","taxAmount","calculatedPercent","typeFee","fee_name","rawAmount","amount","replace","abs","parseFloat","reduce","total","editTax","tempCustomerTax","isShowModalEditCustomerTax","onOkEditTax","customerTaxInfo","assign","countSelectedBill","_c","getUpdateTimeFormat","exportExcel","XLSXData","acc","rows","order_item_id","order_flag","shipping_provider_type","toUpperCase","shop_sku","transform","sla_time_stamp","_d","parse","extra_attributes","_e","TaxInvoiceRequested","invoice_number","customer_first_name","customer_last_name","_f","national_registration_number","address_shipping","first_name","last_name","_g","address1","address2","address3","address4","address5","phone","phone2","city","post_code","country","address_billing","_h","tax_code","branch_number","_j","wallet_credits","variation","shipment_provider","_k","_l","_m","shipping_type","_o","tracking_code","_p","semi_managed","concat","statusName","startDate","endDate","nameFile","exportXLSX","selectors","decls","vars","consts","template","ctx","_r3"],"sourceRoot":"webpack:///"}