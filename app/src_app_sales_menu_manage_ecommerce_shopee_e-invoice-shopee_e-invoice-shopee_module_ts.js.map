{"version":3,"file":"src_app_sales_menu_manage_ecommerce_shopee_e-invoice-shopee_e-invoice-shopee_module_ts.js","mappings":"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","sources":["./src/app/sales/menu/manage/ecommerce/shopee/e-invoice-shopee/e-invoice-shopee.component.ts","./src/app/sales/menu/manage/ecommerce/shopee/e-invoice-shopee/e-invoice-shopee.component.html","./src/app/sales/menu/manage/ecommerce/shopee/e-invoice-shopee/e-invoice-shopee.module.ts"],"sourcesContent":["import { DatePipe } from '@angular/common';\r\nimport { ChangeDetectorRef, Component, OnInit, TemplateRef } from '@angular/core';\r\nimport { Router } from '@angular/router';\r\nimport { VhAlgorithm, VhAuth, VhEcommerce, VhEinvoice, VhQuery, VhQuerySales } from 'ionic-vhframeworks';\r\nimport { NzModalService } from 'ng-zorro-antd/modal';\r\nimport { VhComponent } from 'src/app/sales/components/vh-component/vh-component';\r\nimport { VhType } from 'src/app/sales/interface/vh-type';\r\nimport { BillService } from 'src/app/sales/services/bill.service';\r\nimport { LanguageService } from 'src/app/sales/services/language.service';\r\nimport { PrintService } from 'src/app/sales/services/print.service';\r\n@Component({\r\n  selector: 'app-e-invoice-shopee',\r\n  templateUrl: './e-invoice-shopee.component.html',\r\n  styleUrls: ['./e-invoice-shopee.component.scss']\r\n})\r\nexport class EInvoiceShopeeComponent implements OnInit {\r\n  searchValue: any;\r\n  searchProductAppValue: any = '';\r\n  salesOrder: Array<any> = [];\r\n  salesSubOrder: Array<any> = [];\r\n  selectedIndex: number = 0;\r\n  loadingPickup: boolean = false;\r\n  loadingConfirm: boolean = false;\r\n  isVisibleConfirm: boolean = false;\r\n  billSelected: any = {};\r\n  list_status_bill: Array<any> = [\r\n    { name: \"All\", value: \"ALL\" },\r\n    { name: \"Wait for confirmation\", value: \"UNPAID\" },\r\n    { name: \"Ch ly hng\", value: \"READY_TO_SHIP\", value2: \"PROCESSED\" },\r\n    { name: \"Shipping\", value: \"SHIPPED\", value2: \"RETRY_SHIP\" },\r\n    { name: \"Delivered\", value: \"TO_CONFIRM_RECEIVE\" },\r\n    { name: \"Hon tt\", value: \"COMPLETED\" },\r\n    { name: \" hy\", value: \"IN_CANCEL\", value2: \"CANCELLED\" },\r\n    { name: \"Tr hng\", value: \"TO_RETURN\" },\r\n  ];\r\n  // UNPAID, READY_TO_SHIP, PROCESSED, SHIPPED, TO_CONFIRM_RECEIVE, COMPLETED, RETRY_SHIP, IN_CANCEL, CANCELLED, TO_RETURN\r\n  heightScroll: any;\r\n  widthScroll: any;\r\n  public date: Date[] = [new Date(), new Date()];\r\n  startTimeBackUp: Date;\r\n  endTimeBackUp: Date;\r\n  load_status: boolean = false;\r\n  dataRestore: any;\r\n  /**Gii hn thi gian cho xem bill */\r\n  disabledDate = (current: Date): boolean => {\r\n    // if (current.getTime() < new Date(this.vhAuth.getStore().registrationdate).getTime() - 24 * 60 * 60 * 1000) return true;\r\n    return false;\r\n    //  return true;\r\n  };\r\n  listAddress: Array<any> = [];\r\n  listTimes: Array<any> = [];\r\n  infoShop: any = {};\r\n  listProductOfBranch: Array<any> = []; // sp ca phn mm c lin kt vi sp shopee\r\n  listProductApp: Array<any> = []; // sp trong phn mm cha shopee[]\r\n  listSubProductApp: Array<any> = []; //sp ca app  search\r\n  listProductShopee: Array<any> = []; // sp ca shopee\r\n  id_branch: string = this.vhQuerySales.getDefaultBranch()._id;\r\n  infoBranch = this.vhQuerySales.getlocalBranch(this.vhQuerySales.getDefaultBranch()._id);\r\n  constructor(\r\n    private router: Router,\r\n    public lang: LanguageService,\r\n    public vhComponent: VhComponent,\r\n    public vhAlgorithm: VhAlgorithm,\r\n    private vhQuerySales: VhQuerySales,\r\n    private cdRef: ChangeDetectorRef,\r\n    private datePipe: DatePipe,\r\n    private vhEcommerce: VhEcommerce,\r\n    private vhAuth: VhAuth,\r\n    private vhQuery: VhQuery,\r\n    private vhEinvoice: VhEinvoice,\r\n    private nzModalService: NzModalService,\r\n    private billService: BillService,\r\n    public printService: PrintService,\r\n  ) {\r\n    this.dataRestore = this.router.getCurrentNavigation().extras.state?.dataRestore;\r\n  }\r\n\r\n  ngOnInit(): void {\r\n    this.disabledDate(new Date());\r\n    if (this.dataRestore) {\r\n      this.searchValue = this.dataRestore.searchValue;\r\n      this.salesOrder = this.dataRestore.salesOrder;\r\n      this.salesSubOrder = this.dataRestore.salesSubOrder;\r\n      this.countOrderByStatus(this.salesOrder);\r\n      this.load_status = true;\r\n      this.selectedIndex = this.dataRestore.selectedIndex;\r\n      this.date = this.dataRestore.date;\r\n    }\r\n    this.infoShop = this.vhEcommerce.getlocalShopListShopee()[0];\r\n\r\n    this.listProductOfBranch = this.vhQuerySales.getlocalDetailProducts(35).filter(e => !e.delete_hidden).filter(item => item[this.id_branch] && item[this.id_branch].shopees && item[this.id_branch].shopees.length >= 0);\r\n    let localProducts: Array<any> = this.vhQuerySales.getlocalDetailProducts(35).filter(e => !e.delete_hidden);\r\n\r\n    this.listProductApp = localProducts.map(item => {\r\n      let unit = this.vhQuerySales.getUnit_byRatio(item.units, 1);\r\n      if (item[this.id_branch] && item[this.id_branch].shopees && item[this.id_branch].shopees.length) { //filter nhng sp shopee thuc id shopee  chn\r\n        item[this.id_branch].product_shopees = [...item[this.id_branch].shopees.filter(prod => prod.id_shop == this.infoShop._id)];\r\n      }\r\n      return { ...item, ...unit };\r\n    });\r\n    this.listSubProductApp = [...this.listProductApp];\r\n\r\n    this.listProductShopee = this.clearProductShow(this.vhEcommerce.getlocalProductListShopee(this.infoShop['_id']).filter(item => item.item_status == 'NORMAL'), this.listProductApp);\r\n  }\r\n\r\n  changeTime(event) {\r\n    if (event[1].getTime() - event[0].getTime() <= 1209600000) {\r\n    } else {\r\n      this.vhComponent.showToast(2000, this.lang.translate(\"Thi gian xem khng qu 15 ngy\"), \"alert-toast\");\r\n      this.date = [event[0], new Date(event[0].getTime() + 1209600000)];\r\n    }\r\n  }\r\n\r\n  search(value: string) {\r\n    this.segmentChanged(this.selectedIndex);\r\n    /** Mng bill cn search */\r\n    let valArray: string[] = value.split(',').map(val => this.vhAlgorithm.changeAlias(val?.toString().trim().toLowerCase())).filter(val => val?.length > 0);\r\n    if (valArray?.length > 0) {\r\n      // search theo order_sn\r\n      this.salesOrder = this.salesOrder.filter(item => {\r\n        return valArray.some(val => {\r\n          return this.vhAlgorithm.changeAlias(item?.order_sn?.toString())?.includes(val);\r\n        });\r\n      });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * search tn sn phm trong app viethas\r\n   * @example this.search('Sn phm A')\r\n   */\r\n  searchProductApp(value: string) {\r\n    let val: string = this.vhAlgorithm.changeAlias(value.trim().toLowerCase());\r\n    this.listProductApp = this.vhAlgorithm.searchList(val, [...this.listSubProductApp], ['name','barcode','item_code']);\r\n  }\r\n  segmentChanged(event) { // sau ny s filter theo trng thi qua hm ny\r\n    // Nu chn tab Khc th hin nhng n khng c trong danh sch trng thi\r\n    if(event === this.list_status_bill.length) {\r\n      this.salesOrder = this.salesSubOrder.filter(item => {\r\n        return !this.list_status_bill.some(status => status.value === item.order_status || status.value2 === item.order_status);\r\n      });\r\n        return;\r\n      }\r\n\r\n    if (event == 0) this.salesOrder = this.salesSubOrder\r\n    else this.salesOrder = this.salesSubOrder.filter(item => item.order_status == this.list_status_bill[event].value || item.order_status == this.list_status_bill[event].value2);\r\n  }\r\n\r\n\r\n\r\n  /** Map cha s lng n hng theo trng thi */\r\n  orderCountByStatus: any = {\r\n    \"All\": 0,\r\n    \"Wait for confirmation\": 0,\r\n    \"Ch ly hng\": 0,\r\n    \"Shipping\": 0,\r\n    \"Delivered\": 0,\r\n    \"Hon tt\": 0,\r\n    \" hy\": 0,\r\n    \"Tr hng\": 0,\r\n  }\r\n  /** S lng n hng khng nm trong danh sch trng thi */\r\n  orderOthersCountByStatus = 0;\r\n\r\n  /**\r\n   * m s lng n hng theo trng thi\r\n   * @param orders\r\n   */\r\n  countOrderByStatus(orders) {\r\n    this.orderOthersCountByStatus = orders.filter(order => {\r\n      return !this.list_status_bill.some(status => status.value === order.order_status || status.value2 === order.order_status);\r\n    }).length;\r\n    for (const key in this.orderCountByStatus) {\r\n      if (key === 'All') {\r\n        this.orderCountByStatus[key] = orders.length;\r\n      }\r\n      else {\r\n        this.orderCountByStatus[key] = orders.filter(order => {\r\n          return order.order_status === this.list_status_bill.find(status => status.name === key).value ||\r\n            order.order_status === this.list_status_bill.find(status => status.name === key).value2;\r\n        }).length;\r\n      }\r\n    }\r\n  }\r\n\r\n\r\n\r\n  goBack() {\r\n    this.router.navigate(['/sales/dashboard/manage/ecommerce/shopee'], {\r\n      state: {\r\n        dataRestore: { dataRestore: this.dataRestore }\r\n      }\r\n    });\r\n  }\r\n\r\n  showReport() {\r\n    this.load_status = true;\r\n    this.salesOrder = [];\r\n    this.vhComponent.showLoading(\"\", \"transparent-loading\").then(() => {\r\n      this.vhEcommerce.getSalesOrderListShopee(new Date(this.datePipe.transform(new Date(this.date[0].setHours(0, 0, 0)), \"yyyy-MM-dd HH:mm:ss\").toString()), new Date(this.datePipe.transform(new Date(this.date[1].setHours(23, 59, 59)), \"yyyy-MM-dd HH:mm:ss\").toString()), this.infoShop.access_token.toString(), this.infoShop._id.toString())\r\n        .then((result: any) => {\r\n          this.vhComponent.hideLoading(0);\r\n          this.salesOrder = result.map(item => { return { ...item, create_at: new Date(item.create_time * 1000), checked: item.cqt_status == 1 || !item.cqt_status ? true : false, cqt_status: item.cqt_status ?? 1}; });\r\n          this.salesSubOrder = this.salesOrder;\r\n          this.countOrderByStatus(this.salesOrder);\r\n          this.segmentChanged(this.selectedIndex);\r\n\r\n        })\r\n        .catch(err => this.vhComponent.hideLoading(0));\r\n    });\r\n  }\r\n\r\n  calculateTotal(bill) {\r\n    return +bill['price'] - bill['voucher'] + bill['shipping_fee'];\r\n  }\r\n\r\n  ngAfterViewChecked() {\r\n    if (document.querySelector(\"#order-status-tiki\") && document.querySelector(\".ant-tabs-tab\") && document.querySelector(\".ant-table-thead\") && document.querySelector(\".order-status-tiki-header\") && document.querySelector(\".ant-table-pagination\")) {\r\n      this.heightScroll = document.querySelector(\"#order-status-tiki\").clientHeight - document.querySelector(\".ant-table-thead\").clientHeight\r\n        - document.querySelector(\".order-status-tiki-header\").clientHeight - document.querySelector(\".ant-tabs-tab\").clientHeight - 90 + \"px\";\r\n    }\r\n    if (document.getElementById(\"order-status-tiki\"))\r\n      this.widthScroll = document.getElementById(\"order-status-tiki\").clientWidth + \"px\";\r\n    this.cdRef.detectChanges();\r\n  }\r\n\r\n\r\n  gotoDetail(bill) {\r\n    // this.router.n/avigate(['/sales/dashboard/manage/ecommerce/shopee/order-status/detail'], { state: { bill: bill, dataRestore: { salesOrder: this.salesOrder, searchValue: this.searchValue, id_shop_selected: this.infoShop._id, date: this.date, salesSubOrder: this.salesSubOrder, selectedIndex: this.selectedIndex } } });\r\n  }\r\n\r\n  /** hm sort cho cc ct */\r\n  dateCol = false;\r\n  bill_codeCol = false;\r\n  partner_nameCol = false;\r\n  payment_nameCol = false;\r\n  statusCol = false;\r\n  sum_priceCol = false;\r\n  /** Hm thc hin sp xp theo collection\r\n   *\r\n   * @param colName       // tn ct mun sp xp\r\n   */\r\n  sortTable(colName) {\r\n    switch (colName) {\r\n      case 'date':\r\n        if (this.dateCol) {\r\n          this.salesOrder = this.vhAlgorithm.sortDatebyASC([...this.salesOrder], colName);\r\n        } else {\r\n          this.salesOrder = this.vhAlgorithm.sortDatebyDESC([...this.salesOrder], colName);\r\n        }\r\n        break;\r\n      case 'status': if (this.statusCol) {\r\n        this.salesOrder = this.vhAlgorithm.sortNumberbyASC([...this.salesOrder], 'cqt_status');\r\n      } else {\r\n        this.salesOrder = this.vhAlgorithm.sortNumberbyDESC([...this.salesOrder], 'cqt_status');\r\n      }\r\n        console.log(this.salesOrder);\r\n        break;\r\n    }\r\n  }\r\n  allChecked = true;\r\n  indeterminate = true;\r\n\r\n\r\n\r\n  /**\r\n   * Check tt c\r\n   * @param value\r\n   */\r\n  checkAll(value: boolean): void {\r\n    this.salesOrder.forEach(data => {\r\n      if (!data.disabled) {\r\n        data.checked = value;\r\n      }\r\n    });\r\n    this.refreshStatus();\r\n  }\r\n\r\n\r\n\r\n  /**\r\n   * Check 1 ci\r\n   */\r\n  refreshStatus(): void {\r\n    const validData = this.salesOrder.filter(value => !value.disabled);\r\n    const allChecked = validData.length > 0 && validData.every(value => value.checked === true);\r\n    const allUnChecked = validData.every(value => !value.checked);\r\n    this.allChecked = allChecked;\r\n    this.indeterminate = !allChecked && !allUnChecked;\r\n  }\r\n\r\n  async sendCQT() {\r\n    let bill_checked = this.salesOrder.filter(item => item.checked).filter((data: any) => !data.cqt_status || data.cqt_status == 1); // lc ra nhng ha n  chn v cha gi ln CQT\r\n    if (bill_checked.length == 0) {\r\n      this.vhComponent.alertMessageDesktop(\"error\", this.lang.translate(\"Vui lng chn ha n cn gi CQT\"));\r\n      return;\r\n    }\r\n\r\n    // Nu c bt cqt_vat_ecommerce_use_latest_order_update_time th sp xp theo thi gian cp nht trng thi gn nht ca n hng t sn, \r\n    // c gi trc, mi gi sau\r\n    if(this.cqt_vat_ecommerce_use_latest_order_update_time) {\r\n      bill_checked = bill_checked.sort((a, b) => a.update_time - b.update_time);\r\n    }\r\n\r\n    const batchSize = 1;\r\n    const totalBatches = Math.ceil(bill_checked.length / batchSize);\r\n    if (!bill_checked.length) {\r\n      this.vhComponent.alertMessageDesktop('error', this.lang.translate(\"Please select at least one invoice\"));\r\n      return;\r\n\r\n    }\r\n    await this.vhComponent.showLoadingNotDuration(this.lang.translate(\"Sending...\"));\r\n    for (let i = 0; i < bill_checked.length; i += batchSize) {\r\n      // to mi ln 5 request gi ha n\r\n      const batch = bill_checked.slice(i, i + batchSize);\r\n      const currentBatchIndex = Math.floor(i / batchSize) + 1;\r\n      const promises = batch.map(bill => {\r\n        return this.signatureManual(bill);\r\n\r\n\r\n      });\r\n\r\n      try {\r\n        const results = await this.vhQuery.asyncPromiseAll(promises);\r\n        console.log(`Batch ${i / batchSize + 1}:`, results);\r\n        if (currentBatchIndex == totalBatches) {\r\n          this.vhComponent.hideLoading();\r\n\r\n        }\r\n      } catch (error) {\r\n        // trng hp 1 vi n b li ko gi dc\r\n        if (currentBatchIndex == totalBatches) {\r\n          this.vhComponent.hideLoading();\r\n\r\n        }\r\n        console.error(`Error in batch ${i / batchSize + 1}:`, error);\r\n      }\r\n\r\n\r\n    }\r\n\r\n  }\r\n\r\n  /**\r\n   * hm ny k ha n ln cqt\r\n   * @param invoice\r\n   */\r\n  signatureManual(invoice) {\r\n\r\n    return new Promise((resolve, reject) => {\r\n\r\n      // ly ra chi nhnh hin ti\r\n      let currentBranch = this.vhQuerySales.getlocalBranch(this.vhQuerySales.getDefaultBranch()._id);\r\n\r\n      // trng hp cha c to kt ni ha n in t\r\n      if (!currentBranch.einvoices?.length) {\r\n        this.vhComponent.alertMessageDesktop(\"error\", this.lang.translate(\"Please connect e-invoice for this branch\"));\r\n        resolve(true);\r\n        return;\r\n      }\r\n      // trng hp ch c 1 kt ni ha n in t th to thng lun\r\n      if (currentBranch.einvoices.length && currentBranch.einvoices.length == 1) {\r\n        // trng hp ncc ha n in t l M-invoice\r\n        if (currentBranch.einvoices[0].invoice_provider == 'M-invoice') {\r\n\r\n          if (!currentBranch.einvoices[0].invoiceSeries.length) {\r\n            this.vhComponent.alertMessageDesktop(\"error\", this.lang.translate(\"Please connect e-invoice for this branch\"));\r\n            resolve(true);\r\n            return;\r\n          }\r\n          invoice.isLoading = true;\r\n\r\n          this.changeShopee_toInvoice_byMinvoice(invoice, currentBranch.einvoices[0].invoiceSeries[0])\r\n            .then((rsp: any) => {\r\n              console.log('rsp', rsp);\r\n              if (rsp.vcode == 0) {\r\n                // K t ng ngay khi gi ha n ln C quan thu\r\n                if (this.cqt_invoice_auto_sign) {\r\n                  this.vhEinvoice.saveInvoice_Sign_byMinvoice(currentBranch.taxcode, currentBranch.einvoices[0].token, 1, rsp.data)\r\n                    .then((res: any) => {\r\n                      console.log(res);\r\n                      invoice.isLoading = false;\r\n                      if (res.code == '00') {\r\n                        invoice.cqt_status = 3;\r\n                        invoice.status = this.lang.translate(\"Sent to CQT\");\r\n                        this.vhComponent.alertMessageDesktop(\"success\", this.lang.translate('Update invoice to CQT successfully'));\r\n                        this.vhEcommerce.updateSalesOrderShopee_byFile([invoice.order_sn.toString()], { cqt_status: 3 }, this.infoShop.access_token, this.infoShop._id)\r\n                          .then((array: any) => {\r\n                            console.log('updateSalesOrderShopee_byFile', array);\r\n                            resolve(true);\r\n                          }, error => {\r\n                            console.log(error);\r\n                          });\r\n                      }\r\n                      else if (res.code == '9999') {\r\n                        resolve(true);\r\n                        this.vhComponent.alertMessageDesktop(\"error\", this.lang.translate(\"Vui lng kim tra li thng tin ha n y ln CQT cha ph hp\"));\r\n                      }\r\n                      else if (res.code == '296') {\r\n                        resolve(true);\r\n                        this.vhComponent.alertMessageDesktop(\"error\", this.lang.translate(\"Khng th gi nhng ha n c ngy lp ha n nh hn ngy lp ha n cui cng  gi ln C quan thu. <br> Nu cn gi nhng ha n c hn, bn cn tt cu hnh 'S dng thi gian cp nht trng thi gn nht ca n hng t sn  thit lp ngy lp ha n' trong Ci t\"), 4000);\r\n                      }\r\n                      else {\r\n                        resolve(true);\r\n                        this.vhComponent.alertMessageDesktop(\"error\", this.lang.translate(res.message));\r\n                      }\r\n                    }, (error: any) => {\r\n                      invoice.isLoading = true;\r\n                      this.vhComponent.alertMessageDesktop(\"error\", this.lang.translate(\"C li xy ra khi khi to ha n y ln CQT\"));\r\n                      console.log('error', error);\r\n                    });\r\n                }\r\n                // KHNG K t ng ngay khi gi ha n ln C quan thu\r\n                else {\r\n                  this.vhEinvoice.saveInvoice_noSign_byMinvoice(currentBranch.taxcode, currentBranch.einvoices[0].token, 1, rsp.data)\r\n                    .then((res: any) => {\r\n                      console.log(res);\r\n                      invoice.isLoading = false;\r\n                      if (res.code == '00') {\r\n                        invoice.cqt_status = 2;\r\n                        invoice.status = this.lang.translate(\"Sent to CQT\");\r\n                        this.vhComponent.alertMessageDesktop(\"success\", this.lang.translate('Update invoice to CQT successfully'));\r\n                        this.vhEcommerce.updateSalesOrderShopee_byFile([invoice.order_sn.toString()], { cqt_status: 2 }, this.infoShop.access_token, this.infoShop._id)\r\n                          .then((array: any) => {\r\n                            console.log('updateSalesOrderShopee_byFile', array);\r\n                            resolve(true);\r\n                          }, error => {\r\n                            console.log(error);\r\n                          });\r\n                      }\r\n                      else if (res.code == '9999') {\r\n                        resolve(true);\r\n                        this.vhComponent.alertMessageDesktop(\"error\", this.lang.translate(\"Vui lng kim tra li thng tin ha n y ln CQT cha ph hp\"));\r\n                      }\r\n                      else if (res.code == '296') {\r\n                        resolve(true);\r\n                        this.vhComponent.alertMessageDesktop(\"error\", this.lang.translate(\"Khng th gi nhng ha n c ngy lp ha n nh hn ngy lp ha n cui cng  gi ln C quan thu. <br> Nu cn gi nhng ha n c hn, bn cn tt cu hnh 'S dng thi gian cp nht trng thi gn nht ca n hng t sn  thit lp ngy lp ha n' trong Ci t\"), 4000);\r\n                      }\r\n                      else {\r\n                        resolve(true);\r\n                        this.vhComponent.alertMessageDesktop(\"error\", this.lang.translate(res.message));\r\n                      }\r\n                    }, (error: any) => {\r\n                      invoice.isLoading = true;\r\n                      this.vhComponent.alertMessageDesktop(\"error\", this.lang.translate(\"C li xy ra khi khi to ha n y ln CQT\"));\r\n                      console.log('error', error);\r\n                    });\r\n                }\r\n              }\r\n              else {\r\n                invoice.isLoading = true;\r\n                this.vhComponent.alertMessageDesktop(\"error\", this.lang.translate(\"C li xy ra khi khi to ha n y ln CQT\"));\r\n              }\r\n            }, (error: any) => {\r\n              this.vhComponent.alertMessageDesktop(\"error\", this.lang.translate(\"C li xy ra khi khi to ha n y ln CQT\"));\r\n              invoice.isLoading = true;\r\n              console.log('error', error);\r\n            });\r\n\r\n        }\r\n      }\r\n      // trng hp ch c 2 kt ni ha n in t tr ln th hin modal chn ncc  ha n in t\r\n      if (currentBranch.einvoices.length && currentBranch.einvoices.length > 1) {\r\n\r\n      }\r\n    });\r\n  }\r\n\r\n  /** Gi ha n ln C quan thu km ph vn chuyn */\r\n  cqt_submit_invoice_with_shipping_fee = this.vhQuerySales.getLocalAppSettingNameBranch('permission_branch').cqt_submit_invoice_with_shipping_fee;\r\n  /** Gi ha n ln C quan thu km ph giao dch/ph sn */\r\n  cqt_submit_invoice_with_ecommerce_fee = this.vhQuerySales.getLocalAppSettingNameBranch('permission_branch').cqt_submit_invoice_with_ecommerce_fee;\r\n  /** Gi bn hng ha, dch v... trn sn  bao gm thu VAT */\r\n  cqt_vat_ecommerce_already_Included = this.vhQuerySales.getLocalAppSettingNameBranch('permission_branch').cqt_vat_ecommerce_already_Included;\r\n  /** % thu VAT */\r\n  cqt_vat_ecommerce_rate = this.vhQuerySales.getLocalAppSettingNameBranch('permission_branch').cqt_vat_ecommerce_rate;\r\n  /** K t ng ngay khi gi ha n ln C quan thu */\r\n  cqt_invoice_auto_sign = this.vhQuerySales.getLocalAppSettingNameBranch('permission_branch').cqt_invoice_auto_sign;\r\n  /** Gi bn hng ha, dch v trn sn  bao gm VAT, tnh theo VAT hng ha, dch v lin kt */\r\n  cqt_vat_ecommerce_by_linked_product = this.vhQuerySales.getLocalAppSettingNameBranch('permission_branch').cqt_vat_ecommerce_by_linked_product;\r\n  /** Hng khuyn mi c php xut 0. Nu l true th tchat2 s c cc ct = 0, ma_thue vn l s bnh thng */\r\n  cqt_vat_ecommerce_allow_promotional_items_zero_price = this.vhQuerySales.getLocalAppSettingNameBranch('permission_branch').cqt_vat_ecommerce_allow_promotional_items_zero_price;\r\n  /** Xut ring chit khu/gim gi ca sn phm thnh 1 dng ring khi gi CQT */\r\n  cqt_vat_ecommerce_separate_discount_line = this.vhQuerySales.getLocalAppSettingNameBranch('permission_branch').cqt_vat_ecommerce_separate_discount_line;\r\n  /** Vn gi hng xut bn cho sn phm tng/khuyn mi khi gi CQT */\r\n  cqt_vat_ecommerce_keep_promotional_items_as_sold = this.vhQuerySales.getLocalAppSettingNameBranch('permission_branch').cqt_vat_ecommerce_keep_promotional_items_as_sold;\r\n  /** S dng thi gian cp nht trng thi gn nht ca n hng t sn  thit lp ngy lp ha n */\r\n  cqt_vat_ecommerce_use_latest_order_update_time = this.vhQuerySales.getLocalAppSettingNameBranch('permission_branch').cqt_vat_ecommerce_use_latest_order_update_time;\r\n  /** Xut ha n t sn vi thng tin ngi mua km theo tn sn v m n hng */\r\n  cqt_vat_ecommerce_buyer_info_with_platform_and_so_benh_an = this.vhQuerySales.getLocalAppSettingNameBranch('permission_branch').cqt_vat_ecommerce_buyer_info_with_platform_and_so_benh_an;\r\n  /** Xut ha n t sn vi thng tin thanh ton mc nh l 'Chuyn khon' */\r\n  cqt_vat_ecommerce_default_payment_method_chuyen_khoan: boolean = this.vhQuerySales.getLocalAppSettingNameBranch('permission_branch').cqt_vat_ecommerce_default_payment_method_chuyen_khoan;\r\n  /** M sn phm khi gi CQT l m vch sn phm */\r\n  cqt_vat_ecommerce_item_code_is_barcode = this.vhQuerySales.getLocalAppSettingNameBranch('permission_branch').cqt_vat_ecommerce_item_code_is_barcode;\r\n  /** Gi hng ha, dch v... gi CQT l gi bn  gim */\r\n  cqt_vat_ecommerce_item_price_is_discounted = this.vhQuerySales.getLocalAppSettingNameBranch('permission_branch').cqt_vat_ecommerce_item_price_is_discounted;\r\n\r\n  /**\r\n  * @example\r\n  * this.vhQuerySales.changeShopee_toInvoice_byMinvoice(order, invoiceSeries)\r\n      .then((rsp) => {\r\n        //-----------your code here-----------\r\n      }, (error:any) => {\r\n          console.log('error', error);\r\n      });\r\n\r\n   * @param order ha n ly t tiktok v\r\n   * @param invoiceSeries k hiu ha n\r\n   * @returns Promise => {vcode, msg, data(array)}\r\n   *\r\n   *\r\n   * Cu trc cn x l 3 ci:\r\n   *  - Danh sch ha n chi tit:\r\n   *    + Check trng hp combo\r\n   *  - Ph vn chuyn\r\n   *  - Chit khu thng mi\r\n   *\r\n   *\r\n   * Ghi ch:\r\n   *  - Trng hp c bt cqt_vat_ecommerce_already_Included, th phi tnh li Gi  total sau khi p thu (thu t phn ci t ca app mnh) v Chit khu l khng thay i.\r\n   *  - tchat2 v tchat3 th discountAmount v discountPercentage s = 0\r\n   *  - Chit khu thng mi th Thu = 0\r\n   *  - Combo s khng c trng hp tt c cc sn phm bn trong c gi = 0 ( bt khi lin kt sn phm) nn c th b qua trng hp ny\r\n   *  - i vi combo lin kt, Trng hp cqt_vat_ecommerce_by_linked_product th bt  combo nhng vn gi code  invoice_detail cha  logic khng b thay i. Trng hp cqt_vat_ecommerce_already_Included th bt  invoice_detail cha, khng cn bt  combo na, v khi chia ra t l vn s m bo do  tnh  cha\r\n   */\r\n  public async changeShopee_toInvoice_byMinvoice(order: any, invoiceSeries: string) {\r\n\r\n    return new Promise(async (resolve, reject) => {\r\n\r\n      try {\r\n\r\n        const escrowShopee: any = await this.vhEcommerce.getEscrowShopee(order.order_sn, this.infoShop.access_token, this.infoShop._id);\r\n        console.log('escrowShopee', escrowShopee);\r\n        console.log('order', order);\r\n\r\n        // gn li chi tit ha n ca shopee thnh invoice_details\r\n        let order_details: any = [...escrowShopee.order_income.items];\r\n\r\n\r\n\r\n        /* ---------------------------------------------------------- Khi to invoice ---------------------------------------------------------- */\r\n\r\n        let invoice: any = {\r\n          inv_invoiceSeries: invoiceSeries,\r\n          inv_invoiceIssuedDate: this.vhAlgorithm.formatDateToString(new Date()),\r\n          inv_currencyCode: \"VND\",\r\n          inv_exchangeRate: 1,\r\n          inv_discountAmount: 0,\r\n          inv_vatAmount: 0,\r\n          inv_TotalAmountWithoutVat: 0,\r\n          inv_TotalAmount: 0,\r\n          key_api: order.order_sn,\r\n          so_benh_an: order.order_sn,\r\n        };\r\n\r\n\r\n\r\n        /* --------- X l cqt_vat_ecommerce_use_latest_order_update_time th ly ngy cp nht trng thi gn nht ca n hng t sn --------- */\r\n        if (this.cqt_vat_ecommerce_use_latest_order_update_time) {\r\n          invoice.inv_invoiceIssuedDate = this.vhAlgorithm.formatDateToString(new Date(order.update_time * 1000));// *1000  chuyn t giy sang mili giy\r\n        }\r\n\r\n\r\n\r\n        /* --------------------------------------------------------- Thng tin ngi mua -------------------------------------------------------- */\r\n\r\n        /** Tn ngi mua mc nh nu khng c thng tin trong ha n */\r\n        let buyerDisplayNameDefault = 'Ngi mua khng ly ha n';\r\n        /* ------ X l cqt_vat_ecommerce_buyer_info_with_platform_and_so_benh_an --------------------------------------------------------------- */\r\n        // Nu bt th s thnh: Tn sn - Ngi mua khng ly ha n - M n hng\r\n        if(this.cqt_vat_ecommerce_buyer_info_with_platform_and_so_benh_an) {\r\n          buyerDisplayNameDefault = `Shopee - ${buyerDisplayNameDefault} - ${invoice.so_benh_an}`;\r\n        }\r\n        \r\n        /* ------ X l cqt_vat_ecommerce_default_payment_method_chuyen_khoan ------------------------------------------------------------------- */\r\n        // Nu c bt th lun l 'Chuyn khon', nu khng th s ly theo ca n hng\r\n        if(this.cqt_vat_ecommerce_default_payment_method_chuyen_khoan) {\r\n          invoice.inv_paymentMethodName = 'Chuyn khon';\r\n        }\r\n        else {\r\n          invoice.inv_paymentMethodName = order.payment_method == 'Cash on Delivery' ? 'Tin mt' : 'Chuyn khon';\r\n        }\r\n\r\n        invoice.inv_buyerDisplayName = order.tax_buyerDisplayName ? order.tax_buyerDisplayName : buyerDisplayNameDefault;\r\n        invoice.inv_buyerLegalName = order.tax_buyerLegalName ? order.tax_buyerLegalName : '';\r\n        invoice.inv_buyerTaxCode = order.tax_buyerTaxCode ? order.tax_buyerTaxCode : '';\r\n        invoice.inv_buyerAddressLine = order.tax_buyerAddressLine ? order.tax_buyerAddressLine : '';\r\n        invoice.inv_buyerEmail = order.tax_buyerEmail ? order.tax_buyerEmail : '';\r\n\r\n\r\n\r\n        /* ------------------------------------------------------ Tnh ton invoice details ----------------------------------------------------- */\r\n\r\n        /** Thu sn */\r\n        let platformTax = escrowShopee.order_income.vat_on_imported_goods;\r\n        /** Thu ca ha n (ly t sn / t ci t) */\r\n        let billTax = 0;\r\n        // nu bt cqt_vat_ecommerce_already_Included th ly thu t ci t\r\n        if(this.cqt_vat_ecommerce_already_Included) {\r\n          billTax = this.cqt_vat_ecommerce_rate || 0;\r\n        }\r\n        else {\r\n          billTax = platformTax;\r\n        }\r\n\r\n        //  LU : GI TR SHOPEE TR V  BAO GM S LNG\r\n        let invoice_details = new Array();\r\n\r\n        for (let i = 0; i < order_details.length; i++) {\r\n          /** Sn phm lin kt vi sn phm ca sn */\r\n          const productLinked = this.findProductLinked(order_details[i]);\r\n          // Khi to chi tit ha n\r\n          let invoice_detail = this.billService.createEInvoiceDetailTemplate();\r\n\r\n          /** Tnh cht hng ha. Nu inv_TotalAmountWithoutVat = 0 th tchat = 2, nu khng th tchat = 1 */\r\n          const tchat = (order_details[i].original_price - (order_details[i].seller_discount || 0)) === 0 ? 2 : 1;\r\n          /** Thu ca bill detail ny. Nu c sn phm lin kt v bt setting cqt_vat_ecommerce_by_linked_product th s ly thu t sn phm lin kt, ngc li th vn ly t billTx nh c  */\r\n          const invoiceDetailTax = (this.cqt_vat_ecommerce_by_linked_product && productLinked && productLinked.tax !== undefined) ? productLinked.tax : billTax;\r\n\r\n          // Gn cc gi tr chung\r\n          invoice_detail.tchat = tchat;\r\n          invoice_detail.stt_rec0 = invoice_details.length + 1;\r\n          invoice_detail.inv_itemCode = order_details[i].item_id;\r\n          invoice_detail.inv_unitCode = 'Ci';\r\n          invoice_detail.inv_quantity = order_details[i].quantity_purchased;\r\n          invoice_detail.inv_unitPrice = order_details[i].original_price / order_details[i].quantity_purchased; // Gi gc bn sn phm trn sn shopee\r\n          invoice_detail.ma_thue = invoiceDetailTax;\r\n\r\n\r\n          /* ------ X l tchat --------------------------------------------------------------------------- */\r\n          if(tchat === 2) {\r\n            // Gn li tn\r\n            invoice_detail.inv_itemName = 'Hng khuyn mi/hng tng ' + order_details[i].item_name;\r\n            // Tnh li gi tr tr gi (chit khu) ca chi tit ha n trng hp tchat2\r\n            invoice_detail.inv_discountAmount = 0;\r\n\r\n            /* ------ X l cqt_vat_ecommerce_already_Included cqt_vat_ecommerce_by_linked_product --------- */\r\n            if(this.cqt_vat_ecommerce_already_Included || this.cqt_vat_ecommerce_by_linked_product) {\r\n              // Tnh li gi\r\n              invoice_detail.inv_unitPrice = this.billService.calculateNewPriceToUseSettingTax(invoice_detail.inv_unitPrice, invoice_detail.inv_quantity, invoice_detail.inv_discountAmount, invoice_detail.ma_thue, platformTax);\r\n            }\r\n\r\n            /* ------ X l Hng khuyn mi c php xut 0 ----------------------------------------------- */\r\n            // Nu c bt cqt_vat_ecommerce_allow_promotional_items_zero_price v l tchat2 th cn gn li gi = 0,  cc php tnh cho nhng trng khc bn di cng s t tnh = 0\r\n            if(this.cqt_vat_ecommerce_allow_promotional_items_zero_price) {\r\n              invoice_detail.inv_unitPrice = 0;\r\n            }\r\n\r\n            /* ------ X l Vn gi hng xut bn cho sn phm tng/khuyn mi khi gi CQT ------------------ */\r\n            // Nu c bt cqt_vat_ecommerce_keep_promotional_items_as_sold v l tchat2 th s set li nso thnh tchat1, discountAmount v discountPercentage vn l 0\r\n            if(this.cqt_vat_ecommerce_keep_promotional_items_as_sold) {\r\n              // Gn li tchat\r\n              invoice_detail.tchat = 1; // Gn li tchat thnh 1\r\n              // Gn li tn\r\n              invoice_detail.inv_itemName = order_details[i].item_name;\r\n            }\r\n\r\n            // Tr gi (chit khu) tnh theo %\r\n            invoice_detail.inv_discountPercentage = 0;\r\n          }\r\n          else {\r\n            // Gn li tn\r\n            invoice_detail.inv_itemName = order_details[i].item_name;\r\n            // Tr gi (chit khu) ca nh bn hng trn mi chi tit ha n = seller_discount (khng ly ca sn)\r\n            invoice_detail.inv_discountAmount = (order_details[i].seller_discount || 0);\r\n\r\n            /* ------ X l Gi hng ha, dch v... gi CQT l gi bn  gim ----------------------------------------- */\r\n            if(this.cqt_vat_ecommerce_item_price_is_discounted) {\r\n              // Gn li thnh gi  gim\r\n              invoice_detail.inv_unitPrice = invoice_detail.inv_unitPrice - invoice_detail.inv_discountAmount / invoice_detail.inv_quantity;\r\n              // Gn li Chit khu = 0\r\n              invoice_detail.inv_discountAmount = 0;\r\n            }\r\n\r\n            /* ------ X l cqt_vat_ecommerce_already_Included cqt_vat_ecommerce_by_linked_product --------- */\r\n            if(this.cqt_vat_ecommerce_already_Included || this.cqt_vat_ecommerce_by_linked_product) {\r\n              // Tnh li gi\r\n              invoice_detail.inv_unitPrice = this.billService.calculateNewPriceToUseSettingTax(invoice_detail.inv_unitPrice, invoice_detail.inv_quantity, invoice_detail.inv_discountAmount, invoice_detail.ma_thue, platformTax);\r\n            }\r\n\r\n            // Tr gi (chit khu) tnh theo %\r\n            invoice_detail.inv_discountPercentage = invoice_detail.inv_discountAmount / (invoice_detail.inv_unitPrice * invoice_detail.inv_quantity) * 100;\r\n          }\r\n\r\n          // Gi cui ( tr tr gi) ca chi tit ha n\r\n          invoice_detail.inv_TotalAmountWithoutVat = invoice_detail.inv_unitPrice * invoice_detail.inv_quantity - invoice_detail.inv_discountAmount;\r\n          // Thu VAT c tnh theo chi tit ha n\r\n          invoice_detail.inv_vatAmount = invoice_detail.inv_TotalAmountWithoutVat * invoice_detail.ma_thue / 100;\r\n          // Tng gi tr hng ha k khai theo chi tit ha n\r\n          invoice_detail.inv_TotalAmount = invoice_detail.inv_TotalAmountWithoutVat + invoice_detail.inv_vatAmount;\r\n\r\n          // Nu nh c lin kt\r\n          if (productLinked) {\r\n            // Nu lin kt vi sn phm\r\n            if (productLinked.type === VhType.PRODUCT) {\r\n              // Thay i inv_itemName v inv_itemCode\r\n              invoice_detail.inv_itemName = productLinked.name;\r\n              /* ------ X l cqt_vat_ecommerce_item_code_is_barcode ------------------------------------------ */\r\n              if(this.cqt_vat_ecommerce_item_code_is_barcode) {\r\n                const barcode = this.vhQuerySales.getUnit_byRatio(productLinked.units, 1)?.barcode;\r\n                // Nu c barcode th dng barcode\r\n                if(barcode) {\r\n                  invoice_detail.inv_itemCode = barcode;\r\n                }\r\n                // Nu khng c barcode th thng bo\r\n                else {\r\n                  this.vhComponent.hideLoading();\r\n                  this.vhComponent.alertMessageDesktop(\"error\", this.lang.translate(\"Gi ha n ln CQT tht bi. Ha n c cha sn phm cha c m vch, vui lng b sung v th li. Hoc b chn cu hnh M sn phm khi xut ha n l m vch  tip tc\"), 5000);\r\n                  return;\r\n                }\r\n              }\r\n              else {\r\n                invoice_detail.inv_itemCode = productLinked.id_subproduct ? productLinked.id_subproduct : productLinked['_id'];\r\n              }\r\n\r\n              // Thm vo mng\r\n              invoice_details = this.billService.addEInvoiceDetail(invoice_detail, invoice_details, {cqt_vat_ecommerce_separate_discount_line: this.cqt_vat_ecommerce_separate_discount_line});\r\n            }\r\n            // Nu lin kt vi combo\r\n            else if (productLinked.type === VhType.COMBO) {\r\n              const priceCombo = productLinked.units[0].price;\r\n              if (priceCombo == 0) {\r\n                const errorZeroPriceComboMessage = this.lang.translate(\"Unable to issue the invoice because a linked combo product has a price of 0\", {invoice: order.order_sn});\r\n                this.vhComponent.hideLoading();\r\n                this.vhComponent.alertMessageDesktop(\"error\", errorZeroPriceComboMessage);\r\n                return;\r\n              }\r\n\r\n              // loop qua combo ri tnh li chi tit ha n\r\n              for (let j = 0; j < productLinked.combos.length; j++) {\r\n                const combo = productLinked.combos[j];\r\n                // Khi to chi tit ha n\r\n                let combo_detail = this.billService.createEInvoiceDetailTemplate();\r\n                \r\n                /** T l phn trm ca gi sn phm v tng gi combo */\r\n                const percentRate = (combo.price * combo.quantity) / priceCombo;\r\n                /** Tnh cht hng ha. Nu inv_TotalAmountWithoutVat = 0 th tchat = 2, nu khng th tchat = 1 */\r\n                const tchatCombo = (!percentRate || combo.price == 0 || invoice_detail.inv_TotalAmountWithoutVat * percentRate == 0) ? 2 : 1;\r\n                /** Sn phm trong combo, get li  ly tax */\r\n                let detailproduct = this.vhQuerySales.getlocalDetailProduct(combo.id_subproduct ? combo.id_subproduct : combo.id_product);\r\n                /** Thu ca bill detail ny. Nu c sn phm lin kt v bt setting cqt_vat_ecommerce_by_linked_product th s ly thu t sn phm lin kt, ngc li th vn ly t billTx nh c  */\r\n                const invoiceDetailComboTax = (this.cqt_vat_ecommerce_by_linked_product && detailproduct && detailproduct.tax !== undefined) ? detailproduct.tax : invoice_detail.ma_thue;\r\n                /** n gi */\r\n                const unitPrice = ((invoice_detail.inv_TotalAmountWithoutVat + invoice_detail.inv_discountAmount) * percentRate) / (combo.quantity * invoice_detail.inv_quantity);\r\n\r\n                // Gn cc gi tr chung\r\n                combo_detail.tchat = tchatCombo;\r\n                combo_detail.stt_rec0 = invoice_details.length + 1;\r\n                combo_detail.inv_unitCode = 'Ci';\r\n                combo_detail.inv_quantity = combo.quantity * invoice_detail.inv_quantity;\r\n                combo_detail.inv_unitPrice = unitPrice; // Gi gc bn sn phm trn sn shopee\r\n                combo_detail.ma_thue = invoiceDetailComboTax;\r\n\r\n\r\n                /* ------ X l cqt_vat_ecommerce_item_code_is_barcode ------------------------------------------ */\r\n                if(this.cqt_vat_ecommerce_item_code_is_barcode) {\r\n                  const barcode = this.vhQuerySales.getUnit_byRatio(combo.units, combo.ratio)?.barcode;\r\n                  // Nu c barcode th dng barcode\r\n                  if(barcode) {\r\n                    combo_detail.inv_itemCode = barcode;\r\n                  }\r\n                  // Nu khng c barcode th thng bo\r\n                  else {\r\n                    this.vhComponent.hideLoading();\r\n                    this.vhComponent.alertMessageDesktop(\"error\", this.lang.translate(\"Gi ha n ln CQT tht bi. Ha n c cha sn phm cha c m vch, vui lng b sung v th li. Hoc b chn cu hnh M sn phm khi xut ha n l m vch  tip tc\"), 5000);\r\n                    return;\r\n                  }\r\n                }\r\n                else {\r\n                  combo_detail.inv_itemCode = combo.id_subproduct ? combo.id_subproduct : combo.id_product;\r\n                }\r\n\r\n                /* ------ X l tchat --------------------------------------------------------------------------- */\r\n                if(tchatCombo === 2) {\r\n                  // Gn li tn\r\n                  combo_detail.inv_itemName = 'Hng khuyn mi/hng tng ' + combo.name;\r\n                  // Tnh li gi tr tr gi (chit khu) ca chi tit ha n trng hp tchat2\r\n                  combo_detail.inv_discountAmount = 0;\r\n\r\n                  /* ------ X l cqt_vat_ecommerce_by_linked_product --------- */\r\n                  if(this.cqt_vat_ecommerce_by_linked_product) {\r\n                    // Tnh li gi\r\n                    combo_detail.inv_unitPrice = this.billService.calculateNewPriceToUseSettingTax(combo_detail.inv_unitPrice, combo_detail.inv_quantity, combo_detail.inv_discountAmount, combo_detail.ma_thue, platformTax);\r\n                  }\r\n\r\n                  /* ------ X l Hng khuyn mi c php xut 0 ----------------------------------------------- */\r\n                  // Nu c bt cqt_vat_ecommerce_allow_promotional_items_zero_price v l tchat2 th cn gn li gi = 0,  cc php tnh cho nhng trng khc bn di cng s t tnh = 0\r\n                  if(this.cqt_vat_ecommerce_allow_promotional_items_zero_price) {\r\n                    combo_detail.inv_unitPrice = 0;\r\n                  }\r\n\r\n                  /* ------ X l Vn gi hng xut bn cho sn phm tng/khuyn mi khi gi CQT ------------------ */\r\n                  // Nu c bt cqt_vat_ecommerce_keep_promotional_items_as_sold v l tchat2 th s set li nso thnh tchat1, discountAmount v discountPercentage vn l 0\r\n                  if(this.cqt_vat_ecommerce_keep_promotional_items_as_sold) {\r\n                    // Gn li tchat\r\n                    combo_detail.tchat = 1; // Gn li tchat thnh 1\r\n                    // Gn li tn\r\n                    combo_detail.inv_itemName = combo.name;\r\n                  }\r\n\r\n                  // Tr gi (chit khu) tnh theo %\r\n                  combo_detail.inv_discountPercentage = 0;\r\n                }\r\n                else {\r\n                  // Gn li tn\r\n                  combo_detail.inv_itemName = combo.name;\r\n                  // Tr gi (chit khu) ca nh bn hng trn mi chi tit ha n = seller_discount + shopee_discount\r\n                  combo_detail.inv_discountAmount = this.billService.roundTo4Decimal(invoice_detail.inv_discountAmount * percentRate);\r\n\r\n                  /* ------ X l Gi hng ha, dch v... gi CQT l gi bn  gim ----------------------------------------- */\r\n                  if(this.cqt_vat_ecommerce_item_price_is_discounted) {\r\n                    // Gn li thnh gi  gim\r\n                    combo_detail.inv_unitPrice = combo_detail.inv_unitPrice - combo_detail.inv_discountAmount / combo_detail.inv_quantity;\r\n                    // Gn li Chit khu = 0\r\n                    combo_detail.inv_discountAmount = 0;\r\n                  }\r\n\r\n                  /* ------ X l cqt_vat_ecommerce_by_linked_product --------- */\r\n                  if(this.cqt_vat_ecommerce_by_linked_product) {\r\n                    // Tnh li gi\r\n                    combo_detail.inv_unitPrice = this.billService.calculateNewPriceToUseSettingTax(combo_detail.inv_unitPrice, combo_detail.inv_quantity, combo_detail.inv_discountAmount, combo_detail.ma_thue, platformTax);\r\n                  }\r\n\r\n                  // Tr gi (chit khu) tnh theo %\r\n                  combo_detail.inv_discountPercentage = combo_detail.inv_discountAmount / (combo_detail.inv_unitPrice * combo_detail.inv_quantity) * 100;\r\n                }\r\n\r\n                // Gi cui ( tr tr gi) ca chi tit ha n\r\n                combo_detail.inv_TotalAmountWithoutVat = combo_detail.inv_unitPrice * combo_detail.inv_quantity - combo_detail.inv_discountAmount;\r\n                // Thu VAT c tnh theo chi tit ha n\r\n                combo_detail.inv_vatAmount = combo_detail.inv_TotalAmountWithoutVat * combo_detail.ma_thue / 100;\r\n                // Tng gi tr hng ha k khai theo chi tit ha n\r\n                combo_detail.inv_TotalAmount = combo_detail.inv_TotalAmountWithoutVat + combo_detail.inv_vatAmount;\r\n\r\n                // Thm vo mng\r\n                invoice_details = this.billService.addEInvoiceDetail(combo_detail, invoice_details, {cqt_vat_ecommerce_separate_discount_line: this.cqt_vat_ecommerce_separate_discount_line});\r\n              }\r\n            }\r\n          }\r\n          else {\r\n            invoice_details = this.billService.addEInvoiceDetail(invoice_detail, invoice_details, {cqt_vat_ecommerce_separate_discount_line: this.cqt_vat_ecommerce_separate_discount_line});\r\n          }\r\n        }\r\n\r\n\r\n\r\n        /* -------------------------- Tnh chi ph vn chuyn, nu c th sinh ra mt chi tit ha n \"Ph vn chuyn\" ------------------------- */\r\n\r\n        // Ph ship ngi mua phi tr\r\n        let shipping_paid_by_buyer = 0;\r\n        // Ph ship ngi ca c tr gi (ngi bn + shopee) => ph vn chuyn c tnh thm voucher ca shopee vo\r\n        let shipping_discount = 0;\r\n        if (escrowShopee.order_income.actual_shipping_fee > 0) {\r\n          shipping_discount = escrowShopee.order_income.shopee_shipping_rebate;\r\n          shipping_paid_by_buyer = escrowShopee.order_income.actual_shipping_fee - shipping_discount;\r\n        }\r\n        if (this.cqt_submit_invoice_with_shipping_fee && shipping_paid_by_buyer > 0) {\r\n          // Khi to chi tit ha n\r\n          let invoice_detail = this.billService.createEInvoiceDetailTemplate();\r\n\r\n          // Gn cc gi tr chung\r\n          invoice_detail.tchat = 1;\r\n          invoice_detail.stt_rec0 = invoice_details.length + 1;\r\n          invoice_detail.inv_itemCode = 'phi_van_chuyen';\r\n          invoice_detail.inv_itemName = 'Ph vn chuyn';\r\n          invoice_detail.inv_unitCode = 'Ln';\r\n          invoice_detail.inv_quantity = 1;\r\n          invoice_detail.inv_unitPrice = escrowShopee.order_income.actual_shipping_fee;\r\n          invoice_detail.inv_discountAmount = shipping_discount;\r\n          invoice_detail.inv_TotalAmountWithoutVat = shipping_paid_by_buyer;\r\n          invoice_detail.ma_thue = billTax;\r\n\r\n          /* ------ X l cqt_vat_ecommerce_already_Included ---------------------------------------------- */\r\n          if(this.cqt_vat_ecommerce_already_Included) {\r\n            // Tnh li gi\r\n            invoice_detail.inv_unitPrice = this.billService.calculateNewPriceToUseSettingTax(invoice_detail.inv_unitPrice, invoice_detail.inv_quantity, invoice_detail.inv_discountAmount, invoice_detail.ma_thue, platformTax);\r\n          }\r\n\r\n          // Tr gi (chit khu) tnh theo %\r\n          invoice_detail.inv_discountPercentage = invoice_detail.inv_discountAmount / (invoice_detail.inv_unitPrice * invoice_detail.inv_quantity) * 100;\r\n          // Gi cui ( tr tr gi) ca chi tit ha n\r\n          invoice_detail.inv_TotalAmountWithoutVat = invoice_detail.inv_unitPrice - invoice_detail.inv_discountAmount;\r\n          // Thu VAT c tnh theo chi tit ha n\r\n          invoice_detail.inv_vatAmount = invoice_detail.inv_TotalAmountWithoutVat * invoice_detail.ma_thue / 100;\r\n          // Tng gi tr hng ha k khai theo chi tit ha n\r\n          invoice_detail.inv_TotalAmount = invoice_detail.inv_TotalAmountWithoutVat + invoice_detail.inv_vatAmount;\r\n\r\n          // Thm vo mng\r\n          invoice_details = this.billService.addEInvoiceDetail(invoice_detail, invoice_details, {cqt_vat_ecommerce_separate_discount_line: this.cqt_vat_ecommerce_separate_discount_line});\r\n        }\r\n\r\n\r\n        /* ----------------------------------------------------------- X l voucher ca shopee ----------------------------------------------------------- */\r\n\r\n        // X l phn gim gi (voucher ca shopee + voucher ca sn)\r\n        // to thnh 1 invoice detail cso tchat3 cho phn gim gi\r\n        // ph ph ca shopee ln ng bn = seller_transaction_fee + shipping_seller_protection_fee_amount+commission_fee\r\n        // invoice_detail ny vn s tnh thu, nhng khi tnh tng thu s b qua n (tng ng bill.total * (bill.tax / 100) ca mnh)\r\n        \r\n        /** Tng tin gim gi (Tng tin chit khu) */\r\n        let totalDiscountAmount = 0;\r\n        // Gim gi cho n hng t seller\r\n        if (escrowShopee.order_income.voucher_from_seller > 0) {\r\n          totalDiscountAmount = (escrowShopee.order_income.voucher_from_seller || 0);\r\n        }\r\n        // Ph sn\r\n        if (this.cqt_submit_invoice_with_ecommerce_fee) {\r\n          totalDiscountAmount += escrowShopee.order_income.seller_transaction_fee + escrowShopee.order_income.shipping_seller_protection_fee_amount + escrowShopee.order_income.commission_fee;\r\n        }\r\n\r\n        if(totalDiscountAmount > 0) {\r\n          // Khi to chi tit ha n\r\n          let invoice_detail = this.billService.createEInvoiceDetailTemplate();\r\n\r\n          // Gn cc gi tr chung\r\n          invoice_detail.tchat = 3;\r\n          invoice_detail.stt_rec0 = invoice_details.length + 1;\r\n          invoice_detail.inv_itemCode = 'chiet_khau_thuong_mai';\r\n          invoice_detail.inv_itemName = 'Chit khu thng mi';\r\n          invoice_detail.inv_unitCode = 'Phn';\r\n          invoice_detail.inv_quantity = 1;\r\n          invoice_detail.inv_unitPrice = totalDiscountAmount;\r\n          invoice_detail.inv_TotalAmountWithoutVat = totalDiscountAmount; // Thnh tin trc thu\r\n          invoice_detail.ma_thue = 0; // Khng c thu cho chit khu thng mi\r\n\r\n          // Gi cui ( tr tr gi) ca chi tit ha n\r\n          invoice_detail.inv_TotalAmountWithoutVat = invoice_detail.inv_unitPrice - invoice_detail.inv_discountAmount;\r\n          // Thu VAT c tnh theo chi tit ha n\r\n          invoice_detail.inv_vatAmount = invoice_detail.inv_TotalAmountWithoutVat * invoice_detail.ma_thue / 100;\r\n          // Tng gi tr hng ha k khai theo chi tit ha n\r\n          invoice_detail.inv_TotalAmount = invoice_detail.inv_TotalAmountWithoutVat + invoice_detail.inv_vatAmount;\r\n\r\n          // Thm vo mng\r\n          invoice_details = this.billService.addEInvoiceDetail(invoice_detail, invoice_details, {cqt_vat_ecommerce_separate_discount_line: this.cqt_vat_ecommerce_separate_discount_line});\r\n        }\r\n\r\n\r\n\r\n        /* ---------------------------------------------- Gn li cc trng tnh ton cho invoice ---------------------------------------------- */\r\n\r\n        for (let i = 0; i < invoice_details.length; i++) {\r\n          if (invoice_details[i].tchat == 1) {\r\n            // tchat 1 th cng dn\r\n            invoice.inv_discountAmount += invoice_details[i].inv_discountAmount;\r\n            invoice.inv_vatAmount += invoice_details[i].inv_vatAmount;\r\n            invoice.inv_TotalAmountWithoutVat += invoice_details[i].inv_TotalAmountWithoutVat;\r\n            invoice.inv_TotalAmount += invoice_details[i].inv_TotalAmount;\r\n          } else if (invoice_details[i].tchat == 2) {\r\n            // tchat 2 th b qua\r\n          } else if (invoice_details[i].tchat == 3) {\r\n            // tchat 3 th phi tr li\r\n            invoice.inv_discountAmount -= invoice_details[i].inv_discountAmount;\r\n            invoice.inv_vatAmount -= invoice_details[i].inv_vatAmount;\r\n            invoice.inv_TotalAmountWithoutVat -= invoice_details[i].inv_TotalAmountWithoutVat;\r\n            invoice.inv_TotalAmount -= invoice_details[i].inv_TotalAmount;\r\n          }\r\n        }\r\n\r\n        /* ----- Tr v d liu ---------------------------------------------- */\r\n        // Ha n in t thu gm 2 phn ha n + chi tit ha n\r\n        let invoices = [{ ...invoice, details: [{ data: invoice_details }] }];\r\n        console.log('invoices', invoices);\r\n        resolve({ vcode: 0, msg: 'success', data: invoices });\r\n      } catch (err) {\r\n        console.error(' Li changeTiktok_toInvoice_byMinvoice:', err);\r\n        reject(err);\r\n      }\r\n    });\r\n  }\r\n\r\n  /** C hin th modal chnh sa customer tax hay khng */\r\n  isShowModalEditCustomerTax: boolean = false;\r\n  tempCustomerTax: any = null;\r\n  /**\r\n   * Khi nhn edit ct thng tin khch hng\r\n   */\r\n  editTax(invoice) {\r\n    this.tempCustomerTax = invoice;\r\n    this.isShowModalEditCustomerTax = true;\r\n  }\r\n\r\n\r\n\r\n  /**\r\n   * Khi ok trong modal chnh sa customer tax\r\n   * @param customerTaxInfo\r\n   */\r\n  onOkEditTax(customerTaxInfo) {\r\n    this.isShowModalEditCustomerTax = false;\r\n\r\n    Object.assign(this.tempCustomerTax, customerTaxInfo);\r\n  }\r\n\r\n  /**Xa nhng sp  c lin kt ri ra khi mng ca modal danh sch sp lin kt\r\n   * @example this.clearProductShow(listProductShopee, listProductApp)\r\n   */\r\n  clearProductShow(listProduct, listProductApp) {\r\n    for (let prodApp of listProductApp) {\r\n      if (prodApp[this.id_branch] && prodApp[this.id_branch].shopees && prodApp[this.id_branch].shopees.length) {\r\n        let arrayProdShopee = prodApp[this.id_branch].shopees;\r\n        for (let item of arrayProdShopee) {\r\n          let indexProd = listProduct.findIndex(prod => prod.item_id == item.item_id);\r\n          if (indexProd >= 0) {\r\n            if (listProduct[indexProd].model && item.model && item.model.length) {\r\n              for (let model of item.model) {\r\n                let index = listProduct[indexProd].model.findIndex(data => data.model_id == model?.model_id);\r\n                if (index >= 0) listProduct[indexProd].model.splice(index, 1);\r\n              }\r\n              if (!listProduct[indexProd].model.length) listProduct.splice(indexProd, 1);\r\n            } else listProduct.splice(indexProd, 1);\r\n          }\r\n        }\r\n      }\r\n    }\r\n    return listProduct;\r\n  }\r\n\r\n  visible_affiliate: boolean = false;\r\n  productShopeeSelected: any = null;\r\n\r\n  /**\r\n * Kim tra sn phm  c lien kt hay cha\r\n *\r\n */\r\n  isLinkedToProduct(item): boolean {\r\n    for (let productOfBranch of this.listProductOfBranch) {\r\n      let findProduct = productOfBranch[this.id_branch].shopees.find(data => data.item_id == item.item_id);\r\n      if (findProduct) {\r\n        if (findProduct.model && findProduct.model.length && item.model_id != 0) {\r\n          let indexModel = findProduct.model.findIndex(model => model.model_id == item.model_id);\r\n          if (indexModel >= 0) {\r\n            return true;\r\n          }\r\n        } else {\r\n          return true;\r\n        }\r\n      }\r\n    };\r\n    return false;\r\n  }\r\n\r\n  findProductLinked(item) {\r\n    for (let productOfBranch of this.listProductOfBranch) {\r\n      const shopees = productOfBranch[this.id_branch]?.shopees || [];\r\n\r\n      const found = shopees.find(data => {\r\n        if (data.item_id !== item.item_id) return false;\r\n\r\n        if (data.model?.length && item.model_id !== 0) {\r\n          return data.model.some(model => model.model_id === item.model_id);\r\n        }\r\n\r\n        return data.model?.length ? false : true;\r\n      });\r\n\r\n      if (found) {\r\n        return productOfBranch;\r\n      }\r\n    }\r\n\r\n    return null;\r\n  }\r\n\r\n  openModelSelectProductsShopee(productShopee) {\r\n    this.productShopeeSelected = productShopee;\r\n    this.visible_affiliate = true;\r\n  }\r\n\r\n  /**\r\n   * Tt modal v clone mng product ra mt mng mi  trnh nh li product c b checked\r\n   */\r\n  cancelAffiliate() {\r\n    this.visible_affiliate = false;\r\n  }\r\n\r\n  /**\r\n   * Lin kt sn phm t shopee vi sn phm ti ca hng.\r\n   * @param product Sn phm ca ca hng\r\n   */\r\n  acceptAfiliate(product) {\r\n    const isZeroPriceCombo = product.type === VhType.COMBO && product.units[0].price === 0;\r\n    const confirmZeroPriceComboMessage = this.lang.translate(\"This product is a combo with a price of 0. Do you still want to link it with the product\", {platform : 'Shopee'}) + \"?\";\r\n    this.nzModalService.confirm({\r\n      nzTitle: '<i>' + (isZeroPriceCombo ? confirmZeroPriceComboMessage : this.lang.translate(\"Confirm\")) + '</i>',\r\n      nzIconType: \"info-circle\",\r\n      nzCancelText: this.lang.translate(\"Cancel\"),\r\n      nzOnOk: () => {\r\n        this.vhComponent.showLoading(\"\", \"transparent-loading\").then(() => {\r\n          // Tm sn phm shopee\r\n          const currentProductShopee = this.listProductShopee.find(item => item.item_id == this.productShopeeSelected.item_id);\r\n          const id_product_selected = product.id_subproduct ? product.id_subproduct : product['_id'];\r\n\r\n          let productShopee = {\r\n            item_id: this.productShopeeSelected.item_id,\r\n            models: []\r\n          };\r\n\r\n          // Nu sn phm shopee c model th thm vo mng\r\n          if (currentProductShopee && currentProductShopee.has_model) {\r\n            const model = currentProductShopee.model.find(item => item.model_id == this.productShopeeSelected.model_id);\r\n            productShopee.models.push(model);\r\n          }\r\n\r\n          this.vhEcommerce.addMergeShopeesProduct_model(this.vhQuerySales.getlocalDetailProduct(id_product_selected), productShopee.item_id, productShopee.models, this.infoShop['_id'], this.id_branch).then((bool) => {\r\n            this.vhComponent.hideLoading().then(() => {\r\n              setTimeout(() => {\r\n                this.visible_affiliate = false;\r\n                this.listProductOfBranch = this.vhQuerySales.getlocalDetailProducts(35).filter(e => !e.delete_hidden).filter(item => item[this.id_branch] && item[this.id_branch].shopees && item[this.id_branch].shopees.length >= 0);\r\n                this.vhComponent.alertMessageDesktop('success', this.lang.translate(\"Product linked successfully\"));\r\n              }, 300);\r\n            });\r\n          }).catch(err => {\r\n            console.error(err);\r\n            this.visible_affiliate = false;\r\n            this.vhComponent.alertMessageDesktop('error', this.lang.translate(\"The product link failed\"));\r\n            this.vhComponent.hideLoading(0);\r\n          });\r\n        });\r\n      }\r\n    });\r\n  }\r\n\r\n\r\n\r\n  /**\r\n   * m s lng bill ang check\r\n   */\r\n  get countSelectedBill(): number {\r\n    return this.salesOrder?.filter((e: any) => e.checked)?.filter((data: any) => !data.cqt_status || data.cqt_status == 1)?.length;\r\n  }\r\n\r\n\r\n\r\n  /**\r\n   * Ly ngy cp nht ca n hng theo nh dng 2025-06-25\r\n   */\r\n  getUpdateTimeFormat(order) {\r\n    return this.vhAlgorithm.formatDateToString(new Date(order.update_time * 1000));\r\n  }\r\n\r\n\r\n\r\n  /**\r\n   * Xut danh sch ang hin trn table ra file excel\r\n   */\r\n  exportExcel() {\r\n    if (!this.salesOrder || !this.salesOrder.length) return;\r\n  \r\n    // Lp qua danh sch ha n\r\n    const XLSXData = this.salesOrder.reduce((acc, order) => {\r\n      if (!order || !order.item_list || !order.item_list.length) return acc;\r\n  \r\n      // Mi item trong item_list s thnh 1 row\r\n      const rows = order.item_list.map(item => ({\r\n        'M n hng': order.order_sn || '',\r\n        'M Kin Hng': item.package_list && item.package_list.length > 0 ? item.package_list[0].package_number : '',\r\n        'Ngy t hng': this.datePipe.transform(new Date(order.create_time * 1000), 'yyyy-MM-dd HH:mm') || '',\r\n        'Trng Thi n Hng': (() => {\r\n          const currentDate = new Date();\r\n          const returnDueDate = order.return_request_due_date ? new Date(order.return_request_due_date * 1000) : null;\r\n          if (order.order_status === 'COMPLETED' && returnDueDate && returnDueDate.getTime() > currentDate.getTime()) {\r\n            return `Ngi mua xc nhn  nhn c hng, tuy nhin Ngi mua vn c th gi yu cu Tr hng/Hon tin ti ngy ${this.datePipe.transform(returnDueDate, 'yyyy-MM-dd HH:mm')}`;\r\n          }\r\n          return this.lang.translate(order.order_status) ?? '';\r\n        })(),\r\n        'L do hy': this.lang.translate(order.cancel_reason) || '',\r\n        'Nhn xt t Ngi mua': order.message_to_seller || '',\r\n        'n V Vn Chuyn': (() => {\r\n          switch (order.shipping_carrier) {\r\n            case 'SPX Express':\r\n              return 'Nhanh-SPX Express';\r\n            case 'SPX Instant':\r\n              return 'Ha Tc-SPX Instant';\r\n            case 'GHN - Hng Cng Knh':\r\n              return 'Hng Cng Knh-GHN - Hng Cng Knh';\r\n            case 'AhaMove':\r\n              return 'Ha Tc-AhaMove';\r\n            case 'Giao Hng Nhanh':\r\n              return 'Nhanh-Giao Hng Nhanh';\r\n            default:\r\n              return order.package_list && order.package_list.length > 0 ? order.package_list[0].shipping_carrier : '';\r\n          }\r\n        })(),\r\n        'Ngy giao hng d kin': order.ship_by_date ? this.datePipe.transform(new Date(order.ship_by_date * 1000), 'yyyy-MM-dd HH:mm') : '',\r\n        'Thi gian giao hng': order.pickup_done_time ? this.datePipe.transform(new Date(order.pickup_done_time * 1000), 'yyyy-MM-dd HH:mm') : '',\r\n        'SKU sn phm': item.item_sku || '',\r\n        'Tn sn phm': item.item_name || '',\r\n        'Cn nng sn phm': item.weight || '',\r\n        'Tng cn nng': item.weight ? (item.weight * item.model_quantity_purchased) : '',\r\n        'Gi gc': item.model_original_price || '',\r\n        'Gi u i': item.model_discounted_price || '',\r\n        'S lng': item.model_quantity_purchased || '',\r\n        'Tng gi bn (sn phm)': item.model_discounted_price ? (item.model_discounted_price * item.model_quantity_purchased) : '',\r\n        'Ph vn chuyn ti tr bi Shopee (d kin)': order.estimated_shipping_fee || '',\r\n        'Tng s tin ngi mua thanh ton': order.total_amount || '',\r\n        'Phng thc thanh ton': (() => {\r\n          switch (order.payment_method) {\r\n            case 'ShopeePay Linked Bank Account':\r\n              return 'TK Ngn hng lin kt ShopeePay';\r\n            case 'Cash on Delivery':\r\n              return 'Thanh ton khi nhn hng';\r\n            case 'ShopeePay':\r\n              return 'V ShopeePay';\r\n            case 'Credit / Debit Card':\r\n              return 'Th Tn dng/Ghi n';\r\n            default:\r\n              return order.payment_method || '';\r\n          }\r\n        })(),\r\n        'Ngi Mua': order.buyer_username || '',\r\n        'Tn Ngi nhn': order.recipient_address ? order.recipient_address.name : '',\r\n        'S in thoi': order.recipient_address ? order.recipient_address.phone : '',\r\n        'Tnh/Thnh ph': order.recipient_address.city || '',\r\n        'TP / Qun / Huyn': order.recipient_address.district || '',\r\n        'Qun': order.recipient_address.state || '',\r\n        'a ch nhn hng': order.recipient_address ? order.recipient_address.full_address : '',\r\n        'Quc gia': order.region || ''\r\n      }));\r\n  \r\n      return acc.concat(rows);\r\n    }, []);\r\n  \r\n    // X l tn file, s c dng Order.{status}.{startDate}_{endDate}.xlsx\r\n    const statusName = this.vhAlgorithm.changeAlias(this.list_status_bill[this.selectedIndex]?.name?.toLowerCase().replace(/ /g, '') || 'all');\r\n    const startDate = this.vhAlgorithm.formatDateToString(this.date[0]).replace(/-/g, '');\r\n    const endDate = this.vhAlgorithm.formatDateToString(this.date[1]).replace(/-/g, '');\r\n    const nameFile = `Order.${statusName}.${startDate}_${endDate}`;\r\n\r\n    this.vhAlgorithm.exportXLSX(XLSXData, nameFile).then(() => {\r\n      console.log('Xut file Excel thnh cng:', nameFile);\r\n    }).catch(err => {\r\n      console.error('Li xut file Excel:', err);\r\n    });\r\n  }\r\n\r\n}\r\n","<div nz-row class=\"row-back medium-size\" (click)=\"goBack()\">\r\n    <i nz-icon nzType=\"left\" nzTheme=\"outline\"></i>{{'Back' | translate}}\r\n</div>\r\n<nz-layout id=\"order-status-tiki\">\r\n    <div nz-row nzGutter=\"4\" class=\"order-status-tiki-header\">\r\n        <!-- Tiu  -->\r\n        <div nz-col nzSpan=\"8\" class=\"title\">\r\n            <b>{{'Xut ha n in t t sn'|translate}}</b>\r\n            <br>\r\n             {{'Shop name' | translate}}: <b class=\"color-green\">{{infoShop.data?.name}}</b>\r\n        </div>\r\n        <!-- Tm kim -->\r\n        <div nz-col nzSpan=\"6\" class=\"title center-all-content\">\r\n            <nz-input-group [nzSuffix]=\"suffixIconSearch\">\r\n                <input [(ngModel)]=\"searchValue\" (ngModelChange)=\"search($event)\" type=\"text\" nz-input\r\n                    [placeholder]=\"'Tm m n hng (phn tch bi du phy)' | translate\" />\r\n            </nz-input-group>\r\n            <ng-template #suffixIconSearch>\r\n                <i nz-icon nzType=\"search\"></i>\r\n            </ng-template>\r\n        </div>\r\n        <!-- Chn ngy -->\r\n        <div nz-col nzSpan=\"6\">\r\n            <nz-range-picker nzFormat='dd/MM/yyyy' [nzDisabledDate]=\"disabledDate\" nzFormat=\"dd/MM/yyyy\"\r\n                [(ngModel)]=\"date\" (ngModelChange)=\"changeTime($event)\">\r\n            </nz-range-picker>\r\n        </div>\r\n        <!-- Nt xem bo co v gi CQT -->\r\n        <div nz-col nzSpan=\"4\" class=\"right-all-content\">\r\n            <button class=\"btn-view center-all-content\" nz-button nzType=\"default\" (click)=\"showReport()\">\r\n                <ion-icon src=\"assets/icon/management/view.svg\"></ion-icon>\r\n                {{'View' | translate}}\r\n            </button>\r\n            <button class=\"btn-view center-all-content\" nz-button nzType=\"default\" (click)=\"sendCQT()\">\r\n                {{'Gi CQT' | translate}}\r\n            </button>\r\n            <button class=\"btn-view center-all-content\" nz-button nzType=\"default\" (click)=\"exportExcel()\">\r\n                {{'Xut Excel' | translate}}\r\n            </button>\r\n        </div>\r\n    </div>\r\n    \r\n    <div *ngIf=\"load_status else no_data\" nz-row nzGutter=\"16\" class=\"order-status-tiki-body\">\r\n        <div nz-col nzSpan=\"24\">\r\n            <nz-tabset [(nzSelectedIndex)]=\"selectedIndex\" (nzSelectChange)=\"segmentChanged($event.index)\">\r\n                <nz-tab *ngFor=\"let item of list_status_bill\" nzTitle=\"{{item.name | translate}} ({{orderCountByStatus[item.name]}})\"></nz-tab>\r\n                <nz-tab *ngIf=\"orderOthersCountByStatus > 0\" nzTitle=\"{{'Other' | translate}} ({{orderOthersCountByStatus}})\"></nz-tab>\r\n            </nz-tabset>\r\n            \r\n            <nz-table *ngIf=\"salesOrder.length > 0;else no_bill\" [nzScroll]=\"{y: heightScroll }\" #salesOrder_show\r\n                nzShowPagination nzShowSizeChanger [nzData]=\"salesOrder\" [nzPageSize]=\"20\"\r\n                [nzPageSizeOptions]=\"[20, 30, 40, 50, 100, 200]\">\r\n                <thead>\r\n                    <tr>\r\n                        <th nzAlign=\"center\" nzWidth=\"6%\"><b>{{'No.' | translate}}</b></th>\r\n                        <th nzLeft nzWidth=\"17%\"><b>{{'Date order' | translate}}</b></th>\r\n                        <th nzLeft nzWidth=\"17%\"><b>{{'Order number' | translate}}</b></th>\r\n\r\n                        <th><b>{{'Product' | translate}}</b></th>\r\n                        <th nzWidth=\"15%\"><b>{{'Status on Shopee' | translate}}</b></th>\r\n                        <th (click)=\"statusCol = !statusCol; sortTable('status')\"><b>{{'Status CQT' | translate}}</b><i nz-icon [nzType]=\"statusCol == true ? 'caret-down' : 'caret-up'\" nzTheme=\"outline\"></i></th>\r\n                        <th style=\"text-align: right;\" nzWidth=\"17%\"><b>{{\"Total\"| translate}}</b></th>\r\n                        <!-- <th style=\"text-align: center;\" nzWidth=\"17%\"><b>{{\"Canceled reason\" | translate}}</b></th> -->\r\n                        <th nzAlign=\"center\" [(nzChecked)]=\"allChecked\" [nzIndeterminate]=\"indeterminate\"\r\n                            (nzCheckedChange)=\"checkAll($event)\">\r\n                            ({{countSelectedBill}})\r\n                        </th>\r\n                    </tr>\r\n                </thead>\r\n                <tbody>\r\n                    <tr *ngFor=\"let bill of salesOrder_show.data,index as i\" style=\"cursor: pointer;\"\r\n                        (click)=\"gotoDetail(bill)\">\r\n                        <td nzAlign=\"center\">{{(salesOrder_show.nzPageIndex - 1) * salesOrder_show.nzPageSize + i + 1}}</td>\r\n                        <td nzLeft>\r\n                            {{bill.create_at | date : \"dd/MM/yyyy HH:mm\"}}</td>\r\n                        <td nzLeft> {{bill.order_sn}} <i\r\n                                (click)=\"$event.stopPropagation();vhComponent.copyValue(bill.order_sn)\" nz-icon\r\n                                nzType=\"copy\" nzTheme=\"outline\"></i>\r\n                        </td>\r\n\r\n                        <td><span\r\n                                style=\"font-size: 0.8rem;\"\r\n                                [style.color]=\"isLinkedToProduct(item) ? '' : 'var(--ion-color-vh-red)'\"\r\n                                *ngFor=\"let item of bill.item_list\">{{isLinkedToProduct(item) ? findProductLinked(item)?.name : item.item_name}}\r\n                                (SL :{{item.model_quantity_purchased}}) <i *ngIf=\"!isLinkedToProduct(item)\" (click)=\"$event.stopPropagation();openModelSelectProductsShopee(item)\" class=\"icon-link green\" nz-icon nzType=\"link\" nzTheme=\"outline\"></i>\r\n                                <br>\r\n                            </span>\r\n                        </td>\r\n                        <td>\r\n                            <span nz-tooltip [nzTooltipTitle]=\"getUpdateTimeFormat(bill)\">{{bill.order_status | translate}}</span>\r\n\r\n                        </td>\r\n                        <td>\r\n                            <span *ngIf=\"bill.cqt_status == 3\">{{'Sent to CQT' | translate}} <span nz-tooltip [nzTooltipTitle]=\"'View E-invoice' | translate\" nz-icon class=\"ant-input-password-icon\" [nzType]=\"'eye'\" (click)=\"$event.stopPropagation(); printService.viewEInvoice(infoBranch, {_id: bill.order_sn})\"></span></span>\r\n                            <span *ngIf=\"bill.cqt_status == 2\">{{'Waiting for signature' | translate}} <span nz-tooltip [nzTooltipTitle]=\"'View E-invoice' | translate\" nz-icon class=\"ant-input-password-icon\" [nzType]=\"'eye'\" (click)=\"$event.stopPropagation(); printService.viewEInvoice(infoBranch, {_id: bill.order_sn})\"></span></span>\r\n                            <span *ngIf=\"!bill.cqt_status || bill.cqt_status == 1\">{{'Not sent to CQT' | translate}}</span>\r\n                        </td>\r\n\r\n                        <td style=\"text-align: right;\"><b>{{vhAlgorithm.vhcurrencyunit(bill.total_amount)}}</b></td>\r\n\r\n                        <td nzAlign=\"center\" (click)=\"$event.stopPropagation();\">\r\n                            <i (click)=\"editTax(bill)\" class=\"cus-icon\" nz-icon nzType=\"info-circle\" nzTheme=\"outline\"\r\n                                style=\"cursor: pointer;margin-right: 10px;\"></i>\r\n                            <label *ngIf=\"bill.cqt_status == 1 || !bill.cqt_status\" [(ngModel)]=\"bill.checked\" (ngModelChange)=\" refreshStatus()\"\r\n                                nz-button  nz-checkbox>\r\n                            </label>\r\n                        </td>\r\n                        <!-- <td style=\"text-align: left;\">{{bill.carrier_name}}</td> -->\r\n                    </tr>\r\n                </tbody>\r\n            </nz-table>\r\n            <ng-template #no_bill class=\"full-height\">\r\n                <div nz-col nzSpan=\"24\" class=\"center-all-content\">\r\n                    <div>{{'No data'| translate}}</div>\r\n                </div>\r\n            </ng-template>\r\n        </div>\r\n    </div>\r\n    <ng-template #no_data>\r\n        <div nz-row class=\"no-affiliate\">\r\n            <div nz-col nzSpan=\"24\" class=\"text-center\">\r\n                <img src=\"assets/icon/management/ecommerce/no-data-orderstatus.svg\" alt=\"\">\r\n                <p>{{\"Please click the view button\"|\r\n                    translate}}</p>\r\n            </div>\r\n        </div>\r\n    </ng-template>\r\n\r\n</nz-layout>\r\n\r\n<!-- -------------------------------------------- MODAL CHNH SA THNG TIN THU KHCH HNG -------------------------------------------- -->\r\n<app-edit-customer-tax *ngIf=\"isShowModalEditCustomerTax\" ecommerce_platform=\"shopee\" [invoice]=\"tempCustomerTax\" [infoShop]=\"infoShop\"\r\n    (onClose)=\"isShowModalEditCustomerTax = false\" (onOk)=\"isShowModalEditCustomerTax = false; onOkEditTax($event)\">\r\n</app-edit-customer-tax>\r\n\r\n<!-- --------------modal chn sn phm lin kt--------------- -->\r\n<app-modal-link-product-ecommerce\r\n    [title]=\"'Select Shopee linked products' | translate\"\r\n    [visible_affiliate]=\"visible_affiliate\"\r\n    [listProductApp]=\"listProductApp\"\r\n    [searchProductAppValue]=\"searchProductAppValue\"\r\n    (cancelAffiliate)=\"cancelAffiliate()\"\r\n    (searchProductApp)=\"searchProductApp($event)\"\r\n    (acceptAfiliate)=\"acceptAfiliate($event)\"\r\n></app-modal-link-product-ecommerce>\r\n","\r\nimport { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { RouterModule, Routes } from '@angular/router';\r\nimport { NgZorroAntModule } from 'src/app/ng-zorro-ant.module';\r\nimport { TranslateModule } from '@ngx-translate/core';\r\nimport { IonicModule } from '@ionic/angular';\r\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\r\nimport { ModalLinkProductEcommerceModule } from 'src/app/sales/menu/manage/ecommerce/components/modal-link-product-ecommerce/modal-link-product-ecommerce.module';\r\nimport { EInvoiceShopeeComponent } from './e-invoice-shopee.component';\r\nimport { EditCustomerTaxModule } from 'src/app/sales/menu/manage/ecommerce/components/edit-customer-tax/edit-customer-tax.module';\r\n\r\nconst routes: Routes = [\r\n  {\r\n    path: \"\",\r\n    component: EInvoiceShopeeComponent\r\n  },\r\n]\r\n\r\n\r\n\r\n@NgModule({\r\n  declarations: [\r\n    EInvoiceShopeeComponent\r\n  ],\r\n  imports: [\r\n    CommonModule,\r\n    RouterModule.forChild(routes),\r\n    NgZorroAntModule,\r\n    TranslateModule,\r\n    IonicModule,\r\n    FormsModule,\r\n    ReactiveFormsModule,\r\n    ModalLinkProductEcommerceModule,\r\n    EditCustomerTaxModule\r\n  ]\r\n})\r\nexport class EInvoiceShopeeModule { }\r\n"],"names":["VhType","i0","$event","ctx_r26","_id","ctx_r29","ctx_r39","ctx_r42","ctx_r8","_r9","ctx_r51","ctx_r5","EInvoiceShopeeComponent","constructor","router","lang","vhComponent","vhAlgorithm","vhQuerySales","cdRef","datePipe","vhEcommerce","vhAuth","vhQuery","vhEinvoice","nzModalService","billService","printService","name","value","value2","Date","current","getDefaultBranch","getlocalBranch","getLocalAppSettingNameBranch","cqt_submit_invoice_with_shipping_fee","cqt_submit_invoice_with_ecommerce_fee","cqt_vat_ecommerce_already_Included","cqt_vat_ecommerce_rate","cqt_invoice_auto_sign","cqt_vat_ecommerce_by_linked_product","cqt_vat_ecommerce_allow_promotional_items_zero_price","cqt_vat_ecommerce_separate_discount_line","cqt_vat_ecommerce_keep_promotional_items_as_sold","cqt_vat_ecommerce_use_latest_order_update_time","cqt_vat_ecommerce_buyer_info_with_platform_and_so_benh_an","cqt_vat_ecommerce_default_payment_method_chuyen_khoan","cqt_vat_ecommerce_item_code_is_barcode","cqt_vat_ecommerce_item_price_is_discounted","dataRestore","getCurrentNavigation","extras","state","_a","ngOnInit","disabledDate","searchValue","salesOrder","salesSubOrder","countOrderByStatus","load_status","selectedIndex","date","infoShop","getlocalShopListShopee","listProductOfBranch","getlocalDetailProducts","filter","e","delete_hidden","item","id_branch","shopees","length","localProducts","listProductApp","map","unit","getUnit_byRatio","units","product_shopees","prod","id_shop","listSubProductApp","listProductShopee","clearProductShow","getlocalProductListShopee","item_status","changeTime","event","getTime","showToast","translate","search","segmentChanged","valArray","split","val","changeAlias","toString","trim","toLowerCase","some","order_sn","_b","includes","searchProductApp","searchList","list_status_bill","status","order_status","orders","orderOthersCountByStatus","order","key","orderCountByStatus","find","goBack","navigate","showReport","showLoading","then","getSalesOrderListShopee","transform","setHours","access_token","result","hideLoading","create_at","create_time","checked","cqt_status","catch","err","calculateTotal","bill","ngAfterViewChecked","document","querySelector","heightScroll","clientHeight","getElementById","widthScroll","clientWidth","detectChanges","gotoDetail","sortTable","colName","dateCol","sortDatebyASC","sortDatebyDESC","statusCol","sortNumberbyASC","sortNumberbyDESC","console","log","checkAll","forEach","data","disabled","refreshStatus","validData","allChecked","every","allUnChecked","indeterminate","sendCQT","bill_checked","alertMessageDesktop","sort","a","b","update_time","batchSize","totalBatches","Math","ceil","showLoadingNotDuration","i","batch","slice","currentBatchIndex","floor","promises","signatureManual","results","asyncPromiseAll","error","invoice","Promise","resolve","reject","currentBranch","einvoices","invoice_provider","invoiceSeries","isLoading","changeShopee_toInvoice_byMinvoice","rsp","vcode","saveInvoice_Sign_byMinvoice","taxcode","token","res","code","updateSalesOrderShopee_byFile","array","message","saveInvoice_noSign_byMinvoice","escrowShopee","getEscrowShopee","order_details","order_income","items","inv_invoiceSeries","inv_invoiceIssuedDate","formatDateToString","inv_currencyCode","inv_exchangeRate","inv_discountAmount","inv_vatAmount","inv_TotalAmountWithoutVat","inv_TotalAmount","key_api","so_benh_an","buyerDisplayNameDefault","inv_paymentMethodName","payment_method","inv_buyerDisplayName","tax_buyerDisplayName","inv_buyerLegalName","tax_buyerLegalName","inv_buyerTaxCode","tax_buyerTaxCode","inv_buyerAddressLine","tax_buyerAddressLine","inv_buyerEmail","tax_buyerEmail","platformTax","vat_on_imported_goods","billTax","invoice_details","Array","productLinked","findProductLinked","invoice_detail","createEInvoiceDetailTemplate","tchat","original_price","seller_discount","invoiceDetailTax","tax","undefined","stt_rec0","inv_itemCode","item_id","inv_unitCode","inv_quantity","quantity_purchased","inv_unitPrice","ma_thue","inv_itemName","item_name","calculateNewPriceToUseSettingTax","inv_discountPercentage","type","PRODUCT","barcode","id_subproduct","addEInvoiceDetail","COMBO","priceCombo","price","errorZeroPriceComboMessage","j","combos","combo","combo_detail","percentRate","quantity","tchatCombo","detailproduct","getlocalDetailProduct","id_product","invoiceDetailComboTax","unitPrice","ratio","roundTo4Decimal","shipping_paid_by_buyer","shipping_discount","actual_shipping_fee","shopee_shipping_rebate","totalDiscountAmount","voucher_from_seller","seller_transaction_fee","shipping_seller_protection_fee_amount","commission_fee","invoices","details","msg","editTax","tempCustomerTax","isShowModalEditCustomerTax","onOkEditTax","customerTaxInfo","Object","assign","listProduct","prodApp","arrayProdShopee","indexProd","findIndex","model","index","model_id","splice","isLinkedToProduct","productOfBranch","findProduct","indexModel","found","openModelSelectProductsShopee","productShopee","productShopeeSelected","visible_affiliate","cancelAffiliate","acceptAfiliate","product","isZeroPriceCombo","confirmZeroPriceComboMessage","platform","confirm","nzTitle","nzIconType","nzCancelText","nzOnOk","currentProductShopee","id_product_selected","models","has_model","push","addMergeShopeesProduct_model","bool","setTimeout","countSelectedBill","_c","getUpdateTimeFormat","exportExcel","XLSXData","reduce","acc","item_list","rows","package_list","package_number","currentDate","returnDueDate","return_request_due_date","cancel_reason","message_to_seller","shipping_carrier","ship_by_date","pickup_done_time","item_sku","weight","model_quantity_purchased","model_original_price","model_discounted_price","estimated_shipping_fee","total_amount","buyer_username","recipient_address","phone","city","district","full_address","region","concat","statusName","replace","startDate","endDate","nameFile","exportXLSX","selectors","decls","vars","consts","template","ctx","_r3"],"sourceRoot":"webpack:///"}