{"version":3,"file":"src_app_sales_menu_manage_ecommerce_tiki_e-invoice-sales365_e-invoice-sales365_module_ts.js","mappings":"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","sources":["./src/app/sales/menu/manage/ecommerce/tiki/e-invoice-sales365/e-invoice-sales365.component.html","./src/app/sales/menu/manage/ecommerce/tiki/e-invoice-sales365/e-invoice-sales365.component.ts","./src/app/sales/menu/manage/ecommerce/tiki/e-invoice-sales365/e-invoice-sales365.module.ts"],"sourcesContent":["<div nz-row class=\"row-back medium-size\" (click)=\"goBack()\">\r\n    <i nz-icon nzType=\"left\" nzTheme=\"outline\"></i>{{'Back' | translate}}\r\n</div>\r\n<nz-layout id=\"control-export-goods\">\r\n    <div nz-row nzGutter=\"4\" class=\"control-export-goods-header\">\r\n        <div nz-col nzSpan=\"8\" class=\"title\">\r\n            <b>{{'Xuất hóa đơn điện tử từ phần mềm'|translate}}</b><br>\r\n            {{'Shop name' | translate}} : <b class=\"color-green\">{{infoShop.data?.name}}</b>\r\n        </div>\r\n\r\n        <div nz-col nzSpan=\"6\" class=\"title center-all-content\">\r\n            <nz-input-group [nzSuffix]=\"suffixIconSearch\">\r\n                <input [(ngModel)]=\"searchValue\" (ngModelChange)=\"search($event)\" type=\"text\" nz-input\r\n                    placeholder=\"{{('Search for order code' | translate)}}\" />\r\n            </nz-input-group>\r\n            <ng-template #suffixIconSearch>\r\n                <i nz-icon nzType=\"search\"></i>\r\n            </ng-template>\r\n        </div>\r\n        <div nz-col nzSpan=\"6\">\r\n            <nz-range-picker nzFormat='dd/MM/yyyy' [nzDisabledDate]=\"disabledDate\" nzFormat=\"dd/MM/yyyy\"\r\n                [(ngModel)]=\"date\" (ngModelChange)=\"changeTime($event)\">\r\n            </nz-range-picker>\r\n        </div>\r\n        <div nz-col nzSpan=\"4\" class=\"right-all-content\">\r\n\r\n            <button style=\"margin-right: 10px;\" class=\"btn-view center-all-content\" nz-button nzType=\"default\"\r\n                (click)=\"showReport()\">\r\n                <ion-icon src=\"assets/icon/management/view.svg\"></ion-icon>\r\n                {{'View' | translate}}\r\n            </button>\r\n            <button class=\"btn-view center-all-content\" nz-button nzType=\"default\" (click)=\"send()\">\r\n                <ion-icon src=\"assets/icon/management/view.svg\"></ion-icon>\r\n                {{'Gửi CQT' | translate}}\r\n            </button>\r\n\r\n        </div>\r\n    </div>\r\n    <div *ngIf=\"load_status else no_data\" nz-row nzGutter=\"16\" class=\"control-export-goods-body\">\r\n        <div nz-col nzSpan=\"24\">\r\n            <nz-table [nzData]=\"salesOrder\" [nzScroll]=\"{ y: heightScroll }\" #tableSales\r\n                [nzNoResult]=\"'Không có hóa đơn cần Gửi CQT' | translate\" [nzShowPagination]=\"false\" [nzFrontPagination]=\"false\">\r\n                <thead>\r\n                    <tr>\r\n                        <th nzWidth=\"60px\" [(nzChecked)]=\"allChecked\" [nzIndeterminate]=\"indeterminate\"\r\n                            (nzCheckedChange)=\"checkAll($event)\">\r\n                            ({{countSelectedBill}})\r\n                        </th>\r\n                        <th nzAlign=\"center\" nzWidth=\"6%\"><b>{{'No.' | translate}}</b></th>\r\n                        <th style=\"cursor: pointer;\" nzAlign='left' (click)=\"dateCol = !dateCol; sortTable('date')\">\r\n                            <b>{{'Date' | translate}}</b>\r\n                            <i nz-icon [nzType]=\"dateCol == true ? 'caret-down':'caret-up'\" nzTheme=\"outline\"></i>\r\n                        </th>\r\n                        <th style=\"cursor: pointer;\" nzAlign='left'\r\n                            (click)=\"bill_codeCol = !bill_codeCol; sortTable('bill_code')\">\r\n                            <b>{{'Invoice code' | translate}}</b>\r\n                            <i nz-icon [nzType]=\"bill_codeCol == true ? 'caret-down':'caret-up'\" nzTheme=\"outline\"></i>\r\n                        </th>\r\n                        <th style=\"cursor: pointer;\" nzAlign='left'\r\n                            (click)=\"partner_nameCol = !partner_nameCol; sortTable('partner_name')\">\r\n                            <b>{{'Order number' | translate}}</b>\r\n                            <i nz-icon [nzType]=\"partner_nameCol == true ? 'caret-down':'caret-up'\"\r\n                                nzTheme=\"outline\"></i>\r\n                        </th>\r\n\r\n                        <th style=\"cursor: pointer;\" nzAlign='left'\r\n                            (click)=\"statusCol = !statusCol; sortTable('status')\">\r\n                            <b>{{'Status CQT' | translate}}</b>\r\n                            <i nz-icon [nzType]=\"statusCol == true ? 'caret-down':'caret-up'\" nzTheme=\"outline\"></i>\r\n                        </th>\r\n                        <th style=\"cursor: pointer;\" nzAlign='left'>\r\n                            <b>{{'Function' | translate}}</b>\r\n                        </th>\r\n                        <!-- <th nzWidth=\"15%\" nzAlign='left'><b>{{'Note' | translate}}</b></th> -->\r\n                        <th style=\"cursor: pointer;\" nzWidth=\"15%\" nzAlign='right'\r\n                            (click)=\"sum_priceCol = !sum_priceCol; sortTable('sum_price')\">\r\n                            <b>{{'Total' | translate}}</b>\r\n                            <i nz-icon [nzType]=\"sum_priceCol == true ? 'caret-down' : 'caret-up'\"\r\n                                nzTheme=\"outline\"></i>\r\n                        </th>\r\n                    </tr>\r\n                </thead>\r\n                <tbody>\r\n\r\n                    <tr *ngFor=\"let invoice of tableSales.data; index as i\" style=\"cursor: pointer;\">\r\n                        <td>\r\n                            <label *ngIf=\"invoice.cqt_status != 3\" [(ngModel)]=\"invoice.checked\"\r\n                                (ngModelChange)=\" refreshStatus()\" nz-button nz-checkbox>\r\n                            </label>\r\n                        </td>\r\n                        <td nzAlign=\"center\">{{i + 1}}</td>\r\n                        <td nzAlign='left'>{{invoice.date | date: 'dd/MM/yyyy HH:mm'}}</td>\r\n                        <td (click)=\"$event.stopPropagation();copyBillCode(invoice.bill_code)\" nzAlign='left'>\r\n                            {{invoice.bill_code}} <i nz-icon nzType=\"copy\" nzTheme=\"outline\"></i></td>\r\n                        <td nzAlign='left'>{{invoice.order_number_ecommerce}}\r\n\r\n                        <td nzAlign='left'>{{invoice.status}}</td>\r\n                        <td nzAlign='left'>\r\n                            <i (click)=\"editTax(invoice)\" class=\"cus-icon\" nz-icon nzType=\"info-circle\" nzTheme=\"outline\"\r\n                                style=\"cursor: pointer;margin-right: 10px\"></i>\r\n                            <!-- Xem hóa đơn điện tử -->\r\n                            <span *ngIf=\"invoice.cqt_status == 2 || invoice.cqt_status == 3\" nz-tooltip [nzTooltipTitle]=\"'View E-invoice' | translate\" nz-icon class=\"ant-input-password-icon\" [nzType]=\"'eye'\" (click)=\"$event.stopPropagation(); printService.viewEInvoice(infoBranch, invoice)\"></span>\r\n                            <button *ngIf=\"invoice.cqt_status == 1\" style=\"margin-right: 10px;color: white !important;\"\r\n                                nz-button (click)=\"sendCQTManual(invoice)\" nzType=\"primary\"\r\n                                [nzLoading]=\"invoice.isLoading\">{{'Send CQT' | translate}}</button>\r\n                            <button *ngIf=\"invoice.cqt_status == 2\" style=\"margin-right: 10px;color: white !important;\"\r\n                                nz-button (click)=\"signatureManual(invoice)\" nzType=\"primary\"\r\n                                [nzLoading]=\"invoice.isLoading\">{{'Waiting for signature' | translate}}</button>\r\n                        </td>\r\n                        <!-- <td nzAlign='left'>{{invoice.note}}</td> -->\r\n                        <td nzAlign='right' class=\"money-right\">\r\n                            {{vhAlgorithm.vhcurrencyunit_symbol(invoice['total'])}}\r\n                        </td>\r\n                    </tr>\r\n                </tbody>\r\n            </nz-table>\r\n\r\n        </div>\r\n    </div>\r\n    <ng-template #no_bill class=\"full-height\">\r\n        <div *ngIf=\"load_status\" nz-col nzSpan=\"24\" style=\"height: 60vh;\" class=\"center-all-content\">\r\n            <div>{{'Không có hóa đơn cần Gửi CQT'| translate}}</div>\r\n        </div>\r\n    </ng-template>\r\n    <ng-template #no_data>\r\n        <div nz-row class=\"no-affiliate\">\r\n            <div nz-col nzSpan=\"24\" class=\"text-center\">\r\n                <img src=\"assets/icon/management/ecommerce/no-data-orderstatus.svg\" alt=\"\">\r\n                <p>{{\"Please click the view button\"|\r\n                    translate}}\r\n                </p>\r\n            </div>\r\n        </div>\r\n    </ng-template>\r\n    <ng-template #updateForControl let-params>\r\n        <div nz-row>\r\n            <div nz-col nzSpan=\"24\">\r\n                <span>{{\"Date\"| translate}}: </span>\r\n                <nz-date-picker nzFormat=\"dd/MM/yyyy\" style=\"margin-left:20px\"\r\n                    [(ngModel)]=\"bill_selected.verify_date_delivered_goods\">\r\n                </nz-date-picker>\r\n            </div>\r\n        </div>\r\n    </ng-template>\r\n</nz-layout>\r\n\r\n<!-- -------------------------------------------- MODAL CHỈNH SỬA THÔNG TIN THUẾ KHÁCH HÀNG -------------------------------------------- -->\r\n<app-edit-customer-tax *ngIf=\"isShowModalEditCustomerTax\" [invoice]=\"tempCustomerTax\"\r\n    (onClose)=\"isShowModalEditCustomerTax = false\" (onOk)=\"isShowModalEditCustomerTax = false; onOkEditTax($event)\">\r\n</app-edit-customer-tax>\r\n","import { DatePipe } from '@angular/common';\r\nimport { ChangeDetectorRef, Component, OnInit, TemplateRef } from '@angular/core';\r\nimport { Router } from '@angular/router';\r\nimport { VhAlgorithm, VhAuth, VhEinvoice, VhQuery, VhQuerySales } from 'ionic-vhframeworks';\r\nimport { NzModalService } from 'ng-zorro-antd/modal';\r\nimport { VhComponent } from 'src/app/sales/components/vh-component/vh-component';\r\nimport { BillService } from 'src/app/sales/services/bill.service';\r\nimport { LanguageService } from 'src/app/sales/services/language.service';\r\nimport { PrintService } from 'src/app/sales/services/print.service';\r\n\r\n@Component({\r\n  selector: 'app-e-invoice-sales365',\r\n  templateUrl: './e-invoice-sales365.component.html',\r\n  styleUrls: ['./e-invoice-sales365.component.scss']\r\n})\r\nexport class EInvoiceSales365Component implements OnInit {\r\n\r\n  searchValue: any;\r\n  salesOrder: Array<any> = [];\r\n  salesSubOrder: Array<any> = [];\r\n  heightScroll: any;\r\n  public date: Date[] = [new Date(), new Date()];\r\n  load_status: boolean = false;\r\n  // dataRestore: any;\r\n  bill_selected: any = {};\r\n  /**Giới hạn thời gian cho xem bill */\r\n  disabledDate = (current: Date): boolean => {\r\n    if (current.getTime() < this.minDate.getTime() - 24 * 60 * 60 * 1000) return true;\r\n    return false;\r\n  };\r\n  minDate: Date = new Date(Date.now() - 24 * 60 * 60 * 1000 * 30);\r\n  infoShop: any = {};\r\n  infoBranch = this.vhQuerySales.getlocalBranch(this.vhQuerySales.getDefaultBranch()._id);\r\n  constructor(\r\n    private router: Router,\r\n    public lang: LanguageService,\r\n    public vhComponent: VhComponent,\r\n    public vhAlgorithm: VhAlgorithm,\r\n    private cdRef: ChangeDetectorRef,\r\n    private modal: NzModalService,\r\n    private vhAuth: VhAuth,\r\n    private datePipe: DatePipe,\r\n    private vhQuerySales: VhQuerySales,\r\n    private vhQuery: VhQuery,\r\n    private vhEinvoice: VhEinvoice,\r\n    private billService: BillService,\r\n    private printService: PrintService,\r\n  ) {\r\n    // this.date[0].setHours(0, 0, 0, 0)\r\n    // this.date[1].setHours(23, 59, 59, 59)\r\n    // this.dataRestore = this.router.getCurrentNavigation().extras.state.dataRestore\r\n  }\r\n\r\n  ngOnInit(): void {\r\n    // if (this.dataRestore.id_shop_selected) {\r\n    //   this.searchValue = this.dataRestore.searchValue\r\n    //   this.salesOrder = this.dataRestore.salesOrder\r\n    //   this.salesSubOrder = this.dataRestore.salesSubOrder\r\n    //   this.load_status = true;\r\n    //   this.date = this.dataRestore.date;\r\n    // }\r\n    this.infoShop = this.vhQuerySales.getlocalShopListTiki()[0];\r\n    console.log(this.infoShop);\r\n\r\n    this.getMinDate();\r\n  }\r\n\r\n  /**\r\n   * Lấy ngày giới hạn được xem báo cáo\r\n  */\r\n  getMinDate() {\r\n    let date = new Date(Date.now() - 24 * 60 * 60 * 1000 * 100);\r\n    this.vhQuerySales.getValidityDate(date).then((validitydate: Date) => {\r\n      this.minDate = validitydate;\r\n      if ((this.minDate.getTime()) < new Date(this.vhAuth.getStore().registrationdate).getTime()) {\r\n        this.disabledDate = (current: Date): boolean => {\r\n          if (current.getTime() < new Date(this.vhAuth.getStore().registrationdate).getTime() - 24 * 60 * 60 * 1000) return true;\r\n          return false;\r\n        };\r\n      }\r\n    });\r\n  }\r\n  /**Tìm kiếm hóa đơn */\r\n  search(value: string) {\r\n    if (value.length) {\r\n      let val: string = this.vhAlgorithm.changeAlias(value.trim().toLowerCase());\r\n      this.salesOrder = this.vhAlgorithm.searchList(val, this.salesSubOrder, ['bill_code', 'order_number_ecommerce']);\r\n    } else this.salesOrder = [...this.salesSubOrder];\r\n  }\r\n  goBack() {\r\n    this.router.navigate(['/sales/dashboard/manage/ecommerce/tiki']);\r\n  }\r\n  changeTime(event) {\r\n    if (event[1].getTime() - event[0].getTime() <= 2678400000) {\r\n    } else {\r\n      this.vhComponent.showToast(2000, this.lang.translate(\"The time to view no more than 30 days\"), \"alert-toast\");\r\n      this.date = [event[0], event[0].getTime() + 2678400000];\r\n    }\r\n  }\r\n  showReport() {\r\n    //cqt_status: { $in: [1, 2] },\r\n    this.load_status = true;\r\n    this.salesOrder = [];\r\n    this.salesSubOrder = [];\r\n    this.vhComponent.showLoading(\"\", \"transparent-loading\").then(() => {\r\n      this.vhQuerySales.getBills_byFields({ date: { $gte: new Date(this.date[0].setHours(0, 0, 0)), $lte: new Date(this.date[1].setHours(23, 59, 59, 59)) }, bill_type: { $in: [1] }, id_customer: { $eq: this.infoShop.data.id_customer }, id_branch: { $eq: this.vhQuerySales.getDefaultBranch()._id } , id_shop: { $eq: this.infoShop._id }}, {})\r\n        .then((result: any) => {\r\n          console.log(result);\r\n\r\n          this.salesOrder = result.filter(e => e.cqt_status != 3).map(item => {\r\n            return {\r\n              ...item, status: this.renderStatus(item.cqt_status),\r\n              checked: item.cqt_status != 3 ? true : false,\r\n              note: this.handleNote(item.note),\r\n            };\r\n          });\r\n\r\n          this.salesSubOrder = this.salesOrder;\r\n          this.vhComponent.hideLoading(0);\r\n        }\r\n          , (error => this.vhComponent.hideLoading(0))).catch(err => this.vhComponent.hideLoading(0));\r\n    });\r\n  }\r\n\r\n  /** hàm sort cho các cột */\r\n  dateCol = false;\r\n  bill_codeCol = false;\r\n  partner_nameCol = false;\r\n  payment_nameCol = false;\r\n  statusCol = false;\r\n  sum_priceCol = false;\r\n  /** Hàm thực hiện sắp xếp theo collection\r\n   *\r\n   * @param colName       // tên cột muôn sắp xếp\r\n   */\r\n  sortTable(colName) {\r\n    switch (colName) {\r\n      case 'date':\r\n        if (this.dateCol) {\r\n          this.salesOrder = this.vhAlgorithm.sortDatebyASC([...this.salesOrder], colName);\r\n        } else {\r\n          this.salesOrder = this.vhAlgorithm.sortDatebyDESC([...this.salesOrder], colName);\r\n        }\r\n        break;\r\n      case 'status': if (this.statusCol) {\r\n        this.salesOrder = this.vhAlgorithm.sortNumberbyASC([...this.salesOrder], 'cqt_status');\r\n      } else {\r\n        this.salesOrder = this.vhAlgorithm.sortNumberbyDESC([...this.salesOrder], 'cqt_status');\r\n      }\r\n        console.log(this.salesOrder);\r\n        break;\r\n    }\r\n  }\r\n  handleNote(note) {\r\n    const match = note.match(/\\d+\\w*/);\r\n    return match ? match[0] : null;\r\n  }\r\n\r\n  /**\r\n   * trả về tên loại trạng thái bill\r\n   * @param bill_type\r\n   * @returns string\r\n   * @example let bill_name = this.renderStatus(2)\r\n   */\r\n  renderStatus(cqt_status) {\r\n    switch (cqt_status) {\r\n      case 1: return this.lang.translate('Not sent to CQT');\r\n      case 2: return this.lang.translate('Waiting for signature');\r\n      case 3: return this.lang.translate('Sent to CQT');\r\n      default: return this.lang.translate('Not sent to CQT');\r\n    }\r\n  }\r\n  changeShop(event) {\r\n    this.salesOrder = [];\r\n    this.salesSubOrder = [];\r\n  }\r\n\r\n  ngAfterViewChecked() {\r\n    if (document.querySelector(\"#control-export-goods\") && document.querySelector(\".ant-table-thead\") && document.querySelector(\".control-export-goods-header\")) {\r\n      this.heightScroll = document.querySelector(\"#control-export-goods\").clientHeight - document.querySelector(\".ant-table-thead\").clientHeight\r\n        - document.querySelector(\".control-export-goods-header\").clientHeight + \"px\";\r\n\r\n\r\n    }\r\n\r\n    this.cdRef.detectChanges();\r\n  }\r\n\r\n  /**Render date theo định dạng ngày/tháng/năm */\r\n  format_date(date) {\r\n    return this.datePipe.transform(date, \"dd/MM/yyyy\");\r\n  }\r\n\r\n  gotoDetail(bill) {\r\n    // this.router.navigate(['/sales/dashboard/manage/ecommerce/shopee/control/export-goods/detail'], { state: { bill: bill, dataRestore: { salesOrder: this.salesOrder, searchValue: this.searchValue, id_shop_selected: this.infoShop._id, listProduct: this.dataRestore.listProduct, date: this.date, salesSubOrder: this.salesSubOrder } } })\r\n  }\r\n\r\n\r\n  allChecked = true;\r\n  indeterminate = true;\r\n\r\n\r\n\r\n  /**\r\n   * Check tất cả\r\n   * @param value\r\n   */\r\n  checkAll(value: boolean): void {\r\n    this.salesOrder.forEach(data => {\r\n      if (!data.disabled) {\r\n        data.checked = value;\r\n      }\r\n    });\r\n    this.refreshStatus();\r\n  }\r\n\r\n\r\n\r\n  /**\r\n   * Check 1 cái\r\n   */\r\n  refreshStatus(): void {\r\n    const validData = this.salesOrder.filter(value => !value.disabled);\r\n    const allChecked = validData.length > 0 && validData.every(value => value.checked === true);\r\n    const allUnChecked = validData.every(value => !value.checked);\r\n    this.allChecked = allChecked;\r\n    this.indeterminate = !allChecked && !allUnChecked;\r\n  }\r\n\r\n\r\n  /**\r\n   * Khi nhấn nút gửi\r\n   */\r\n  async send() {\r\n\r\n    let bills = this.salesOrder.filter((data: any) => data.checked);\r\n    const batchSize = 1;\r\n    const totalBatches = Math.ceil(bills.length / batchSize);\r\n    if (!bills.length) {\r\n      this.vhComponent.alertMessageDesktop('error', this.lang.translate(\"Please select at least one invoice\"));\r\n      return;\r\n\r\n    }\r\n    await this.vhComponent.showLoadingNotDuration(this.lang.translate(\"Sending...\"));\r\n    for (let i = 0; i < bills.length; i += batchSize) {\r\n      // tạo mỗi lần 1 request gửi hóa đơn\r\n      const batch = bills.slice(i, i + batchSize);\r\n      const currentBatchIndex = Math.floor(i / batchSize) + 1;\r\n\r\n      const promises = batch.map(bill => {\r\n        if (bill.cqt_status == 1 || !bill.cqt_status) return this.sendCQT(bill);\r\n        if (bill.cqt_status == 2) return this.signature(bill);\r\n        return Promise.resolve(); // nếu không thuộc 1 hoặc 2 thì skip\r\n      });\r\n\r\n      try {\r\n        const results = await this.vhQuery.asyncPromiseAll(promises);\r\n        if (currentBatchIndex == totalBatches) {\r\n          this.vhComponent.hideLoading();\r\n          this.salesOrder = this.salesOrder.filter((data: any) => data.cqt_status != 3);\r\n        }\r\n      } catch (error) {\r\n        // trường hợp 1 vài đơn bị lỗi ko gửi dc\r\n        if (currentBatchIndex == totalBatches) {\r\n          this.vhComponent.hideLoading();\r\n          this.salesOrder = this.salesOrder.filter((data: any) => data.cqt_status != 3);\r\n        }\r\n        console.error(`Error in batch ${i / batchSize + 1}:`, error);\r\n      }\r\n    }\r\n  }\r\n\r\n  currentBranch = this.vhQuerySales.getlocalBranch(this.vhQuerySales.getDefaultBranch()._id);\r\n  /**\r\n   * hàm này gửi hóa đơn lên cqt và ký luôn\r\n   * @param invoice\r\n   */\r\n  sendCQT(invoice) {\r\n    return new Promise((resolve, reject) => {\r\n      // trường hợp chưa có tạo kết nối hóa đơn điện tử\r\n      if (!this.currentBranch.einvoices?.length) {\r\n        this.vhComponent.alertMessageDesktop(\"error\", this.lang.translate(\"Please connect e-invoice for this branch\"));\r\n        resolve('');\r\n        return;\r\n      }\r\n      // trường hợp chỉ có 1 kết nối hóa đơn điện tử thì tạo thẳng luôn\r\n      if (this.currentBranch.einvoices.length && this.currentBranch.einvoices.length == 1) {\r\n        // trường hợp ncc hóa đơn điện tử là M-invoice\r\n        if (this.currentBranch.einvoices[0].invoice_provider == 'M-invoice') {\r\n\r\n          if (!this.currentBranch.einvoices[0].invoiceSeries.length) {\r\n            this.vhComponent.alertMessageDesktop(\"error\", this.lang.translate(\"Please connect e-invoice for this branch\"));\r\n\r\n            resolve('');\r\n            return;\r\n          }\r\n        }\r\n        this.billService.changeBill_byLocal_toInvoice_byMinvoice(invoice._id, this.currentBranch.einvoices[0].invoiceSeries[0], 'TIKI', this.infoShop)\r\n          .then((rsp) => {\r\n            if (rsp.vcode == 0) {\r\n              this.vhEinvoice.saveInvoice_Sign_byMinvoice(this.currentBranch.taxcode, this.currentBranch.einvoices[0].token, 1, rsp.data)\r\n                .then(async (res: any) => {\r\n\r\n\r\n                  if (res.code == '00') {\r\n                    invoice.cqt_status = 3;\r\n                    invoice.status = this.lang.translate(\"Sent to CQT\");\r\n                    await this.vhQuerySales.updateBill(invoice._id, { cqt_status: 3 });\r\n                    resolve('');\r\n                    // this.vhComponent.alertMessageDesktop(\"success\", this.lang.translate('Send invoice to CQT successfully'))\r\n                  }\r\n\r\n                  else if (res.code == '9999') {\r\n                    reject(invoice._id);\r\n                    this.vhComponent.alertMessageDesktop(\"error\", invoice.bill_code + ' ' + this.lang.translate(\"Vui lòng kiểm tra lại thông tin hóa đơn đẩy lên CQT chưa phù hợp\"));\r\n                  }\r\n                  else {\r\n                    reject(invoice._id);\r\n                    this.vhComponent.alertMessageDesktop(\"error\", invoice.bill_code + ' ' + this.lang.translate(res.message));\r\n                  }\r\n                });\r\n            }\r\n          }, (error: any) => {\r\n            console.log('error', error);\r\n          });\r\n      }\r\n    });\r\n\r\n  }\r\n  /**\r\n   * hàm này ký hóa đơn lên cqt\r\n   * @param invoice\r\n   */\r\n  signature(invoice) {\r\n    return new Promise((resolve, reject) => {\r\n      // trường hợp chưa có tạo kết nối hóa đơn điện tử\r\n      if (!this.currentBranch.einvoices?.length) {\r\n        this.vhComponent.alertMessageDesktop(\"error\", this.lang.translate(\"Please connect e-invoice for this branch\"));\r\n        resolve('');\r\n        return;\r\n      }\r\n      // trường hợp chỉ có 1 kết nối hóa đơn điện tử thì tạo thẳng luôn\r\n      if (this.currentBranch.einvoices.length && this.currentBranch.einvoices.length == 1) {\r\n        // trường hợp ncc hóa đơn điện tử là M-invoice\r\n        if (this.currentBranch.einvoices[0].invoice_provider == 'M-invoice') {\r\n\r\n          if (!this.currentBranch.einvoices[0].invoiceSeries.length) {\r\n            this.vhComponent.alertMessageDesktop(\"error\", this.lang.translate(\"Please connect e-invoice for this branch\"));\r\n\r\n            resolve('');\r\n            return;\r\n          }\r\n        }\r\n        this.billService.changeBill_byLocal_toInvoice_byMinvoice(invoice._id, this.currentBranch.einvoices[0].invoiceSeries[0], 'TIKI', this.infoShop)\r\n          .then((rsp) => {\r\n            if (rsp.vcode == 0) {\r\n              this.vhEinvoice.saveInvoice_Sign_byMinvoice(this.currentBranch.taxcode, this.currentBranch.einvoices[0].token, 2, rsp.data)\r\n                .then((res: any) => {\r\n\r\n\r\n                  if (res.code == '00') {\r\n                    invoice.cqt_status = 3;\r\n                    invoice.status = this.lang.translate(\"Sent to CQT\");\r\n                    // this.vhComponent.alertMessageDesktop(\"success\", this.lang.translate('Update invoice to CQT successfully'))\r\n                    this.vhQuerySales.updateBill(invoice._id, { cqt_status: 3 });\r\n                    resolve('');\r\n                  }\r\n\r\n\r\n                  else if (res.code == '9999') {\r\n                    reject(invoice._id);\r\n                    this.vhComponent.alertMessageDesktop(\"error\", invoice.bill_code + ' ' + this.lang.translate(\"Vui lòng kiểm tra lại thông tin hóa đơn đẩy lên CQT chưa phù hợp\"));\r\n                  }\r\n                  else {\r\n                    reject(invoice._id);\r\n                    this.vhComponent.alertMessageDesktop(\"error\", invoice.bill_code + ' ' + this.lang.translate(res.message));\r\n                  }\r\n                });\r\n            }\r\n          }, (error: any) => {\r\n            console.log('error', error);\r\n          });\r\n      }\r\n    });\r\n\r\n  }\r\n\r\n\r\n\r\n  /**\r\n   * hàm này gửi hóa đơn lên cqt \r\n   * @param invoice \r\n   */\r\n  sendCQTManual(invoice) {\r\n    // lấy ra chi nhánh hiện tại\r\n    let currentBranch = this.vhQuerySales.getlocalBranch(this.vhQuerySales.getDefaultBranch()._id);\r\n    console.log(currentBranch);\r\n\r\n    // trường hợp chưa có tạo kết nối hóa đơn điện tử\r\n    if (!currentBranch.einvoices?.length) {\r\n      this.vhComponent.alertMessageDesktop(\"error\", this.lang.translate(\"Please connect e-invoice for this branch\"))\r\n      return\r\n    }\r\n    // trường hợp chỉ có 1 kết nối hóa đơn điện tử thì tạo thẳng luôn\r\n    if (currentBranch.einvoices.length && currentBranch.einvoices.length == 1) {\r\n      // trường hợp ncc hóa đơn điện tử là M-invoice\r\n      if (currentBranch.einvoices[0].invoice_provider == 'M-invoice') {\r\n\r\n        if (!currentBranch.einvoices[0].invoiceSeries.length) {\r\n          this.vhComponent.alertMessageDesktop(\"error\", this.lang.translate(\"Please connect e-invoice for this branch\"))\r\n          return\r\n        }\r\n        invoice.isLoading = true\r\n        this.billService.changeBill_byLocal_toInvoice_byMinvoice(invoice._id, currentBranch.einvoices[0].invoiceSeries[0], 'TIKI', this.infoShop)\r\n          .then((rsp) => {\r\n            if (rsp.vcode == 0) {\r\n              this.vhEinvoice.saveInvoice_Sign_byMinvoice(currentBranch.taxcode, currentBranch.einvoices[0].token, 1, rsp.data)\r\n                .then((res: any) => {\r\n                  invoice.isLoading = false\r\n                  console.log(res);\r\n                  if (res.code == '00') {\r\n                    invoice.cqt_status = 3\r\n                    invoice.status = this.lang.translate(\"Sent to CQT\")\r\n                    this.vhQuerySales.updateBill(invoice._id, { cqt_status: 3 })\r\n                    this.vhComponent.alertMessageDesktop(\"success\", this.lang.translate('Send invoice to CQT successfully'))\r\n                  }\r\n                  else if (res.code == '9999') {\r\n                    this.vhComponent.alertMessageDesktop(\"error\", this.lang.translate(\"Vui lòng kiểm tra lại thông tin hóa đơn đẩy lên CQT chưa phù hợp\"))\r\n                  }\r\n                  else {\r\n                    this.vhComponent.alertMessageDesktop(\"error\", this.lang.translate(res.message))\r\n                  }\r\n                }, (error: any) => {\r\n                  invoice.isLoading = true\r\n                  this.vhComponent.alertMessageDesktop(\"error\", this.lang.translate(\"Có lỗi xảy ra khi khởi tạo hóa đơn đẩy lên CQT\"))\r\n                  console.log('error', error)\r\n                })\r\n            }\r\n            else {\r\n              invoice.isLoading = true\r\n              this.vhComponent.alertMessageDesktop(\"error\", this.lang.translate(\"Có lỗi xảy ra khi khởi tạo hóa đơn đẩy lên CQT\"))\r\n            }\r\n          }, (error: any) => {\r\n            this.vhComponent.alertMessageDesktop(\"error\", this.lang.translate(\"Có lỗi xảy ra khi khởi tạo hóa đơn đẩy lên CQT\"))\r\n            invoice.isLoading = true\r\n            console.log('error', error)\r\n          })\r\n\r\n      }\r\n    }\r\n    // trường hợp chỉ có 2 kết nối hóa đơn điện tử trở lên thì hiện modal chọn ncc  hóa đơn điện tử\r\n    if (currentBranch.einvoices.length && currentBranch.einvoices.length > 1) {\r\n\r\n    }\r\n  }\r\n\r\n\r\n\r\n  /** Có hiển thị modal chỉnh sửa customer tax hay không */\r\n  isShowModalEditCustomerTax: boolean = false;\r\n  tempCustomerTax: any = null;\r\n\r\n\r\n\r\n  /**\r\n   * Khi nhấn edit cột thông tin khách hàng\r\n   */\r\n  editTax(invoice) {\r\n    this.tempCustomerTax = invoice;\r\n    this.isShowModalEditCustomerTax = true;\r\n  }\r\n\r\n\r\n\r\n  /**\r\n   * Khi ok trong modal chỉnh sửa customer tax\r\n   * @param customerTaxInfo\r\n   */\r\n  onOkEditTax(customerTaxInfo) {\r\n    this.isShowModalEditCustomerTax = false;\r\n    Object.assign(this.tempCustomerTax, customerTaxInfo);\r\n  }\r\n\r\n\r\n\r\n  /**\r\n   * Đếm số lượng bill đang check\r\n   */\r\n  get countSelectedBill(): number {\r\n    return this.salesOrder?.filter((e: any) => e.checked)?.filter((data: any) => data.cqt_status != 3)?.length;\r\n  }\r\n\r\n}\r\n","import { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { RouterModule, Routes } from '@angular/router';\r\nimport { NgZorroAntModule } from 'src/app/ng-zorro-ant.module';\r\nimport { TranslateModule } from '@ngx-translate/core';\r\nimport { IonicModule } from '@ionic/angular';\r\nimport { FormsModule } from '@angular/forms';\r\nimport { SearchModule } from 'src/app/sales/components/search/search.module';\r\nimport { EInvoiceSales365Component } from './e-invoice-sales365.component';\r\nconst routes: Routes = [\r\n  {\r\n    path: \"\",\r\n    component: EInvoiceSales365Component\r\n  },\r\n]\r\n\r\n\r\n\r\n@NgModule({\r\n  declarations: [\r\n    EInvoiceSales365Component\r\n  ],\r\n  imports: [\r\n    CommonModule,\r\n    RouterModule.forChild(routes),\r\n    NgZorroAntModule,\r\n    TranslateModule,\r\n    IonicModule,\r\n    FormsModule,\r\n    SearchModule\r\n  ]\r\n})\r\nexport class EInvoiceSales365Module { }\r\n"],"names":["i0","$event","ctx_r23","ctx_r40","ctx_r41","ctx_r42","ctx_r43","ctx_r44","ctx_r2","ctx_r51","EInvoiceSales365Component","constructor","router","lang","vhComponent","vhAlgorithm","cdRef","modal","vhAuth","datePipe","vhQuerySales","vhQuery","vhEinvoice","billService","printService","Date","current","getTime","minDate","now","getlocalBranch","getDefaultBranch","_id","ngOnInit","infoShop","getlocalShopListTiki","console","log","getMinDate","date","getValidityDate","then","validitydate","getStore","registrationdate","disabledDate","search","value","length","val","changeAlias","trim","toLowerCase","salesOrder","searchList","salesSubOrder","goBack","navigate","changeTime","event","showToast","translate","showReport","load_status","showLoading","getBills_byFields","$gte","setHours","$lte","bill_type","$in","id_customer","$eq","data","id_branch","id_shop","result","filter","e","cqt_status","map","item","status","renderStatus","checked","note","handleNote","hideLoading","error","catch","err","sortTable","colName","dateCol","sortDatebyASC","sortDatebyDESC","statusCol","sortNumberbyASC","sortNumberbyDESC","match","changeShop","ngAfterViewChecked","document","querySelector","heightScroll","clientHeight","detectChanges","format_date","transform","gotoDetail","bill","checkAll","forEach","disabled","refreshStatus","validData","allChecked","every","allUnChecked","indeterminate","send","bills","batchSize","totalBatches","Math","ceil","alertMessageDesktop","showLoadingNotDuration","i","batch","slice","currentBatchIndex","floor","promises","sendCQT","signature","Promise","resolve","results","asyncPromiseAll","invoice","reject","currentBranch","einvoices","_a","invoice_provider","invoiceSeries","changeBill_byLocal_toInvoice_byMinvoice","rsp","vcode","saveInvoice_Sign_byMinvoice","taxcode","token","res","code","updateBill","bill_code","message","sendCQTManual","isLoading","editTax","tempCustomerTax","isShowModalEditCustomerTax","onOkEditTax","customerTaxInfo","Object","assign","countSelectedBill","_b","_c","selectors","decls","vars","consts","template","ctx","_r5"],"sourceRoot":"webpack:///"}