{"version":3,"file":"src_app_sales_menu_manage_ecommerce_tiki_e-invoice-tiki_e-invoice-tiki_module_ts.js","mappings":"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","sources":["./src/app/sales/menu/manage/ecommerce/tiki/e-invoice-tiki/e-invoice-tiki.component.ts","./src/app/sales/menu/manage/ecommerce/tiki/e-invoice-tiki/e-invoice-tiki.component.html","./src/app/sales/menu/manage/ecommerce/tiki/e-invoice-tiki/e-invoice-tiki.module.ts"],"sourcesContent":["import { DatePipe } from '@angular/common';\r\nimport { ChangeDetectorRef, Component, OnInit } from '@angular/core';\r\nimport { Router } from '@angular/router';\r\nimport { VhAlgorithm, VhAuth, VhEinvoice, VhQuery, VhQuerySales } from 'ionic-vhframeworks';\r\nimport { NzModalService } from 'ng-zorro-antd/modal';\r\nimport { VhComponent } from 'src/app/sales/components/vh-component/vh-component';\r\nimport { VhType } from 'src/app/sales/interface/vh-type';\r\nimport { BillService } from 'src/app/sales/services/bill.service';\r\nimport { LanguageService } from 'src/app/sales/services/language.service';\r\nimport { PrintService } from 'src/app/sales/services/print.service';\r\n@Component({\r\n  selector: 'app-e-invoice-tiki',\r\n  templateUrl: './e-invoice-tiki.component.html',\r\n  styleUrls: ['./e-invoice-tiki.component.scss']\r\n})\r\nexport class EInvoiceTikiComponent implements OnInit {\r\n  searchValue: any;\r\n  searchProductAppValue: any = '';\r\n  salesOrder: Array<any> = [];\r\n  salesSubOrder: Array<any> = [];\r\n  selectedIndex: number = 0;\r\n  loadingPickup: boolean = false;\r\n  loadingConfirm: boolean = false;\r\n  isVisibleConfirm: boolean = false;\r\n  billSelected: any = {};\r\n  list_status_bill: Array<any> = [\r\n    { name: \"All\", status: \"all\" },\r\n    { name: \"Wait for confirmation\", status: \"queueing\", main_state: 'awaiting_confirmation' },//1\r\n    { name: \"ang ng gi\", status: \"queueing\", main_state: 'processing' },//2\r\n    { name: \"Ly hng\", main_state: 'processing', main_substate: \"picked_up_from_seller\", main_substate1: \"picking_up_from_seller\" },//3\r\n    { name: \"Ly hng tht bi\", main_substate1: \"pickup_failed_2\", main_substate: 'pickup_failed_1' },//4\r\n    { name: \"Tnh trng giao hng\", status: \"ready_to_ship\", status2: \"shipping\", main_state: 'shipping' },//5\r\n    { name: \"Giao hng thnh cng\", status: \"successful_delivery\" },//6\r\n    { name: \"Giao hng tht bi\", status: \"handover_to_partner\", main_state: 'shipping', main_substate: \"3pl_delivery_failed_1\", main_substate2: \"3pl_delivery_failed_2\", main_substate3: \"3pl_delivery_failed_3\" },\r\n    { name: \"ang tr hng v cho nh bn\", status: \"handover_to_partner\", main_substate: \"3pl_returning_to_seller\", main_state: 'shipping' },//8\r\n    { name: \" hy (Cha giao hng)\", status: \"canceled\", main_state: 'canceled', confirmation_status: 'waiting', confirmation_status1: 'seller_confirmed' },\r\n    { name: \"Tr hng thnh cng\", status: \"canceled\", main_state: 'canceled', confirmation_status: 'ready_to_pick' },\r\n  ]\r\n  heightScroll: any;\r\n  widthScroll: any;\r\n  public date: Date[] = [new Date(), new Date()];\r\n  startTimeBackUp: Date;\r\n  endTimeBackUp: Date;\r\n  load_status: boolean = false;\r\n  dataRestore: any;\r\n  /**Gii hn thi gian cho xem bill */\r\n  disabledDate = (current: Date): boolean => {\r\n    if (current.getTime() < new Date(this.vhAuth.getStore().registrationdate).getTime() - 24 * 60 * 60 * 1000) return true;\r\n    return false;\r\n  };\r\n  listAddress: Array<any> = [];\r\n  listTimes: Array<any> = [];\r\n  infoShop: any = {};\r\n  listProductOfBranch: Array<any> = []; // sp ca phn mm c lin kt vi tiki\r\n  listProductApp: Array<any> = []; //sp ca phn mm\r\n  listSubProductApp: Array<any> = []; //sp ca app cha tiki[]\r\n  id_branch: string = this.vhQuerySales.getDefaultBranch()._id;\r\n  arrayHidden: Array<any> = []; //mng ny cha id ca nhng sp ang tm n\r\n\r\n  currentBranch = this.vhQuerySales.getlocalBranch(this.vhQuerySales.getDefaultBranch()._id);\r\n  infoBranch = this.vhQuerySales.getlocalBranch(this.vhQuerySales.getDefaultBranch()._id);\r\n\r\n\r\n\r\n  constructor(\r\n    private router: Router,\r\n    public lang: LanguageService,\r\n    public vhComponent: VhComponent,\r\n    public vhAlgorithm: VhAlgorithm,\r\n    private vhQuerySales: VhQuerySales,\r\n    private cdRef: ChangeDetectorRef,\r\n    private datePipe: DatePipe,\r\n    private nzModalService: NzModalService,\r\n    private vhAuth: VhAuth,\r\n    private vhQuery: VhQuery,\r\n    private vhEinvoice: VhEinvoice,\r\n    private billService: BillService,\r\n    public printService: PrintService,\r\n  ) {\r\n    this.dataRestore = this.router.getCurrentNavigation().extras.state?.dataRestore;\r\n  }\r\n\r\n\r\n\r\n  ngOnInit(): void {\r\n    this.disabledDate(new Date());\r\n    if (this.dataRestore) {\r\n      this.searchValue = this.dataRestore.searchValue;\r\n      this.salesOrder = this.dataRestore.salesOrder;\r\n      this.salesSubOrder = this.dataRestore.salesSubOrder;\r\n      this.countOrderByStatus(this.salesOrder);\r\n      this.load_status = true;\r\n      this.selectedIndex = this.dataRestore.selectedIndex;\r\n      this.date = this.dataRestore.date;\r\n    }\r\n    this.infoShop = this.vhQuerySales.getlocalShopListTiki()[0];\r\n\r\n    this.listProductOfBranch = this.vhQuerySales.getlocalDetailProducts(35).filter(e => !e.delete_hidden).filter(item => item[this.id_branch] && item[this.id_branch].tikis && item[this.id_branch].tikis.length >= 0);\r\n\r\n    let localProducts: Array<any> = this.vhQuerySales.getlocalDetailProducts(35).filter(e => !e.delete_hidden);\r\n    this.listProductApp = localProducts.map(item => {\r\n      if (item[this.id_branch] && item[this.id_branch].tikis && item[this.id_branch].tikis.length) { //filter nhng sp tiki thuc id tiki  chn\r\n        item[this.id_branch].tikis = [...item[this.id_branch].tikis.filter(prod => prod.id_shop == this.infoShop._id)];\r\n      }\r\n      return { ...item, ...this.vhQuerySales.getUnit_byRatio(item.units, 1) };\r\n    });\r\n\r\n    this.listSubProductApp = [...this.listProductApp];\r\n  }\r\n\r\n\r\n\r\n  changeTime(event) {\r\n    if (event[1].getTime() - event[0].getTime() <= 1209600000) {\r\n    } else {\r\n      this.vhComponent.showToast(2000, this.lang.translate(\"Thi gian xem khng qu 15 ngy\"), \"alert-toast\");\r\n      this.date = [event[0], new Date(event[0].getTime() + 1209600000)];\r\n    }\r\n  }\r\n\r\n\r\n\r\n  search(value: string) {\r\n    this.segmentChanged(this.selectedIndex);\r\n    /** Mng bill cn search */\r\n    let valArray: string[] = value.split(',').map(val => this.vhAlgorithm.changeAlias(val?.toString().trim().toLowerCase())).filter(val => val?.length > 0);\r\n    if (valArray?.length > 0) {\r\n      // search theo code\r\n      this.salesOrder = this.salesOrder.filter(item => {\r\n        return valArray.some(val => {\r\n          return this.vhAlgorithm.changeAlias(item?.code?.toString())?.includes(val);\r\n        });\r\n      });\r\n    }\r\n  }\r\n\r\n\r\n\r\n  /**\r\n   * search tn sn phm trong app viethas\r\n   * @example this.search('Sn phm A')\r\n   */\r\n  searchProductApp(value: string) {\r\n    let val: string = this.vhAlgorithm.changeAlias(value.trim().toLowerCase());\r\n    this.listProductApp = this.vhAlgorithm.searchList(val, [...this.listSubProductApp],  ['name','barcode','item_code']);\r\n  }\r\n\r\n\r\n\r\n  segmentChanged(event) { // sau ny s filter theo trng thi qua hm ny \r\n    if (event == 0) this.salesOrder = this.salesSubOrder\r\n    else {\r\n      switch (event) {\r\n        case 1: \r\n        case 2: \r\n        case 5: {\r\n          this.salesOrder = this.salesSubOrder.filter(item => (item.status == this.list_status_bill[event].status || item.status == this.list_status_bill[event].status2) && item.main_state == this.list_status_bill[event].main_state)\r\n          break;\r\n        };\r\n        case 3: {\r\n          this.salesOrder = this.salesSubOrder.filter(item => item.main_state == this.list_status_bill[event].main_state && (item.main_substate == this.list_status_bill[event].main_substate || item.main_substate == this.list_status_bill[event].main_substate1))\r\n          break;\r\n        };\r\n\r\n        case 4: {\r\n          this.salesOrder = this.salesSubOrder.filter(item => (item.main_substate == this.list_status_bill[event].main_substate1 || item.main_substate == this.list_status_bill[event].main_substate))\r\n          break;\r\n        }\r\n        case 6: {\r\n          this.salesOrder = this.salesSubOrder.filter(item => item.status == this.list_status_bill[event].status)\r\n          break;\r\n        };\r\n        case 8: \r\n        case 7: {\r\n          this.salesOrder = this.salesSubOrder.filter(item => item.status == this.list_status_bill[event].status && item.main_state == this.list_status_bill[event].main_state && (item.main_substate == this.list_status_bill[event].main_substate || item.main_substate == this.list_status_bill[event].main_substate2 || item.main_substate == this.list_status_bill[event].main_substate3))\r\n          break;\r\n        }\r\n        case 9: \r\n        case 10: {\r\n          this.salesOrder = this.salesSubOrder.filter(item => item.status == this.list_status_bill[event].status && item.main_state == this.list_status_bill[event].main_state && (item.items[0].confirmation.status == this.list_status_bill[event].confirmation_status || item.items[0].confirmation.status == this.list_status_bill[event].confirmation_status1))\r\n          break;\r\n        }\r\n      }\r\n    }\r\n  }\r\n  \r\n\r\n\r\n  /** Map cha s lng n hng theo trng thi */\r\n  orderCountByStatus: any = {\r\n    'All': 0,\r\n    'Wait for confirmation': 0,\r\n    'ang ng gi': 0,\r\n    'Ly hng': 0,\r\n    'Ly hng tht bi': 0,\r\n    'Tnh trng giao hng': 0,\r\n    'Giao hng thnh cng': 0,\r\n    'Giao hng tht bi': 0,\r\n    'ang tr hng v cho nh bn': 0,\r\n    ' hy (Cha giao hng)': 0,\r\n    'Tr hng thnh cng': 0,\r\n  }\r\n\r\n  /**\r\n   * m s lng n hng theo trng thi\r\n   * @param orders\r\n   */\r\n  countOrderByStatus(orders) {\r\n    this.orderCountByStatus['All'] = orders.length;\r\n    this.orderCountByStatus['Wait for confirmation'] = orders.filter(order => order.status === 'queueing' && order.main_state === 'awaiting_confirmation').length;\r\n    this.orderCountByStatus['ang ng gi'] = orders.filter(order => order.status === 'queueing' && order.main_state === 'processing').length;\r\n    this.orderCountByStatus['Ly hng'] = orders.filter(order => order.main_state === 'processing' && (order.main_substate === 'picked_up_from_seller' || order.main_substate === 'picking_up_from_seller')).length;\r\n    this.orderCountByStatus['Ly hng tht bi'] = orders.filter(order => order.main_substate === 'pickup_failed_1' || order.main_substate === 'pickup_failed_2').length;\r\n    this.orderCountByStatus['Tnh trng giao hng'] = orders.filter(order => (order.status === 'ready_to_ship' || order.status === 'shipping') && order.main_state === 'shipping').length;\r\n    this.orderCountByStatus['Giao hng thnh cng'] = orders.filter(order => order.status === 'successful_delivery').length;\r\n    this.orderCountByStatus['Giao hng tht bi'] = orders.filter(order => order.status === 'handover_to_partner' && order.main_state === 'shipping' && (order.main_substate === '3pl_delivery_failed_1' || order.main_substate === '3pl_delivery_failed_2' || order.main_substate === '3pl_delivery_failed_3')).length;\r\n    this.orderCountByStatus['ang tr hng v cho nh bn'] = orders.filter(order => order.status === 'handover_to_partner' && order.main_substate === '3pl_returning_to_seller' && order.main_state === 'shipping').length;\r\n    this.orderCountByStatus[' hy (Cha giao hng)'] = orders.filter(order => order.status === 'canceled' && order.main_state === 'canceled' && (order.items[0].confirmation.status === 'waiting' || order.items[0].confirmation.status === 'seller_confirmed')).length;\r\n    this.orderCountByStatus['Tr hng thnh cng'] = orders.filter(order => order.status === 'canceled' && order.main_state === 'canceled' && order.items[0].confirmation.status === 'ready_to_pick').length;\r\n  }\r\n\r\n\r\n\r\n  goBack() {\r\n    this.router.navigate(['/sales/dashboard/manage/ecommerce/tiki'], {\r\n      state: {\r\n        dataRestore: { dataRestore: this.dataRestore }\r\n      }\r\n    });\r\n  }\r\n\r\n\r\n\r\n  showReport() {\r\n    this.load_status = true;\r\n    this.salesOrder = [];\r\n    this.vhComponent.showLoading(\"\", \"transparent-loading\").then(() => {\r\n      this.vhQuerySales.getSalesOrderListTiki(new Date(this.datePipe.transform(new Date(this.date[0].setHours(0, 0, 0)), \"yyyy-MM-dd HH:mm:ss\").toString()), new Date(this.datePipe.transform(new Date(this.date[1].setHours(23, 59, 59)), \"yyyy-MM-dd HH:mm:ss\").toString()), this.infoShop.access_token.toString(), this.infoShop._id.toString())\r\n        .then((result: any) => {\r\n          this.vhComponent.hideLoading(0);\r\n          this.salesOrder = result.map(item => { return { ...item, create_at: new Date(item.create_time * 1000), checked: true }; });\r\n          this.salesSubOrder = this.salesOrder;\r\n          this.countOrderByStatus(this.salesOrder);\r\n          this.segmentChanged(this.selectedIndex);\r\n        })\r\n        .catch(err => this.vhComponent.hideLoading(0));\r\n    });\r\n  }\r\n\r\n\r\n\r\n  calculateTotal(bill) {\r\n    return +bill['price'] - bill['voucher'] + bill['shipping_fee'];\r\n  }\r\n\r\n\r\n\r\n  ngAfterViewChecked() {\r\n    if (document.querySelector(\"#order-status-tiki\") && document.querySelector(\".ant-tabs-tab\") && document.querySelector(\".ant-table-thead\") && document.querySelector(\".order-status-tiki-header\") && document.querySelector(\".ant-table-pagination\")) {\r\n      this.heightScroll = document.querySelector(\"#order-status-tiki\").clientHeight - document.querySelector(\".ant-table-thead\").clientHeight\r\n        - document.querySelector(\".order-status-tiki-header\").clientHeight - document.querySelector(\".ant-tabs-tab\").clientHeight - 90 + \"px\";\r\n    }\r\n    if (document.getElementById(\"order-status-tiki\"))\r\n      this.widthScroll = document.getElementById(\"order-status-tiki\").clientWidth + \"px\";\r\n    this.cdRef.detectChanges();\r\n  }\r\n\r\n\r\n\r\n  gotoDetail(bill) {\r\n    this.router.navigate(['/sales/dashboard/manage/ecommerce/tiki/order-status/detail'], { state: { bill: bill, dataRestore: { salesOrder: this.salesOrder, searchValue: this.searchValue, id_shop_selected: this.infoShop._id, date: this.date, salesSubOrder: this.salesSubOrder, selectedIndex: this.selectedIndex } } });\r\n  }\r\n\r\n\r\n\r\n  allChecked = true;\r\n  indeterminate = true;\r\n\r\n\r\n\r\n  /**\r\n   * Check tt c\r\n   * @param value\r\n   */\r\n  checkAll(value: boolean): void {\r\n    this.salesOrder.forEach(data => {\r\n      if (!data.disabled) {\r\n        data.checked = value;\r\n      }\r\n    });\r\n    this.refreshStatus();\r\n  }\r\n\r\n  /** C hin th modal chnh sa customer tax hay khng */\r\n  isShowModalEditCustomerTax: boolean = false;\r\n  tempCustomerTax: any = null;\r\n  /**\r\n   * Khi nhn edit ct thng tin khch hng\r\n   */\r\n  editTax(invoice) {\r\n    this.tempCustomerTax = invoice;\r\n    this.isShowModalEditCustomerTax = true;\r\n  }\r\n\r\n\r\n\r\n  /**\r\n   * Khi ok trong modal chnh sa customer tax\r\n   * @param customerTaxInfo\r\n   */\r\n  onOkEditTax(customerTaxInfo) {\r\n    this.isShowModalEditCustomerTax = false;\r\n\r\n    Object.assign(this.tempCustomerTax, customerTaxInfo);\r\n  }\r\n\r\n  findProductLinked(item) {\r\n    for (let productOfBranch of this.listProductOfBranch) {\r\n      let findProduct = productOfBranch[this.id_branch].tikis.find(data => data.product_id == item.product.id);\r\n      if (findProduct) {\r\n        return productOfBranch;\r\n      }\r\n    }\r\n\r\n    return null;\r\n  }\r\n\r\n  /**\r\n   * Kim tra sn phm  c lien kt hay cha\r\n   *\r\n   */\r\n  isLinkedToProduct(item): boolean {\r\n    for (let productOfBranch of this.listProductOfBranch) {\r\n      let findProduct = productOfBranch[this.id_branch].tikis.find(data => data.product_id == item.product.id);\r\n      if (findProduct) {\r\n        return true;\r\n      }\r\n\r\n    };\r\n    return false;\r\n  }\r\n\r\n  visible_affiliate: boolean = false; // hin th modal chn sn phm phn mm lin kt\r\n  productTikiSelected: any = null; // sn phm tiki c chn  lien kt\r\n\r\n\r\n  openModelSelectProductsTiki(productTiki) {\r\n    this.productTikiSelected = productTiki;\r\n    this.visible_affiliate = true;\r\n  }\r\n\r\n\r\n  /**\r\n   * Tt modal v clone mng product ra mt mng mi  trnh nh li product c b checked\r\n   */\r\n  cancelAffiliate() {\r\n    this.visible_affiliate = false;\r\n  }\r\n\r\n\r\n  /**\r\n    * Lin kt sn phm t tiki vi sn phm ti ca hng.\r\n    * @param product Sn phm ca ca hng\r\n    */\r\n  acceptAfiliate(product) {\r\n    const isZeroPriceCombo = product.type === VhType.COMBO && product.units[0].price === 0;\r\n    const confirmZeroPriceComboMessage = this.lang.translate(\"This product is a combo with a price of 0. Do you still want to link it with the product\", { platform: 'Tiki' }) + \"?\";\r\n\r\n    this.nzModalService.confirm({\r\n      nzTitle: '<i>' + (isZeroPriceCombo ? confirmZeroPriceComboMessage : this.lang.translate(\"Confirm\")) + '</i>',\r\n      nzIconType: \"info-circle\",\r\n      nzCancelText: this.lang.translate(\"Cancel\"),\r\n      nzOnOk: () => {\r\n        this.vhComponent.showLoading(\"\", \"transparent-loading\").then(() => {\r\n          const id_product_selected = product.id_subproduct ? product.id_subproduct : product['_id'];\r\n          this.vhQuerySales.addMergeTikiProduct(id_product_selected, [this.productTikiSelected.product.id], this.infoShop['_id']).then((bool) => {\r\n            this.vhComponent.hideLoading().then(() => {\r\n              setTimeout(() => {\r\n                this.visible_affiliate = false;\r\n                this.listProductOfBranch = this.vhQuerySales.getlocalDetailProducts(35).filter(e => !e.delete_hidden).filter(item => item[this.id_branch] && item[this.id_branch].tikis && item[this.id_branch].tikis.length >= 0);\r\n                this.vhComponent.alertMessageDesktop('success', this.lang.translate(\"Product linked successfully\"));\r\n              }, 300);\r\n            });\r\n          }).catch(err => {\r\n            console.error(err);\r\n            this.visible_affiliate = false;\r\n            this.vhComponent.alertMessageDesktop('error', this.lang.translate(\"The product link failed\"));\r\n            this.vhComponent.hideLoading(0);\r\n          });\r\n        });\r\n      }\r\n    });\r\n  }\r\n\r\n  /**Xa nhng sp  c lin kt ri ra khi mng ca modal danh sch sp lin kt\r\n   * @param listProduct : danh sch sp  lk vi sn\r\n   * @param listProductApp : ton b danh sch sp ca app\r\n   * @example let daa =  this.clearProductShow([], [])\r\n   *\r\n  */\r\n  clearProductShow(listProduct, listProductApp) {\r\n    for (let prodApp of listProductApp) {\r\n      if (prodApp[this.id_branch] && prodApp[this.id_branch].tikis && prodApp[this.id_branch].tikis.length) {\r\n        for (let item of prodApp[this.id_branch].tikis) {\r\n          let indexProd = listProduct.findIndex(prod => prod.product_id == item.product_id);\r\n          if (indexProd >= 0)\r\n            listProduct.splice(indexProd, 1);\r\n        }\r\n      }\r\n    }\r\n    return listProduct;\r\n  }\r\n\r\n\r\n\r\n  /**\r\n   * Check 1 ci\r\n   */\r\n  refreshStatus(): void {\r\n    const validData = this.salesOrder.filter(value => !value.disabled);\r\n    const allChecked = validData.length > 0 && validData.every(value => value.checked === true);\r\n    const allUnChecked = validData.every(value => !value.checked);\r\n    this.allChecked = allChecked;\r\n    this.indeterminate = !allChecked && !allUnChecked;\r\n  }\r\n\r\n\r\n\r\n  async send() {\r\n    let bills = this.salesOrder.filter((data: any) => data.checked).filter((data: any) => !data.cqt_status || data.cqt_status == 1); // lc ra nhng ha n  chn v cha gi ln CQT;\r\n    const batchSize = 1;\r\n    const totalBatches = Math.ceil(bills.length / batchSize);\r\n\r\n    if (!bills.length) {\r\n      this.vhComponent.alertMessageDesktop('error', this.lang.translate(\"Please select at least one invoice\"));\r\n      return;\r\n    }\r\n\r\n    // Nu c bt cqt_vat_ecommerce_use_latest_order_update_time th sp xp theo thi gian cp nht trng thi gn nht ca n hng t sn, \r\n    // c gi trc, mi gi sau\r\n    if(this.cqt_vat_ecommerce_use_latest_order_update_time) {\r\n      bills = bills.sort((a, b) => a.update_time - b.update_time);\r\n    }\r\n\r\n    await this.vhComponent.showLoadingNotDuration(this.lang.translate(\"Sending...\"));\r\n\r\n    try {\r\n      for (let i = 0; i < bills.length; i += batchSize) {\r\n        const batch = bills.slice(i, i + batchSize);\r\n        const currentBatchIndex = Math.floor(i / batchSize) + 1;\r\n\r\n        const promises = batch.map(bill => {\r\n          console.log(`Processing bill: ${bill.code}`);\r\n          return this.sendCQT(bill);\r\n        });\r\n\r\n        try {\r\n          const results = await this.vhQuery.asyncPromiseAll(promises);\r\n          console.log(`Batch ${currentBatchIndex}/${totalBatches} done`, results);\r\n        } catch (batchError) {\r\n          console.error(`Error in batch ${currentBatchIndex}:`, batchError);\r\n        }\r\n      }\r\n    } finally {\r\n      //  lun c gi sau khi x l xong mi batch\r\n      await this.vhComponent.hideLoading();\r\n    }\r\n  }\r\n\r\n\r\n  /**\r\n   * hm ny gi ha n ln cqt v k lun\r\n   * @param invoice\r\n   */\r\n  sendCQT(invoice) {\r\n    return new Promise((resolve, reject) => {\r\n      // trng hp cha c to kt ni ha n in t\r\n      if (!this.currentBranch.einvoices?.length) {\r\n        this.vhComponent.alertMessageDesktop(\"error\", this.lang.translate(\"Please connect e-invoice for this branch\"));\r\n        resolve('');\r\n        return;\r\n      }\r\n      // trng hp ch c 1 kt ni ha n in t th to thng lun\r\n      if (this.currentBranch.einvoices.length && this.currentBranch.einvoices.length == 1) {\r\n        // trng hp ncc ha n in t l M-invoice\r\n        if (this.currentBranch.einvoices[0].invoice_provider == 'M-invoice') {\r\n\r\n          if (!this.currentBranch.einvoices[0].invoiceSeries.length) {\r\n            this.vhComponent.alertMessageDesktop(\"error\", this.lang.translate(\"Please connect e-invoice for this branch\"));\r\n            resolve('');\r\n            return;\r\n          }\r\n        }\r\n\r\n        this.changeBill_byLocal_toInvoice_byMinvoice(invoice, this.currentBranch.einvoices[0].invoiceSeries[0])\r\n          .then((rsp) => {\r\n            if (rsp.vcode == 0) {\r\n              // K t ng ngay khi gi ha n ln C quan thu\r\n              if (this.cqt_invoice_auto_sign) {\r\n                this.vhEinvoice.saveInvoice_Sign_byMinvoice(this.currentBranch.taxcode, this.currentBranch.einvoices[0].token, 1, rsp.data)\r\n                  .then(async (res: any) => {\r\n                    console.log('res', res);\r\n                    if (res.code == '00') {\r\n                      invoice.cqt_status = 3;\r\n                      invoice.status = this.lang.translate(\"Sent to CQT\");\r\n                      this.vhQuerySales.updateSalesOrderTiki_byFile([invoice.code.toString()], { cqt_status: 3 }, this.infoShop.access_token, this.infoShop._id)\r\n                        .then((array: any) => {\r\n                          console.log('updateSalesOrderTiki_byFile', array);\r\n                          resolve(true);\r\n                        }, error => {\r\n                          console.log(error);\r\n                        });\r\n                      resolve('');\r\n                    }\r\n                    else if (res.code == '9999') {\r\n                      reject(invoice._id);\r\n                      this.vhComponent.alertMessageDesktop(\"error\", invoice.bill_code + ' ' + this.lang.translate(\"Vui lng kim tra li thng tin ha n y ln CQT cha ph hp\"));\r\n                    }\r\n                    else if (res.code == '296') {\r\n                      resolve(true);\r\n                      this.vhComponent.alertMessageDesktop(\"error\", this.lang.translate(\"Khng th gi nhng ha n c ngy lp ha n nh hn ngy lp ha n cui cng  gi ln C quan thu. <br> Nu cn gi nhng ha n c hn, bn cn tt cu hnh 'S dng thi gian cp nht trng thi gn nht ca n hng t sn  thit lp ngy lp ha n' trong Ci t\"), 4000);\r\n                    }\r\n                    else {\r\n                      reject(invoice._id);\r\n                      this.vhComponent.alertMessageDesktop(\"error\", invoice.bill_code + ' ' + this.lang.translate(res.message));\r\n                    }\r\n                  }).catch((error: any) => {\r\n                    console.error('Error saving invoice:', error);\r\n                    reject(invoice._id);\r\n                    this.vhComponent.alertMessageDesktop(\"error\", invoice.bill_code + ' ' + this.lang.translate(\"An error occurred while sending the invoice to CQT. Please try again later.\"));\r\n                  });\r\n              }\r\n              else {\r\n                this.vhEinvoice.saveInvoice_noSign_byMinvoice(this.currentBranch.taxcode, this.currentBranch.einvoices[0].token, 1, rsp.data)\r\n                  .then(async (res: any) => {\r\n                    console.log('res', res);\r\n                    if (res.code == '00') {\r\n                      invoice.cqt_status = 2;\r\n                      invoice.status = this.lang.translate(\"Sent to CQT\");\r\n                      this.vhQuerySales.updateSalesOrderTiki_byFile([invoice.code.toString()], { cqt_status: 2 }, this.infoShop.access_token, this.infoShop._id)\r\n                        .then((array: any) => {\r\n                          console.log('updateSalesOrderTiki_byFile', array);\r\n                          resolve(true);\r\n                        }, error => {\r\n                          console.log(error);\r\n                        });\r\n                      resolve('');\r\n                    }\r\n                    else if (res.code == '9999') {\r\n                      reject(invoice._id);\r\n                      this.vhComponent.alertMessageDesktop(\"error\", invoice.bill_code + ' ' + this.lang.translate(\"Vui lng kim tra li thng tin ha n y ln CQT cha ph hp\"));\r\n                    }\r\n                    else if (res.code == '296') {\r\n                      resolve(true);\r\n                      this.vhComponent.alertMessageDesktop(\"error\", this.lang.translate(\"Khng th gi nhng ha n c ngy lp ha n nh hn ngy lp ha n cui cng  gi ln C quan thu. <br> Nu cn gi nhng ha n c hn, bn cn tt cu hnh 'S dng thi gian cp nht trng thi gn nht ca n hng t sn  thit lp ngy lp ha n' trong Ci t\"), 4000);\r\n                    }\r\n                    else {\r\n                      reject(invoice._id);\r\n                      this.vhComponent.alertMessageDesktop(\"error\", invoice.bill_code + ' ' + this.lang.translate(res.message));\r\n                    }\r\n                  }).catch((error: any) => {\r\n                    console.error('Error saving invoice:', error);\r\n                    reject(invoice._id);\r\n                    this.vhComponent.alertMessageDesktop(\"error\", invoice.bill_code + ' ' + this.lang.translate(\"An error occurred while sending the invoice to CQT. Please try again later.\"));\r\n                  });\r\n              }\r\n            }\r\n          }, (error: any) => {\r\n            console.log('error', error);\r\n          });\r\n      }\r\n    });\r\n  }\r\n\r\n\r\n\r\n  /** Gi ha n ln C quan thu km ph vn chuyn */\r\n  cqt_submit_invoice_with_shipping_fee = this.vhQuerySales.getLocalAppSettingNameBranch('permission_branch').cqt_submit_invoice_with_shipping_fee;\r\n  /** Gi ha n ln C quan thu km ph giao dch/ph sn */\r\n  cqt_submit_invoice_with_ecommerce_fee = this.vhQuerySales.getLocalAppSettingNameBranch('permission_branch').cqt_submit_invoice_with_ecommerce_fee;\r\n  /** Gi bn hng ha, dch v... trn sn  bao gm thu VAT */\r\n  cqt_vat_ecommerce_already_Included = this.vhQuerySales.getLocalAppSettingNameBranch('permission_branch').cqt_vat_ecommerce_already_Included;\r\n  /** % thu VAT */\r\n  cqt_vat_ecommerce_rate = this.vhQuerySales.getLocalAppSettingNameBranch('permission_branch').cqt_vat_ecommerce_rate;\r\n  /** K t ng ngay khi gi ha n ln C quan thu */\r\n  cqt_invoice_auto_sign = this.vhQuerySales.getLocalAppSettingNameBranch('permission_branch').cqt_invoice_auto_sign;\r\n  /** Gi bn hng ha, dch v trn sn  bao gm VAT, tnh theo VAT hng ha, dch v lin kt */\r\n  cqt_vat_ecommerce_by_linked_product = this.vhQuerySales.getLocalAppSettingNameBranch('permission_branch').cqt_vat_ecommerce_by_linked_product;\r\n  /** Hng khuyn mi c php xut 0. Nu l true th tchat2 s c cc ct = 0, ma_thue vn l s bnh thng */\r\n  cqt_vat_ecommerce_allow_promotional_items_zero_price = this.vhQuerySales.getLocalAppSettingNameBranch('permission_branch').cqt_vat_ecommerce_allow_promotional_items_zero_price;\r\n  /** Xut ring chit khu/gim gi ca sn phm thnh 1 dng ring khi gi CQT */\r\n  cqt_vat_ecommerce_separate_discount_line = this.vhQuerySales.getLocalAppSettingNameBranch('permission_branch').cqt_vat_ecommerce_separate_discount_line;\r\n  /** Vn gi hng xut bn cho sn phm tng/khuyn mi khi gi CQT */\r\n  cqt_vat_ecommerce_keep_promotional_items_as_sold = this.vhQuerySales.getLocalAppSettingNameBranch('permission_branch').cqt_vat_ecommerce_keep_promotional_items_as_sold;\r\n  /** S dng thi gian cp nht trng thi gn nht ca n hng t sn  thit lp ngy lp ha n */\r\n  cqt_vat_ecommerce_use_latest_order_update_time = this.vhQuerySales.getLocalAppSettingNameBranch('permission_branch').cqt_vat_ecommerce_use_latest_order_update_time;\r\n  /** Xut ha n t sn vi thng tin ngi mua km theo tn sn v m n hng */\r\n  cqt_vat_ecommerce_buyer_info_with_platform_and_so_benh_an = this.vhQuerySales.getLocalAppSettingNameBranch('permission_branch').cqt_vat_ecommerce_buyer_info_with_platform_and_so_benh_an;\r\n  /** Xut ha n t sn vi thng tin thanh ton mc nh l 'Chuyn khon' */\r\n  cqt_vat_ecommerce_default_payment_method_chuyen_khoan: boolean = this.vhQuerySales.getLocalAppSettingNameBranch('permission_branch').cqt_vat_ecommerce_default_payment_method_chuyen_khoan;\r\n  /** M sn phm khi gi CQT l m vch sn phm */\r\n  cqt_vat_ecommerce_item_code_is_barcode = this.vhQuerySales.getLocalAppSettingNameBranch('permission_branch').cqt_vat_ecommerce_item_code_is_barcode;\r\n  /** Gi hng ha, dch v... gi CQT l gi bn  gim */\r\n  cqt_vat_ecommerce_item_price_is_discounted = this.vhQuerySales.getLocalAppSettingNameBranch('permission_branch').cqt_vat_ecommerce_item_price_is_discounted;\r\n\r\n\r\n\r\n  /**\r\n   * @example\r\n   * this.vhQuerySales.changeBill_byLocal_toInvoice_byMinvoice(id_bill, invoiceSeries)\r\n      .then((rsp) => {\r\n        //-----------your code here-----------\r\n      }, (error: any) => {\r\n          console.log('error', error);\r\n      });\r\n   * @param id_bill\r\n   * @param invoiceSeries\r\n   * @returns Promise => {vcode, msg, data(array)}\r\n   *\r\n   *\r\n   * Cu trc cn x l 3 ci:\r\n   *  - Danh sch ha n chi tit:\r\n   *    + Check trng hp combo\r\n   *  - Ph vn chuyn\r\n   *  - Chit khu thng mi\r\n   *\r\n   *\r\n   * Ghi ch:\r\n   *  - Trng hp c bt cqt_vat_ecommerce_already_Included, th phi tnh li Gi  total sau khi p thu (thu t phn ci t ca app mnh) v Chit khu l khng thay i.\r\n   *  - tchat2 v tchat3 th discountAmount v discountPercentage s = 0\r\n   *  - Chit khu thng mi th Thu = 0\r\n   *  - Combo s khng c trng hp tt c cc sn phm bn trong c gi = 0 ( bt khi lin kt sn phm) nn c th b qua trng hp ny\r\n   *  - i vi combo lin kt, Trng hp cqt_vat_ecommerce_by_linked_product th bt  combo nhng vn gi code  invoice_detail cha  logic khng b thay i. Trng hp cqt_vat_ecommerce_already_Included th bt  invoice_detail cha, khng cn bt  combo na, v khi chia ra t l vn s m bo do  tnh  cha\r\n   */\r\n  public changeBill_byLocal_toInvoice_byMinvoice(bill: any, invoiceSeries: string): Promise<any> {\r\n    return new Promise<any>((resolve, reject) => {\r\n      (async () => {\r\n        try {\r\n          \r\n          /** Cha thng tin ha n v bill details s gi ln cqt */\r\n          let invoices = new Array();\r\n          /** Danh sch bill details */\r\n          var invoice_details = new Array();\r\n\r\n          console.log('bill', bill);\r\n\r\n\r\n          /* ---------------------------------------------------------- Khi to invoice ---------------------------------------------------------- */\r\n\r\n          const invoice: any = {\r\n            inv_invoiceSeries: invoiceSeries,\r\n            inv_invoiceIssuedDate: this.vhAlgorithm.formatDateToString(new Date()),\r\n            inv_currencyCode: \"VND\",\r\n            inv_exchangeRate: 1,\r\n\r\n            inv_discountAmount: 0, // Tng tin chit khu (tng ca ct Tin chit khu)\r\n            inv_TotalAmountWithoutVat: 0, // Cng tin hng ( tr CK) Cha bao gm VAT (ct Thnh tin trc thu, = +tchat1 -tchat3 b qua tchat2)\r\n            inv_vatAmount: 0, // Tin thu GTGT (= Cng tin hng ( tr CK) Cha bao gm VAT * bill.tax / 100)\r\n            inv_TotalAmount: 0, // Tng cng tin thanh ton (sau thu) (= Cng tin hng ( tr CK) Cha bao gm VAT + Tin thu GTGT) tng ng trnG payment ca mnh\r\n\r\n            key_api: bill.code,\r\n            so_benh_an: bill.code\r\n          };\r\n\r\n\r\n\r\n          /* --------- X l cqt_vat_ecommerce_use_latest_order_update_time th ly ngy cp nht trng thi gn nht ca n hng t sn --------- */\r\n          if (this.cqt_vat_ecommerce_use_latest_order_update_time) {\r\n            invoice.inv_invoiceIssuedDate = this.vhAlgorithm.formatDateToString(new Date(bill.updated_at));\r\n          }\r\n    \r\n\r\n\r\n          /* --------------------------------------------------------- Thng tin ngi mua -------------------------------------------------------- */\r\n\r\n          /** Tn ngi mua mc nh nu khng c thng tin trong ha n */\r\n          let buyerDisplayNameDefault = 'Ngi mua khng ly ha n';\r\n          /* ------ X l cqt_vat_ecommerce_buyer_info_with_platform_and_so_benh_an --------------------------------------------------------------- */\r\n          // Nu bt th s thnh: Tn sn - Ngi mua khng ly ha n - M n hng\r\n          if(this.cqt_vat_ecommerce_buyer_info_with_platform_and_so_benh_an) {\r\n            buyerDisplayNameDefault = `Tiki - ${buyerDisplayNameDefault} - ${invoice.so_benh_an}`;\r\n          }\r\n        \r\n          /* ------ X l cqt_vat_ecommerce_default_payment_method_chuyen_khoan ------------------------------------------------------------------- */\r\n          // Nu c bt th lun l 'Chuyn khon', nu khng th s ly theo ca n hng\r\n          if(this.cqt_vat_ecommerce_default_payment_method_chuyen_khoan) {\r\n            invoice.inv_paymentMethodName = 'Chuyn khon';\r\n          }\r\n          else {\r\n            invoice.inv_paymentMethodName = bill.payment.method == 'cod' ? 'Tin mt' : 'Chuyn khon';\r\n          }\r\n\r\n          invoice.inv_buyerDisplayName = bill.invoice?.tax_info?.company_name ? bill.invoice?.tax_info?.company_name : bill.tax_buyerDisplayName ? bill.tax_buyerDisplayName : buyerDisplayNameDefault;\r\n          invoice.inv_buyerLegalName = bill.invoice?.tax_info?.company_name ? bill.invoice?.tax_info?.company_name : bill.tax_buyerLegalName ? bill.tax_buyerLegalName : '';\r\n          invoice.inv_buyerTaxCode = bill.invoice?.tax_info?.code ? bill.invoice?.tax_info?.code : bill.tax_buyerTaxCode ? bill.tax_buyerTaxCode : '';\r\n          invoice.inv_buyerAddressLine = bill.invoice?.tax_info?.address ? bill.invoice?.tax_info?.address : bill.tax_buyerAddressLine ? bill.tax_buyerAddressLine : '';\r\n          invoice.inv_buyerEmail = bill.invoice?.tax_info?.email ? bill.invoice?.tax_info?.email : bill.tax_buyerEmail ? bill.tax_buyerEmail : '';\r\n\r\n\r\n          /* ------------------------------------------------------ Tnh ton invoice details ----------------------------------------------------- */\r\n\r\n          /** Thu sn */\r\n          let platformTax = 0;\r\n          /** Thu ca ha n (ly t sn / t ci t) */\r\n          let billTax = 0;\r\n          // nu bt cqt_vat_ecommerce_already_Included th ly thu t ci t\r\n          if (this.cqt_vat_ecommerce_already_Included) {\r\n            billTax = this.cqt_vat_ecommerce_rate || 0;\r\n          }\r\n          else {\r\n            billTax = platformTax;\r\n          }\r\n\r\n          /**  cng dn tin seller gim gi ph ship trong tng bill detail shipping_fee_discountAmount  tr vo ph sn tr Tiki v total_seller_fee l bao gm gim gi ph vn chuyn */\r\n          let shipping_fee_discountAmount = 0;\r\n\r\n          // Lp qua bill details\r\n          for (let i = 0; i < bill['items'].length; i++) {\r\n            let product: any = bill['items'][i];\r\n            /** Sn phm lin kt vi sn phm ca sn */\r\n            const productLinked = this.findProductLinked(product);\r\n            // Khi to chi tit ha n\r\n            let invoice_detail = this.billService.createEInvoiceDetailTemplate();\r\n\r\n            /** n gi */\r\n            let unitPrice = product.price;\r\n            /** S lng */\r\n            const quantity = product.qty;\r\n            /** Gim gi ca seller (khng tnh sn) */\r\n            let discountAmount = product.seller_income_detail?.discount?.discount_coupon?.seller_discount || 0;\r\n            /** Total cha c thu */\r\n            let totalAmountWithoutVat = (unitPrice * quantity) - discountAmount;\r\n            /** Tnh cht hng ha. Nu inv_TotalAmountWithoutVat = 0 th tchat = 2, nu khng th tchat = 1 */\r\n            const tchat = totalAmountWithoutVat === 0 ? 2 : 1;\r\n            /** Thu ca bill detail ny. Nu c sn phm lin kt v bt setting cqt_vat_ecommerce_by_linked_product th s ly thu t sn phm lin kt, ngc li th vn ly t billTx nh c  */\r\n            const invoiceDetailTax = (this.cqt_vat_ecommerce_by_linked_product && productLinked && productLinked.tax !== undefined) ? productLinked.tax : billTax;\r\n\r\n            // Gn cc gi tr chung\r\n            invoice_detail.tchat = tchat; // Tnh cht hng ha: Hng ha dch v (gi tr tchat l 1); Khuyn mi (gi tr tchat l 2); Chit khu thng mi (gi tr tchat l 3); Ghi ch/ din gii (gi tr tchat l 4); Hng ha c trng (gi tr tchat l 5)\r\n            invoice_detail.stt_rec0 = invoice_details.length + 1;\r\n            invoice_detail.inv_itemCode = product.product.id;\r\n            invoice_detail.inv_unitCode = 'Ci';\r\n            invoice_detail.inv_quantity = quantity;\r\n            invoice_detail.inv_unitPrice = unitPrice; // n gi\r\n            invoice_detail.ma_thue = invoiceDetailTax; // % thu\r\n\r\n\r\n            /* ------ X l tchat --------------------------------------------------------------------------- */\r\n            if (tchat === 2) {\r\n              // Gn li tn\r\n              invoice_detail.inv_itemName = 'Hng khuyn mi/hng tng ' + product.product.name;\r\n              // Tnh li gi tr tr gi (chit khu) ca chi tit ha n trng hp tchat2\r\n              invoice_detail.inv_discountAmount = 0;\r\n\r\n              /* ------ X l cqt_vat_ecommerce_already_Included cqt_vat_ecommerce_by_linked_product --------- */\r\n              if(this.cqt_vat_ecommerce_already_Included || this.cqt_vat_ecommerce_by_linked_product) {\r\n                // Tnh li gi\r\n                invoice_detail.inv_unitPrice = this.billService.calculateNewPriceToUseSettingTax(invoice_detail.inv_unitPrice, invoice_detail.inv_quantity, invoice_detail.inv_discountAmount, invoice_detail.ma_thue, platformTax);\r\n              }\r\n\r\n              /* ------ X l Hng khuyn mi c php xut 0 ----------------------------------------------- */\r\n              // Nu c bt cqt_vat_ecommerce_allow_promotional_items_zero_price v l tchat2 th cn gn li gi = 0,  cc php tnh cho nhng trng khc bn di cng s t tnh = 0\r\n              if(this.cqt_vat_ecommerce_allow_promotional_items_zero_price) {\r\n                invoice_detail.inv_unitPrice = 0;\r\n              }\r\n\r\n              /* ------ X l Vn gi hng xut bn cho sn phm tng/khuyn mi khi gi CQT ------------------ */\r\n              // Nu c bt cqt_vat_ecommerce_keep_promotional_items_as_sold v l tchat2 th s set li nso thnh tchat1, discountAmount v discountPercentage vn l 0\r\n              if(this.cqt_vat_ecommerce_keep_promotional_items_as_sold) {\r\n                // Gn li tchat\r\n                invoice_detail.tchat = 1; // Gn li tchat thnh 1\r\n                // Gn li tn\r\n                invoice_detail.inv_itemName = product.product.name;\r\n              }\r\n\r\n              // Tr gi (chit khu) tnh theo %\r\n              invoice_detail.inv_discountPercentage = 0;\r\n            }\r\n            else {\r\n              // Gn li tn\r\n              invoice_detail.inv_itemName = product.product.name;\r\n              // Tr gi (chit khu) ca nh bn hng trn mi chi tit ha n = seller_discount + shopee_discount\r\n              invoice_detail.inv_discountAmount = discountAmount;\r\n\r\n              /* ------ X l Gi hng ha, dch v... gi CQT l gi bn  gim ----------------------------------------- */\r\n              if(this.cqt_vat_ecommerce_item_price_is_discounted) {\r\n                // Gn li thnh gi  gim\r\n                invoice_detail.inv_unitPrice = invoice_detail.inv_unitPrice - invoice_detail.inv_discountAmount / invoice_detail.inv_quantity;\r\n                // Gn li Chit khu = 0\r\n                invoice_detail.inv_discountAmount = 0;\r\n              }\r\n\r\n              /* ------ X l cqt_vat_ecommerce_already_Included cqt_vat_ecommerce_by_linked_product --------- */\r\n              if(this.cqt_vat_ecommerce_already_Included || this.cqt_vat_ecommerce_by_linked_product) {\r\n                // Tnh li gi\r\n                invoice_detail.inv_unitPrice = this.billService.calculateNewPriceToUseSettingTax(invoice_detail.inv_unitPrice, invoice_detail.inv_quantity, invoice_detail.inv_discountAmount, invoice_detail.ma_thue, platformTax);\r\n              }\r\n\r\n              // Tr gi (chit khu) tnh theo %\r\n              invoice_detail.inv_discountPercentage = invoice_detail.inv_discountAmount / (invoice_detail.inv_unitPrice * invoice_detail.inv_quantity) * 100;\r\n            }\r\n\r\n            // Gi cui ( tr tr gi) ca chi tit ha n\r\n            invoice_detail.inv_TotalAmountWithoutVat = invoice_detail.inv_unitPrice * invoice_detail.inv_quantity - invoice_detail.inv_discountAmount;\r\n            //Thu VAT c tnh theo chi tit ha n\r\n            invoice_detail.inv_vatAmount = invoice_detail.inv_TotalAmountWithoutVat * invoice_detail.ma_thue / 100;\r\n            //Tng gi tr hng ha k khai theo chi tit ha n\r\n            invoice_detail.inv_TotalAmount = invoice_detail.inv_TotalAmountWithoutVat + invoice_detail.inv_vatAmount;\r\n\r\n            // Nu nh c lin kt\r\n            if (productLinked) {\r\n              // Nu lin kt vi sn phm\r\n              if (productLinked.type === VhType.PRODUCT) {\r\n                // Thay i inv_itemName v inv_itemCode\r\n                invoice_detail.inv_itemName = productLinked.name;\r\n\r\n                /* ------ X l cqt_vat_ecommerce_item_code_is_barcode ------------------------------------------ */\r\n                if(this.cqt_vat_ecommerce_item_code_is_barcode) {\r\n                  const barcode = this.vhQuerySales.getUnit_byRatio(productLinked.units, 1)?.barcode;\r\n                  // Nu c barcode th dng barcode\r\n                  if(barcode) {\r\n                    invoice_detail.inv_itemCode = barcode;\r\n                  }\r\n                  // Nu khng c barcode th thng bo\r\n                  else {\r\n                    this.vhComponent.hideLoading();\r\n                    this.vhComponent.alertMessageDesktop(\"error\", this.lang.translate(\"Gi ha n ln CQT tht bi. Ha n c cha sn phm cha c m vch, vui lng b sung v th li. Hoc b chn cu hnh M sn phm khi xut ha n l m vch  tip tc\"), 5000);\r\n                    return;\r\n                  }\r\n                }\r\n                else {\r\n                  invoice_detail.inv_itemCode = productLinked.id_subproduct ? productLinked.id_subproduct : productLinked['_id'];\r\n                }\r\n                \r\n                invoice_details = this.billService.addEInvoiceDetail(invoice_detail, invoice_details, {cqt_vat_ecommerce_separate_discount_line: this.cqt_vat_ecommerce_separate_discount_line});\r\n              }\r\n              // Nu lin kt vi combo\r\n              else if (productLinked.type === VhType.COMBO) {\r\n                const priceCombo = productLinked.units[0].price;\r\n                if (priceCombo == 0) {\r\n                  const errorZeroPriceComboMessage = this.lang.translate(\"Unable to issue the invoice because a linked combo product has a price of 0\", { invoice: bill.code });\r\n                  this.vhComponent.hideLoading();\r\n                  this.vhComponent.alertMessageDesktop(\"error\", errorZeroPriceComboMessage);\r\n                  return;\r\n                }\r\n                \r\n                // loop qua combo ri tnh li chi tit ha n\r\n                for (let j = 0; j < productLinked.combos.length; j++) {\r\n                  const combo = productLinked.combos[j];\r\n                  // Khi to chi tit ha n\r\n                  let combo_detail = this.billService.createEInvoiceDetailTemplate();\r\n                  \r\n                  /** T l phn trm ca gi sn phm v tng gi combo */\r\n                  const percentRate = (combo.price * combo.quantity) / priceCombo;\r\n                  /** Tnh cht hng ha. Nu inv_TotalAmountWithoutVat = 0 th tchat = 2, nu khng th tchat = 1 */\r\n                  const tchatCombo = (!percentRate || combo.price == 0 || invoice_detail.inv_TotalAmountWithoutVat * percentRate == 0) ? 2 : 1;\r\n                  /** Sn phm trong combo, get li  ly tax */\r\n                  let detailproduct = this.vhQuerySales.getlocalDetailProduct(combo.id_subproduct ? combo.id_subproduct : combo.id_product);\r\n                  /** Thu ca bill detail ny. Nu c sn phm lin kt v bt setting cqt_vat_ecommerce_by_linked_product th s ly thu t sn phm lin kt, ngc li th vn ly t billTx nh c  */\r\n                  const invoiceDetailComboTax = (this.cqt_vat_ecommerce_by_linked_product && detailproduct && detailproduct.tax !== undefined) ? detailproduct.tax : invoice_detail.ma_thue;\r\n                  /** n gi */\r\n                  const unitPrice = ((invoice_detail.inv_TotalAmountWithoutVat + invoice_detail.inv_discountAmount) * percentRate) / (combo.quantity * invoice_detail.inv_quantity);\r\n  \r\n                  // Gn cc gi tr chung\r\n                  combo_detail.tchat = tchatCombo;\r\n                  combo_detail.stt_rec0 = invoice_details.length + 1;\r\n                  combo_detail.inv_unitCode = 'Ci';\r\n                  combo_detail.inv_quantity = combo.quantity * invoice_detail.inv_quantity;\r\n                  combo_detail.inv_unitPrice = unitPrice; // Gi gc bn sn phm trn sn shopee\r\n                  combo_detail.ma_thue = invoiceDetailComboTax;\r\n\r\n\r\n                  /* ------ X l cqt_vat_ecommerce_item_code_is_barcode ------------------------------------------ */\r\n                  if(this.cqt_vat_ecommerce_item_code_is_barcode) {\r\n                    const barcode = this.vhQuerySales.getUnit_byRatio(combo.units, combo.ratio)?.barcode;\r\n                    // Nu c barcode th dng barcode\r\n                    if(barcode) {\r\n                      combo_detail.inv_itemCode = barcode;\r\n                    }\r\n                    // Nu khng c barcode th thng bo\r\n                    else {\r\n                      this.vhComponent.hideLoading();\r\n                      this.vhComponent.alertMessageDesktop(\"error\", this.lang.translate(\"Gi ha n ln CQT tht bi. Ha n c cha sn phm cha c m vch, vui lng b sung v th li. Hoc b chn cu hnh M sn phm khi xut ha n l m vch  tip tc\"), 5000);\r\n                      return;\r\n                    }\r\n                  }\r\n                  else {\r\n                    combo_detail.inv_itemCode = combo.id_subproduct ? combo.id_subproduct : combo.id_product;\r\n                  }\r\n  \r\n  \r\n                  /* ------ X l tchat --------------------------------------------------------------------------- */\r\n                  if(tchatCombo === 2) {\r\n                    // Gn li tn\r\n                    combo_detail.inv_itemName = 'Hng khuyn mi/hng tng ' + combo.name;\r\n                    // Tnh li gi tr tr gi (chit khu) ca chi tit ha n trng hp tchat2\r\n                    combo_detail.inv_discountAmount = 0;\r\n  \r\n                    /* ------ X l cqt_vat_ecommerce_by_linked_product --------- */\r\n                    if(this.cqt_vat_ecommerce_by_linked_product) {\r\n                      // Tnh li gi\r\n                      combo_detail.inv_unitPrice = this.billService.calculateNewPriceToUseSettingTax(combo_detail.inv_unitPrice, combo_detail.inv_quantity, combo_detail.inv_discountAmount, combo_detail.ma_thue, platformTax);\r\n                    }\r\n  \r\n                    /* ------ X l Hng khuyn mi c php xut 0 ----------------------------------------------- */\r\n                    // Nu c bt cqt_vat_ecommerce_allow_promotional_items_zero_price v l tchat2 th cn gn li gi = 0,  cc php tnh cho nhng trng khc bn di cng s t tnh = 0\r\n                    if(this.cqt_vat_ecommerce_allow_promotional_items_zero_price) {\r\n                      combo_detail.inv_unitPrice = 0;\r\n                    }\r\n\r\n                    /* ------ X l Vn gi hng xut bn cho sn phm tng/khuyn mi khi gi CQT ------------------ */\r\n                    // Nu c bt cqt_vat_ecommerce_keep_promotional_items_as_sold v l tchat2 th s set li nso thnh tchat1, discountAmount v discountPercentage vn l 0\r\n                    if(this.cqt_vat_ecommerce_keep_promotional_items_as_sold) {\r\n                      // Gn li tchat\r\n                      combo_detail.tchat = 1; // Gn li tchat thnh 1\r\n                      // Gn li tn\r\n                      combo_detail.inv_itemName = combo.name;\r\n                    }\r\n  \r\n                    // Tr gi (chit khu) tnh theo %\r\n                    combo_detail.inv_discountPercentage = 0;\r\n                  }\r\n                  else {\r\n                    // Gn li tn\r\n                    combo_detail.inv_itemName = combo.name;\r\n                    // Tr gi (chit khu) ca nh bn hng trn mi chi tit ha n = seller_discount + shopee_discount\r\n                    combo_detail.inv_discountAmount = this.billService.roundTo4Decimal(invoice_detail.inv_discountAmount * percentRate);\r\n\r\n                    /* ------ X l Gi hng ha, dch v... gi CQT l gi bn  gim ----------------------------------------- */\r\n                    if(this.cqt_vat_ecommerce_item_price_is_discounted) {\r\n                      // Gn li thnh gi  gim\r\n                      combo_detail.inv_unitPrice = combo_detail.inv_unitPrice - combo_detail.inv_discountAmount / combo_detail.inv_quantity;\r\n                      // Gn li Chit khu = 0\r\n                      combo_detail.inv_discountAmount = 0;\r\n                    }\r\n  \r\n                    /* ------ X l cqt_vat_ecommerce_by_linked_product --------- */\r\n                    if(this.cqt_vat_ecommerce_by_linked_product) {\r\n                      // Tnh li gi\r\n                      combo_detail.inv_unitPrice = this.billService.calculateNewPriceToUseSettingTax(combo_detail.inv_unitPrice, combo_detail.inv_quantity, combo_detail.inv_discountAmount, combo_detail.ma_thue, platformTax);\r\n                    }\r\n  \r\n                    // Tr gi (chit khu) tnh theo %\r\n                    combo_detail.inv_discountPercentage = combo_detail.inv_discountAmount / (combo_detail.inv_unitPrice * combo_detail.inv_quantity) * 100;\r\n                  }\r\n  \r\n                  // Gi cui ( tr tr gi) ca chi tit ha n\r\n                  combo_detail.inv_TotalAmountWithoutVat = combo_detail.inv_unitPrice * combo_detail.inv_quantity - combo_detail.inv_discountAmount;\r\n                  // Thu VAT c tnh theo chi tit ha n\r\n                  combo_detail.inv_vatAmount = combo_detail.inv_TotalAmountWithoutVat * combo_detail.ma_thue / 100;\r\n                  // Tng gi tr hng ha k khai theo chi tit ha n\r\n                  combo_detail.inv_TotalAmount = combo_detail.inv_TotalAmountWithoutVat + combo_detail.inv_vatAmount;\r\n  \r\n                  // Thm vo mng\r\n                  invoice_details = this.billService.addEInvoiceDetail(combo_detail, invoice_details, {cqt_vat_ecommerce_separate_discount_line: this.cqt_vat_ecommerce_separate_discount_line});\r\n                }\r\n              }\r\n            }\r\n            else {\r\n              invoice_details = this.billService.addEInvoiceDetail(invoice_detail, invoice_details, {cqt_vat_ecommerce_separate_discount_line: this.cqt_vat_ecommerce_separate_discount_line});\r\n            }\r\n\r\n            if(tchat === 1) {\r\n              // Cng dn tin seller gim gi ph ship\r\n              shipping_fee_discountAmount += product.seller_income_detail.discount?.discount_shipping_fee?.seller_subsidy || 0;\r\n            }\r\n          }\r\n\r\n\r\n\r\n          /* -------------------------------------------------------- X l Ph vn chuyn -------------------------------------------------------- */\r\n\r\n          // X l cho ph\r\n          if (this.cqt_submit_invoice_with_shipping_fee && bill.invoice.shipping_amount_after_discount + shipping_fee_discountAmount > 0) {\r\n            // Khi to chi tit ha n\r\n            let invoice_detail = this.billService.createEInvoiceDetailTemplate();\r\n\r\n            /** Gim gi (ch ly gim gi ca Tiki) */\r\n            const discountAmount = bill.invoice.shipping_discount_amount - shipping_fee_discountAmount;\r\n            /** n gi */\r\n            let unitPrice = bill.invoice.shipping_amount_after_discount + discountAmount + shipping_fee_discountAmount;\r\n            /** S lng */\r\n            const quantity = 1;\r\n            /** Total cha c thu */\r\n            let totalAmountWithoutVat = (unitPrice * quantity) - discountAmount;\r\n\r\n            // Gn cc gi tr chung\r\n            invoice_detail.tchat = 1;\r\n            invoice_detail.stt_rec0 = invoice_details.length + 1;\r\n            invoice_detail.inv_itemCode = 'phi_van_chuyen';\r\n            invoice_detail.inv_itemName = 'Ph vn chuyn';\r\n            invoice_detail.inv_unitCode = 'Ln';\r\n            invoice_detail.inv_quantity = quantity;\r\n            invoice_detail.inv_unitPrice = unitPrice;\r\n            invoice_detail.inv_discountAmount = discountAmount; // gim gi (Tin chit khu)\r\n            invoice_detail.inv_TotalAmountWithoutVat = totalAmountWithoutVat; // Thnh tin trc thu\r\n            invoice_detail.ma_thue = billTax; // % thu\r\n\r\n            /* ------ X l cqt_vat_ecommerce_already_Included ---------------------------------------------- */\r\n            if (this.cqt_vat_ecommerce_already_Included) {\r\n              // Tnh li gi\r\n              invoice_detail.inv_unitPrice = this.billService.calculateNewPriceToUseSettingTax(invoice_detail.inv_unitPrice, invoice_detail.inv_quantity, invoice_detail.inv_discountAmount, invoice_detail.ma_thue, platformTax);\r\n            }\r\n\r\n            // Tr gi (chit khu) tnh theo %\r\n            invoice_detail.inv_discountPercentage = invoice_detail.inv_discountAmount / (invoice_detail.inv_unitPrice * invoice_detail.inv_quantity) * 100;\r\n            // Gi cui ( tr tr gi) ca chi tit ha n\r\n            invoice_detail.inv_TotalAmountWithoutVat = invoice_detail.inv_unitPrice - invoice_detail.inv_discountAmount;\r\n            // Thu VAT c tnh theo chi tit ha n\r\n            invoice_detail.inv_vatAmount = invoice_detail.inv_TotalAmountWithoutVat * invoice_detail.ma_thue / 100;\r\n            // Tng gi tr hng ha k khai theo chi tit ha n\r\n            invoice_detail.inv_TotalAmount = invoice_detail.inv_TotalAmountWithoutVat + invoice_detail.inv_vatAmount;\r\n\r\n            // Thm vo mng\r\n            invoice_details = this.billService.addEInvoiceDetail(invoice_detail, invoice_details, {cqt_vat_ecommerce_separate_discount_line: this.cqt_vat_ecommerce_separate_discount_line});\r\n          }\r\n\r\n\r\n\r\n          /* --------------------------------------------------------- X l ph tr Tiki --------------------------------------------------------- */\r\n\r\n          if (this.cqt_submit_invoice_with_ecommerce_fee) {\r\n            /** Ph tr Tiki */\r\n            const total_seller_fee = Math.abs(bill.invoice?.total_seller_fee) - shipping_fee_discountAmount || 0; // total_seller_fee l s m (treated as statement entry in seller account: -25000 means expense, charge or cost)\r\n            if (total_seller_fee > 0) {\r\n              // Khi to chi tit ha n\r\n              let invoice_detail = this.billService.createEInvoiceDetailTemplate();\r\n\r\n              /** Gim gi */\r\n              const discountAmount = 0;\r\n              /** n gi */\r\n              let unitPrice = total_seller_fee;\r\n              /** S lng */\r\n              const quantity = 1;\r\n              /** Total cha c thu */\r\n              let totalAmountWithoutVat = (unitPrice * quantity) - discountAmount;\r\n\r\n              // Gn cc gi tr chung\r\n              invoice_detail.tchat = 3;\r\n              invoice_detail.stt_rec0 = invoice_details.length + 1,\r\n              invoice_detail.inv_itemCode = 'chiet_khau_thuong_mai',\r\n              invoice_detail.inv_itemName = 'Chit khu thng mi',\r\n              invoice_detail.inv_unitCode = 'Phn',\r\n              invoice_detail.inv_quantity = quantity,\r\n              invoice_detail.inv_unitPrice = unitPrice,\r\n              invoice_detail.inv_TotalAmountWithoutVat = totalAmountWithoutVat, // Thnh tin trc thu\r\n              invoice_detail.ma_thue = 0, // Khng c thu cho chit khu thng mi\r\n              invoice_detail.inv_TotalAmount = total_seller_fee + 0 // tng tin sau thu (Thnh tin sau thu)\r\n\r\n              // Gi cui ( tr tr gi) ca chi tit ha n\r\n              invoice_detail.inv_TotalAmountWithoutVat = invoice_detail.inv_unitPrice - invoice_detail.inv_discountAmount;\r\n              // Thu VAT c tnh theo chi tit ha n\r\n              invoice_detail.inv_vatAmount = invoice_detail.inv_TotalAmountWithoutVat * invoice_detail.ma_thue / 100;\r\n              // Tng gi tr hng ha k khai theo chi tit ha n\r\n              invoice_detail.inv_TotalAmount = invoice_detail.inv_TotalAmountWithoutVat + invoice_detail.inv_vatAmount;\r\n\r\n              // Thm vo mng\r\n              invoice_details = this.billService.addEInvoiceDetail(invoice_detail, invoice_details, {cqt_vat_ecommerce_separate_discount_line: this.cqt_vat_ecommerce_separate_discount_line});\r\n            }\r\n          }\r\n\r\n\r\n          /* ---------------------------------------------- Gn li cc trng tnh ton cho invoice ---------------------------------------------- */\r\n\r\n          for (let i = 0; i < invoice_details.length; i++) {\r\n            if (invoice_details[i].tchat == 1) {\r\n              // tchat 1 th cng dn\r\n              invoice.inv_discountAmount += invoice_details[i].inv_discountAmount;\r\n              invoice.inv_vatAmount += invoice_details[i].inv_vatAmount;\r\n              invoice.inv_TotalAmountWithoutVat += invoice_details[i].inv_TotalAmountWithoutVat;\r\n              invoice.inv_TotalAmount += invoice_details[i].inv_TotalAmount;\r\n            } else if (invoice_details[i].tchat == 2) {\r\n              // tchat 2 th b qua\r\n            } else if (invoice_details[i].tchat == 3) {\r\n              // tchat 3 th phi tr li\r\n              invoice.inv_discountAmount -= invoice_details[i].inv_discountAmount;\r\n              invoice.inv_vatAmount -= invoice_details[i].inv_vatAmount;\r\n              invoice.inv_TotalAmountWithoutVat -= invoice_details[i].inv_TotalAmountWithoutVat;\r\n              invoice.inv_TotalAmount -= invoice_details[i].inv_TotalAmount;\r\n            }\r\n          }\r\n\r\n\r\n          /* ----------------------------------------------------------- Tr v gi tr ----------------------------------------------------------- */\r\n\r\n          invoices = [{ ...invoice, details: [{ data: invoice_details }] }];\r\n          console.log('data', invoices);\r\n          resolve({ vcode: 0, msg: 'success', data: invoices });\r\n        } catch (err) {\r\n          console.error(' Li saveInvoice_noSign_byMinvoice:', err);\r\n          reject(err);\r\n        }\r\n      })();\r\n    });\r\n  }\r\n\r\n\r\n\r\n  /**\r\n   * m s lng bill ang check\r\n   */\r\n  get countSelectedBill(): number {\r\n    return this.salesOrder?.filter((e: any) => e.checked)?.filter((data: any) => !data.cqt_status || data.cqt_status == 1)?.length;\r\n  }\r\n\r\n\r\n\r\n  /**\r\n   * Ly ngy cp nht ca n hng theo nh dng 2025-06-25\r\n   */\r\n  getUpdateTimeFormat(order) {\r\n    return this.vhAlgorithm.formatDateToString(new Date(order.updated_at));\r\n  }\r\n\r\n}\r\n","<div nz-row class=\"row-back medium-size\" (click)=\"goBack()\">\r\n    <i nz-icon nzType=\"left\" nzTheme=\"outline\"></i>{{'Back' | translate}}\r\n</div>\r\n<nz-layout id=\"order-status-tiki\">\r\n    <div nz-row nzGutter=\"4\" class=\"order-status-tiki-header\">\r\n        <!-- Tiu  -->\r\n        <div nz-col nzSpan=\"8\" class=\"title\">\r\n            <b>{{'Xut ha n in t t sn'|translate}}</b>\r\n            <br>\r\n             {{'Shop name' | translate}}: <b class=\"color-green\">{{infoShop.data?.name}}</b>\r\n        </div>\r\n        <!-- Tm kim -->\r\n        <div nz-col nzSpan=\"6\" class=\"title center-all-content\">\r\n            <nz-input-group [nzSuffix]=\"suffixIconSearch\">\r\n                <input [(ngModel)]=\"searchValue\" (ngModelChange)=\"search($event)\" type=\"text\" nz-input\r\n                    [placeholder]=\"'Tm m n hng (phn tch bi du phy)' | translate\" />\r\n            </nz-input-group>\r\n            <ng-template #suffixIconSearch>\r\n                <i nz-icon nzType=\"search\"></i>\r\n            </ng-template>\r\n        </div>\r\n        <!-- Chn ngy -->\r\n        <div nz-col nzSpan=\"6\">\r\n            <nz-range-picker nzFormat='dd/MM/yyyy' [nzDisabledDate]=\"disabledDate\" nzFormat=\"dd/MM/yyyy\"\r\n                [(ngModel)]=\"date\" (ngModelChange)=\"changeTime($event)\">\r\n            </nz-range-picker>\r\n        </div>\r\n        <!-- Nt xem bo co v gi CQT -->\r\n        <div nz-col nzSpan=\"4\" class=\"right-all-content\">\r\n            <button class=\"btn-view center-all-content\" nz-button nzType=\"default\" (click)=\"showReport()\">\r\n                <ion-icon src=\"assets/icon/management/view.svg\"></ion-icon>\r\n                {{'View' | translate}}\r\n            </button>\r\n            <button class=\"btn-view center-all-content\" nz-button nzType=\"default\" (click)=\"send()\">\r\n                {{'Gi CQT' | translate}}\r\n            </button>\r\n        </div>\r\n    </div>\r\n    \r\n    <div *ngIf=\"load_status else no_data\" nz-row nzGutter=\"16\" class=\"order-status-tiki-body\">\r\n        <div nz-col nzSpan=\"24\">\r\n            <nz-tabset [(nzSelectedIndex)]=\"selectedIndex\" (nzSelectChange)=\"segmentChanged($event.index)\">\r\n                <nz-tab *ngFor=\"let item of list_status_bill\" nzTitle=\"{{item.name | translate}} ({{orderCountByStatus[item.name]}})\">\r\n                </nz-tab>\r\n\r\n            </nz-tabset>\r\n            <nz-table *ngIf=\"salesOrder.length > 0;else no_bill\" [nzScroll]=\"{y: heightScroll }\" #salesOrder_show\r\n                nzShowPagination nzShowSizeChanger [nzData]=\"salesOrder\" [nzPageSize]=\"20\"\r\n                [nzPageSizeOptions]=\"[20, 30, 40, 50, 100, 200]\">\r\n                <thead>\r\n                    <tr>\r\n                        <th nzAlign=\"center\" nzWidth=\"6%\"><b>{{'No.' | translate}}</b></th>\r\n                        <th nzLeft nzWidth=\"17%\"><b>{{'Date order' | translate}}</b></th>\r\n                        <th nzLeft nzWidth=\"17%\"><b>{{'Order number' | translate}}</b></th>\r\n                        <th><b>{{'Product' | translate}}</b></th>\r\n                        <th nzWidth=\"15%\"><b>{{'Status on Tiki' | translate}}</b></th>\r\n                        <th><b>{{'Status CQT' | translate}}</b>\r\n                        <th style=\"text-align: right;\" nzWidth=\"17%\"><b>{{\"Total\"| translate}}</b></th>\r\n                        <!-- <th style=\"text-align: center;\" nzWidth=\"17%\"><b>{{\"Canceled reason\" | translate}}</b></th> -->\r\n                        <th nzAlign=\"center\" [(nzChecked)]=\"allChecked\" [nzIndeterminate]=\"indeterminate\"\r\n                            (nzCheckedChange)=\"checkAll($event)\">\r\n                            ({{countSelectedBill}})\r\n                        </th>\r\n                    </tr>\r\n                </thead>\r\n                <tbody>\r\n                    <tr *ngFor=\"let bill of salesOrder_show.data,index as i\" style=\"cursor: pointer;\"\r\n                        (click)=\"gotoDetail(bill)\">\r\n                        <td nzAlign=\"center\">{{(salesOrder_show.nzPageIndex - 1) * salesOrder_show.nzPageSize + i + 1}}</td>\r\n                        <td nzLeft>\r\n                            {{bill.created_at | date : \"dd/MM/yyyy HH:mm\"}}</td>\r\n                        <td nzLeft> {{bill.code}} <i (click)=\"$event.stopPropagation();vhComponent.copyValue(bill.code)\"\r\n                                nz-icon nzType=\"copy\" nzTheme=\"outline\"></i>\r\n                        </td>\r\n                        <td>\r\n                            <span\r\n                                [style.color]=\"isLinkedToProduct(item) ? '' : 'var(--ion-color-vh-red)'\"\r\n                                style=\"font-size: 0.8rem;\"\r\n                                *ngFor=\"let item of bill.items\"\r\n                            >\r\n                                {{isLinkedToProduct(item) ? findProductLinked(item).name : item.product.name}} (SL: {{item.qty}})\r\n                                <i *ngIf=\"!isLinkedToProduct(item)\" (click)=\"$event.stopPropagation();openModelSelectProductsTiki(item)\" class=\"icon-link green\" nz-icon nzType=\"link\" nzTheme=\"outline\"></i>\r\n                                <br>\r\n                            </span>\r\n                        </td>\r\n                        <td *ngIf=\"bill.status != 'queueing'\">\r\n                            <ng-container *ngIf=\"bill.main_substate_text; else elseTemplate\">\r\n                                <span nz-tooltip [nzTooltipTitle]=\"getUpdateTimeFormat(bill)\">{{bill.main_substate_text | translate}}</span>\r\n                            </ng-container>\r\n                            <ng-template #elseTemplate>\r\n                                <span nz-tooltip [nzTooltipTitle]=\"getUpdateTimeFormat(bill)\">{{bill.main_state_text | translate}}</span>\r\n                            </ng-template>\r\n\r\n                        </td>\r\n                        <td *ngIf=\"bill.status == 'queueing'\">\r\n                            <div class=\"left-all-content\" nz-tooltip [nzTooltipTitle]=\"getUpdateTimeFormat(bill)\">\r\n                                <button class=\"btn-confirm\" nz-button\r\n                                    (click)=\"$event.stopPropagation();updateStatusComfirm(bill)\">\r\n                                    {{'XN cn hng'}}</button>\r\n                            </div>\r\n                        </td>\r\n                        \r\n                        <td>\r\n                            <span *ngIf=\"bill.cqt_status == 3\">{{'Sent to CQT' | translate}} <span nz-tooltip [nzTooltipTitle]=\"'View E-invoice' | translate\" nz-icon class=\"ant-input-password-icon\" [nzType]=\"'eye'\" (click)=\"$event.stopPropagation(); printService.viewEInvoice(infoBranch, {_id: bill.code})\"></span></span>\r\n                            <span *ngIf=\"bill.cqt_status == 2\">{{'Waiting for signature' | translate}} <span nz-tooltip [nzTooltipTitle]=\"'View E-invoice' | translate\" nz-icon class=\"ant-input-password-icon\" [nzType]=\"'eye'\" (click)=\"$event.stopPropagation(); printService.viewEInvoice(infoBranch, {_id: bill.code})\"></span></span>\r\n                            <span *ngIf=\"!bill.cqt_status || bill.cqt_status == 1\">{{'Not sent to CQT' | translate}}</span>\r\n                        </td>\r\n\r\n                        <td style=\"text-align: right;\">\r\n                            <b>{{vhAlgorithm.vhcurrencyunit(bill.invoice.total_seller_income)}}</b>\r\n                        </td>\r\n                        <!-- <td style=\"text-align: center;\"><span\r\n                                *ngIf=\"bill.status == 'canceled'\">{{bill.cancel_info.reason_text}}</span></td> -->\r\n                        <td nzAlign=\"center\" (click)=\"$event.stopPropagation();\">\r\n                            <label *ngIf=\"bill.cqt_status == 1 || !bill.cqt_status\" [(ngModel)]=\"bill.checked\" (ngModelChange)=\" refreshStatus\"\r\n                                nz-button  nz-checkbox>\r\n                            </label>\r\n                        </td>\r\n                        <!-- <td style=\"text-align: left;\">{{bill.carrier_name}}</td> -->\r\n                    </tr>\r\n                </tbody>\r\n            </nz-table>\r\n            <ng-template #no_bill class=\"full-height\">\r\n                <div nz-col nzSpan=\"24\" class=\"center-all-content\">\r\n                    <div>{{'No data'| translate}}</div>\r\n                </div>\r\n            </ng-template>\r\n        </div>\r\n    </div>\r\n    <ng-template #no_data>\r\n        <div nz-row class=\"no-affiliate\">\r\n            <div nz-col nzSpan=\"24\" class=\"text-center\">\r\n                <img src=\"assets/icon/management/ecommerce/no-data-orderstatus.svg\" alt=\"\">\r\n                <p>{{\"Please click the view button\"|\r\n                    translate}}</p>\r\n            </div>\r\n        </div>\r\n    </ng-template>\r\n\r\n</nz-layout>\r\n\r\n<!-- -------------------------------------------- MODAL CHNH SA THNG TIN THU KHCH HNG -------------------------------------------- -->\r\n<app-edit-customer-tax *ngIf=\"isShowModalEditCustomerTax\" ecommerce_platform=\"tiki\" [invoice]=\"tempCustomerTax\" [infoShop]=\"infoShop\"\r\n    (onClose)=\"isShowModalEditCustomerTax = false\" (onOk)=\"isShowModalEditCustomerTax = false; onOkEditTax($event)\">\r\n</app-edit-customer-tax>\r\n\r\n<!-- --------------modal chn sn phm lin kt--------------- -->\r\n<app-modal-link-product-ecommerce\r\n    [title]=\"'Select Tiki linked products' | translate\"\r\n    [visible_affiliate]=\"visible_affiliate\"\r\n    [listProductApp]=\"listProductApp\"\r\n    [searchProductAppValue]=\"searchProductAppValue\"\r\n    (cancelAffiliate)=\"cancelAffiliate()\"\r\n    (searchProductApp)=\"searchProductApp($event)\"\r\n    (acceptAfiliate)=\"acceptAfiliate($event)\"\r\n></app-modal-link-product-ecommerce>\r\n","\r\nimport { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { RouterModule, Routes } from '@angular/router';\r\nimport { NgZorroAntModule } from 'src/app/ng-zorro-ant.module';\r\nimport { TranslateModule } from '@ngx-translate/core';\r\nimport { IonicModule } from '@ionic/angular';\r\nimport { FormsModule } from '@angular/forms';\r\nimport { EditCustomerTaxModule } from 'src/app/sales/menu/manage/ecommerce/components/edit-customer-tax/edit-customer-tax.module';\r\nimport { ModalLinkProductEcommerceModule } from 'src/app/sales/menu/manage/ecommerce/components/modal-link-product-ecommerce/modal-link-product-ecommerce.module';\r\nconst routes: Routes = [\r\n  {\r\n    path: \"\",\r\n    component: EInvoiceTikiComponent\r\n  },\r\n]\r\nimport { EInvoiceTikiComponent } from './e-invoice-tiki.component';\r\n\r\n\r\n\r\n@NgModule({\r\n  declarations: [\r\n    EInvoiceTikiComponent\r\n  ],\r\n  imports: [\r\n    CommonModule,\r\n    RouterModule.forChild(routes),\r\n    NgZorroAntModule,\r\n    TranslateModule,\r\n    IonicModule,\r\n    FormsModule,\r\n    EditCustomerTaxModule,\r\n    ModalLinkProductEcommerceModule\r\n  ]\r\n})\r\nexport class EInvoiceTikiModule { }\r\n"],"names":["VhType","i0","$event","_r28","ctx_r37","_id","ctx_r40","ctx_r50","ctx_r7","_r8","ctx_r60","ctx_r5","EInvoiceTikiComponent","constructor","router","lang","vhComponent","vhAlgorithm","vhQuerySales","cdRef","datePipe","nzModalService","vhAuth","vhQuery","vhEinvoice","billService","printService","name","status","main_state","main_substate","main_substate1","status2","main_substate2","main_substate3","confirmation_status","confirmation_status1","Date","current","getTime","getStore","registrationdate","getDefaultBranch","getlocalBranch","getLocalAppSettingNameBranch","cqt_submit_invoice_with_shipping_fee","cqt_submit_invoice_with_ecommerce_fee","cqt_vat_ecommerce_already_Included","cqt_vat_ecommerce_rate","cqt_invoice_auto_sign","cqt_vat_ecommerce_by_linked_product","cqt_vat_ecommerce_allow_promotional_items_zero_price","cqt_vat_ecommerce_separate_discount_line","cqt_vat_ecommerce_keep_promotional_items_as_sold","cqt_vat_ecommerce_use_latest_order_update_time","cqt_vat_ecommerce_buyer_info_with_platform_and_so_benh_an","cqt_vat_ecommerce_default_payment_method_chuyen_khoan","cqt_vat_ecommerce_item_code_is_barcode","cqt_vat_ecommerce_item_price_is_discounted","dataRestore","getCurrentNavigation","extras","state","_a","ngOnInit","disabledDate","searchValue","salesOrder","salesSubOrder","countOrderByStatus","load_status","selectedIndex","date","infoShop","getlocalShopListTiki","listProductOfBranch","getlocalDetailProducts","filter","e","delete_hidden","item","id_branch","tikis","length","localProducts","listProductApp","map","prod","id_shop","getUnit_byRatio","units","listSubProductApp","changeTime","event","showToast","translate","search","value","segmentChanged","valArray","split","val","changeAlias","toString","trim","toLowerCase","some","code","_b","includes","searchProductApp","searchList","list_status_bill","items","confirmation","orders","orderCountByStatus","order","goBack","navigate","showReport","showLoading","then","getSalesOrderListTiki","transform","setHours","access_token","result","hideLoading","create_at","create_time","checked","catch","err","calculateTotal","bill","ngAfterViewChecked","document","querySelector","heightScroll","clientHeight","getElementById","widthScroll","clientWidth","detectChanges","gotoDetail","id_shop_selected","checkAll","forEach","data","disabled","refreshStatus","editTax","invoice","tempCustomerTax","isShowModalEditCustomerTax","onOkEditTax","customerTaxInfo","Object","assign","findProductLinked","productOfBranch","findProduct","find","product_id","product","id","isLinkedToProduct","openModelSelectProductsTiki","productTiki","productTikiSelected","visible_affiliate","cancelAffiliate","acceptAfiliate","isZeroPriceCombo","type","COMBO","price","confirmZeroPriceComboMessage","platform","confirm","nzTitle","nzIconType","nzCancelText","nzOnOk","id_product_selected","id_subproduct","addMergeTikiProduct","bool","setTimeout","alertMessageDesktop","console","error","clearProductShow","listProduct","prodApp","indexProd","findIndex","splice","validData","allChecked","every","allUnChecked","indeterminate","send","bills","cqt_status","batchSize","totalBatches","Math","ceil","sort","a","b","update_time","showLoadingNotDuration","i","batch","slice","currentBatchIndex","floor","promises","log","sendCQT","results","asyncPromiseAll","batchError","Promise","resolve","reject","currentBranch","einvoices","invoice_provider","invoiceSeries","changeBill_byLocal_toInvoice_byMinvoice","rsp","vcode","saveInvoice_Sign_byMinvoice","taxcode","token","res","updateSalesOrderTiki_byFile","array","bill_code","message","saveInvoice_noSign_byMinvoice","invoices","Array","invoice_details","inv_invoiceSeries","inv_invoiceIssuedDate","formatDateToString","inv_currencyCode","inv_exchangeRate","inv_discountAmount","inv_TotalAmountWithoutVat","inv_vatAmount","inv_TotalAmount","key_api","so_benh_an","updated_at","buyerDisplayNameDefault","inv_paymentMethodName","payment","method","inv_buyerDisplayName","tax_info","company_name","_c","_d","tax_buyerDisplayName","inv_buyerLegalName","_e","_f","_g","_h","tax_buyerLegalName","inv_buyerTaxCode","_j","_k","_l","_m","tax_buyerTaxCode","inv_buyerAddressLine","_o","_p","address","_q","_r","tax_buyerAddressLine","inv_buyerEmail","_s","_t","email","_u","_v","tax_buyerEmail","platformTax","billTax","shipping_fee_discountAmount","productLinked","invoice_detail","createEInvoiceDetailTemplate","unitPrice","quantity","qty","discountAmount","seller_income_detail","_w","discount","_x","discount_coupon","_y","seller_discount","totalAmountWithoutVat","tchat","invoiceDetailTax","tax","undefined","stt_rec0","inv_itemCode","inv_unitCode","inv_quantity","inv_unitPrice","ma_thue","inv_itemName","calculateNewPriceToUseSettingTax","inv_discountPercentage","PRODUCT","barcode","_z","addEInvoiceDetail","priceCombo","errorZeroPriceComboMessage","j","combos","combo","combo_detail","percentRate","tchatCombo","detailproduct","getlocalDetailProduct","id_product","invoiceDetailComboTax","ratio","_0","roundTo4Decimal","_1","discount_shipping_fee","_2","seller_subsidy","shipping_amount_after_discount","shipping_discount_amount","total_seller_fee","abs","_3","details","msg","countSelectedBill","getUpdateTimeFormat","selectors","decls","vars","consts","template","ctx","_r3"],"sourceRoot":"webpack:///"}