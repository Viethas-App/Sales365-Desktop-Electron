{"version":3,"file":"src_app_sales_menu_manage_ecommerce_tiktok_e-invoice-tiktok_e-invoice-tiktok_module_ts.js","mappings":"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","sources":["./src/app/sales/menu/manage/ecommerce/tiktok/e-invoice-tiktok/e-invoice-tiktok.component.ts","./src/app/sales/menu/manage/ecommerce/tiktok/e-invoice-tiktok/e-invoice-tiktok.component.html","./src/app/sales/menu/manage/ecommerce/tiktok/e-invoice-tiktok/e-invoice-tiktok.module.ts"],"sourcesContent":["import { DatePipe } from '@angular/common';\r\nimport { ChangeDetectorRef, Component, OnInit, TemplateRef } from '@angular/core';\r\nimport { Router } from '@angular/router';\r\nimport { VhAlgorithm, VhAuth, VhEcommerce, VhEinvoice, VhQuery, VhQuerySales } from 'ionic-vhframeworks';\r\nimport { NzModalService } from 'ng-zorro-antd/modal';\r\nimport { VhComponent } from 'src/app/sales/components/vh-component/vh-component';\r\nimport { VhType } from 'src/app/sales/interface/vh-type';\r\nimport { BillService } from 'src/app/sales/services/bill.service';\r\nimport { LanguageService } from 'src/app/sales/services/language.service';\r\nimport { PrintService } from 'src/app/sales/services/print.service';\r\n@Component({\r\n  selector: 'app-e-invoice-tiktok',\r\n  templateUrl: './e-invoice-tiktok.component.html',\r\n  styleUrls: ['./e-invoice-tiktok.component.scss']\r\n})\r\nexport class EInvoiceTiktokComponent implements OnInit {\r\n  searchValue: any;\r\n  salesOrder: Array<any> = [];\r\n  salesSubOrder: Array<any> = [];\r\n  selectedIndex: number = 0;\r\n  list_status_bill: Array<any> = [\r\n    { name: \"All\", value: \"all\" },\r\n    { name: \"UNPAID\", value: \"UNPAID\" },\r\n    { name: \"ON_HOLD\", value: \"ON_HOLD\" },\r\n    { name: \"AWAITING_SHIPMENT\", value: \"AWAITING_SHIPMENT\" },\r\n    { name: \"AWAITING_COLLECTION\", value: \"AWAITING_COLLECTION\", },\r\n    { name: \"PARTIALLY_SHIPPING\", value: \"PARTIALLY_SHIPPING\" },\r\n    { name: \"IN_TRANSIT\", value: \"IN_TRANSIT\" },\r\n    { name: \"DELIVERED\", value: \"DELIVERED\" },\r\n    { name: \"COMPLETED\", value: \"COMPLETED\" },\r\n    { name: \"CANCELLED\", value: \"CANCELLED\" },\r\n    { name: \"RETURNED\", value: \"RETURNED\" }, // trng thi n tr hng hon tin\r\n  ];\r\n  // \"pending\", \"unpaid\", \"packed\", \"shipped\", \"delivered\", \"returned\", \"cancelled\", \"lost_by_3pl\", \"damaged_by_3pl\"\r\n  heightScroll: any;\r\n  widthScroll: any;\r\n  public date: Date[] = [new Date(), new Date()];\r\n  startTimeBackUp: Date;\r\n  endTimeBackUp: Date;\r\n  load_status: boolean = false;\r\n  dataRestore: any;\r\n  /**Gii hn thi gian cho xem bill */\r\n  disabledDate = (current: Date): boolean => {\r\n    if (current.getTime() < new Date(this.vhAuth.getStore().registrationdate).getTime() - 24 * 60 * 60 * 1000) return true;\r\n    return false;\r\n  };\r\n  infoShop: any = {};\r\n  listProductOfBranch: Array<any> = []; // sp ca phn mm c lin kt vi sp tiktok\r\n  listProductApp: Array<any> = []; // sp trong phn mm cha tiktok[]\r\n  listSubProductApp: Array<any> = []; //sp ca app  search\r\n  listProductTiktok: Array<any> = []; // sp ca tiktok\r\n  searchProductAppValue: any = '';\r\n  id_branch: string = this.vhQuerySales.getDefaultBranch()._id;\r\n  infoBranch = this.vhQuerySales.getlocalBranch(this.vhQuerySales.getDefaultBranch()._id);\r\n  constructor(\r\n    private router: Router,\r\n    public lang: LanguageService,\r\n    public vhComponent: VhComponent,\r\n    public vhAlgorithm: VhAlgorithm,\r\n    private vhQuerySales: VhQuerySales,\r\n    private cdRef: ChangeDetectorRef,\r\n    private modal: NzModalService,\r\n    private vhAuth: VhAuth,\r\n    private vhEcommerce: VhEcommerce,\r\n    private vhEinvoice: VhEinvoice,\r\n    private vhQuery: VhQuery,\r\n    private billService: BillService,\r\n    public printService: PrintService,\r\n    public datePipe: DatePipe,\r\n  ) {\r\n    this.dataRestore = this.router.getCurrentNavigation().extras.state?.dataRestore;\r\n  }\r\n\r\n  ngOnInit(): void {\r\n    if (this.dataRestore) {\r\n      this.searchValue = this.dataRestore.searchValue;\r\n      this.salesOrder = this.dataRestore.salesOrder;\r\n      this.salesSubOrder = this.dataRestore.salesSubOrder;\r\n      this.countOrderByStatus(this.salesOrder);\r\n      this.load_status = true;\r\n      this.selectedIndex = this.dataRestore.selectedIndex;\r\n      this.date = this.dataRestore.date;\r\n      this.segmentChanged(this.selectedIndex);\r\n    }\r\n    this.infoShop = this.vhEcommerce.getlocalShopListTiktok()[0];\r\n\r\n    this.listProductOfBranch = this.vhQuerySales.getlocalDetailProducts(35)\r\n      .filter(e => !e.delete_hidden)\r\n      .filter(item =>\r\n        item[this.id_branch] &&\r\n        item[this.id_branch].tiktoks &&\r\n        item[this.id_branch].tiktoks.length >= 0\r\n      );\r\n\r\n    let localProducts: Array<any> = this.vhQuerySales.getlocalDetailProducts(35).filter(e => !e.delete_hidden);\r\n    this.listProductApp = localProducts.map(item => {\r\n      let unit = this.vhQuerySales.getUnit_byRatio(item.units, 1);\r\n      if (item[this.id_branch] && item[this.id_branch].tiktoks && item[this.id_branch].tiktoks.length) { //filter nhng sp tiktok thuc id tiktok  chn\r\n        item[this.id_branch].product_tiktoks = [...item[this.id_branch].tiktoks.filter(prod => prod.id_shop == this.infoShop._id)];\r\n      }\r\n      return { ...item, ...unit };\r\n    });\r\n    this.listSubProductApp = [...this.listProductApp];\r\n    this.listProductTiktok = this.clearProductShow(this.vhEcommerce.getlocalProductListTiktok(this.infoShop['_id']).filter(item => item.status == 'ACTIVATE'), this.listProductApp);\r\n  }\r\n  /**\r\n   * bt sk thay i ngy xem ha n\r\n   * @example this.changeTime('2023-06-09T04:14:30.367Z')\r\n   */\r\n  changeTime(event) {\r\n    if (event[1].getTime() - event[0].getTime() <= 2678400000) {\r\n    } else {\r\n      this.vhComponent.showToast(2000, this.lang.translate(\"The time to view no more than 30 days\"), \"alert-toast\");\r\n      this.date = [new Date(event[0]), new Date(event[0].getTime() + 2678313600)];\r\n    }\r\n  }\r\n\r\n  /**\r\n   * lc salesOrder theo id\r\n   * @param value\r\n   * @example this.search('060623A001')\r\n   */\r\n  search(value: string) {\r\n    this.segmentChanged(this.selectedIndex);\r\n    /** Mng bill cn search */\r\n    let valArray: string[] = value.split(',').map(val => this.vhAlgorithm.changeAlias(val?.toString().trim().toLowerCase())).filter(val => val?.length > 0);\r\n    if (valArray?.length > 0) {\r\n      // search theo id\r\n      this.salesOrder = this.salesOrder.filter(item => {\r\n        return valArray.some(val => {\r\n          return this.vhAlgorithm.changeAlias(item?.id?.toString())?.includes(val);\r\n        });\r\n      });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * search tn sn phm trong app viethas\r\n   * @example this.search('Sn phm A')\r\n   */\r\n  searchProductApp(value: string) {\r\n    let val: string = this.vhAlgorithm.changeAlias(value.trim().toLowerCase());\r\n    this.listProductApp = this.vhAlgorithm.searchList(val, [...this.listSubProductApp], ['name', 'barcode', 'item_code']);\r\n  }\r\n\r\n  /**\r\n   * bt sk thay i tab xem trng thi n\r\n   * @param event\r\n   */\r\n  segmentChanged(event) { // sau ny s filter theo trng thi qua hm ny\r\n    const selectedStatus = this.list_status_bill[event].value;\r\n\r\n    if (selectedStatus === 'all') {\r\n      this.salesOrder = this.salesSubOrder;\r\n    } else if (selectedStatus === 'RETURNED') {\r\n      this.salesOrder = this.salesSubOrder.filter(\r\n        item => item.status === 'COMPLETED' && item.cancel_reason?.trim()\r\n      );\r\n    } else if (selectedStatus === 'COMPLETED') {\r\n      this.salesOrder = this.salesSubOrder.filter(\r\n        item => item.status === 'COMPLETED' && !item.cancel_reason?.trim()\r\n      );\r\n    } else {\r\n      this.salesOrder = this.salesSubOrder.filter(item => item.status === selectedStatus);\r\n    }\r\n  }\r\n\r\n\r\n\r\n  /** Map cha s lng n hng theo trng thi */\r\n  orderCountByStatus: any = {\r\n    'All': 0,\r\n    'UNPAID': 0,\r\n    'ON_HOLD': 0,\r\n    'AWAITING_SHIPMENT': 0,\r\n    'AWAITING_COLLECTION': 0,\r\n    'PARTIALLY_SHIPPING': 0,\r\n    'IN_TRANSIT': 0,\r\n    'DELIVERED': 0,\r\n    'COMPLETED': 0,\r\n    'CANCELLED': 0,\r\n    'RETURNED': 0\r\n  };\r\n\r\n  /**\r\n   * m s lng n hng theo trng thi\r\n   * @param orders\r\n   */\r\n  countOrderByStatus(orders) {\r\n    for (const key in this.orderCountByStatus) {\r\n      if (key === 'All') {\r\n        this.orderCountByStatus[key] = orders.length;\r\n      } else if (key === 'RETURNED') {\r\n        this.orderCountByStatus[key] = orders.filter(\r\n          order => order.status === 'COMPLETED' && order.cancel_reason?.trim()\r\n        ).length;\r\n      } else if (key === 'COMPLETED') {\r\n        this.orderCountByStatus[key] = orders.filter(\r\n          order => order.status === 'COMPLETED' && !order.cancel_reason?.trim()\r\n        ).length;\r\n      } else {\r\n        this.orderCountByStatus[key] = orders.filter(order => order.status === key).length;\r\n      }\r\n    }\r\n  }\r\n\r\n\r\n\r\n  /**\r\n   * tr v trang qun l tiktok\r\n   * @example this.goBack()\r\n   */\r\n  goBack() {\r\n    this.router.navigate(['/sales/dashboard/manage/ecommerce/tiktok'], {\r\n      state: {\r\n        dataRestore: { dataRestore: this.dataRestore }\r\n      }\r\n    });\r\n  }\r\n  /**\r\n   * get ha n tiktok\r\n   * @example this.showReport()\r\n   */\r\n  showReport() {\r\n    this.load_status = true;\r\n    this.salesOrder = [];\r\n    this.vhComponent.showLoading(\"\", \"transparent-loading\").then(() => {\r\n      this.vhEcommerce.getSalesOrderListTiktok(new Date(this.date[0].setHours(0, 0, 0)),\r\n        new Date(this.date[1].setHours(23, 59, 59)),\r\n        this.infoShop.shop_cipher, this.infoShop.app_key,\r\n        this.infoShop.access_token.toString(), this.infoShop._id.toString())\r\n        .then((result: any) => {\r\n          this.vhComponent.hideLoading(0);\r\n          // this.salesOrder = result.map(item => { return { ...item, id_shop: this.infoShop._id, shop_name: shop.account }})\r\n          this.salesSubOrder = this.processOrders(result);\r\n          console.log(this.salesSubOrder);\r\n          this.salesOrder = this.salesSubOrder;\r\n          this.countOrderByStatus(this.salesOrder);\r\n          this.segmentChanged(this.selectedIndex);\r\n        }, (error => this.vhComponent.hideLoading(0))\r\n        ).catch(err => this.vhComponent.hideLoading(0));\r\n    });\r\n\r\n  }\r\n\r\n\r\n  /**\r\n   * tnh li tng tin\r\n   * @param bill\r\n   * @returns number\r\n   * @example let total = this.calculateTotal(bill)\r\n   */\r\n  calculateTotal(bill) {\r\n    return +bill['price'] - bill['voucher'] + bill['shipping_fee'];\r\n  }\r\n\r\n  ngAfterViewChecked() {\r\n    if (document.querySelector(\"#order-status-tiki\") && document.querySelector(\".ant-tabs-tab\") && document.querySelector(\".ant-table-thead\") && document.querySelector(\".order-status-tiki-header\") && document.querySelector(\".ant-table-pagination\")) {\r\n      this.heightScroll = document.querySelector(\"#order-status-tiki\").clientHeight - document.querySelector(\".ant-table-thead\").clientHeight\r\n        - document.querySelector(\".order-status-tiki-header\").clientHeight - document.querySelector(\".ant-tabs-tab\").clientHeight - 90 + \"px\";\r\n    }\r\n    if (document.getElementById(\"order-status-tiki\"))\r\n      this.widthScroll = document.getElementById(\"order-status-tiki\").clientWidth + \"px\";\r\n    this.cdRef.detectChanges();\r\n  }\r\n\r\n\r\n  gotoDetail(bill) {\r\n\r\n    // this.router.navigate(['/sales/dashboard/manage/ecommerce/lazada/order-status/detail'], { state: { bill: bill, dataRestore: { salesOrder: this.salesOrder, searchValue: this.searchValue, id_shop_selected: this.infoShop._id, date: this.date, salesSubOrder: this.salesSubOrder, selectedIndex: this.selectedIndex } } })\r\n  }\r\n\r\n  processOrders(orders) {\r\n    // .filter(e => e.cqt_status != 3)\r\n    return orders.map(order => {\r\n      const lineItemMap = {};\r\n\r\n      order.line_items.forEach(item => {\r\n        const key = `${item.product_id}_${item.sku_id}_${item.sale_price}`;\r\n        item.price = Number(item.sale_price);\r\n\r\n        if (!lineItemMap[key]) {\r\n          lineItemMap[key] = {\r\n            ...item,\r\n            quantity: 1,\r\n            total_price: item.price,\r\n          };\r\n        } else {\r\n          lineItemMap[key].quantity += 1;\r\n          lineItemMap[key].total_price += item.price;\r\n        }\r\n\r\n      });\r\n      order.cqt_status = order.cqt_status ? order.cqt_status : 1;\r\n\r\n      order.checked = order.cqt_status == 1 || !order.cqt_status ? true : false;\r\n      order.create_at = new Date(order.create_time * 1000);\r\n      return {\r\n        ...order,\r\n        order_details: Object.values(lineItemMap),\r\n      };\r\n    });\r\n  }\r\n\r\n\r\n  /** hm sort cho cc ct */\r\n  dateCol = false;\r\n  bill_codeCol = false;\r\n  partner_nameCol = false;\r\n  payment_nameCol = false;\r\n  statusCol = false;\r\n  sum_priceCol = false;\r\n  /** Hm thc hin sp xp theo collection\r\n   *\r\n   * @param colName       // tn ct mun sp xp\r\n   */\r\n  sortTable(colName) {\r\n    switch (colName) {\r\n      case 'date':\r\n        if (this.dateCol) {\r\n          this.salesOrder = this.vhAlgorithm.sortDatebyASC([...this.salesOrder], colName);\r\n        } else {\r\n          this.salesOrder = this.vhAlgorithm.sortDatebyDESC([...this.salesOrder], colName);\r\n        }\r\n        break;\r\n      case 'status': if (this.statusCol) {\r\n        this.salesOrder = this.vhAlgorithm.sortNumberbyASC([...this.salesOrder], 'cqt_status');\r\n      } else {\r\n        this.salesOrder = this.vhAlgorithm.sortNumberbyDESC([...this.salesOrder], 'cqt_status');\r\n      }\r\n        console.log(this.salesOrder);\r\n        break;\r\n    }\r\n  }\r\n\r\n\r\n  allChecked = true;\r\n  indeterminate = true;\r\n\r\n\r\n\r\n  /**\r\n   * Check tt c\r\n   * @param value\r\n   */\r\n  checkAll(value: boolean): void {\r\n    this.salesOrder.forEach(data => {\r\n      if (!data.disabled) {\r\n        data.checked = value;\r\n      }\r\n    });\r\n    this.refreshStatus();\r\n  }\r\n\r\n\r\n\r\n  /**\r\n   * Check 1 ci\r\n   */\r\n  refreshStatus(): void {\r\n    const validData = this.salesOrder.filter(value => !value.disabled);\r\n    const allChecked = validData.length > 0 && validData.every(value => value.checked === true);\r\n    const allUnChecked = validData.every(value => !value.checked);\r\n    this.allChecked = allChecked;\r\n    this.indeterminate = !allChecked && !allUnChecked;\r\n  }\r\n\r\n  async sendCQT() {\r\n    let bill_checked = this.salesOrder.filter(item => item.checked).filter((data: any) => !data.cqt_status || data.cqt_status == 1); // lc ra nhng ha n  chn v cha gi ln CQT\r\n\r\n    if (bill_checked.length == 0) {\r\n      this.vhComponent.alertMessageDesktop(\"error\", this.lang.translate(\"Vui lng chn ha n cn gi CQT\"));\r\n      return;\r\n    }\r\n\r\n    // Nu c bt cqt_vat_ecommerce_use_latest_order_update_time th sp xp theo thi gian cp nht trng thi gn nht ca n hng t sn,\r\n    // c gi trc, mi gi sau\r\n    if (this.cqt_vat_ecommerce_use_latest_order_update_time) {\r\n      bill_checked = bill_checked.sort((a, b) => a.update_time - b.update_time);\r\n    }\r\n\r\n    const batchSize = 1;\r\n    const totalBatches = Math.ceil(bill_checked.length / batchSize);\r\n    if (!bill_checked.length) {\r\n      this.vhComponent.alertMessageDesktop('error', this.lang.translate(\"Please select at least one invoice\"));\r\n      return;\r\n\r\n    }\r\n    await this.vhComponent.showLoadingNotDuration(this.lang.translate(\"Sending...\"));\r\n    for (let i = 0; i < bill_checked.length; i += batchSize) {\r\n      // to mi ln 5 request gi ha n\r\n      const batch = bill_checked.slice(i, i + batchSize);\r\n      const currentBatchIndex = Math.floor(i / batchSize) + 1;\r\n      const promises = batch.map(bill => {\r\n        return this.signatureManual(bill);\r\n\r\n\r\n      });\r\n\r\n      try {\r\n        const results = await this.vhQuery.asyncPromiseAll(promises);\r\n        console.log(`Batch ${i / batchSize + 1}:`, results);\r\n        if (currentBatchIndex == totalBatches) {\r\n          this.vhComponent.hideLoading();\r\n\r\n        }\r\n      } catch (error) {\r\n        // trng hp 1 vi n b li ko gi dc\r\n        if (currentBatchIndex == totalBatches) {\r\n          this.vhComponent.hideLoading();\r\n\r\n        }\r\n        console.error(`Error in batch ${i / batchSize + 1}:`, error);\r\n      }\r\n\r\n\r\n    }\r\n\r\n  }\r\n\r\n  /**\r\n   * hm ny k ha n ln cqt\r\n   * @param invoice\r\n   */\r\n  signatureManual(invoice) {\r\n    return new Promise((resolve, reject) => {\r\n\r\n      // ly ra chi nhnh hin ti\r\n      let currentBranch = this.vhQuerySales.getlocalBranch(this.vhQuerySales.getDefaultBranch()._id);\r\n\r\n      console.log('currentBranch', currentBranch);\r\n      // trng hp cha c to kt ni ha n in t\r\n      if (!currentBranch.einvoices?.length) {\r\n        this.vhComponent.alertMessageDesktop(\"error\", this.lang.translate(\"Please connect e-invoice for this branch\"));\r\n        resolve(true);\r\n        return;\r\n      }\r\n      // trng hp ch c 1 kt ni ha n in t th to thng lun\r\n      if (currentBranch.einvoices.length && currentBranch.einvoices.length == 1) {\r\n        // trng hp ncc ha n in t l M-invoice\r\n        if (currentBranch.einvoices[0].invoice_provider == 'M-invoice') {\r\n\r\n          if (!currentBranch.einvoices[0].invoiceSeries.length) {\r\n            this.vhComponent.alertMessageDesktop(\"error\", this.lang.translate(\"Please connect e-invoice for this branch\"));\r\n            resolve(true);\r\n            return;\r\n          }\r\n          invoice.isLoading = true;\r\n          this.changeTiktok_toInvoice_byMinvoice(invoice, currentBranch.einvoices[0].invoiceSeries[0])\r\n            .then((rsp: any) => {\r\n              console.log('changeTiktok_toInvoice_byMinvoice', rsp);\r\n              if (rsp.vcode == 0) {\r\n                // K t ng ngay khi gi ha n ln C quan thu\r\n                if (this.cqt_invoice_auto_sign) {\r\n                  this.vhEinvoice.saveInvoice_Sign_byMinvoice(currentBranch.taxcode, currentBranch.einvoices[0].token, 1, rsp.data)\r\n                    .then((res: any) => {\r\n                      console.log(res);\r\n                      invoice.isLoading = false;\r\n                      if (res.code == '00') {\r\n                        invoice.cqt_status = 3;\r\n                        this.vhComponent.alertMessageDesktop(\"success\", this.lang.translate('Update invoice to CQT successfully'));\r\n                        this.vhEcommerce.updateSalesOrderTiktok_byFile([invoice.id.toString()], { cqt_status: 3 }, this.infoShop.shop_cipher, this.infoShop.app_key, this.infoShop.access_token, this.infoShop._id)\r\n                          .then((array: any) => {\r\n                            console.log('updateSalesOrderTiktok_byFile', array);\r\n                            resolve(true);\r\n                          }, error => {\r\n                            console.log(error);\r\n                          });\r\n                      }\r\n                      else if (res.code == '9999') {\r\n                        resolve(true);\r\n                        this.vhComponent.alertMessageDesktop(\"error\", this.lang.translate(\"Vui lng kim tra li thng tin ha n y ln CQT cha ph hp\"));\r\n                      }\r\n                      else if (res.code == '296') {\r\n                        resolve(true);\r\n                        this.vhComponent.alertMessageDesktop(\"error\", this.lang.translate(\"Khng th gi nhng ha n c ngy lp ha n nh hn ngy lp ha n cui cng  gi ln C quan thu. <br> Nu cn gi nhng ha n c hn, bn cn tt cu hnh 'S dng thi gian cp nht trng thi gn nht ca n hng t sn  thit lp ngy lp ha n' trong Ci t\"), 4000);\r\n                      }\r\n                      else {\r\n                        resolve(true);\r\n                        this.vhComponent.alertMessageDesktop(\"error\", this.lang.translate(res.message));\r\n                      }\r\n                    }, (error: any) => {\r\n                      invoice.isLoading = true;\r\n                      this.vhComponent.alertMessageDesktop(\"error\", this.lang.translate(\"C li xy ra khi khi to ha n y ln CQT\"));\r\n                      console.log('error', error);\r\n                    });\r\n                }\r\n                // KHNG K t ng ngay khi gi ha n ln C quan thu\r\n                else {\r\n                  this.vhEinvoice.saveInvoice_noSign_byMinvoice(currentBranch.taxcode, currentBranch.einvoices[0].token, 1, rsp.data)\r\n                    .then((res: any) => {\r\n                      console.log(res);\r\n                      invoice.isLoading = false;\r\n                      if (res.code == '00') {\r\n                        invoice.cqt_status = 2;\r\n                        this.vhComponent.alertMessageDesktop(\"success\", this.lang.translate('Update invoice to CQT successfully'));\r\n                        this.vhEcommerce.updateSalesOrderTiktok_byFile([invoice.id.toString()], { cqt_status: 2 }, this.infoShop.shop_cipher, this.infoShop.app_key, this.infoShop.access_token, this.infoShop._id)\r\n                          .then((array: any) => {\r\n                            console.log('updateSalesOrderTiktok_byFile', array);\r\n                            resolve(true);\r\n                          }, error => {\r\n                            console.log(error);\r\n                          });\r\n                      }\r\n                      else if (res.code == '9999') {\r\n                        resolve(true);\r\n                        this.vhComponent.alertMessageDesktop(\"error\", this.lang.translate(\"Vui lng kim tra li thng tin ha n y ln CQT cha ph hp\"));\r\n                      }\r\n                      else if (res.code == '296') {\r\n                        resolve(true);\r\n                        this.vhComponent.alertMessageDesktop(\"error\", this.lang.translate(\"Khng th gi nhng ha n c ngy lp ha n nh hn ngy lp ha n cui cng  gi ln C quan thu. <br> Nu cn gi nhng ha n c hn, bn cn tt cu hnh 'S dng thi gian cp nht trng thi gn nht ca n hng t sn  thit lp ngy lp ha n' trong Ci t\"), 4000);\r\n                      }\r\n                      else {\r\n                        resolve(true);\r\n                        this.vhComponent.alertMessageDesktop(\"error\", this.lang.translate(res.message));\r\n                      }\r\n                    }, (error: any) => {\r\n                      invoice.isLoading = true;\r\n                      this.vhComponent.alertMessageDesktop(\"error\", this.lang.translate(\"C li xy ra khi khi to ha n y ln CQT\"));\r\n                      console.log('error', error);\r\n                    });\r\n                }\r\n              }\r\n              else {\r\n                invoice.isLoading = true;\r\n                this.vhComponent.alertMessageDesktop(\"error\", this.lang.translate(\"C li xy ra khi khi to ha n y ln CQT\"));\r\n              }\r\n            }, (error: any) => {\r\n              this.vhComponent.alertMessageDesktop(\"error\", this.lang.translate(\"C li xy ra khi khi to ha n y ln CQT\"));\r\n              invoice.isLoading = true;\r\n              console.log('error', error);\r\n            });\r\n\r\n        }\r\n      }\r\n      // trng hp ch c 2 kt ni ha n in t tr ln th hin modal chn ncc  ha n in t\r\n      if (currentBranch.einvoices.length && currentBranch.einvoices.length > 1) {\r\n\r\n      }\r\n    });\r\n  }\r\n\r\n  /** Gi ha n ln C quan thu km ph vn chuyn */\r\n  cqt_submit_invoice_with_shipping_fee = this.vhQuerySales.getLocalAppSettingNameBranch('permission_branch').cqt_submit_invoice_with_shipping_fee;\r\n  /** Gi ha n ln C quan thu km ph giao dch/ph sn */\r\n  cqt_submit_invoice_with_ecommerce_fee = this.vhQuerySales.getLocalAppSettingNameBranch('permission_branch').cqt_submit_invoice_with_ecommerce_fee;\r\n  /** Gi bn hng ha, dch v... trn sn  bao gm thu VAT */\r\n  cqt_vat_ecommerce_already_Included = this.vhQuerySales.getLocalAppSettingNameBranch('permission_branch').cqt_vat_ecommerce_already_Included;\r\n  /** % thu VAT */\r\n  cqt_vat_ecommerce_rate = this.vhQuerySales.getLocalAppSettingNameBranch('permission_branch').cqt_vat_ecommerce_rate;\r\n  /** K t ng ngay khi gi ha n ln C quan thu */\r\n  cqt_invoice_auto_sign = this.vhQuerySales.getLocalAppSettingNameBranch('permission_branch').cqt_invoice_auto_sign;\r\n  /** Gi bn hng ha, dch v trn sn  bao gm VAT, tnh theo VAT hng ha, dch v lin kt */\r\n  cqt_vat_ecommerce_by_linked_product = this.vhQuerySales.getLocalAppSettingNameBranch('permission_branch').cqt_vat_ecommerce_by_linked_product;\r\n  /** Hng khuyn mi c php xut 0. Nu l true th tchat2 s c cc ct = 0, ma_thue vn l s bnh thng */\r\n  cqt_vat_ecommerce_allow_promotional_items_zero_price = this.vhQuerySales.getLocalAppSettingNameBranch('permission_branch').cqt_vat_ecommerce_allow_promotional_items_zero_price;\r\n  /** Xut ring chit khu/gim gi ca sn phm thnh 1 dng ring khi gi CQT */\r\n  cqt_vat_ecommerce_separate_discount_line = this.vhQuerySales.getLocalAppSettingNameBranch('permission_branch').cqt_vat_ecommerce_separate_discount_line;\r\n  /** Vn gi hng xut bn cho sn phm tng/khuyn mi khi gi CQT */\r\n  cqt_vat_ecommerce_keep_promotional_items_as_sold = this.vhQuerySales.getLocalAppSettingNameBranch('permission_branch').cqt_vat_ecommerce_keep_promotional_items_as_sold;\r\n  /** S dng thi gian cp nht trng thi gn nht ca n hng t sn  thit lp ngy lp ha n */\r\n  cqt_vat_ecommerce_use_latest_order_update_time = this.vhQuerySales.getLocalAppSettingNameBranch('permission_branch').cqt_vat_ecommerce_use_latest_order_update_time;\r\n  /** Xut ha n t sn vi thng tin ngi mua km theo tn sn v m n hng */\r\n  cqt_vat_ecommerce_buyer_info_with_platform_and_so_benh_an = this.vhQuerySales.getLocalAppSettingNameBranch('permission_branch').cqt_vat_ecommerce_buyer_info_with_platform_and_so_benh_an;\r\n  /** Xut ha n t sn vi thng tin thanh ton mc nh l 'Chuyn khon' */\r\n  cqt_vat_ecommerce_default_payment_method_chuyen_khoan: boolean = this.vhQuerySales.getLocalAppSettingNameBranch('permission_branch').cqt_vat_ecommerce_default_payment_method_chuyen_khoan;\r\n  /** M sn phm khi gi CQT l m vch sn phm */\r\n  cqt_vat_ecommerce_item_code_is_barcode = this.vhQuerySales.getLocalAppSettingNameBranch('permission_branch').cqt_vat_ecommerce_item_code_is_barcode;\r\n  /** Gi hng ha, dch v... gi CQT l gi bn  gim */\r\n  cqt_vat_ecommerce_item_price_is_discounted = this.vhQuerySales.getLocalAppSettingNameBranch('permission_branch').cqt_vat_ecommerce_item_price_is_discounted;\r\n\r\n\r\n\r\n  /**\r\n * @example\r\n * this.vhQuerySales.changeTiktok_toInvoice_byMinvoice(order, invoiceSeries)\r\n    .then((rsp) => {\r\n      //-----------your code here-----------\r\n    }, (error: any) => {\r\n        console.log('error', error);\r\n    });\r\n\r\n  * @param order : ha n ly t tiktok v\r\n  * @param invoiceSeries : k hiu ha n\r\n  * @returns Promise => {vcode, msg, data(array)}\r\n   *\r\n   *\r\n   * Cu trc cn x l 3 ci:\r\n   *  - Danh sch ha n chi tit:\r\n   *    + Check trng hp combo\r\n   *  - Ph vn chuyn\r\n   *  - Chit khu thng mi\r\n   *\r\n   *\r\n   * Ghi ch:\r\n   *  - Trng hp c bt cqt_vat_ecommerce_already_Included, th phi tnh li Gi  total sau khi p thu (thu t phn ci t ca app mnh) v Chit khu l khng thay i.\r\n   *  - tchat2 v tchat3 th discountAmount v discountPercentage s = 0\r\n   *  - Chit khu thng mi th Thu = 0\r\n   *  - Combo s khng c trng hp tt c cc sn phm bn trong c gi = 0 ( bt khi lin kt sn phm) nn c th b qua trng hp ny\r\n   *  - i vi combo lin kt, Trng hp cqt_vat_ecommerce_by_linked_product th bt  combo nhng vn gi code  invoice_detail cha  logic khng b thay i. Trng hp cqt_vat_ecommerce_already_Included th bt  invoice_detail cha, khng cn bt  combo na, v khi chia ra t l vn s m bo do  tnh  cha\r\n  */\r\n  public async changeTiktok_toInvoice_byMinvoice(order: any, invoiceSeries: string) {\r\n    console.log('changeTiktok_toInvoice_byMinvoice', order);\r\n    return new Promise(async (resolve, reject) => {\r\n      try {\r\n\r\n        // Tch phn chi tit ha n\r\n        // ca tiktok ra, v gom nhng chi tit ha n ging nhau li\r\n        // Cn cng dn seller_discount v platform_discount theo quantity\r\n        let order_details: any = [...order.line_items];\r\n        for (let i = 0; i < order_details.length; i++) if (order_details[i].quantity == undefined) order_details[i].quantity = 1;;\r\n        for (let i = 0; i < order_details.length; i++) {\r\n          if (order_details[i]) {\r\n            let quantity = order_details[i].quantity;\r\n            let seller_discount = order_details[i].seller_discount ? Number(order_details[i].seller_discount) : 0;\r\n            let platform_discount = order_details[i].platform_discount ? Number(order_details[i].platform_discount) : 0;\r\n            for (let j = i + 1; j < order_details.length; j++) {\r\n              if (order_details[j] && order_details[i].sku_id === order_details[j].sku_id) {\r\n                if ((order_details[i].original_price === order_details[j].original_price) || (order_details[i].sale_price === order_details[j].sale_price)\r\n                  || (order_details[i].seller_discount === order_details[j].seller_discount) || (order_details[i].platform_discount === order_details[j].platform_discount)) {\r\n                  quantity = quantity + order_details[j].quantity;\r\n                  seller_discount = seller_discount + Number(order_details[j].seller_discount) * order_details[j].quantity;\r\n                  platform_discount = platform_discount + Number(order_details[j].platform_discount) * order_details[j].quantity;\r\n                  order_details[j] = null;\r\n                }\r\n              }\r\n            }\r\n            order_details[i].quantity = quantity;\r\n            order_details[i].seller_discount = seller_discount;\r\n            order_details[i].platform_discount = platform_discount;\r\n          }\r\n        }\r\n        order_details = order_details.filter((e: any) => e != null);\r\n\r\n\r\n\r\n        /* ---------------------------------------------------------- Khi to invoice ---------------------------------------------------------- */\r\n\r\n        let invoice: any = {\r\n          inv_invoiceSeries: invoiceSeries,\r\n          inv_invoiceIssuedDate: this.vhAlgorithm.formatDateToString(new Date()),\r\n          inv_currencyCode: \"VND\",\r\n          inv_exchangeRate: 1,\r\n          inv_discountAmount: 0,\r\n          inv_vatAmount: 0,\r\n          inv_TotalAmountWithoutVat: 0,\r\n          inv_TotalAmount: 0,\r\n          key_api: order.id,\r\n          so_benh_an: order.id,// dng  tra li trn minvoice\r\n        };\r\n\r\n\r\n\r\n        /* --------- X l cqt_vat_ecommerce_use_latest_order_update_time th ly ngy cp nht trng thi gn nht ca n hng t sn --------- */\r\n        if (this.cqt_vat_ecommerce_use_latest_order_update_time) {\r\n          invoice.inv_invoiceIssuedDate = this.vhAlgorithm.formatDateToString(new Date(order.update_time * 1000));// *1000  chuyn t giy sang mili giy\r\n        }\r\n\r\n\r\n\r\n        /* --------------------------------------------------------- Thng tin ngi mua -------------------------------------------------------- */\r\n\r\n        /** Tn ngi mua mc nh nu khng c thng tin trong ha n */\r\n        let buyerDisplayNameDefault = 'Ngi mua khng ly ha n';\r\n        /* ------ X l cqt_vat_ecommerce_buyer_info_with_platform_and_so_benh_an --------------------------------------------------------------- */\r\n        // Nu bt th s thnh: Tn sn - Ngi mua khng ly ha n - M n hng\r\n        if (this.cqt_vat_ecommerce_buyer_info_with_platform_and_so_benh_an) {\r\n          buyerDisplayNameDefault = `Tiktok - ${buyerDisplayNameDefault} - ${invoice.so_benh_an}`;\r\n        }\r\n\r\n        /* ------ X l cqt_vat_ecommerce_default_payment_method_chuyen_khoan ------------------------------------------------------------------- */\r\n        // Nu c bt th lun l 'Chuyn khon', nu khng th s ly theo ca n hng\r\n        if (this.cqt_vat_ecommerce_default_payment_method_chuyen_khoan) {\r\n          invoice.inv_paymentMethodName = 'Chuyn khon';\r\n        }\r\n        else {\r\n          invoice.inv_paymentMethodName = order.payment_method_name == 'Cash on delivery' ? 'Tin mt' : 'Chuyn khon';\r\n        }\r\n\r\n        invoice.inv_buyerDisplayName = order.tax_buyerDisplayName ? order.tax_buyerDisplayName : buyerDisplayNameDefault;\r\n        invoice.inv_buyerLegalName = order.tax_buyerLegalName ? order.tax_buyerLegalName : '';\r\n        invoice.inv_buyerTaxCode = order.tax_buyerTaxCode ? order.tax_buyerTaxCode : '';\r\n        invoice.inv_buyerAddressLine = order.tax_buyerAddressLine ? order.tax_buyerAddressLine : '';\r\n        invoice.inv_buyerEmail = order.tax_buyerEmail ? order.tax_buyerEmail : '';\r\n\r\n\r\n\r\n        /* ------------------------------------------------------ Tnh ton invoice details ----------------------------------------------------- */\r\n\r\n        /** Thu sn */\r\n        let platformTax = Number(order.payment.tax);\r\n        /** Thu ca ha n (ly t sn / t ci t) */\r\n        let billTax = 0;\r\n        // nu bt cqt_vat_ecommerce_already_Included th ly thu t ci t\r\n        if (this.cqt_vat_ecommerce_already_Included) {\r\n          billTax = this.cqt_vat_ecommerce_rate || 0;\r\n        }\r\n        else {\r\n          billTax = platformTax;\r\n        }\r\n\r\n        /**------------To chi tit ha n thu----------------- */\r\n        var invoice_details = new Array();\r\n\r\n        for (let i = 0; i < order_details.length; i++) {\r\n          /** Sn phm lin kt vi sn phm ca sn */\r\n          const productLinked = this.findProductLinked(order_details[i]);\r\n          // Khi to chi tit ha n\r\n          let invoice_detail = this.billService.createEInvoiceDetailTemplate();\r\n\r\n          /** n gi */\r\n          let unitPrice = Number(order_details[i].original_price);\r\n          /** Total cha c thu */\r\n          let totalAmountWithoutVat = unitPrice * order_details[i].quantity - Number(order_details[i].seller_discount);\r\n          /** Tnh cht hng ha. Nu inv_TotalAmountWithoutVat = 0 th tchat = 2, nu khng th tchat = 1 */\r\n          const tchat = totalAmountWithoutVat === 0 ? 2 : 1;\r\n          /** Thu ca bill detail ny. Nu c sn phm lin kt v bt setting cqt_vat_ecommerce_by_linked_product th s ly thu t sn phm lin kt, ngc li th vn ly t billTx nh c  */\r\n          const invoiceDetailTax = (this.cqt_vat_ecommerce_by_linked_product && productLinked && productLinked.tax !== undefined) ? productLinked.tax : billTax;\r\n\r\n          // Gn cc gi tr chung\r\n          invoice_detail.tchat = tchat;\r\n          invoice_detail.stt_rec0 = invoice_details.length + 1;\r\n          invoice_detail.inv_itemCode = order_details[i].id;\r\n          invoice_detail.inv_unitCode = 'Ci';\r\n          invoice_detail.inv_quantity = order_details[i].quantity;\r\n          invoice_detail.inv_unitPrice = unitPrice; // Gi bn sn phm trn sn tiktok\r\n          invoice_detail.ma_thue = invoiceDetailTax;\r\n\r\n\r\n          /* ------ X l tchat --------------------------------------------------------------------------- */\r\n          if (tchat === 2) {\r\n            // Gn li tn\r\n            invoice_detail.inv_itemName = 'Hng khuyn mi/hng tng ' + order_details[i].product_name;\r\n            // Tnh li gi tr tr gi (chit khu) ca chi tit ha n trng hp tchat2\r\n            invoice_detail.inv_discountAmount = 0;\r\n\r\n            /* ------ X l cqt_vat_ecommerce_already_Included cqt_vat_ecommerce_by_linked_product --------- */\r\n            if (this.cqt_vat_ecommerce_already_Included || this.cqt_vat_ecommerce_by_linked_product) {\r\n              // Tnh li gi\r\n              invoice_detail.inv_unitPrice = this.billService.calculateNewPriceToUseSettingTax(invoice_detail.inv_unitPrice, invoice_detail.inv_quantity, invoice_detail.inv_discountAmount, invoice_detail.ma_thue, platformTax);\r\n            }\r\n\r\n            /* ------ X l Hng khuyn mi c php xut 0 ----------------------------------------------- */\r\n            // Nu c bt cqt_vat_ecommerce_allow_promotional_items_zero_price v l tchat2 th cn gn li gi = 0,  cc php tnh cho nhng trng khc bn di cng s t tnh = 0\r\n            if (this.cqt_vat_ecommerce_allow_promotional_items_zero_price) {\r\n              invoice_detail.inv_unitPrice = 0;\r\n            }\r\n\r\n            /* ------ X l Vn gi hng xut bn cho sn phm tng/khuyn mi khi gi CQT ------------------ */\r\n            // Nu c bt cqt_vat_ecommerce_keep_promotional_items_as_sold v l tchat2 th s set li nso thnh tchat1, discountAmount v discountPercentage vn l 0\r\n            if (this.cqt_vat_ecommerce_keep_promotional_items_as_sold) {\r\n              // Gn li tchat\r\n              invoice_detail.tchat = 1; // Gn li tchat thnh 1\r\n              // Gn li tn\r\n              invoice_detail.inv_itemName = order_details[i].product_name;\r\n            }\r\n\r\n            // Tr gi (chit khu) tnh theo %\r\n            invoice_detail.inv_discountPercentage = 0;\r\n          }\r\n          else {\r\n            // Gn li tn\r\n            invoice_detail.inv_itemName = order_details[i].product_name;\r\n            // Tr gi (chit khu) ca nh bn hng trn mi chi tit ha n (khng ly ca sn)\r\n            invoice_detail.inv_discountAmount = Number(order_details[i].seller_discount);\r\n\r\n            /* ------ X l Gi hng ha, dch v... gi CQT l gi bn  gim ----------------------------------------- */\r\n            if(this.cqt_vat_ecommerce_item_price_is_discounted) {\r\n              // Gn li thnh gi  gim\r\n              invoice_detail.inv_unitPrice = invoice_detail.inv_unitPrice - invoice_detail.inv_discountAmount / invoice_detail.inv_quantity;\r\n              // Gn li Chit khu = 0\r\n              invoice_detail.inv_discountAmount = 0;\r\n            }\r\n\r\n            /* ------ X l cqt_vat_ecommerce_already_Included cqt_vat_ecommerce_by_linked_product --------- */\r\n            if (this.cqt_vat_ecommerce_already_Included || this.cqt_vat_ecommerce_by_linked_product) {\r\n              // Tnh li gi\r\n              invoice_detail.inv_unitPrice = this.billService.calculateNewPriceToUseSettingTax(invoice_detail.inv_unitPrice, invoice_detail.inv_quantity, invoice_detail.inv_discountAmount, invoice_detail.ma_thue, platformTax);\r\n            }\r\n\r\n            // Tr gi (chit khu) tnh theo %\r\n            invoice_detail.inv_discountPercentage = invoice_detail.inv_discountAmount / (invoice_detail.inv_unitPrice * invoice_detail.inv_quantity) * 100;\r\n          }\r\n\r\n          // Gi cui ( tr tr gi) ca chi tit ha n\r\n          invoice_detail.inv_TotalAmountWithoutVat = invoice_detail.inv_unitPrice * invoice_detail.inv_quantity - invoice_detail.inv_discountAmount;\r\n          // Thu VAT c tnh theo chi tit ha n\r\n          invoice_detail.inv_vatAmount = invoice_detail.inv_TotalAmountWithoutVat * invoice_detail.ma_thue / 100;\r\n          // Tng gi tr hng ha k khai theo chi tit ha n\r\n          invoice_detail.inv_TotalAmount = invoice_detail.inv_TotalAmountWithoutVat + invoice_detail.inv_vatAmount;\r\n\r\n          // Nu nh c lin kt\r\n          if (productLinked) {\r\n            // Nu lin kt vi sn phm\r\n            if (productLinked.type === VhType.PRODUCT) {\r\n              // Thay i inv_itemName v inv_itemCode\r\n              invoice_detail.inv_itemName = productLinked.name;\r\n\r\n              /* ------ X l cqt_vat_ecommerce_item_code_is_barcode ------------------------------------------ */\r\n              if(this.cqt_vat_ecommerce_item_code_is_barcode) {\r\n                const barcode = this.vhQuerySales.getUnit_byRatio(productLinked.units, 1)?.barcode;\r\n                // Nu c barcode th dng barcode\r\n                if(barcode) {\r\n                  invoice_detail.inv_itemCode = barcode;\r\n                }\r\n                // Nu khng c barcode th thng bo\r\n                else {\r\n                  this.vhComponent.hideLoading();\r\n                  this.vhComponent.alertMessageDesktop(\"error\", this.lang.translate(\"Gi ha n ln CQT tht bi. Ha n c cha sn phm cha c m vch, vui lng b sung v th li. Hoc b chn cu hnh M sn phm khi xut ha n l m vch  tip tc\"), 5000);\r\n                  return;\r\n                }\r\n              }\r\n              else {\r\n                invoice_detail.inv_itemCode = productLinked.id_subproduct ? productLinked.id_subproduct : productLinked['_id'];\r\n              }\r\n              \r\n              // Thm vo mng\r\n              invoice_details = this.billService.addEInvoiceDetail(invoice_detail, invoice_details, { cqt_vat_ecommerce_separate_discount_line: this.cqt_vat_ecommerce_separate_discount_line });\r\n            }\r\n            // Nu lin kt vi combo\r\n            else if (productLinked.type === VhType.COMBO) {\r\n              const priceCombo = productLinked.units[0].price;\r\n              if (priceCombo == 0) {\r\n                const errorZeroPriceComboMessage = this.lang.translate(\"Unable to issue the invoice because a linked combo product has a price of 0\", { invoice: order.id });\r\n                this.vhComponent.hideLoading();\r\n                this.vhComponent.alertMessageDesktop(\"error\", errorZeroPriceComboMessage);\r\n                return;\r\n              }\r\n\r\n              // loop qua combo ri tnh li chi tit ha n\r\n              for (let j = 0; j < productLinked.combos.length; j++) {\r\n                const combo = productLinked.combos[j];\r\n                // Khi to chi tit ha n\r\n                let combo_detail = this.billService.createEInvoiceDetailTemplate();\r\n\r\n                /** T l phn trm ca gi sn phm v tng gi combo */\r\n                const percentRate = (combo.price * combo.quantity) / priceCombo;\r\n                /** Tnh cht hng ha. Nu inv_TotalAmountWithoutVat = 0 th tchat = 2, nu khng th tchat = 1 */\r\n                const tchatCombo = (!percentRate || combo.price == 0 || invoice_detail.inv_TotalAmountWithoutVat * percentRate == 0) ? 2 : 1;\r\n                /** Sn phm trong combo, get li  ly tax */\r\n                let detailproduct = this.vhQuerySales.getlocalDetailProduct(combo.id_subproduct ? combo.id_subproduct : combo.id_product);\r\n                /** Thu ca bill detail ny. Nu c sn phm lin kt v bt setting cqt_vat_ecommerce_by_linked_product th s ly thu t sn phm lin kt, ngc li th vn ly t billTx nh c  */\r\n                const invoiceDetailComboTax = (this.cqt_vat_ecommerce_by_linked_product && detailproduct && detailproduct.tax !== undefined) ? detailproduct.tax : invoice_detail.ma_thue;\r\n                /** n gi */\r\n                const unitPrice = ((invoice_detail.inv_TotalAmountWithoutVat + invoice_detail.inv_discountAmount) * percentRate) / (combo.quantity * invoice_detail.inv_quantity);\r\n\r\n                // Gn cc gi tr chung\r\n                combo_detail.tchat = tchatCombo;\r\n                combo_detail.stt_rec0 = invoice_details.length + 1;\r\n                combo_detail.inv_unitCode = 'Ci';\r\n                combo_detail.inv_quantity = combo.quantity * invoice_detail.inv_quantity;\r\n                combo_detail.inv_unitPrice = unitPrice; // Gi gc bn sn phm trn sn shopee\r\n                combo_detail.ma_thue = invoiceDetailComboTax;\r\n\r\n\r\n                /* ------ X l cqt_vat_ecommerce_item_code_is_barcode ------------------------------------------ */\r\n                if(this.cqt_vat_ecommerce_item_code_is_barcode) {\r\n                  const barcode = this.vhQuerySales.getUnit_byRatio(combo.units, combo.ratio)?.barcode;\r\n                  // Nu c barcode th dng barcode\r\n                  if(barcode) {\r\n                    combo_detail.inv_itemCode = barcode;\r\n                  }\r\n                  // Nu khng c barcode th thng bo\r\n                  else {\r\n                    this.vhComponent.hideLoading();\r\n                    this.vhComponent.alertMessageDesktop(\"error\", this.lang.translate(\"Gi ha n ln CQT tht bi. Ha n c cha sn phm cha c m vch, vui lng b sung v th li. Hoc b chn cu hnh M sn phm khi xut ha n l m vch  tip tc\"), 5000);\r\n                    return;\r\n                  }\r\n                }\r\n                else {\r\n                  combo_detail.inv_itemCode = combo.id_subproduct ? combo.id_subproduct : combo.id_product;\r\n                }\r\n\r\n\r\n                /* ------ X l tchat --------------------------------------------------------------------------- */\r\n                if (tchatCombo === 2) {\r\n                  // Gn li tn\r\n                  combo_detail.inv_itemName = 'Hng khuyn mi/hng tng ' + combo.name;\r\n                  // Tnh li gi tr tr gi (chit khu) ca chi tit ha n trng hp tchat2\r\n                  combo_detail.inv_discountAmount = 0;\r\n\r\n                  /* ------ X l cqt_vat_ecommerce_by_linked_product --------- */\r\n                  if (this.cqt_vat_ecommerce_by_linked_product) {\r\n                    // Tnh li gi\r\n                    combo_detail.inv_unitPrice = this.billService.calculateNewPriceToUseSettingTax(combo_detail.inv_unitPrice, combo_detail.inv_quantity, combo_detail.inv_discountAmount, combo_detail.ma_thue, platformTax);\r\n                  }\r\n\r\n                  /* ------ X l Hng khuyn mi c php xut 0 ----------------------------------------------- */\r\n                  // Nu c bt cqt_vat_ecommerce_allow_promotional_items_zero_price v l tchat2 th cn gn li gi = 0,  cc php tnh cho nhng trng khc bn di cng s t tnh = 0\r\n                  if (this.cqt_vat_ecommerce_allow_promotional_items_zero_price) {\r\n                    combo_detail.inv_unitPrice = 0;\r\n                  }\r\n\r\n                  /* ------ X l Vn gi hng xut bn cho sn phm tng/khuyn mi khi gi CQT ------------------ */\r\n                  // Nu c bt cqt_vat_ecommerce_keep_promotional_items_as_sold v l tchat2 th s set li nso thnh tchat1, discountAmount v discountPercentage vn l 0\r\n                  if (this.cqt_vat_ecommerce_keep_promotional_items_as_sold) {\r\n                    // Gn li tchat\r\n                    combo_detail.tchat = 1; // Gn li tchat thnh 1\r\n                    // Gn li tn\r\n                    combo_detail.inv_itemName = combo.name;\r\n                  }\r\n\r\n                  // Tr gi (chit khu) tnh theo %\r\n                  combo_detail.inv_discountPercentage = 0;\r\n                }\r\n                else {\r\n                  // Gn li tn\r\n                  combo_detail.inv_itemName = combo.name;\r\n                  // Tr gi (chit khu) ca nh bn hng trn mi chi tit ha n = seller_discount + shopee_discount\r\n                  combo_detail.inv_discountAmount = this.billService.roundTo4Decimal(invoice_detail.inv_discountAmount * percentRate);\r\n\r\n                  /* ------ X l Gi hng ha, dch v... gi CQT l gi bn  gim ----------------------------------------- */\r\n                  if(this.cqt_vat_ecommerce_item_price_is_discounted) {\r\n                    // Gn li thnh gi  gim\r\n                    combo_detail.inv_unitPrice = combo_detail.inv_unitPrice - combo_detail.inv_discountAmount / combo_detail.inv_quantity;\r\n                    // Gn li Chit khu = 0\r\n                    combo_detail.inv_discountAmount = 0;\r\n                  }\r\n\r\n                  /* ------ X l cqt_vat_ecommerce_by_linked_product --------- */\r\n                  if (this.cqt_vat_ecommerce_by_linked_product) {\r\n                    // Tnh li gi\r\n                    combo_detail.inv_unitPrice = this.billService.calculateNewPriceToUseSettingTax(combo_detail.inv_unitPrice, combo_detail.inv_quantity, combo_detail.inv_discountAmount, combo_detail.ma_thue, platformTax);\r\n                  }\r\n\r\n                  // Tr gi (chit khu) tnh theo %\r\n                  combo_detail.inv_discountPercentage = combo_detail.inv_discountAmount / (combo_detail.inv_unitPrice * combo_detail.inv_quantity) * 100;\r\n                }\r\n\r\n                // Gi cui ( tr tr gi) ca chi tit ha n\r\n                combo_detail.inv_TotalAmountWithoutVat = combo_detail.inv_unitPrice * combo_detail.inv_quantity - combo_detail.inv_discountAmount;\r\n                // Thu VAT c tnh theo chi tit ha n\r\n                combo_detail.inv_vatAmount = combo_detail.inv_TotalAmountWithoutVat * combo_detail.ma_thue / 100;\r\n                // Tng gi tr hng ha k khai theo chi tit ha n\r\n                combo_detail.inv_TotalAmount = combo_detail.inv_TotalAmountWithoutVat + combo_detail.inv_vatAmount;\r\n\r\n                // Thm vo mng\r\n                invoice_details = this.billService.addEInvoiceDetail(combo_detail, invoice_details, { cqt_vat_ecommerce_separate_discount_line: this.cqt_vat_ecommerce_separate_discount_line });\r\n              }\r\n            }\r\n          }\r\n          else {\r\n            invoice_details = this.billService.addEInvoiceDetail(invoice_detail, invoice_details, { cqt_vat_ecommerce_separate_discount_line: this.cqt_vat_ecommerce_separate_discount_line });\r\n          }\r\n        }\r\n\r\n\r\n\r\n        /* -------------------------- Tnh chi ph vn chuyn, nu c th sinh ra mt chi tit ha n \"Ph vn chuyn\" ------------------------- */\r\n\r\n        //Ph ship ngi mua phi tr\r\n        let shipping_paid_by_buyer = 0;\r\n        //Ph ship ca ngi mua c tr gi (ngi bn + tiktok)\r\n        let shipping_discount = 0;\r\n        if (Number(order.payment.original_shipping_fee) > 0) {\r\n          shipping_discount = Number(order.payment.shipping_fee_seller_discount) + Number(order.payment.shipping_fee_platform_discount) + Number(order.payment.shipping_fee_cofunded_discount);\r\n          shipping_paid_by_buyer = Number(order.payment.original_shipping_fee) - shipping_discount;\r\n        }\r\n        if (this.cqt_submit_invoice_with_shipping_fee && shipping_paid_by_buyer > 0) {\r\n          // Khi to chi tit ha n\r\n          let invoice_detail = this.billService.createEInvoiceDetailTemplate();\r\n\r\n          // Gn cc gi tr chung\r\n          invoice_detail.tchat = 1;\r\n          invoice_detail.stt_rec0 = invoice_details.length + 1;\r\n          invoice_detail.inv_itemCode = 'phi_van_chuyen';\r\n          invoice_detail.inv_itemName = 'Ph vn chuyn';\r\n          invoice_detail.inv_unitCode = 'Ln';\r\n          invoice_detail.inv_quantity = 1;\r\n          invoice_detail.inv_unitPrice = Number(order.payment.original_shipping_fee);\r\n          invoice_detail.inv_discountAmount = shipping_discount;\r\n          invoice_detail.inv_TotalAmountWithoutVat = shipping_paid_by_buyer;\r\n          invoice_detail.ma_thue = billTax;\r\n\r\n          /* ------ X l cqt_vat_ecommerce_already_Included ---------------------------------------------- */\r\n          if (this.cqt_vat_ecommerce_already_Included) {\r\n            // Tnh li gi\r\n            invoice_detail.inv_unitPrice = this.billService.calculateNewPriceToUseSettingTax(invoice_detail.inv_unitPrice, invoice_detail.inv_quantity, invoice_detail.inv_discountAmount, invoice_detail.ma_thue, platformTax);\r\n          }\r\n\r\n          // Tr gi (chit khu) tnh theo %\r\n          invoice_detail.inv_discountPercentage = invoice_detail.inv_discountAmount / (invoice_detail.inv_unitPrice * invoice_detail.inv_quantity) * 100;\r\n          // Gi cui ( tr tr gi) ca chi tit ha n\r\n          invoice_detail.inv_TotalAmountWithoutVat = invoice_detail.inv_unitPrice - invoice_detail.inv_discountAmount;\r\n          // Thu VAT c tnh theo chi tit ha n\r\n          invoice_detail.inv_vatAmount = invoice_detail.inv_TotalAmountWithoutVat * invoice_detail.ma_thue / 100;\r\n          // Tng gi tr hng ha k khai theo chi tit ha n\r\n          invoice_detail.inv_TotalAmount = invoice_detail.inv_TotalAmountWithoutVat + invoice_detail.inv_vatAmount;\r\n\r\n          // Thm vo mng\r\n          invoice_details = this.billService.addEInvoiceDetail(invoice_detail, invoice_details, { cqt_vat_ecommerce_separate_discount_line: this.cqt_vat_ecommerce_separate_discount_line });\r\n        }\r\n\r\n\r\n\r\n        /* ----------------------------------------------------------- X l voucher ca shopee ----------------------------------------------------------- */\r\n\r\n        //ecommerce_fee_paid_by_seller\r\n        // nu bt cqt_submit_invoice_with_ecommerce_fee true th mi gn\r\n        if (this.cqt_submit_invoice_with_ecommerce_fee) {\r\n          let orderStatementTransaction: any = null;\r\n\r\n          try {\r\n            orderStatementTransaction = await this.vhEcommerce.getOrderStatementTransactionsTiktok(\r\n              this.infoShop.shop_cipher,\r\n              this.infoShop.app_key,\r\n              this.infoShop.access_token.toString(),\r\n              order.id\r\n            );\r\n\r\n            console.log(orderStatementTransaction);\r\n            if (-Number(orderStatementTransaction.fee_and_tax_amount) > 0) {\r\n              // Khi to chi tit ha n\r\n              let invoice_detail = this.billService.createEInvoiceDetailTemplate();\r\n\r\n              // Gn cc gi tr chung\r\n              invoice_detail.tchat = 3;\r\n              invoice_detail.stt_rec0 = invoice_details.length + 1;\r\n              invoice_detail.inv_itemCode = 'chiet_khau_thuong_mai';\r\n              invoice_detail.inv_itemName = 'Chit khu thng mi';\r\n              invoice_detail.inv_unitCode = 'Phn';\r\n              invoice_detail.inv_quantity = 1;\r\n              invoice_detail.inv_unitPrice = -Number(orderStatementTransaction.fee_and_tax_amount) || 0; // fee_and_tax_amount l tng ph + thu m tiktok tr trn doanh thu ca n hng\r\n              invoice_detail.inv_TotalAmountWithoutVat = -Number(orderStatementTransaction.fee_and_tax_amount) || 0;\r\n              invoice_detail.ma_thue = 0; // Khng c thu cho chit khu thng mi\r\n\r\n              // Gi cui ( tr tr gi) ca chi tit ha n\r\n              invoice_detail.inv_TotalAmountWithoutVat = invoice_detail.inv_unitPrice - invoice_detail.inv_discountAmount;\r\n              // Thu VAT c tnh theo chi tit ha n\r\n              invoice_detail.inv_vatAmount = invoice_detail.inv_TotalAmountWithoutVat * invoice_detail.ma_thue / 100;\r\n              // Tng gi tr hng ha k khai theo chi tit ha n\r\n              invoice_detail.inv_TotalAmount = invoice_detail.inv_TotalAmountWithoutVat + invoice_detail.inv_vatAmount;\r\n\r\n              // Thm vo mng\r\n              invoice_details = this.billService.addEInvoiceDetail(invoice_detail, invoice_details, { cqt_vat_ecommerce_separate_discount_line: this.cqt_vat_ecommerce_separate_discount_line });\r\n            }\r\n          } catch (_) {\r\n            // B qua nu c li\r\n          }\r\n        }\r\n\r\n\r\n        /**---------------Tnh gi tr cn li cho ha n thu ------------------*/\r\n        for (let i = 0; i < invoice_details.length; i++) {\r\n          if (invoice_details[i].tchat == 1) {\r\n            // tchat 1 th cng dn\r\n            invoice.inv_discountAmount += invoice_details[i].inv_discountAmount;\r\n            invoice.inv_vatAmount += invoice_details[i].inv_vatAmount;\r\n            invoice.inv_TotalAmountWithoutVat += invoice_details[i].inv_TotalAmountWithoutVat;\r\n            invoice.inv_TotalAmount += invoice_details[i].inv_TotalAmount;\r\n          } else if (invoice_details[i].tchat == 2) {\r\n            // tchat 2 th b qua\r\n          } else if (invoice_details[i].tchat == 3) {\r\n            // tchat 3 th phi tr li\r\n            invoice.inv_discountAmount -= invoice_details[i].inv_discountAmount;\r\n            invoice.inv_vatAmount -= invoice_details[i].inv_vatAmount;\r\n            invoice.inv_TotalAmountWithoutVat -= invoice_details[i].inv_TotalAmountWithoutVat;\r\n            invoice.inv_TotalAmount -= invoice_details[i].inv_TotalAmount;\r\n          }\r\n        }\r\n        /**--------------- tr v d liu ------------------*/\r\n        //Ha n in t thu gm 2 phn ha n + chi tit ha n\r\n        let invoices = [{ ...invoice, details: [{ data: invoice_details }] }];\r\n        console.log('invoices', invoices);\r\n        resolve({ vcode: 0, msg: 'success', data: invoices });\r\n      } catch (err) {\r\n        console.error(' Li changeTiktok_toInvoice_byMinvoice:', err);\r\n        reject(err);\r\n      }\r\n\r\n    });\r\n  }\r\n\r\n\r\n\r\n\r\n  /** C hin th modal chnh sa customer tax hay khng */\r\n  isShowModalEditCustomerTax: boolean = false;\r\n  tempCustomerTax: any = null;\r\n  /**\r\n   * Khi nhn edit ct thng tin khch hng\r\n   */\r\n  editTax(invoice) {\r\n    this.tempCustomerTax = invoice;\r\n    this.isShowModalEditCustomerTax = true;\r\n  }\r\n\r\n\r\n\r\n  /**\r\n   * Khi ok trong modal chnh sa customer tax\r\n   * @param customerTaxInfo\r\n   */\r\n  onOkEditTax(customerTaxInfo) {\r\n    this.isShowModalEditCustomerTax = false;\r\n\r\n    Object.assign(this.tempCustomerTax, customerTaxInfo);\r\n  }\r\n\r\n  visible_affiliate: boolean = false; // Hin th modal chn sn phm lin kt\r\n  productTiktokSelected: any = null; // Sn phm tiktok  lien kt\r\n\r\n  openModelSelectProductsTiktok(productTiktok) {\r\n    this.productTiktokSelected = productTiktok;\r\n    this.visible_affiliate = true;\r\n  }\r\n\r\n  /**\r\n   * Tt modal v clone mng product ra mt mng mi  trnh nh li product c b checked\r\n   */\r\n  cancelAffiliate() {\r\n    this.visible_affiliate = false;\r\n  }\r\n\r\n  /**\r\n  * Kim tra sn phm  c lien kt hay cha\r\n  *\r\n  */\r\n  isLinkedToProduct(item): boolean {\r\n    for (let productOfBranch of this.listProductOfBranch) {\r\n      let findProduct = productOfBranch[this.id_branch].tiktoks.find(data => data.id === item.product_id);\r\n      if (findProduct) {\r\n        if (findProduct.skus && findProduct.skus.length) {\r\n          let indexSku = findProduct.skus.findIndex(sku => sku.id === item.sku_id);\r\n          if (indexSku >= 0) {\r\n            return true;\r\n          }\r\n        } else {\r\n          return true;\r\n        }\r\n      }\r\n    };\r\n    return false;\r\n  }\r\n\r\n  findProductLinked(item) {\r\n    for (let productOfBranch of this.listProductOfBranch) {\r\n      const tiktoks = productOfBranch[this.id_branch]?.tiktoks || [];\r\n\r\n      const found = tiktoks.find(data => {\r\n        if (data.id !== item.product_id) return false;\r\n\r\n        if (data.skus?.length) {\r\n          return data.skus.some(skus => skus.id === item.sku_id);\r\n        }\r\n\r\n        return data.skus?.length ? false : true;\r\n      });\r\n\r\n      if (found) {\r\n        return productOfBranch;\r\n      }\r\n    }\r\n\r\n    return null;\r\n  }\r\n\r\n  /**\r\n  * Lin kt sn phm t tiktok vi sn phm ti ca hng.\r\n  * @param product Sn phm ca ca hng\r\n  */\r\n  acceptAfiliate(product) {\r\n    const isZeroPriceCombo = product.type === VhType.COMBO && product.units[0].price === 0;\r\n    const confirmZeroPriceComboMessage = this.lang.translate(\"This product is a combo with a price of 0. Do you still want to link it with the product\", { platform: 'Tiktok' }) + \"?\";\r\n\r\n    this.modal.confirm({\r\n      nzTitle: '<i>' + (isZeroPriceCombo ? confirmZeroPriceComboMessage : this.lang.translate(\"Confirm\")) + '</i>',\r\n      nzIconType: \"info-circle\",\r\n      nzCancelText: this.lang.translate(\"Cancel\"),\r\n      nzOnOk: () => {\r\n        this.vhComponent.showLoading(\"\", \"transparent-loading\").then(() => {\r\n          // Tm sn phm tiktok\r\n          const currentProductTiktok = this.listProductTiktok.find(product =>\r\n            product.skus?.some(sku => sku.id === this.productTiktokSelected.sku_id)\r\n          );\r\n          const id_product_selected = product.id_subproduct ? product.id_subproduct : product['_id'];\r\n\r\n          let productTiktok = {\r\n            id: currentProductTiktok.id,\r\n            id_shop: this.infoShop._id,\r\n            SkuIds: [],\r\n          };\r\n\r\n          // Nu sn phm tiktok c model th thm vo mng\r\n          if (currentProductTiktok && currentProductTiktok.skus.length > 0) {\r\n            const sku = currentProductTiktok.skus.find(item => item.id == this.productTiktokSelected.sku_id);\r\n            productTiktok.SkuIds.push({ id: sku.id });\r\n          }\r\n\r\n          this.vhEcommerce.addMergeTiktokProduct_skus(this.vhQuerySales.getlocalDetailProduct(id_product_selected), productTiktok.id, productTiktok.SkuIds, this.infoShop['_id'], this.id_branch).then((bool) => {\r\n            this.vhComponent.hideLoading().then(() => {\r\n              setTimeout(() => {\r\n                this.visible_affiliate = false;\r\n                this.listProductOfBranch = this.vhQuerySales.getlocalDetailProducts(35).filter(e => !e.delete_hidden).filter(item => item[this.id_branch] && item[this.id_branch].tiktoks && item[this.id_branch].tiktoks.length >= 0);\r\n                this.vhComponent.alertMessageDesktop('success', this.lang.translate(\"Product linked successfully\"));\r\n              }, 300);\r\n            });\r\n          }).catch(err => {\r\n            console.error(err);\r\n            this.visible_affiliate = false;\r\n            this.vhComponent.alertMessageDesktop('error', this.lang.translate(\"The product link failed\"));\r\n            this.vhComponent.hideLoading(0);\r\n          });\r\n        });\r\n      }\r\n    });\r\n  }\r\n\r\n  /**Xa nhng sp  c lin kt ri ra khi mng ca modal danh sch sp lin kt\r\n   * @example this.clearProductShow(listProductTiktok, listProductApp)\r\n   */\r\n  clearProductShow(listProduct, listProductApp) {\r\n    for (let prodApp of listProductApp) {\r\n      if (prodApp[this.id_branch] && prodApp[this.id_branch].tiktoks && prodApp[this.id_branch].tiktoks.length) {\r\n        let arrayProdTiktok = prodApp[this.id_branch].tiktoks;\r\n        for (let item of arrayProdTiktok) {\r\n          let indexProd = listProduct.findIndex(prod => prod.id == item.id);\r\n          if (indexProd >= 0) {\r\n            if (listProduct[indexProd].skus && item.skus && item.skus.length) {\r\n              for (let skus of item.skus) {\r\n                let index = listProduct[indexProd].skus.findIndex(data => data.id == skus.id);\r\n                if (index >= 0) listProduct[indexProd].skus.splice(index, 1);\r\n              }\r\n              if (!listProduct[indexProd].skus.length) listProduct.splice(indexProd, 1);\r\n            } else listProduct.splice(indexProd, 1);\r\n          }\r\n        }\r\n      }\r\n    }\r\n    return listProduct;\r\n  }\r\n\r\n\r\n\r\n  /**\r\n   * m s lng bill ang check\r\n   */\r\n  get countSelectedBill(): number {\r\n    return this.salesOrder?.filter((e: any) => e.checked)?.filter((data: any) => !data.cqt_status || data.cqt_status == 1)?.length;\r\n  }\r\n\r\n\r\n\r\n  /**\r\n   * Ly ngy cp nht ca n hng theo nh dng 2025-06-25\r\n   */\r\n  getUpdateTimeFormat(order) {\r\n    return this.vhAlgorithm.formatDateToString(new Date(order.update_time * 1000));\r\n  }\r\n\r\n\r\n\r\n  /**\r\n   * Xut danh sch ang hin trn table ra file excel\r\n   */\r\n  exportExcel() {\r\n    if (!this.salesOrder || !this.salesOrder.length) return;\r\n  \r\n    // Lp qua danh sch ha n\r\n    const XLSXData = this.salesOrder.reduce((acc, order) => {\r\n      if (!order || !order.order_details || !order.order_details.length) return acc;\r\n  \r\n      // Mi item trong order_details s thnh 1 row\r\n      const rows = order.order_details.map(item => ({\r\n        'Order ID': order.id || '',\r\n        'Order Status': this.lang.translate(item.package_status) || '',\r\n        'Order Substatus': this.lang.translate(item.display_status) || '',\r\n        'Normal or Pre-order': item.sku_type?.toUpperCase() || '',\r\n        'SKU ID': item.sku_id || '',\r\n        'Seller SKU': item.seller_sku || '',\r\n        'Product Name': item.product_name || '',\r\n        'Variation': item.sku_name || '',\r\n        'Quantity': item.quantity,\r\n        'SKU Unit Original Price': item.original_price,\r\n        'SKU Subtotal Before Discount': item.original_price * item.quantity,\r\n        'SKU Platform Discount': item.platform_discount,\r\n        'SKU Seller Discount': item.seller_discount,\r\n        'SKU Subtotal After Discount': (item.original_price * item.quantity) - item.platform_discount - item.seller_discount,\r\n        'Shipping Fee After Discount': order.payment.original_shipping_fee - order.payment.shipping_fee_seller_discount - order.payment.shipping_fee_platform_discount,\r\n        'Original Shipping Fee': order.payment.original_shipping_fee,\r\n        'Shipping Fee Seller Discount': order.payment.shipping_fee_seller_discount,\r\n        'Shipping Fee Platform Discount': order.payment.shipping_fee_platform_discount,\r\n        'Taxes': order.payment.tax,\r\n        'Order Amount': order.payment.total_amount,\r\n        'Created Time': this.datePipe.transform(new Date(order.create_at), 'dd/MM/yyyy HH:mm:ss') || '',\r\n        'Paid Time': order.paid_time ? this.datePipe.transform(new Date(order.paid_time * 1000), 'dd/MM/yyyy HH:mm:ss') : '',\r\n        'RTS Time': item.rts_time ? this.datePipe.transform(new Date(item.rts_time * 1000), 'dd/MM/yyyy HH:mm:ss') : '',\r\n        'Delivered Time': order.delivery_time ? this.datePipe.transform(new Date(order.delivery_time * 1000), 'dd/MM/yyyy HH:mm:ss') : '',\r\n        'Cancelled Time': order.cancel_time ? this.datePipe.transform(new Date(order.cancel_time * 1000), 'dd/MM/yyyy HH:mm:ss') : '',\r\n        'Cancel By': item.cancel_user,\r\n        'Cancel Reason': order.cancel_reason,\r\n        'Fulfillment Type': order.fulfillment_type,\r\n        'Tracking ID': item.tracking_number,\r\n        'Delivery Option': order.delivery_option_name,\r\n        'Shipping Provider Name': item.shipping_provider_name,\r\n        'Buyer Message': order.buyer_message,\r\n        'Recipient': order.recipient_address.name,\r\n        'Phone #': order.recipient_address.phone_number,\r\n        'Country': order.recipient_address.district_info.find(info => info.address_level_name === 'Country')?.address_name,\r\n        'Province': order.recipient_address.district_info.find(info => info.address_level_name === 'city' || info.address_level_name === 'province')?.address_name,\r\n        'District': order.recipient_address.district_info.find(info => info.address_level_name === 'district')?.address_name,\r\n        'Detail Address': order.recipient_address.address_detail,\r\n        'Payment Method': order.payment_method_name,\r\n        'Package ID': order.packages[0].id,\r\n        'Seller Note': order.seller_note,\r\n        'Checked Status': order.checked ? 'Checked' : 'Unchecked',\r\n      }));\r\n  \r\n      return acc.concat(rows);\r\n    }, []);\r\n\r\n    // Hng sub di title\r\n    XLSXData.unshift({\r\n      'Order ID': 'Platform unique order ID.',\r\n      'Order Status': 'Current order status.',\r\n      'Order Substatus': '',\r\n      'Normal or Pre-order': '',\r\n      'SKU ID': 'Platform SKU ID.',\r\n      'Seller SKU': 'Seller sku input by the seller in the product system.',\r\n      'Product Name': 'Platform product name.',\r\n      'Variation': 'Platform SKU variation',\r\n      'Quantity': 'SKU sold quantity in the order.',\r\n      'SKU Unit Original Price': '1 SKU original price.',\r\n      'SKU Subtotal Before Discount': 'It equals to SKU Unit Original Price * Sku Quantity.',\r\n      'SKU Platform Discount': 'Total platform discount in this SKU ID.',\r\n      'SKU Seller Discount': 'Total seller discount in this SKU ID.',\r\n      'SKU Subtotal After Discount': 'It equals SKU Subtotal Before Discount - SKU Platform Discount - SKU Seller Discount.',\r\n      'Shipping Fee After Discount': 'It equals to Original Shipping Fee - Shipping Fee Seller Discount - Shipping Fee Platform Discount.',\r\n      'Original Shipping Fee': \"The order's original shipping fee.\",\r\n      'Shipping Fee Seller Discount': \"The order's shipping fee discount from the seller.\",\r\n      'Shipping Fee Platform Discount': \"The order's  shipping fee discount from the platform.\",\r\n      'Taxes': '',\r\n      'Order Amount': 'Order total amount paid by the buyer.',\r\n      'Created Time': 'Order created time.',\r\n      'Paid Time': 'Order paid time.',\r\n      'RTS Time': \"The time when the seller clicks 'arrange shipment'.\",\r\n      'Delivered Time': 'The time when the order status changes to Delivered.',\r\n      'Cancelled Time': 'The time when the order status changes to Cancelled.',\r\n      'Cancel By': 'The order is cancelled by whom.',\r\n      'Cancel Reason': \"The order cancel reason.\",\r\n      'Fulfillment Type': '',\r\n      'Tracking ID': \"The order's tracking number.\",\r\n      'Delivery Option': \"The order's delivery option.\",\r\n      'Shipping Provider Name': \"The order's shipping provider name.\",\r\n      'Buyer Message': '',\r\n      'Recipient': '',\r\n      'Phone #': '',\r\n      'Country': '',\r\n      'Province': '',\r\n      'District': '',\r\n      'Detail Address': '',\r\n      'Payment Method': \"The order's payment method.\",\r\n      'Package ID': \"The order's Package ID\",\r\n      'Seller Note': '',\r\n      'Checked Status': '',\r\n    });\r\n  \r\n    // X l tn file, s c dng Order.{status}.{startDate}_{endDate}.xlsx\r\n    const statusName = this.vhAlgorithm.changeAlias(this.list_status_bill[this.selectedIndex]?.name?.toLowerCase().replace(/ /g, '') || 'all');\r\n    const startDate = this.vhAlgorithm.formatDateToString(this.date[0]).replace(/-/g, '');\r\n    const endDate = this.vhAlgorithm.formatDateToString(this.date[1]).replace(/-/g, '');\r\n    const nameFile = `Order.${statusName}.${startDate}_${endDate}`;\r\n\r\n    this.vhAlgorithm.exportXLSX(XLSXData, nameFile).then(() => {\r\n      console.log('Xut file Excel thnh cng:', nameFile);\r\n    }).catch(err => {\r\n      console.error('Li xut file Excel:', err);\r\n    });\r\n  }\r\n\r\n}\r\n","<div nz-row class=\"row-back medium-size\" (click)=\"goBack()\">\r\n    <i nz-icon nzType=\"left\" nzTheme=\"outline\"></i>{{'Back' | translate}}\r\n</div>\r\n<nz-layout id=\"order-status-tiki\">\r\n    <div nz-row nzGutter=\"4\" class=\"order-status-tiki-header\">\r\n        <!-- Tiu  -->\r\n        <div nz-col nzSpan=\"8\" class=\"title\">\r\n            <b>{{'Xut ha n in t t sn'|translate}}</b>\r\n            <br>\r\n            {{'Shop name' | translate}}: <b class=\"color-green\">{{infoShop.data?.name}}</b>\r\n        </div>\r\n        <!-- Tm kim -->\r\n        <div nz-col nzSpan=\"6\" class=\"title center-all-content\">\r\n            <nz-input-group [nzSuffix]=\"suffixIconSearch\">\r\n                <input [(ngModel)]=\"searchValue\" (ngModelChange)=\"search($event)\" type=\"text\" nz-input\r\n                    [placeholder]=\"'Tm m n hng (phn tch bi du phy)' | translate\" />\r\n            </nz-input-group>\r\n            <ng-template #suffixIconSearch>\r\n                <i nz-icon nzType=\"search\"></i>\r\n            </ng-template>\r\n        </div>\r\n        <!-- Chn ngy -->\r\n        <div nz-col nzSpan=\"6\">\r\n            <nz-range-picker nzFormat='dd/MM/yyyy' [nzDisabledDate]=\"disabledDate\" nzFormat=\"dd/MM/yyyy\"\r\n                [(ngModel)]=\"date\" (ngModelChange)=\"changeTime($event)\">\r\n            </nz-range-picker>\r\n        </div>\r\n        <!-- Nt xem bo co v gi CQT -->\r\n        <div nz-col nzSpan=\"4\" class=\"right-all-content\">\r\n            <button class=\"btn-view center-all-content\" nz-button nzType=\"default\" (click)=\"showReport()\">\r\n                <ion-icon src=\"assets/icon/management/view.svg\"></ion-icon>\r\n                {{'View' | translate}}\r\n            </button>\r\n            <button class=\"btn-view center-all-content\" nz-button nzType=\"default\" (click)=\"sendCQT()\">\r\n                {{'Gi CQT' | translate}}\r\n            </button>\r\n            <button class=\"btn-view center-all-content\" nz-button nzType=\"default\" (click)=\"exportExcel()\">\r\n                {{'Xut Excel' | translate}}\r\n            </button>\r\n        </div>\r\n    </div>\r\n    \r\n    <div *ngIf=\"load_status else no_data\" nz-row nzGutter=\"16\" class=\"order-status-tiki-body\">\r\n        <div nz-col nzSpan=\"24\">\r\n            <nz-tabset [(nzSelectedIndex)]=\"selectedIndex\" (nzSelectChange)=\"segmentChanged($event.index)\">\r\n                <nz-tab *ngFor=\"let item of list_status_bill\" nzTitle=\"{{item.name | translate}} ({{orderCountByStatus[item.name]}})\">\r\n                </nz-tab>\r\n            </nz-tabset>\r\n\r\n            <nz-table *ngIf=\"salesOrder.length > 0;else no_bill\" [nzScroll]=\"{y: heightScroll }\" #salesOrder_show\r\n                nzShowPagination nzShowSizeChanger [nzData]=\"salesOrder\" [nzPageSize]=\"20\"\r\n                [nzPageSizeOptions]=\"[20, 30, 40, 50, 100, 200]\">\r\n                <thead>\r\n                    <tr>\r\n                        <th nzAlign=\"center\" nzWidth=\"6%\"><b>{{'No.' | translate}}</b></th>\r\n                        <th nzLeft nzWidth=\"10%\" (click)=\"dateCol = !dateCol; sortTable('date')\">\r\n                            <b>{{'Date order' | translate}}</b>\r\n                            <i nz-icon [nzType]=\"dateCol == true ? 'caret-down' : 'caret-up'\" nzTheme=\"outline\"></i>\r\n                        </th>\r\n                        <th nzLeft nzWidth=\"15%\"><b>{{'Order number' | translate}}</b></th>\r\n\r\n                        <th nzWidth=\"25%\"><b>{{'Product' | translate}}</b></th>\r\n                        <th nzWidth=\"15%\">\r\n                            <b>{{'Status on Tiktok' | translate}}</b>\r\n                             \r\n                        </th>\r\n                        <th  (click)=\"statusCol = !statusCol; sortTable('status')\"><b>{{'Status CQT' | translate}}</b>\r\n                         <i nz-icon [nzType]=\"statusCol == true ? 'caret-down' : 'caret-up'\" nzTheme=\"outline\"></i></th>\r\n                        <th style=\"text-align: right;\" nzWidth=\"17%\"><b>{{\"Total\"| translate}}</b></th>\r\n\r\n                        <th nzAlign=\"center\" [(nzChecked)]=\"allChecked\" [nzIndeterminate]=\"indeterminate\"\r\n                            (nzCheckedChange)=\"checkAll($event)\">\r\n                            ({{countSelectedBill}})\r\n                        </th>\r\n                    </tr>\r\n                </thead>\r\n                <tbody>\r\n                    <tr *ngFor=\"let bill of salesOrder_show.data,index as i\" style=\"cursor: pointer;\"\r\n                        (click)=\"gotoDetail(bill)\">\r\n                        <td nzAlign=\"center\">{{(salesOrder_show.nzPageIndex - 1) * salesOrder_show.nzPageSize + i + 1}}</td>\r\n                        <td nzLeft>\r\n                            {{bill.create_at | date : \"dd/MM/yyyy HH:mm\"}}</td>\r\n                        <td nzLeft>\r\n                            <a target=\"_blank\"\r\n                                href=\"https://seller-vn.tiktok.com/order/detail?order_no={{bill.id}}&shop_region=VN\">\r\n                                {{bill.id}} </a>\r\n                            <i (click)=\"$event.stopPropagation();vhComponent.copyValue(bill.id)\" nz-icon nzType=\"copy\"\r\n                                nzTheme=\"outline\"></i>\r\n                        </td>\r\n\r\n                        <td nzWidth=\"25%\">\r\n                            <span style=\"font-size: 0.8rem;\"\r\n                                [style.color]=\"isLinkedToProduct(item) ? '' : 'var(--ion-color-vh-red)'\"\r\n                                *ngFor=\"let item of bill.order_details\">\r\n                                {{isLinkedToProduct(item) ? findProductLinked(item).name : item.product_name + ' - ' +\r\n                                item.sku_name}} (SL :{{item.quantity}})\r\n                                <i *ngIf=\"!isLinkedToProduct(item)\"\r\n                                    (click)=\"$event.stopPropagation();openModelSelectProductsTiktok(item)\"\r\n                                    class=\"icon-link green\" nz-icon nzType=\"link\" nzTheme=\"outline\"></i>\r\n                                <br>\r\n                            </span>\r\n                        </td>\r\n                        <td>\r\n                            <span nz-tooltip [nzTooltipTitle]=\"getUpdateTimeFormat(bill)\">{{bill.status | translate}}</span>\r\n                            <!-- <div class=\"left-all-content\"\r\n                                *ngIf=\"bill.order_status =='READY_TO_SHIP' && bill.package_list[0]?.logistics_status !='LOGISTICS_NOT_START'\">\r\n                                <button class=\"btn-confirm\" nz-button\r\n                                    (click)=\"$event.stopPropagation();updateStatusComfirm(bill)\">\r\n                                    {{'To gi hng'}}</button>\r\n                            </div> -->\r\n                        </td>\r\n                        <td>\r\n                            <span *ngIf=\"bill.cqt_status == 3\">{{'Sent to CQT' | translate}} <span nz-tooltip [nzTooltipTitle]=\"'View E-invoice' | translate\" nz-icon class=\"ant-input-password-icon\" [nzType]=\"'eye'\" (click)=\"$event.stopPropagation(); printService.viewEInvoice(infoBranch, {_id: bill.id})\"></span></span>\r\n                            <span *ngIf=\"bill.cqt_status == 2\">{{'Waiting for signature' | translate}} <span nz-tooltip [nzTooltipTitle]=\"'View E-invoice' | translate\" nz-icon class=\"ant-input-password-icon\" [nzType]=\"'eye'\" (click)=\"$event.stopPropagation(); printService.viewEInvoice(infoBranch, {_id: bill.id})\"></span></span>\r\n                            <span *ngIf=\"!bill.cqt_status || bill.cqt_status == 1\">{{'Not sent to CQT' | translate}}</span>\r\n                        </td>\r\n                        <td style=\"text-align: right;\"><b>{{vhAlgorithm.vhcurrencyunit(bill.payment.total_amount)}}</b>\r\n                        </td>\r\n\r\n                        <td nzAlign=\"center\" (click)=\"$event.stopPropagation();\">\r\n                            <!-- Sa -->\r\n\r\n                            <i (click)=\"editTax(bill)\" class=\"cus-icon\" nz-icon nzType=\"info-circle\" nzTheme=\"outline\"\r\n                                style=\"cursor: pointer;margin-right: 10px;\"></i>\r\n                            <label *ngIf=\"bill.cqt_status == 1 || !bill.cqt_status\" [(ngModel)]=\"bill.checked\"\r\n                                (ngModelChange)=\" refreshStatus()\" nz-button nz-checkbox>\r\n                            </label>\r\n                        </td>\r\n                    </tr>\r\n                </tbody>\r\n            </nz-table>\r\n            <ng-template #no_bill class=\"full-height\">\r\n                <div nz-col nzSpan=\"24\" class=\"center-all-content\">\r\n                    <div>{{'No data'| translate}}</div>\r\n                </div>\r\n            </ng-template>\r\n        </div>\r\n    </div>\r\n    <ng-template #no_data>\r\n        <div nz-row class=\"no-affiliate\">\r\n            <div nz-col nzSpan=\"24\" class=\"text-center\">\r\n                <img src=\"assets/icon/management/ecommerce/no-data-orderstatus.svg\" alt=\"\">\r\n                <p>{{\"Please click the view button\"|\r\n                    translate}}</p>\r\n            </div>\r\n        </div>\r\n    </ng-template>\r\n\r\n</nz-layout>\r\n\r\n\r\n<!-- -------------------------------------------- MODAL CHNH SA THNG TIN THU KHCH HNG -------------------------------------------- -->\r\n<app-edit-customer-tax *ngIf=\"isShowModalEditCustomerTax\" ecommerce_platform=\"tiktok\" [invoice]=\"tempCustomerTax\" [infoShop]=\"infoShop\"\r\n    (onClose)=\"isShowModalEditCustomerTax = false\" (onOk)=\"isShowModalEditCustomerTax = false; onOkEditTax($event)\">\r\n</app-edit-customer-tax>\r\n\r\n<!-- --------------modal chn sn phm lin kt--------------- -->\r\n<app-modal-link-product-ecommerce [title]=\"'Select Tiktok linked products' | translate\"\r\n    [visible_affiliate]=\"visible_affiliate\" [listProductApp]=\"listProductApp\"\r\n    [searchProductAppValue]=\"searchProductAppValue\" (cancelAffiliate)=\"cancelAffiliate()\"\r\n    (searchProductApp)=\"searchProductApp($event)\"\r\n    (acceptAfiliate)=\"acceptAfiliate($event)\"></app-modal-link-product-ecommerce>","\r\nimport { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { RouterModule, Routes } from '@angular/router';\r\nimport { NgZorroAntModule } from 'src/app/ng-zorro-ant.module';\r\nimport { TranslateModule } from '@ngx-translate/core';\r\nimport { IonicModule } from '@ionic/angular';\r\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\r\nimport { ModalLinkProductEcommerceModule } from 'src/app/sales/menu/manage/ecommerce/components/modal-link-product-ecommerce/modal-link-product-ecommerce.module';\r\n\r\nconst routes: Routes = [\r\n  {\r\n    path: \"\",\r\n    component: EInvoiceTiktokComponent\r\n  },\r\n]\r\nimport { EInvoiceTiktokComponent } from './e-invoice-tiktok.component';\r\nimport { EditCustomerTaxModule } from 'src/app/sales/menu/manage/ecommerce/components/edit-customer-tax/edit-customer-tax.module';\r\n\r\n\r\n\r\n@NgModule({\r\n  declarations: [\r\n    EInvoiceTiktokComponent\r\n  ],\r\n  imports: [\r\n    CommonModule,\r\n    RouterModule.forChild(routes),\r\n    NgZorroAntModule,\r\n    TranslateModule,\r\n    IonicModule,\r\n    FormsModule,\r\n    ReactiveFormsModule,\r\n    ModalLinkProductEcommerceModule,\r\n    EditCustomerTaxModule\r\n  ]\r\n})\r\nexport class EInvoiceTiktokModule { }\r\n"],"names":["VhType","i0","$event","ctx_r25","_id","ctx_r28","ctx_r38","ctx_r41","ctx_r43","ctx_r7","_r8","ctx_r51","ctx_r5","EInvoiceTiktokComponent","constructor","router","lang","vhComponent","vhAlgorithm","vhQuerySales","cdRef","modal","vhAuth","vhEcommerce","vhEinvoice","vhQuery","billService","printService","datePipe","name","value","Date","current","getTime","getStore","registrationdate","getDefaultBranch","getlocalBranch","getLocalAppSettingNameBranch","cqt_submit_invoice_with_shipping_fee","cqt_submit_invoice_with_ecommerce_fee","cqt_vat_ecommerce_already_Included","cqt_vat_ecommerce_rate","cqt_invoice_auto_sign","cqt_vat_ecommerce_by_linked_product","cqt_vat_ecommerce_allow_promotional_items_zero_price","cqt_vat_ecommerce_separate_discount_line","cqt_vat_ecommerce_keep_promotional_items_as_sold","cqt_vat_ecommerce_use_latest_order_update_time","cqt_vat_ecommerce_buyer_info_with_platform_and_so_benh_an","cqt_vat_ecommerce_default_payment_method_chuyen_khoan","cqt_vat_ecommerce_item_code_is_barcode","cqt_vat_ecommerce_item_price_is_discounted","dataRestore","getCurrentNavigation","extras","state","_a","ngOnInit","searchValue","salesOrder","salesSubOrder","countOrderByStatus","load_status","selectedIndex","date","segmentChanged","infoShop","getlocalShopListTiktok","listProductOfBranch","getlocalDetailProducts","filter","e","delete_hidden","item","id_branch","tiktoks","length","localProducts","listProductApp","map","unit","getUnit_byRatio","units","product_tiktoks","prod","id_shop","listSubProductApp","listProductTiktok","clearProductShow","getlocalProductListTiktok","status","changeTime","event","showToast","translate","search","valArray","split","val","changeAlias","toString","trim","toLowerCase","some","id","_b","includes","searchProductApp","searchList","selectedStatus","list_status_bill","cancel_reason","orders","key","orderCountByStatus","order","goBack","navigate","showReport","showLoading","then","getSalesOrderListTiktok","setHours","shop_cipher","app_key","access_token","result","hideLoading","processOrders","console","log","error","catch","err","calculateTotal","bill","ngAfterViewChecked","document","querySelector","heightScroll","clientHeight","getElementById","widthScroll","clientWidth","detectChanges","gotoDetail","lineItemMap","line_items","forEach","product_id","sku_id","sale_price","price","Number","Object","quantity","total_price","cqt_status","checked","create_at","create_time","order_details","values","sortTable","colName","dateCol","sortDatebyASC","sortDatebyDESC","statusCol","sortNumberbyASC","sortNumberbyDESC","checkAll","data","disabled","refreshStatus","validData","allChecked","every","allUnChecked","indeterminate","sendCQT","bill_checked","alertMessageDesktop","sort","a","b","update_time","batchSize","totalBatches","Math","ceil","showLoadingNotDuration","i","batch","slice","currentBatchIndex","floor","promises","signatureManual","results","asyncPromiseAll","invoice","Promise","resolve","reject","currentBranch","einvoices","invoice_provider","invoiceSeries","isLoading","changeTiktok_toInvoice_byMinvoice","rsp","vcode","saveInvoice_Sign_byMinvoice","taxcode","token","res","code","updateSalesOrderTiktok_byFile","array","message","saveInvoice_noSign_byMinvoice","undefined","seller_discount","platform_discount","j","original_price","inv_invoiceSeries","inv_invoiceIssuedDate","formatDateToString","inv_currencyCode","inv_exchangeRate","inv_discountAmount","inv_vatAmount","inv_TotalAmountWithoutVat","inv_TotalAmount","key_api","so_benh_an","buyerDisplayNameDefault","inv_paymentMethodName","payment_method_name","inv_buyerDisplayName","tax_buyerDisplayName","inv_buyerLegalName","tax_buyerLegalName","inv_buyerTaxCode","tax_buyerTaxCode","inv_buyerAddressLine","tax_buyerAddressLine","inv_buyerEmail","tax_buyerEmail","platformTax","payment","tax","billTax","invoice_details","Array","productLinked","findProductLinked","invoice_detail","createEInvoiceDetailTemplate","unitPrice","totalAmountWithoutVat","tchat","invoiceDetailTax","stt_rec0","inv_itemCode","inv_unitCode","inv_quantity","inv_unitPrice","ma_thue","inv_itemName","product_name","calculateNewPriceToUseSettingTax","inv_discountPercentage","type","PRODUCT","barcode","id_subproduct","addEInvoiceDetail","COMBO","priceCombo","errorZeroPriceComboMessage","combos","combo","combo_detail","percentRate","tchatCombo","detailproduct","getlocalDetailProduct","id_product","invoiceDetailComboTax","ratio","roundTo4Decimal","shipping_paid_by_buyer","shipping_discount","original_shipping_fee","shipping_fee_seller_discount","shipping_fee_platform_discount","shipping_fee_cofunded_discount","orderStatementTransaction","getOrderStatementTransactionsTiktok","fee_and_tax_amount","_","invoices","details","msg","editTax","tempCustomerTax","isShowModalEditCustomerTax","onOkEditTax","customerTaxInfo","assign","openModelSelectProductsTiktok","productTiktok","productTiktokSelected","visible_affiliate","cancelAffiliate","isLinkedToProduct","productOfBranch","findProduct","find","skus","indexSku","findIndex","sku","found","acceptAfiliate","product","isZeroPriceCombo","confirmZeroPriceComboMessage","platform","confirm","nzTitle","nzIconType","nzCancelText","nzOnOk","currentProductTiktok","id_product_selected","SkuIds","push","addMergeTiktokProduct_skus","bool","setTimeout","listProduct","prodApp","arrayProdTiktok","indexProd","index","splice","countSelectedBill","_c","getUpdateTimeFormat","exportExcel","XLSXData","reduce","acc","rows","package_status","display_status","sku_type","toUpperCase","seller_sku","sku_name","total_amount","transform","paid_time","rts_time","delivery_time","cancel_time","cancel_user","fulfillment_type","tracking_number","delivery_option_name","shipping_provider_name","buyer_message","recipient_address","phone_number","district_info","info","address_level_name","address_name","_d","address_detail","packages","seller_note","concat","unshift","statusName","replace","startDate","endDate","nameFile","exportXLSX","selectors","decls","vars","consts","template","ctx","_r3"],"sourceRoot":"webpack:///"}